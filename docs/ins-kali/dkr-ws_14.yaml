- en: 14\. Collecting Container Logs
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 14. 收集容器日志
- en: Overview
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 概述
- en: In the previous chapter, we made sure we were collecting metrics data for our
    running Docker containers and services. This chapter builds on this and dedicates
    itself to collecting and monitoring the logs for Docker containers and the applications
    running on them. It will start with a discussion of why we need to have a clear
    log monitoring strategy for our development projects and discuss some of the things
    we need to remember. We will then introduce the main player in our log monitoring
    strategy – that is, Splunk – to collect, visualize, and monitor our logs. We'll
    install Splunk, forward log data from our system and running containers, and use
    the Splunk query language to set up monitoring dashboards that work with the log
    data we've collected. By the end of this chapter, you will have the skills to
    set up a centralized log monitoring service for your Docker container project.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们确保为我们运行的Docker容器和服务收集了指标数据。本章将在此基础上，致力于收集和监控Docker容器和其中运行的应用程序的日志。它将从讨论为什么我们需要为我们的开发项目建立清晰的日志监控策略开始，并讨论我们需要记住的一些事情。然后，我们将介绍我们日志监控策略中的主要角色
    - 即Splunk - 以收集、可视化和监控我们的日志。我们将安装Splunk，从我们的系统和运行的容器中转发日志数据，并使用Splunk查询语言设置与我们收集的日志数据配合工作的监控仪表板。通过本章的学习，您将具备为您的Docker容器项目建立集中式日志监控服务的技能。
- en: Introduction
  id: totrans-3
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: Whenever something goes wrong with our running applications or service, the
    first thing we usually look for in our application logs is a clue as to what is
    causing the issue. So, it becomes important to understand how you'll be collecting
    logs and monitoring log events for your project.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 每当我们的运行应用程序或服务出现问题时，我们通常首先在应用程序日志中寻找线索，以了解问题的原因。因此，了解如何收集日志并监控项目的日志事件变得非常重要。
- en: As we implement a microservice architecture with Docker, it becomes more important
    to ensure we are able to see the logs our applications and containers are generating.
    As the number of containers and services grows, trying to access each running
    container individually becomes increasingly unwieldy as a means of troubleshooting
    any issues that arise. For scalable applications, where they scale up and down
    depending on demand, it may become increasingly difficult to track log errors
    across multiple containers.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 随着我们实施基于Docker的微服务架构，确保我们能够查看应用程序和容器生成的日志变得更加重要。随着容器和服务数量的增加，尝试单独访问每个运行的容器作为故障排除的手段变得越来越不方便。对于可伸缩的应用程序，根据需求进行伸缩，跨多个容器跟踪日志错误可能变得越来越困难。
- en: Ensuring we have a proper log monitoring strategy in place will help us troubleshoot
    our applications and ensure our services are running at their optimum efficiency.
    It will also help us to lessen the amount of time we spend searching through our
    logs.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 确保我们有一个合适的日志监控策略将有助于我们排除应用程序故障，并确保我们的服务以最佳效率运行。这也将帮助我们减少在日志中搜索所花费的时间。
- en: 'There are a few things you will need to consider when building a log monitoring
    strategy for your project:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在为您的项目构建日志监控策略时，有一些事情您需要考虑：
- en: Your application will be using a framework to handle logs. Sometimes, this can
    cause an overhead on the container, so make sure you are testing your containers
    to ensure they are able to run without any issues with this logging framework.
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您的应用程序将使用一个框架来处理日志。有时，这可能会对容器造成负担，因此请确保测试您的容器，以确保它们能够在不出现与此日志框架相关的任何问题的情况下运行。
- en: Containers are transient, so the logs will be lost each time the container is
    shut down. You must either forward the logs to a logging service or store the
    logs in a data volume to make sure you can troubleshoot any issues that may arise.
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 容器是瞬时的，因此每次关闭容器时日志都会丢失。您必须将日志转发到日志服务或将日志存储在数据卷中，以确保您可以解决可能出现的任何问题。
- en: Docker contains a logging driver that's used to forward log events to a Syslog
    instance running on the host. Unless you are using the Enterprise version of Docker,
    the `log` command will not work (though it will for JSON) if you are using a specific
    logging driver.
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Docker包含一个日志驱动程序，用于将日志事件转发到主机上运行的Syslog实例。除非您使用Docker的企业版，否则如果您使用特定的日志驱动程序，`log`命令将无法使用（尽管对于JSON格式的日志可以使用）。
- en: Log aggregation applications will usually charge you for the amount of data
    they are ingesting in their service. And, if you have a service deployed on your
    environment, you will also need to think about storage requirements – especially
    how long you plan to keep your logs.
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 日志聚合应用通常会根据其所摄取的数据量向您收费。而且，如果您在环境中部署了一个服务，您还需要考虑存储需求，特别是您计划保留日志的时间有多长。
- en: You will need to consider how your development environment will operate compared
    to your production environment. For example, there is no need to keep logs in
    your development environment for a long period, but production may have a requirement
    for you to keep them for a while.
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您需要考虑您的开发环境与生产环境的运行方式。例如，在开发环境中没有必要长时间保留日志，但生产环境可能要求您保留一段时间。
- en: You may not just need application data. You may need to collect logs for your
    application, the container the application is running on, and the underlying host
    and operating system on which both the application and the container are running.
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可能不仅需要应用程序数据。您可能需要收集应用程序的日志，应用程序运行的容器以及应用程序和容器都在运行的基础主机和操作系统的日志。
- en: There are many applications we could use as part of our log monitoring strategy,
    including Splunk, Sumo Logic, Nagios Logs, Data Dog, and Elasticsearch. In this
    chapter, we have decided to use Splunk as our log monitoring application. It is
    one of the oldest applications and has a large community of support and documentation.
    It is also the best when it comes to working with data and creating visualizations.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以在日志监控策略中使用许多应用程序，包括Splunk、Sumo Logic、Nagios Logs、Data Dog和Elasticsearch。在本章中，我们决定使用Splunk作为我们的日志监控应用程序。它是最古老的应用程序之一，拥有庞大的支持和文档社区。在处理数据和创建可视化方面也是最好的。
- en: You'll see in the following sections how easy it is to get the application up,
    running, and configured so that you can start monitoring your system logs and
    our container applications.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的章节中，您将看到如何轻松地启动、运行和配置应用程序，以便开始监控系统日志和我们的容器应用程序。
- en: Introducing Splunk
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍Splunk
- en: Long before Docker's rise in popularity, Splunk was established in 2003 to help
    companies discover some patterns and information from the bulk of data provided
    by the growing number of applications and services in their environments. Splunk
    is a software application that allows you to gather your logs and data from your
    applications and hardware systems. It then lets you analyze and visualize the
    data you have collected, usually in one central location.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在Docker的普及之前很久，Splunk于2003年成立，旨在帮助公司从不断增长的应用和服务提供的大量数据中发现一些模式和信息。Splunk是一款软件应用，允许您从应用程序和硬件系统中收集日志和数据。然后，它让您分析和可视化您收集的数据，通常在一个中央位置。
- en: Splunk allows you to enter your data in different formats, and in a lot of situations,
    Splunk will be able to recognize the data format it is in. You can then use this
    data to help troubleshoot your applications, create monitoring dashboards, and
    create alerts on specific events when they occur.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: Splunk允许您以不同的格式输入数据，在许多情况下，Splunk将能够识别数据所在的格式。然后，您可以使用这些数据来帮助排除应用程序故障，创建监控仪表板，并在特定事件发生时创建警报。
- en: Note
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: In this chapter, we'll only be touching the surface of what Splunk can do, but
    if you're interested, there are a lot of valuable resources that will show you
    how to gain operational intelligence from your data, and even use Splunk to create
    machine learning and predictive intelligence models.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们只会触及Splunk的一部分功能，但如果您感兴趣，有许多宝贵的资源可以向您展示如何从数据中获得运营智能，甚至使用Splunk创建机器学习和预测智能模型。
- en: Splunk provides a number of different products to suit your needs, including
    Splunk Cloud for users and companies wanting to opt for a cloud log monitoring
    solution.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: Splunk提供了许多不同的产品来满足您的需求，包括Splunk Cloud，适用于希望选择云日志监控解决方案的用户和公司。
- en: For our log monitoring strategy, we will be using Splunk Enterprise. It is easy
    to install and comes with a large number of features. When using Splunk, you might
    already know that license costs are charged by the amount of log data you send
    to Splunk, which is then indexed. Splunk Enterprise allows you to index up to
    500 MB of data per day for free on a trial basis. After 60 days, you can either
    upgrade your license or continue to work on a free license, which will continue
    to allow you to log 500 MB of data per day. There is a developer license available
    to users, which can be applied for and allows users to log 10 GB of data per day.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 对于我们的日志监控策略，我们将使用Splunk Enterprise。它易于安装，并带有大量功能。在使用Splunk时，您可能已经知道许可成本是按您发送到Splunk的日志数据量收费，然后对其进行索引。Splunk
    Enterprise允许您在试用期内每天索引高达500 MB的数据。60天后，您可以选择升级许可证，或者继续使用免费许可证，该许可证将继续允许您每天记录500
    MB的数据。用户可以申请开发者许可证，该许可证允许用户每天记录10 GB的数据。
- en: To get started with Splunk, we first need to understand its basic architecture.
    This will be discussed in the following section.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始使用Splunk，我们首先需要了解其基本架构。这将在下一节中讨论。
- en: Basic Architecture of Splunk Installation
  id: totrans-24
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Splunk安装的基本架构
- en: 'By discussing the architecture of Splunk, you will get an idea of how each
    part works and familiarize yourself with some of the terms that we will be using
    in this chapter:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 通过讨论Splunk的架构，您将了解每个部分的工作原理，并熟悉我们在本章中将使用的一些术语：
- en: '**Indexers**: For larger Splunk installations, it is recommended that you have
    dedicated and replicated indexers set up as part of your environment. The role
    of the indexer is to index your date – that is, organize the log data you have
    sent to Splunk. It also adds metadata and extra information to help speed up the
    searching process. The indexers will then store your log data, which is ready
    to be used and queried upon by the search head.'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**索引器**：对于较大的Splunk安装，建议您设置专用和复制的索引器作为环境的一部分。索引器的作用是索引您的数据 - 也就是说，组织您发送到Splunk的日志数据。它还添加元数据和额外信息，以帮助加快搜索过程。然后索引器将存储您的日志数据，这些数据已准备好供搜索头使用和查询。'
- en: '**Search head**: This is the main web interface where you perform search queries
    and administer your Splunk installation. The search head will connect with the
    indexers to query data that has been collected and stored on them. In larger installations,
    you may even have numerous search heads to allow a larger number of queries and
    reporting to take place.'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**搜索头**：这是主要的Web界面，您可以在其中执行搜索查询和管理您的Splunk安装。搜索头将与索引器连接，以查询已收集和存储在它们上面的数据。在较大的安装中，您甚至可能有多个搜索头，以允许更多的查询和报告进行。'
- en: '**Data forwarders**: These are usually installed on a system you would like
    to collect logs on. It is a small application that is configured to collect logs
    on your system and then push the data to your Splunk indexer.'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数据转发器**：通常安装在您希望收集日志的系统上。它是一个小型应用程序，配置为在您的系统上收集日志，然后将数据推送到您的Splunk索引器。'
- en: In the following section, we will be using the official Splunk Docker image,
    where we will be running both the search head and indexer on the active container.
    We will continue to use Docker for our Splunk environment as it also provides
    indexers and data forwarders as supported Docker images. These allow you to test
    and sandbox an installation before you move forward with an installation.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的部分中，我们将使用官方的Splunk Docker镜像，在活动容器上同时运行搜索头和索引器。我们将继续在Splunk环境中使用Docker，因为它还提供了索引器和数据转发器作为受支持的Docker镜像。这使您可以在继续安装之前测试和沙盒化安装。
- en: Note
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Please note that we are using the Splunk Docker image for simplicity. It will
    allow us to remove the application, if needed. It is easy and straightforward
    to install the application and run it on your system if you prefer this option.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，我们使用Splunk Docker镜像是为了简单起见。如果需要，它将允许我们移除应用程序。如果您更喜欢这个选项，安装应用程序并在您的系统上运行它是简单而直接的。
- en: Another important feature of Splunk is that it includes a large app ecosystem
    provided by both Splunk and other third-party providers. These apps are usually
    created to help users monitor services where logs are forwarded to Splunk and
    then a third-party app will be installed on the search head. This will provide
    dashboards and monitoring tools specifically for these logs. For example, you
    can forward your logs from a Cisco device and then install a Cisco-provided Splunk
    app to start monitoring your Cisco devices as soon as you start indexing data.
    You can create your own Splunk app, but to have it listed as an officially provided
    app, it needs to be certified by Splunk.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: Splunk的另一个重要特性是，它包括由Splunk和其他第三方提供者提供的大型应用程序生态系统。这些应用程序通常是为了帮助用户监视将日志转发到Splunk的服务而创建的，然后在搜索头上安装第三方应用程序。这将为这些日志提供专门的仪表板和监控工具。例如，您可以将日志从思科设备转发，然后安装思科提供的Splunk应用程序，以便在开始索引数据后立即开始监视您的思科设备。您可以创建自己的Splunk应用程序，但要使其列为官方提供的应用程序，它需要经过Splunk的认证。
- en: Note
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: 'For a complete list of both the free and paid Splunk apps that are available,
    Splunk has set up their SplunkBase to allow users to search for and download the
    available apps from the following URL: [https://splunkbase.splunk.com/apps/](https://splunkbase.splunk.com/apps/).'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 有关可用的免费和付费Splunk应用程序的完整列表，Splunk已设置他们的SplunkBase，允许用户从以下网址搜索并下载可用的应用程序：[https://splunkbase.splunk.com/apps/](https://splunkbase.splunk.com/apps/)。
- en: This has been a quick introduction to Splunk and should have helped you understand
    some of the work we are going to be doing in the following sections. The best
    way to get you familiar with Splunk, though, is to get the container running on
    your system so that you can start to work with it.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 这是对Splunk的快速介绍，应该帮助您了解接下来我们将要做的一些工作。然而，让您熟悉Splunk的最佳方法是在您的系统上运行容器，这样您就可以开始使用它了。
- en: Installing and Running Splunk on Docker
  id: totrans-36
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在Docker上安装和运行Splunk
- en: As part of this chapter, we'll use the official Splunk Docker image to install
    it on our system. Even though installing Splunk directly on your host system is
    not a difficult process, installing Splunk as a container image will help extend
    our knowledge of Docker and push our skills further.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 作为本章的一部分，我们将使用官方的Splunk Docker镜像在我们的系统上安装它。尽管直接在主机系统上安装Splunk并不是一个困难的过程，但将Splunk安装为容器镜像将有助于扩展我们对Docker的知识，并进一步提升我们的技能。
- en: Our Splunk installation will run both a search head and indexer on the same
    container since the amount of data we'll be monitoring will be minimal. However,
    if you were to use Splunk in a production environment with multiple users accessing
    the data, you may need to look at installing dedicated indexers, as well as one
    or more dedicated search heads.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的Splunk安装将在同一个容器上同时运行搜索头和索引器，因为我们将监控的数据量很小。然而，如果您要在多个用户访问数据的生产环境中使用Splunk，您可能需要考虑安装专用的索引器，以及一个或多个专用的搜索头。
- en: Note
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: We will be using Splunk Enterprise Version 8.0.2 in this chapter. The majority
    of the work that will be performed in this chapter will not be too advanced and,
    as a result, should be compatible with the subsequent version of Splunk in the
    future.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将使用Splunk Enterprise版本8.0.2。本章中将进行的大部分工作不会太高级，因此应该与将来的Splunk版本兼容。
- en: Before we start to work with Splunk, let's run through the three main directories
    used by the Splunk application. Although we'll only be performing basic configurations
    and changes, the following details will be beneficial in understanding how the
    directories in the application are organized and, as you'll see, will help you
    with your Docker container setup.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们开始使用Splunk之前，让我们先了解一下Splunk应用程序使用的三个主要目录。虽然我们只会执行基本的配置和更改，但以下细节将有助于理解应用程序中的目录是如何组织的，并且会帮助您进行Docker容器设置。
- en: 'In the main Splunk application directory, usually installed as `/opt/splunk/`,
    you will see three main directories, as explained here:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 在主要的Splunk应用程序目录中，通常安装为`/opt/splunk/`，您将看到这里解释的三个主要目录：
- en: '**etc directory**: This is where all the configuration information is held
    for our Splunk installation. We will create a directory and mount the etc directory
    as part of our running container to make sure any changes we make to the configuration
    is kept and not destroyed when we turn off our application. This will include
    user access, software settings and saved searches, dashboards, and the Splunk
    app.'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**etc目录**：这是我们Splunk安装的所有配置信息所在的地方。我们将创建一个目录，并将etc目录挂载为我们运行的容器的一部分，以确保我们对配置所做的任何更改都得以保留，当我们关闭应用程序时不会被销毁。这将包括用户访问、软件设置和保存的搜索、仪表板以及Splunk应用程序。'
- en: '**bin directory**: This is where all of Splunk''s application and binary files
    are stored. You won''t need to access this directory or make changes to files
    in this directory at this point, but it is something you may need to investigate
    further.'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**bin目录**：这是存储所有Splunk应用程序和二进制文件的地方。在这一点上，您不需要访问此目录或更改此目录中的文件，但这可能是您需要进一步调查的内容。'
- en: '**var directory**: Splunk''s indexed data and application logs are stored in
    this directory. When we first start working with Splunk, we won''t bother keeping
    the data we are storing in the var directory. But when we have ironed out all
    the bugs with our deployment, we will mount the var directory to keep our indexed
    data and make sure we can continue to search against it, even if our Splunk container
    stops running.'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**var目录**：Splunk的索引数据和应用程序日志存储在这个目录中。当我们开始使用Splunk时，我们不会费心保留我们存储在var目录中的数据。但是当我们解决了部署中的所有问题后，我们将挂载var目录以保留我们的索引数据，并确保我们可以继续对其进行搜索，即使我们的Splunk容器停止运行。'
- en: Note
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: To download some of the applications and content used in this chapter, you will
    need to sign up for an account on [splunk.com](http://splunk.com) to gain access
    to it. There is no obligation to purchase anything or provide credit card details
    when you sign up as it is just a means Splunk uses to track who is using their
    application.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 要下载本章中使用的一些应用程序和内容，您需要在[splunk.com](http://splunk.com)上注册一个帐户以获取访问权限。注册时无需购买任何东西或提供信用卡详细信息，这只是Splunk用来跟踪谁在使用他们的应用程序的手段。
- en: 'To run our Splunk container, we will pull the official image from Docker Hub
    and then run a command similar to the following:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 要运行我们的Splunk容器，我们将从Docker Hub拉取官方镜像，然后运行类似以下的命令：
- en: '[PRE0]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: As you can see from the preceding command, we need to expose the relevant ports
    needed for accessing different parts of our installation. You'll also note that
    there are two environment variables we need to specify as part of our running
    container. The first is `SPLUNK_START_ARGS`, which we have set to `--accept-license`,
    which you'd normally accept when you install Splunk on a running server. Secondly,
    we need to provide a value for the `SPLUNK_PASSWORD` environment variable. This
    is the password used by the Administrator account, and it is the account you will
    use when you first log in to Splunk.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 正如您从前面的命令中所看到的，我们需要暴露所需的相关端口，以便访问安装的不同部分。您还会注意到，我们需要指定两个环境变量作为运行容器的一部分。第一个是`SPLUNK_START_ARGS`，我们将其设置为`--accept-license`，这是您在安装Splunk时通常会接受的许可证。其次，我们需要为`SPLUNK_PASSWORD`环境变量提供一个值。这是管理员帐户使用的密码，也是您首次登录Splunk时将使用的帐户。
- en: We've provided a large amount of theory to get you ready for the next part of
    this chapter. It's time to put this theory into practice and get our Splunk installation
    running so that we can start collecting logs from our host system. In the following
    exercise, we will install a Splunk data forwarder on our running host system to
    collect logs to be forwarded to our Splunk indexer.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经提供了大量的理论知识，为本章的下一部分做好准备。现在是时候将这些理论付诸实践，让我们的Splunk安装运行起来，这样我们就可以开始从主机系统收集日志。在接下来的练习中，我们将在运行的主机系统上安装Splunk数据转发器，以便收集日志并转发到我们的Splunk索引器。
- en: Note
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Please use `touch` command to create files and `vim` command to work on the
    file using vim editor.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 请使用`touch`命令创建文件，并使用`vim`命令在文件上使用vim编辑器进行操作。
- en: 'Exercise 14.01: Running the Splunk Container and Starting to Collect Data'
  id: totrans-54
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习14.01：运行Splunk容器并开始收集数据
- en: 'In this exercise, you will get Splunk running using the official Splunk Docker
    image available on Docker Hub. You will make some basic configuration changes
    to help administer user access to the application on the image, and then you will
    install a forwarder on your system so that you can start to consume logs in your
    Splunk installation:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，您将使用Docker Hub上提供的官方Splunk Docker镜像来运行Splunk。您将进行一些基本的配置更改，以帮助管理用户访问镜像上的应用程序，然后您将在系统上安装一个转发器，以便开始在Splunk安装中消耗日志：
- en: 'Create a new directory called `chapter14`:'
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个名为`chapter14`的新目录：
- en: '[PRE1]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Pull the latest supported image from Docker Hub that has been created by Splunk
    using the `docker pull` command. The repository is simply listed as `splunk/splunk`:'
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`docker pull`命令从Docker Hub拉取由Splunk创建的最新支持的镜像。仓库简单地列为`splunk/splunk`：
- en: '[PRE2]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Run the Splunk image on your system with the `docker run` command. Use the
    `--rm` option to make sure the container is removed fully when it is killed, the
    `-d` option to have the container running as a daemon in the background of your
    system, and the `-p` option to expose port `8000` on your host machine so that
    you can view the applications on our web browser. Lastly, use the `-e` option
    to provide environment variables to the system when you start up the container:'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`docker run`命令在您的系统上运行Splunk镜像。使用`--rm`选项确保容器在被杀死时完全被移除，使用`-d`选项将容器作为守护进程在系统后台运行，使用`-p`选项在主机上暴露端口`8000`，以便您可以在Web浏览器上查看应用程序。最后，使用`-e`选项在启动容器时向系统提供环境变量：
- en: '[PRE3]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: In the preceding command, you are exposing port `8000` for the web interface,
    accepting the Splunk license with one environment variable, and also setting an
    administration password as `changeme`. The command is also running in the background
    as a daemon with `-d`.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 在上述命令中，您正在为Web界面暴露端口`8000`，使用一个环境变量接受Splunk许可，并将管理密码设置为`changeme`。该命令还以`-d`作为守护进程在后台运行。
- en: 'Splunk will take 1 or 2 minutes to start up. Use the `docker logs` command
    to view the progress of the application:'
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Splunk将需要1到2分钟来启动。使用`docker logs`命令来查看应用程序的进展情况：
- en: '[PRE4]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'When you see a similar line to the following showing `Ansible playbook complete`,
    you should be ready to log in:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 当您看到类似以下内容的行显示`Ansible playbook complete`时，您应该准备好登录了：
- en: '[PRE5]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Enter the URL `http://0.0.0.0:8000` to access the web interface of our Splunk
    installation. You should see something similar to the following. To log in, use
    `admin` as the username and the password we set with the `SPLUNK_PASSWORD` environment
    variable while running the image. In this case, you will use `changeme`:![Figure
    14.1: The Splunk web login page'
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入URL `http://0.0.0.0:8000` 来访问我们的Splunk安装的Web界面。您应该会看到类似以下的内容。要登录，请使用`admin`作为用户名，并使用在运行镜像时设置的`SPLUNK_PASSWORD`环境变量作为密码。在这种情况下，您将使用`changeme`：![图14.1：Splunk
    Web登录页面
- en: '](image/B15021_14_01.jpg)'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_01.jpg)'
- en: 'Figure 14.1: The Splunk web login page'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.1：Splunk Web登录页面
- en: 'Once you''ve logged in, you will be presented with the Splunk home screen,
    which should look similar to the following. The home screen is divided into separate
    sections, as outlined here:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 登录后，您将看到Splunk主屏幕，它应该看起来类似于以下内容。主屏幕分为不同的部分，如下所述：
- en: '![Figure 14.2: The Splunk welcome screen'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '![图14.2：Splunk欢迎屏幕'
- en: '](image/B15021_14_02.jpg)'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_02.jpg)'
- en: 'Figure 14.2: The Splunk welcome screen'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.2：Splunk欢迎屏幕
- en: 'The home screen can be broken down into the following sections:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 主屏幕可以分为以下几个部分：
- en: '- **Splunk>**: This is the icon at the top-left of the screen. It will bring
    you back to your home screen at any time if you simply click on the icon.'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '- **Splunk>**：这是屏幕左上角的图标。如果您简单地点击该图标，它将随时带您回到主屏幕。'
- en: '- **Apps Menu**: This runs along the left-hand side of the screen and allows
    you to install and configure Splunk apps.'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: '- **应用程序菜单**：这在屏幕的左侧，允许您安装和配置Splunk应用程序。'
- en: '- **Menu Bar**: This runs along the top of the screen and contains different
    options, depending on the level of privileges you have with your account. As you
    have logged in as the Administrator account, you get the full range of options.
    This allows us to configure and manage how Splunk is run and how it is administered.
    The main configuration option in the menu bar is `Settings`. It provides a large
    drop-down list that lets you control the majority of the aspects of how Splunk
    is run.'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '- **菜单栏**：它位于屏幕顶部，包含不同的选项，取决于您在帐户中拥有的特权级别。由于您已经以管理员帐户登录，您可以获得完整的选项范围。这使我们能够配置和管理Splunk的运行和管理方式。菜单栏中的主要配置选项是“设置”。它提供了一个大的下拉列表，让您控制Splunk运行的大部分方面。'
- en: '- **Main Workspace**: The main workspace fills the rest of the page and is
    where you can start to search your data, set up dashboards, and start to visualize
    your data. You can set a home dashboard so that each time you log in or click
    on the `Splunk>` icon, you will also be presented with this dashboard. We will
    set the home dashboard later in this chapter to show you how it is done.'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: '- **主工作区**：主工作区填充了页面的其余部分，您可以在这里开始搜索数据，设置仪表板，并开始可视化数据。您可以设置一个主仪表板，这样每次登录或单击“Splunk>`图标时，您也会看到此仪表板。我们将在本章后面设置主仪表板，以向您展示如何操作。'
- en: 'You can start to make changes to our Splunk configurations, but if the container
    stops running for some reason, all our changes will be lost. Instead, create a
    directory where you can store all the relevant configuration information needed
    for your Splunk environment. Stop the Splunk server you currently have running
    with the following command:'
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可以开始对我们的Splunk配置进行更改，但如果容器因某种原因停止运行，所有更改都将丢失。相反，创建一个目录，您可以在其中存储所有Splunk环境所需的相关配置信息。使用以下命令停止当前正在运行的Splunk服务器：
- en: '[PRE6]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Create a directory that can be mounted on the Splunk host. Call it `testSplunk`
    for this purpose:'
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个可以挂载到Splunk主机上的目录。为此目的命名为“testSplunk”：
- en: '[PRE7]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Run the Splunk container again, this time using the `-v` option to mount the
    directory you created in the previous step to the `/opt/splunk/etc` directory
    on your container. Expose the extra port of `9997` in order to forward data to
    our Splunk installation later in this exercise:'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 再次运行Splunk容器，这次使用“-v”选项将您在上一步创建的目录挂载到容器上的“/opt/splunk/etc”目录。暴露额外的端口“9997”，以便稍后将数据转发到我们的Splunk安装中。
- en: '[PRE8]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Once Splunk has started up again, log back into your Splunk web interface as
    the Administrator account.
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦Splunk再次启动，以管理员帐户重新登录到Splunk Web界面。
- en: 'Add a new user to your system to make sure you are saving the relevant configuration
    details in your mounted directory through the `Settings` menu at the top of the
    screen. Click on the `Settings` menu:![Figure 14.3: The Splunk settings menu'
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向系统添加一个新用户，以确保通过屏幕顶部的“设置”菜单将相关配置详细信息保存在您的挂载目录中。单击“设置”菜单：![图14.3：Splunk设置菜单
- en: '](image/B15021_14_03.jpg)'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_03.jpg)'
- en: 'Figure 14.3: The Splunk settings menu'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.3：Splunk设置菜单
- en: With the `Settings` menu open, move to the bottom section and click on `Users`
    in the `Users and Authentication` section. You should see a list of all the users
    that have been created on your installation of Splunk. Only the admin account
    will be listed in there so far. To create a new user, click on the `New User`
    button at the top of the screen.
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开“设置”菜单，移动到底部部分，然后在“用户和身份验证”部分中单击“用户”。您应该看到已在Splunk安装中创建的所有用户的列表。目前只有管理员帐户会列在其中。要创建新用户，请单击屏幕顶部的“新用户”按钮。
- en: 'You''ll be presented with a web form where you can add your new user account
    details. Fill in the details for the new user. Once you''re happy with the details
    you''ve added, click on the `Save` button at the bottom of the screen:![Figure
    14.4: Creating new users on Splunk'
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将看到一个网页表单，您可以在其中添加新用户帐户的详细信息。填写新用户的详细信息。一旦您对添加的详细信息感到满意，点击屏幕底部的“保存”按钮：![图14.4：在Splunk上创建新用户
- en: '](image/B15021_14_04.jpg)'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_04.jpg)'
- en: 'Figure 14.4: Creating new users on Splunk'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.4：在Splunk上创建新用户
- en: 'To make sure you are now keeping this data on your mounted directory, move
    back to your terminal to see whether the new user is stored in your mounted directory.
    Simply list the directories in the `testsplunk/users` directory using the following
    command:'
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了确保您现在将这些数据保存在您的挂载目录中，请返回到您的终端，查看新用户是否存储在您的挂载目录中。只需使用以下命令列出`testsplunk/users`目录中的目录：
- en: '[PRE9]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'You should see that a directory has been set up for the new account you created
    in the previous step; in this case, `vincesesto`:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该看到已为您在上一步中创建的新帐户设置了一个目录；在这种情况下是`vincesesto`：
- en: '[PRE10]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'It''s time to start sending data to the Splunk instance running on your system.
    Before you start collecting data from your running Docker containers, install
    a forwarder on your running system, and start forwarding logs from there. To access
    the forwarder specific to your system, go to the following URL and download the
    forwarder specific to your operating system: [https://www.splunk.com/en_us/download/universal-forwarder.html](https://www.splunk.com/en_us/download/universal-forwarder.html).'
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在是时候开始向在您的系统上运行的Splunk实例发送数据了。在开始从正在运行的Docker容器中收集数据之前，在您的运行系统上安装一个转发器，并从那里开始转发日志。要访问特定于您系统的转发器，请转到以下网址并下载特定于您操作系统的转发器：[https://www.splunk.com/en_us/download/universal-forwarder.html](https://www.splunk.com/en_us/download/universal-forwarder.html)。
- en: 'Follow the prompts to accept the license so that you can use the application.
    Also, accept the default options presented in the installation program:![Figure
    14.5: Splunk forwarder installation program'
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照提示接受许可证，以便您可以使用该应用程序。还要接受安装程序中呈现的默认选项：![图14.5：Splunk转发器安装程序
- en: '](image/B15021_14_05.jpg)'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_05.jpg)'
- en: 'Figure 14.5: Splunk forwarder installation program'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.5：Splunk转发器安装程序
- en: 'The forwarder will usually start automatically. Verify that the forwarder is
    running by accessing your terminal and changing to the installation directory
    on your system using the `cd` command. For the Splunk forwarder, the binary and
    application files will be located in the `/opt/splunkforwarder/bin/` directory:'
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转发器通常会自动启动。通过访问终端并使用`cd`命令切换到系统安装目录，验证转发器是否正在运行。对于Splunk转发器，二进制和应用程序文件将位于`/opt/splunkforwarder/bin/`目录中：
- en: '[PRE11]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'In the `bin` directory, check the status of the forwarder by running the `./splunk
    status` command, as follows:'
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`bin`目录中，通过运行`./splunk status`命令来检查转发器的状态，如下所示：
- en: '[PRE12]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'If it is running, you should see something similar to the following output:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 如果它正在运行，您应该看到类似于以下输出：
- en: '[PRE13]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'If the forwarder did not start when the installation took place, run it from
    the `bin` directory with the `start` option using the following command:'
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果转发器在安装时没有启动，请使用以下命令从`bin`目录运行带有`start`选项的转发器：
- en: '[PRE14]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'The output provided will show the Splunk daemon and services starting up. It
    will also show the Process ID (PID) of the services that are running on the system:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 提供的输出将显示Splunk守护程序和服务的启动。它还将显示正在系统上运行的服务的进程ID（PID）：
- en: '[PRE15]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'You need to let the Splunk forwarder know where it needs to send its data.
    In *step 8* of this exercise, we made sure we ran our Splunk container with port
    `9997` exposed for this specific reason. Use the `./splunk` command to tell the
    forwarder to send the data to our Splunk container running on IP address `0.0.0.0`
    on port `9997` using the Administrator username and password for our Splunk instance:'
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您需要让Splunk转发器知道它需要发送数据的位置。在本练习的*步骤8*中，我们确保运行了具有端口`9997`的Splunk容器，以便出于这个特定的原因暴露。使用`./splunk`命令告诉转发器将数据发送到我们运行在IP地址`0.0.0.0`端口`9997`上的Splunk容器，使用我们Splunk实例的管理员用户名和密码：
- en: '[PRE16]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'The command should return an output similar to the following:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 该命令应返回类似以下的输出：
- en: '[PRE17]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Finally, to complete the setup of your Splunk forwarder, nominate some log
    files to forward to our Splunk container. Use the `./splunk` command on the forwarder
    to monitor the files in the `/var/log` directory of our system and send them to
    the Splunk container to be indexed so that we can start viewing them:'
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，为了完成Splunk转发器的设置，指定一些日志文件转发到我们的Splunk容器。使用转发器上的`./splunk`命令监视我们系统的`/var/log`目录中的文件，并将它们发送到Splunk容器进行索引，以便我们可以开始查看它们：
- en: '[PRE18]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'After a few minutes, if everything has worked as it should, you should have
    some log events ready to be viewed on your Splunk container. Move back to your
    web browser and enter the following URL to open a Splunk search page: `http://0.0.0.0:8000/en-US/app/search/search`.'
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 几分钟后，如果一切正常，您应该有一些日志事件可以在Splunk容器上查看。返回到您的网络浏览器，输入以下URL以打开Splunk搜索页面：`http://0.0.0.0:8000/en-US/app/search/search`。
- en: Note
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: The following step uses a very basic Splunk search query to search over all
    the data on your installation. If you have not worked with the Splunk query language
    previously, don't worry; we'll spend an entire section, *Working with the Splunk
    Query Language*, explaining the query language in more depth.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤使用非常基本的Splunk搜索查询来搜索安装中的所有数据。如果您之前没有使用过Splunk查询语言，不用担心；我们将花费一个完整的部分，*使用Splunk查询语言*，更深入地解释查询语言。
- en: 'Perform a basic search by simply adding an asterisk (`*`) as a search query,
    as shown in the following screenshot. If everything has worked as it should, you
    should start to see log events in the results area of the search page:![Figure
    14.6: Splunk search window with data displayed from our forwarder'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过简单地将星号(`*`)作为搜索查询添加，执行基本搜索，如下截图所示。如果一切正常，您应该开始在搜索页面的结果区域看到日志事件：![图14.6：Splunk搜索窗口，显示来自我们的转发器的数据
- en: '](image/B15021_14_06.jpg)'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_06.jpg)'
- en: 'Figure 14.6: Splunk search window with data displayed from our forwarder'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.6：Splunk搜索窗口，显示来自我们的转发器的数据
- en: For the final part of this exercise, you will practice the easiest way to upload
    data to Splunk, which is by simply uploading the file directly to your running
    system. Download the sample data file named `weblog.csv` from [https://packt.live/3hFbh4C](https://packt.live/3hFbh4C)
    and place it in your `/tmp` directory.
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在本练习的最后部分，您将练习将数据上传到Splunk的最简单方法，即直接将文件上传到正在运行的系统中。从[https://packt.live/3hFbh4C](https://packt.live/3hFbh4C)下载名为`weblog.csv`的示例数据文件，并将其放在您的`/tmp`目录中。
- en: 'Move back to your Splunk web interface and click on the `Settings` menu option.
    Select `Add Data` from the right-hand side of the menu options, as shown in the
    following screenshot:![Figure 14.7: Importing files directly into Splunk'
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到您的Splunk网络界面，单击`设置`菜单选项。从菜单选项的右侧选择`添加数据`，如下截图所示：![图14.7：直接导入文件到Splunk
- en: '](image/B15021_14_07.jpg)'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_07.jpg)'
- en: 'Figure 14.7: Importing files directly into Splunk'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.7：直接导入文件到Splunk
- en: 'Click `Upload files from my computer` toward the bottom of the screen:![Figure
    14.8: Uploading files on Splunk'
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击屏幕底部的“从我的计算机上传文件”：![图14.8：在Splunk上上传文件
- en: '](image/B15021_14_08.jpg)'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_08.jpg)'
- en: 'Figure 14.8: Uploading files on Splunk'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.8：在Splunk上上传文件
- en: The next screen will allow you to select the source file from your machine.
    Select the `weblog.csv` file you downloaded earlier in this exercise. Click the
    `Next` button at the top of the screen when you have selected the file.
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一个屏幕将允许您从您的计算机中选择源文件。在此练习中，选择您之前下载的`weblog.csv`文件。当您选择文件后，请点击屏幕顶部的`Next`按钮。
- en: Set `Source Type` to choose or accept in what format Splunk has viewed your
    data. In this instance, it should have recognized your data as a `.csv` file.
    Click the `Next` button.
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置`Source Type`以选择或接受Splunk查看数据的格式。在这种情况下，它应该已经将您的数据识别为`.csv`文件。点击`Next`按钮。
- en: 'The `Input Settings` page lets you set the name of your host but leave the
    index as the default. Click the `Review` button:![Figure 14.9: Input settings
    page'
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`Input Settings`页面让您设置主机的名称，但将索引保留为默认值。点击`Review`按钮：![图14.9：输入设置页面'
- en: '](image/B15021_14_09.jpg)'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_09.jpg)'
- en: 'Figure 14.9: Input settings page'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.9：输入设置页面
- en: 'Click the `Submit` button if all the entries look correct. Then, click `Start
    Searching`, where you should see your search screen, along with the sample web
    log data available and ready to be searched. It should look similar to the following:![Figure
    14.10: Searching imported files in Splunk'
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果所有条目看起来正确，请点击`Submit`按钮。然后，点击`Start Searching`，您应该看到您的搜索屏幕，以及可供搜索的示例Web日志数据。它应该看起来类似于以下内容：![图14.10：在Splunk中搜索导入的文件
- en: '](image/B15021_14_10.jpg)'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_10.jpg)'
- en: 'Figure 14.10: Searching imported files in Splunk'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.10：在Splunk中搜索导入的文件
- en: In a short amount of time, we have set up a Splunk search head and indexer on
    our system and installed a Splunk forwarder to send logs into the indexer and
    search head. We also manually added log data to our index so that we could view
    it.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 在短时间内，我们已经在系统上设置了Splunk搜索头和索引器，并安装了Splunk转发器将日志发送到索引器和搜索头。我们还手动向我们的索引中添加了日志数据，以便我们可以查看它。
- en: The next part of this chapter will focus on getting your Docker container logs
    into the new Splunk container we have running.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的下一部分将重点介绍如何将Docker容器日志传输到我们正在运行的新Splunk容器中。
- en: Getting Container Logs into Splunk
  id: totrans-140
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将容器日志传输到Splunk
- en: Our log monitoring environment is starting to take shape, but we need to get
    our Docker container logs into the application to make it worth the work. We have
    set up our Splunk forwarder to send logs from our system to the `/var/log` directory.
    Up until now, we have learned that we can simply mount the log file of our container
    and use the Splunk forwarder to send logs to the Splunk indexer. This is one way
    to do this, but Docker provides an easier option for sending logs to Splunk.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的日志监控环境开始成形，但我们需要将我们的Docker容器日志传输到应用程序中，以使其值得工作。我们已经设置了Splunk转发器，将日志从我们的系统发送到`/var/log`目录。到目前为止，我们已经学会了我们可以简单地挂载我们容器的日志文件，并使用Splunk转发器将日志发送到Splunk索引器。这是一种方法，但Docker提供了一个更简单的选项来将日志发送到Splunk。
- en: 'Docker provides a log driver specific to Splunk that will send our container
    logs via our network to an HTTP Event Collector on our Splunk installation. We''ll
    need to open a new port to expose the Event Collector as Splunk uses port `8088`
    to collect data in this method. So far, we''ve exposed ports `8000` and `9997`
    on our Splunk installation. Before we proceed with the rest of this chapter, let''s
    look at all the available ports and how they function on Splunk:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: Docker提供了一个特定于Splunk的日志驱动程序，它将通过我们的网络将容器日志发送到我们Splunk安装中的HTTP事件收集器。我们需要打开一个新端口来暴露事件收集器，因为Splunk使用端口`8088`来收集数据。到目前为止，我们已经在Splunk安装中暴露了端口`8000`和`9997`。在我们继续本章的其余部分之前，让我们看看Splunk上所有可用的端口以及它们在Splunk上的功能：
- en: '`8000`: You''ve been using this port for the web application, and this is the
    dedicated default web port used to access Splunk in your browser.'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`8000`：您一直在使用这个端口进行web应用程序，这是用于在浏览器中访问Splunk的专用默认web端口。'
- en: '`9997`: This port is the default port used by Splunk forwarders to forward
    data to the indexer. We exposed this port in the previous section of this chapter
    to make sure we''re able to collect logs from our running system.'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`9997`：这个端口是Splunk转发器用来将数据转发到索引器的默认端口。我们在本章的前一节中暴露了这个端口，以确保我们能够从正在运行的系统中收集日志。'
- en: '`8089`: Splunk comes with an API that runs by default as part of the search
    head. Port `8089` is where the API manager sits to interface with the API running
    on your instance.'
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`8089`：Splunk自带一个API，默认作为搜索头的一部分运行。端口`8089`是API管理器所在的位置，用于与运行在您的实例上的API进行接口。'
- en: '`8088`: Port `8088` needs to be exposed to allow information to be forwarded
    to the Event Collector that''s been set up on your system. In the upcoming exercise,
    we''ll use this port to start sending Docker container logs to an HTTP Event Collector.'
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`8088`：端口`8088`需要暴露以允许信息被转发到已在您的系统上设置的事件收集器。在即将进行的练习中，我们将使用这个端口开始将Docker容器日志发送到HTTP事件收集器。'
- en: '`8080`: If we had a larger Splunk installation with dedicated indexers, port
    `8080` is used for indexers to communicate among themselves and allow replication
    among these indexers.'
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`8080`：如果我们有一个更大的Splunk安装，有专用的索引器，端口`8080`用于索引器之间的通信，并允许这些索引器之间的复制。'
- en: Note
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: The web interface for Splunk runs by default on port `8000`, but this may clash
    with our Panoramic Trekking App if you are hosting the application on the same
    port. If this does cause any issues, feel free to expose the port on the Splunk
    container to something different, such as port `8080`, as you will still be able
    to access the web interface and it will not cause any issues with our services
    using that port.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: Splunk的web界面默认在端口`8000`上运行，但如果您在同一端口上托管应用程序，可能会与我们的Panoramic Trekking App发生冲突。如果这造成任何问题，请随意将Splunk容器上的端口暴露为不同的端口，例如端口`8080`，因为您仍然可以访问web界面，并且不会对使用该端口的我们的服务造成任何问题。
- en: Once an `HTTP Event Collector` has been set up on Splunk, forwarding logs to
    Splunk is simply a matter of adding the correct options to our `docker run` command.
    The following sample command uses `--log-driver=splunk` to signal to the running
    container to use the Splunk log driver.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦在Splunk上设置了`HTTP事件收集器`，将日志转发到Splunk只是在我们的`docker run`命令中添加正确的选项。以下示例命令使用`--log-driver=splunk`来向正在运行的容器发出信号，以使用Splunk日志驱动程序。
- en: 'It then needs to include further `--log-opt` options to make sure the logs
    are forwarded correctly. The first is `splunk-url`, which is the URL your system
    is currently being hosted on. As we don''t have DNS set up, we can simply use
    the IP address we are using to host our Splunk instance, along with the port of
    `8088`. The second is `splunk-token`. This is the token that''s assigned by Splunk
    when you create the HTTP Event Collector:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 然后需要包括进一步的`--log-opt`选项，以确保日志被正确转发。第一个是`splunk-url`，这是您的系统当前托管的URL。由于我们没有设置DNS，我们可以简单地使用托管Splunk实例的IP地址，以及端口`8088`。第二个是`splunk-token`。这是在创建HTTP事件收集器时由Splunk分配的令牌：
- en: '[PRE19]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'There is the option to add Splunk logging driver details to your Docker configuration
    file. Here, you will need to add the following details to your `daemon.json` file
    in the `/etc/docker` configuration file. This will only work if you have Splunk
    as a separate application and not a Docker instance on your system. As we have
    set up our Splunk instance as a Docker container, this option will not work. This
    is because the Docker daemon will need to restart and connect to `splunk-url`
    listed in the configuration. Of course, without the Docker daemon running, `splunk-url`
    will never be available:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以将Splunk日志驱动程序的详细信息添加到您的Docker配置文件中。在这里，您需要将以下详细信息添加到`/etc/docker`配置文件中的`daemon.json`文件中。只有当您将Splunk作为单独的应用程序而不是系统上的Docker实例时，这才能起作用。由于我们已将Splunk实例设置为Docker容器，因此此选项将不起作用。这是因为Docker守护程序将需要重新启动并连接到配置中列出的`splunk-url`。当然，在没有运行Docker守护程序的情况下，`splunk-url`将永远不可用。
- en: '[PRE20]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: In the following exercise, we are going to extend our Splunk installation to
    open ports specific for our `HTTP Event Collector`, which we'll also create. We
    will then start to send logs from our containers into Splunk, ready for us to
    start viewing them.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的练习中，我们将扩展我们的Splunk安装，打开特定于我们的`HTTP事件收集器`的端口，我们也将创建它。然后，我们将开始将日志从我们的容器发送到Splunk，准备开始查看它们。
- en: 'Exercise 14.02: Creating an HTTP Event Collector and Starting to Collect Docker
    Logs'
  id: totrans-156
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习14.02：创建HTTP事件收集器并开始收集Docker日志
- en: 'In this exercise, you will create an `HTTP Event Collector` for your Splunk
    installation and use the Docker `log` driver to forward your logs to your Event
    Collector. You will use the `random-logger` Docker image, which is provided by
    the `chentex` repository and available for use on Docker Hub, to generate some
    logs in your system and demonstrate the use of Splunk further:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，您将为您的Splunk安装创建一个`HTTP事件收集器`，并使用Docker`log`驱动程序将日志转发到您的事件收集器。您将使用`chentex`存储库提供的`random-logger`
    Docker镜像，并可在Docker Hub上使用，以在系统中生成一些日志，并进一步演示Splunk的使用：
- en: 'Start the Splunk image again, this time with port `8088` exposed to all our
    Docker containers to push their logs to it:'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 再次启动Splunk镜像，这次将端口`8088`暴露给所有我们的Docker容器，以将它们的日志推送到其中：
- en: '[PRE21]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Wait for Splunk to start up again and log back into the web interface with the
    Administrator account.
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 等待Splunk再次启动，并使用管理员账户重新登录web界面。
- en: Go to the `Settings` menu and select `Data Inputs` to create a new `HTTP Event
    Collector`. Select `HTTP Event Collector` from the options list.
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到`设置`菜单，选择`数据输入`以创建新的`HTTP事件收集器`。从选项列表中选择`HTTP事件收集器`。
- en: 'Click on the `Global Settings` button on the `HTTP Event Collector` page. You
    will be presented with a page similar to the following. On this page, click on
    the `Enabled` button, next to `All Tokens`, and make sure `Enable SLL` is not
    selected as you will not be using SSL in this exercise. This will make things
    a little easier for you. When you''re happy with the details on the screen, click
    the `Save` button to save your configurations:![Figure 14.11: Enabling HTTP Event
    Collector on your system'
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击`HTTP事件收集器`页面上的`全局设置`按钮。您将看到一个类似以下内容的页面。在此页面上，单击`启用`按钮，旁边是`所有令牌`，并确保未选择`启用SSL`，因为在这个练习中您将不使用SSL。这将使您的操作变得更加简单。当您对屏幕上的细节满意时，单击`保存`按钮保存您的配置：![图14.11：在您的系统上启用HTTP事件收集器
- en: '](image/B15021_14_11.jpg)'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_11.jpg)'
- en: 'Figure 14.11: Enabling HTTP Event Collector on your system'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.11：在您的系统上启用HTTP事件收集器
- en: 'When you return to the `HTTP Event Collector` page, click the `New Token` button
    at the top-right of the screen. You''ll be presented with a screen similar to
    the following. This is where you''ll set up your new Event Collector so that you
    can collect your Docker container logs:![Figure 14.12: Naming your HTTP Event
    Collector on Splunk'
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当您返回到“HTTP事件收集器”页面时，请点击屏幕右上角的“新令牌”按钮。您将看到一个类似以下的屏幕。在这里，您将设置新的事件收集器，以便可以收集Docker容器日志：![图14.12：在Splunk上命名您的HTTP事件收集器
- en: '](image/B15021_14_12.jpg)'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_12.jpg)'
- en: 'Figure 14.12: Naming your HTTP Event Collector on Splunk'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.12：在Splunk上命名您的HTTP事件收集器
- en: The preceding screen is where you set the name of your new Event Collector.
    Enter the name `Docker Logs` and, for the rest of the entries, accept the defaults
    by leaving them blank. Click the `Next` button at the top of the screen.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的屏幕是您设置新事件收集器名称的地方。输入名称“Docker Logs”，对于其余的条目，通过将它们留空来接受默认值。点击屏幕顶部的“下一步”按钮。
- en: 'Accept the default values for the `Input Settings` and `Review` pages until
    you see a page similar to the following, in which a new `HTTP Event Collector`
    has been created with a token available. The token is displayed as `5c051cdb-b1c6-482f-973f-2a8de0d92ed8`.
    Yours will be different as Splunk provides a unique token to allow for the secure
    transfer of data from sources that are trusted by the user. Use this token to
    allow your Docker containers to start logging data in your Splunk installation:![Figure
    14.13: Completed HTTP Event Collector on Splunk'
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接受“输入设置”和“审阅”页面的默认值，直到您看到一个类似以下的页面，在这个页面上创建了一个新的“HTTP事件收集器”，并提供了一个可用的令牌。令牌显示为“5c051cdb-b1c6-482f-973f-2a8de0d92ed8”。您的令牌将不同，因为Splunk为用户信任的数据源提供了一个唯一的令牌，以便安全地传输数据。使用此令牌允许您的Docker容器开始在Splunk安装中记录数据：![图14.13：在Splunk上完成HTTP事件收集器
- en: '](image/B15021_14_13.jpg)'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_13.jpg)'
- en: 'Figure 14.13: Completed HTTP Event Collector on Splunk'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.13：在Splunk上完成HTTP事件收集器
- en: 'Use the `hello-world` Docker image to make sure you can send data to Splunk.
    In this instance, add four extra command-line options as part of your `docker
    run` command. Specify `--log-driver` as `splunk`. Provide the log options as the
    `splunk-url` of our system, including port `8088`, `splunk-token`, which you created
    in the previous step, and, finally, state `splunk-=insecureipverify` as `true`.
    This final option will limit the work required in setting up your Splunk installation
    so that you won''t need to organize the SSL certificates that will be used with
    our Splunk server:'
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用“hello-world” Docker镜像，确保您可以将数据发送到Splunk。在这种情况下，作为您的“docker run”命令的一部分，添加四个额外的命令行选项。指定“--log-driver”为“splunk”。将日志选项指定为我们系统的“splunk-url”，包括端口“8088”，“splunk-token”（您在上一步中创建的），最后，将“splunk-=insecureipverify”状态指定为“true”。这个最后的选项将限制在设置Splunk安装时所需的工作，这样您就不需要组织将与我们的Splunk服务器一起使用的SSL证书：
- en: '[PRE22]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'The commands should return an output similar to the following:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 命令应返回类似以下的输出：
- en: '[PRE23]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Return to the Splunk web interface and click the `Start Searching` button.
    If you have already moved on from the previous screen, go to the Splunk search
    page at `http://0.0.0.0:8000/en-US/app/search/search`. In the search query box,
    enter `source="http:Docker Logs"`, as shown in the following screenshot. If everything
    has worked well, you should also see data entries being provided by the `hello-world`
    image:![Figure 14.14: Starting to collect docker logs with Splunk'
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到Splunk Web界面，点击“开始搜索”按钮。如果您已经从上一个屏幕中移开，请转到Splunk搜索页面，网址为“http://0.0.0.0:8000/en-US/app/search/search”。在搜索查询框中，输入“source="http:Docker
    Logs"”，如下截图所示。如果一切顺利，您还应该看到“hello-world”镜像提供的数据条目：![图14.14：开始使用Splunk收集docker日志
- en: '](image/B15021_14_14.jpg)'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_14.jpg)'
- en: 'Figure 14.14: Starting to collect docker logs with Splunk'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.14：开始使用Splunk收集docker日志
- en: 'The previous step has shown that the Splunk installation is now able to collect
    Docker log data, but you will need to create a new volume to store your index
    data so that it is not destroyed every time you stop Splunk from running. Move
    back into your terminal and kill the running `splunk` container:'
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 上一步已经表明，Splunk安装现在能够收集Docker日志数据，但您需要创建一个新的卷来存储您的索引数据，以便在停止Splunk运行时不被销毁。回到您的终端并杀死运行中的`splunk`容器：
- en: '[PRE24]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'In the same directory where you created the original `testsplunk` directory,
    create a new directory so that we can mount our Splunk index data. In this instance,
    name it `testsplunkindex`:'
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在创建原始`testsplunk`目录的同一目录中，创建一个新目录，以便我们可以挂载我们的Splunk索引数据。在这种情况下，将其命名为`testsplunkindex`：
- en: '[PRE25]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'From your working directory, start the Splunk image again. Mount the new directory
    you just created in order to store your index data:'
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从您的工作目录开始，再次启动Splunk镜像。挂载您刚刚创建的新目录，以存储您的索引数据：
- en: '[PRE26]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Use the `random-logger` Docker image to generate some logs in your system.
    In the following command, there''s an added `tag` log option. This will mean that
    each log event that''s generated and sent to Splunk will also include this tag
    as metadata, which can help you search for data when you are searching in Splunk.
    By using the `{{.Name}}` and `{{.FullID}}` options, these details will be automatically
    added, just like the container name and ID number will be added as your tag when
    the container is created:'
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`random-logger` Docker镜像在您的系统中生成一些日志。在以下命令中，有一个额外的`tag`日志选项。这意味着每个生成并发送到Splunk的日志事件也将包含此标签作为元数据，这可以帮助您在Splunk中搜索数据时进行搜索。通过使用`{{.Name}}`和`{{.FullID}}`选项，这些细节将被自动添加，就像容器名称和ID号在创建容器时将被添加为您的标签一样：
- en: '[PRE27]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Note
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: 'If your Splunk instance is not running correctly or you have not configured
    something correctly, the `log-generator` container will fail to connect or run.
    You will see an error similar to the following:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的Splunk实例运行不正确，或者您没有正确配置某些内容，`log-generator`容器将无法连接或运行。您将看到类似以下的错误：
- en: '`docker: Error response from daemon: failed to initialize logging driver:`'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: '`docker: Error response from daemon: failed to initialize logging driver:`'
- en: 'Once this is running, move back to the Splunk search page on the web interface
    and in this instance, include the tag you created in the previous step. The following
    query will ensure that only new data that has been provided by the `log-generator`
    image will display in our Splunk output:'
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦这个运行起来，回到web界面上的Splunk搜索页面，在这种情况下，包括你在上一步创建的标签。以下查询将确保只有`log-generator`镜像提供的新数据将显示在我们的Splunk输出中：
- en: '[PRE28]'
  id: totrans-191
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Your Splunk search should result in something similar to the following. Here,
    you can see the logs that have been generated by the `log-generator` image. You
    can see that it is logging at random times and that each entry is now tagged with
    the name and instance ID of your container:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 您的Splunk搜索应该会产生类似以下的结果。在这里，您可以看到由`log-generator`镜像生成的日志。您可以看到它在随机时间记录，并且每个条目现在都带有容器的名称和实例ID作为标签：
- en: '![Figure 14.15: Splunk search result'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: '![图14.15：Splunk搜索结果'
- en: '](image/B15021_14_15.jpg)'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_15.jpg)'
- en: 'Figure 14.15: Splunk search result'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.15：Splunk搜索结果
- en: Our Splunk installation is coming along nicely as we've now been able to configure
    the application to include an `HTTP Event Collector` and have started collecting
    logs from the `log-generator` Docker image. Even if we stop our Splunk instance,
    they should still be available for us to search and extract useful information.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的Splunk安装进展顺利，因为我们现在已经能够配置应用程序以包括`HTTP事件收集器`，并开始从`log-generator` Docker镜像中收集日志。即使我们停止Splunk实例，它们仍应可供我们搜索和提取有用信息。
- en: The following section will provide a more in-depth demonstration of how to use
    the Splunk query language.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 下一节将提供如何使用Splunk查询语言的更深入演示。
- en: Working with the Splunk Query Language
  id: totrans-198
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Splunk查询语言
- en: The Splunk query language can be a little difficult to pick up, but once you
    do, you'll find it helpful to interpret, analyze, and present your data from your
    Splunk environment. The best way to get comfortable with the query language is
    to simply dive in.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: Splunk查询语言可能有点难以掌握，但一旦掌握，您会发现它有助于解释、分析和呈现来自Splunk环境的数据。熟悉查询语言的最佳方法就是简单地开始使用。
- en: 'The following list describes a few things to take into account when working
    with the query language:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用查询语言时需要考虑以下几点：
- en: '**Narrow your search**: The larger the amount of data you want to search over,
    the longer your query will take to return a result. If you know the time frame
    or a source, such as the one we created for `docker logs`, the query will return
    the result faster.'
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**缩小您的搜索范围**：您想要搜索的数据量越大，您的查询就会花费更长的时间返回结果。如果您知道时间范围或源，比如我们为`docker logs`创建的源，查询将更快地返回结果。'
- en: '**Use simple search terms**: If you have an idea of what will be included in
    your log (for example, `ERROR` or `DEBUG`), this is a great place to start with
    your search terms as it will also help limit the amount of data you are receiving.
    This is another reason why we used a tag in the previous section when adding logs
    to our Splunk instance.'
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用简单的搜索词条**：如果您知道日志中会包含什么（例如，`ERROR`或`DEBUG`），这是一个很好的起点，因为它还将帮助限制您接收到的数据量。这也是为什么在前一节中在向Splunk实例添加日志时我们使用了标签的另一个原因。'
- en: '**Chain search terms**: We can use `AND` to group search terms. We can also
    use `OR` to search for logs with more than one search term use.'
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**链接搜索词条**：我们可以使用`AND`来组合搜索词条。我们还可以使用`OR`来搜索具有多个搜索词条的日志。'
- en: '**Add wildcards to search multiple terms**: The query language also has the
    option to use wildcards, such as an asterisk. If you used the `ERR*` query, for
    example, it would search for not only `ERROR` but also `ERR` and `ERRORS`.'
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**添加通配符以搜索多个词条**：查询语言还可以使用通配符，比如星号。例如，如果您使用了`ERR*`查询，它将搜索不仅是`ERROR`，还有`ERR`和`ERRORS`。'
- en: '**Extracted fields provide more details**: Splunk will do its best to find
    and locate fields in the log events, especially if your logs are in a known log
    format such as Apache log file format or a recognizable format such as CSV or
    JSON logs. If you are creating logs for your application, Splunk will do an amazing
    job of extracting fields if you present your data as key-value pairs.'
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提取的字段提供了更多的细节：Splunk将尽其所能在日志事件中找到和定位字段，特别是如果您的日志采用已知的日志格式，比如Apache日志文件格式，或者是识别格式，比如CSV或JSON日志。如果您为您的应用程序创建日志，如果您将数据呈现为键值对，Splunk将会出色地提取字段。
- en: '**Add functions to a group and visualize data**: Adding functions to your search
    terms can help you transform and present your data. They are usually added to
    your search term with a pipe (`|`) character. The following exercise will use
    the `stats`, `chart`, and `timechart` functions to help aggregate search results
    and calculate statistics such as `average`, `count`, and `sum`. As an example,
    if we are using a search term such as `ERR*`, we can then pipe this to the `stats`
    command to count the number of times we see an error event: `ERR* | stats count`'
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**添加函数来对数据进行分组和可视化**：向搜索词条添加函数可以帮助您转换和呈现数据。它们通常与管道（`|`）字符一起添加到搜索词条中。下面的练习将使用`stats`、`chart`和`timechart`函数来帮助聚合搜索结果和计算统计数据，比如`average`、`count`和`sum`。例如，如果我们使用了一个搜索词条，比如`ERR*`，然后我们可以将其传输到`stats`命令来计算我们看到错误事件的次数：`ERR*
    | stats count`'
- en: Splunk also provides handy tips when you are entering your query. Once you have
    the basics down, it will help you provide additional functionality to your data.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: Splunk在输入查询时还提供了方便的提示。一旦您掌握了基础知识，它将帮助您为数据提供额外的功能。
- en: In the following exercise, you will find that, even when Splunk cannot find
    your extracted fields, you can create your own so that you can analyze your data.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的练习中，您将发现，即使Splunk找不到您提取的字段，您也可以创建自己的字段，以便分析您的数据。
- en: 'Exercise 14.03: Getting Familiar with the Splunk Query Language'
  id: totrans-209
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习14.03：熟悉Splunk查询语言
- en: 'In this exercise, you will run through a series of tasks that demonstrate the
    basic functionality of the query language and help you become more familiar with
    using it. This will help you examine and visualize your own data:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，您将运行一系列任务，演示查询语言的基本功能，并帮助您更熟悉使用它。这将帮助您检查和可视化您自己的数据：
- en: Make sure your Splunk container is running and that the `log-generator` container
    is sending data to Splunk.
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保您的Splunk容器正在运行，并且“log-generator”容器正在向Splunk发送数据。
- en: When you log in to Splunk, from the home page, click `Search & Reporting app`
    from the left-hand side menu or go to the URL `http://0.0.0.0:8000/en-US/app/search/search`
    to bring up the search page.
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当您登录Splunk时，从主页，点击左侧菜单中的“搜索和报告应用程序”，或者转到URL“http://0.0.0.0:8000/en-US/app/search/search”来打开搜索页面。
- en: 'When you get to the search page, you will see a textbox that says `enter search
    here`. Start with a simple term such as the word `ERROR`, as shown in the following
    screenshot, and press *Enter* to have Splunk run the query:![Figure 14.16: Splunk
    search page'
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当您到达搜索页面时，您会看到一个文本框，上面写着“在此输入搜索”。从一个简单的术语开始，比如单词“ERROR”，如下截图所示，然后按*Enter*让Splunk运行查询：![图14.16：Splunk搜索页面
- en: '](image/B15021_14_16.jpg)'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_16.jpg)'
- en: 'Figure 14.16: Splunk search page'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.16：Splunk搜索页面
- en: If you were to only enter the term `ERR*` with an asterisk (`*`) at the end
    of the term, this should also give results similar to the ones shown in the preceding
    screenshot.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您只输入术语“ERR*”，并在术语的末尾加上一个星号（`*`），这也应该会产生类似于前面截图中显示的结果。
- en: 'Chain search terms together using `AND` to make sure our log events include
    multiple values. Enter a search similar to `sourcetype=htt* AND ERR*` to search
    for all `HTTP` Event Collector logs that are also showing `ERR` values in their
    logs:![Figure 14.17: Chaining search terms together'
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用“AND”链接搜索项，以确保我们的日志事件包含多个值。输入类似于`sourcetype=htt* AND ERR*`的搜索，以搜索所有`HTTP`事件收集器日志，这些日志还显示其日志中的`ERR`值：![图14.17：链接搜索项
- en: '](image/B15021_14_17.jpg)'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_17.jpg)'
- en: 'Figure 14.17: Chaining search terms together'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.17：链接搜索项
- en: 'The searches you enter will most likely default to searching through all the
    data since your installation. Looking through all your data could result in a
    very time-consuming search. Narrow this down by entering a time range to search
    over. Click the drop-down menu to the right of the query textbox to limit the
    data your search is run over. Limit the search to `Last 24 hours`:![Figure 14.18:
    Limiting searches with time ranges'
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您输入的搜索很可能默认搜索自安装以来的所有数据。查看所有数据可能会导致非常耗时的搜索。通过输入时间范围来缩小范围。单击查询文本框右侧的下拉菜单，以限制搜索运行的数据。将搜索限制为“最近24小时”：![图14.18：限制时间范围内的搜索
- en: '](image/B15021_14_18.jpg)'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_18.jpg)'
- en: 'Figure 14.18: Limiting searches with time ranges'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.18：限制时间范围内的搜索
- en: 'Look through the extracted fields on the left-hand side of the results page.
    You''ll notice that there are two sections. The first is `SELECTED FIELDS`, which
    includes data specific to your search. The second is `INTERESTING FIELDS`. This
    data is still relevant and part of your data but not specifically related to your
    search query:![Figure 14.19: Extracted fields'
  id: totrans-223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看结果页面左侧的提取字段。您会注意到有两个部分。第一个是“已选择字段”，其中包括特定于您的搜索的数据。第二个是“有趣的字段”。这些数据仍然相关并且是您的数据的一部分，但与您的搜索查询没有特定关联：![图14.19：提取的字段
- en: '](image/B15021_14_19.jpg)'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: '](图像/B15021_14_19.jpg)'
- en: 'Figure 14.19: Extracted fields'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.19：提取的字段
- en: To create the fields to be listed, click the `Extract Your Own Fields` link.
    The following steps will walk through the process of creating new fields relevant
    to the data the `log-generator` container is providing.
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要创建要列出的字段，请点击“提取您自己的字段”链接。以下步骤将引导您完成创建与“log-generator”容器提供的数据相关的新字段的过程。
- en: 'You''ll be taken to a new page where you''ll be presented with sample data
    from the `httpevent` source type you have recently been searching on. First, you''ll
    need to select a sample event. Select the first line that is similar to the one
    listed here. Click the `Next` button at the top of the screen to move on to the
    next step:'
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将被带到一个新页面，其中将呈现您最近正在搜索的“httpevent”源类型的示例数据。首先，您需要选择一个示例事件。选择与此处列出的类似的第一行。点击屏幕顶部的“下一步”按钮，以继续下一步：
- en: '[PRE29]'
  id: totrans-228
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'You''ll then be asked to choose the method you want to use in order to extract
    fields. If you are working with files that have a clear delimiter, such as a `.SSV`
    file, use the `Delimiters` method. In this instance, though, you are going to
    use the `Regular Expression` method. Click `Regular Expression` and then click
    the `Next` button:![Figure 14.20: Field extraction method'
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，您将被要求选择要使用的提取字段的方法。如果您正在处理具有明确分隔符的文件，例如“.SSV”文件，请使用“分隔符”方法。但在这种情况下，您将使用“正则表达式”方法。点击“正则表达式”，然后点击“下一步”按钮：![图14.20：字段提取方法
- en: '](image/B15021_14_20.jpg)'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: '](图像/B15021_14_20.jpg)'
- en: 'Figure 14.20: Field extraction method'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.20：字段提取方法
- en: 'You should now have one line of data where you can start to select fields to
    extract. All the log data provided by the `log-generator` container is the same,
    so this line will serve as a template for all the events Splunk receives. As shown
    in the following screenshot, click `ERROR`, and when you''re provided with the
    opportunity to enter a field name, enter `level`, and then select the `Add Extraction`
    button. Select the line of text after `ERROR`. In this example, it is `something
    happened in this execution`. Add a field name of `message`. Click the `Add Extraction`
    button. Then, click the `Next` button when you have selected all the relevant
    fields:![Figure 14.21: Field extraction in Splunk'
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在您应该有一行数据，可以开始选择要提取的字段。由“log-generator”容器提供的所有日志数据都是相同的，因此此行将作为Splunk接收的所有事件的模板。如下截图所示，点击“ERROR”，当您有机会输入字段名称时，输入“level”，然后选择“添加提取”按钮。选择“ERROR”后的文本行。在此示例中，它是“此执行中发生了某事”。添加一个字段名称“message”。点击“添加提取”按钮。然后，在选择所有相关字段后，点击“下一步”按钮：![图14.21：Splunk中的字段提取
- en: '](image/B15021_14_21.jpg)'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: '](图像/B15021_14_21.jpg)'
- en: 'Figure 14.21: Field extraction in Splunk'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.21：Splunk中的字段提取
- en: 'You should now be able to see all the events with the new fields you have highlighted.
    Click the `Next` button:![Figure 14.22: Events with the new fields'
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您现在应该能够看到所有已突出显示的新字段的事件。点击“下一步”按钮：![图14.22：带有新字段的事件
- en: '](image/B15021_14_22.jpg)'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: '](图像/B15021_14_22.jpg)'
- en: 'Figure 14.22: Events with the new fields'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.22：带有新字段的事件
- en: 'Finally, you''ll be presented with a screen similar to the following. In the
    `Permissions` section, click the `All apps` button to allow this field extraction
    to occur across your entire Splunk installation, not limiting it to one app or
    the owner. If you''re happy with the extractions name and other options, click
    the `Finish` button at the top of the screen:![Figure 14.23: Field extraction
    in Splunk completed'
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，你将看到一个类似以下的屏幕。在`权限`部分，点击`所有应用`按钮，允许此字段提取在整个Splunk安装中进行，而不限制在一个应用或所有者中。如果你对提取的名称和其他选项满意，点击屏幕顶部的`完成`按钮：![图14.23：在Splunk中完成字段提取
- en: '](image/B15021_14_23.jpg)'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_23.jpg)'
- en: 'Figure 14.23: Field extraction in Splunk completed'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.23：在Splunk中完成字段提取
- en: 'Move back into your search page and add `sourcetype=httpevent` to the search
    query. Once it loads, look through the extracted fields. You should now have the
    `level` and `message` fields you added as `INTERESTING FIELDS`. If you click on
    the `level` field, you will get a breakdown of the number of events received,
    similar to what''s shown in the following screenshot:![Figure 14.24: Displaying
    field breakdown in the search results'
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到搜索页面，并在搜索查询中添加`sourcetype=httpevent`。加载完成后，浏览提取的字段。现在你应该有你添加的`level`和`message`字段作为`感兴趣的字段`。如果你点击`level`字段，你将得到接收事件数量的详细信息，类似于下面截图中显示的内容：![图14.24：在搜索结果中显示字段细分
- en: '](image/B15021_14_24.jpg)'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_24.jpg)'
- en: 'Figure 14.24: Displaying field breakdown in the search results'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.24：在搜索结果中显示字段细分
- en: 'Use the `stats` function to count the number of events for each error level
    in your logs. Do this by using the `sourcetype=httpevent | stats count by level`
    search query for the results of your search from the previous step and pipe the
    values of the `stats` function to `count by level`:![Figure 14.25: Using the stats
    function'
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`stats`函数来计算日志中每个错误级别的事件数量。通过使用`sourcetype=httpevent | stats count by level`搜索查询来获取上一步搜索结果的结果，并将`stats`函数的值传递给`count
    by level`：![图14.25：使用stats函数
- en: '](image/B15021_14_25.jpg)'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_25.jpg)'
- en: 'Figure 14.25: Using the stats function'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.25：使用stats函数
- en: 'The `stats` function gives you some nice information, but if you want to see
    the data presented over a period of time, use the `timechart` function. Run the
    `sourcetype=httpevent | timechart span=1m count by level` query to give the result
    over a range of time. If you perform your search over the past 15 minutes, the
    preceding query should give you a breakdown of data by each minute. Click the
    `Visualization` tab under the search query textbox. You will be presented with
    a graph representing the results of our search:![Figure 14.26: Creating visualizations
    from search results'
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`stats`函数提供了一些很好的信息，但如果你想看到数据在一段时间内的呈现，可以使用`timechart`函数。运行`sourcetype=httpevent
    | timechart span=1m count by level`查询，以在一段时间内给出结果。如果你在过去15分钟内进行搜索，上述查询应该给出每分钟的数据细分。点击搜索查询文本框下的`可视化`选项卡。你将看到一个代表我们搜索结果的图表：![图14.26：从搜索结果创建可视化'
- en: '](image/B15021_14_26.jpg)'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_26.jpg)'
- en: 'Figure 14.26: Creating visualizations from search results'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.26：从搜索结果创建可视化
- en: You can use the span option in your query to group your data by minute (1m),
    hour (5), day (1d), and so on.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在查询中使用span选项来按分钟（1m）、小时（5）、天（1d）等对数据进行分组。
- en: 'In the preceding screenshot, where it mentions the chart type (`Column Chart`),
    you can change the type you currently have displayed. Click the `Column Chart`
    text. It will let you select from a few different types of charts. In this instance,
    use the line chart:![Figure 14.27: Selecting the chart type'
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在前面的截图中，提到了图表类型（`柱状图`），你可以更改当前显示的类型。点击`柱状图`文本。它将让你从几种不同类型的图表中选择。在这种情况下，使用折线图：![图14.27：选择图表类型
- en: '](image/B15021_14_27.jpg)'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_27.jpg)'
- en: 'Figure 14.27: Selecting the chart type'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 图 14.27：选择图表类型
- en: Note
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: In the following steps, you are going to create a dashboard for your data visualization.
    Dashboards are a way to display your data to users without them needing to know
    anything specific about Splunk or the data involved. It is perfect for non-technical
    users as you simply provide a URL to the dashboard so that the user will simply
    load the dashboard to see the information they need. Dashboards are also perfect
    for searches you need to perform on a regular basis so as to limit the amount
    of work you need to do.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的步骤中，你将为数据可视化创建一个仪表板。仪表板是一种向用户显示数据的方式，用户无需了解Splunk或涉及的数据的任何特定信息。对于非技术用户来说，这是完美的，因为你只需提供仪表板的URL，用户就可以加载仪表板以查看他们需要的信息。仪表板也非常适合你需要定期执行的搜索，以限制你需要做的工作量。
- en: 'When you are happy with the chart, click the `Save As` button at the top of
    the screen and select the `Dashboard Panel`. You''ll be presented with a form
    similar to the one shown in the following screenshot. Create a new dashboard called
    `Log Container Dashboard` that is `Shared in App` (the current search app) with
    the specific panel you have just created, named `Error Level`:![Figure 14.28:
    Creating dashboards from search results'
  id: totrans-256
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当你对图表满意时，点击屏幕顶部的“另存为”按钮，然后选择“仪表板面板”。你将看到一个类似下面截图中所示的表单。创建一个名为“日志容器仪表板”的新仪表板，将其“共享在应用程序”（当前的搜索应用程序）中，并包括你刚创建的特定面板，命名为“错误级别”：![图
    14.28：从搜索结果创建仪表板
- en: '](image/B15021_14_28.jpg)'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_28.jpg)'
- en: 'Figure 14.28: Creating dashboards from search results'
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 图 14.28：从搜索结果创建仪表板
- en: 'Click the `Save` button to create the new dashboard. You''ll be given the opportunity
    to view your dashboard when you click save. But if you need to view the dashboard
    at a later stage, go to the app you''ve created the dashboard in (in this case,
    the `Search & Reporting` app) and click the `Dashboards` menu at the top of the
    screen. You will be presented with the available dashboards. This is where you
    can click the relevant one. You''ll notice you have two other dashboards available
    that have been provided by default as part of your Splunk installation:![Figure
    14.29: Dashboards in Splunk'
  id: totrans-259
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“保存”按钮创建新仪表板。当你点击保存时，你将有机会查看你的仪表板。但如果你需要在以后查看仪表板，前往你创建仪表板的应用程序（在本例中是“搜索与报告”应用程序），然后点击屏幕顶部的“仪表板”菜单。你将看到可用的仪表板。在这里你可以点击相关的仪表板。你会注意到你有另外两个可用的仪表板，这是作为Splunk安装的默认部分提供的：![图
    14.29：Splunk中的仪表板
- en: '](image/B15021_14_29.jpg)'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_29.jpg)'
- en: 'Figure 14.29: Dashboards in Splunk'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 图 14.29：Splunk中的仪表板
- en: Open the `Log Container` dashboard you just created and click the `Edit` button
    at the top of the screen. This will let you add a new panel to your dashboard
    without you needing to move back to the search window.
  id: totrans-262
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开你刚创建的“日志容器”仪表板，然后点击屏幕顶部的“编辑”按钮。这样可以让你在不需要返回搜索窗口的情况下向仪表板添加新面板。
- en: When you click on the `Edit` button, you'll be given extra options to make changes
    to the look and feel of your dashboard. Click the `Add Panel` button now.
  id: totrans-263
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当你点击“编辑”按钮时，你将获得额外的选项来更改仪表板的外观和感觉。现在点击“添加面板”按钮。
- en: When you select `Add Panel`, you'll be presented with some extra selections
    on the right-hand side of the screen. Click the `New` menu option and then select
    `Single Value`.
  id: totrans-264
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当你选择“添加面板”时，屏幕右侧将出现一些额外的选择。点击“新建”菜单选项，然后选择“单个数值”。
- en: 'Name the panel `Total Errors` and add `sourcetype=httpevent AND ERROR | stats
    count` as the search string. The screen where you can add the new dashboard panel
    should look similar to the following. It should provide details regarding the
    `Content Title` and `Search String`:![Figure 14.30: Adding panels to your Splunk
    dashboard'
  id: totrans-265
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将面板命名为“总错误”，并将`sourcetype=httpevent AND ERROR | stats count`添加为搜索字符串。您可以添加新仪表板面板的屏幕应该类似于以下内容。它应该提供有关“内容标题”和“搜索字符串”的详细信息：![图14.30：将面板添加到您的Splunk仪表板
- en: '](image/B15021_14_30.jpg)'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_30.jpg)'
- en: 'Figure 14.30: Adding panels to your Splunk dashboard'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.30：向您的Splunk仪表板添加面板
- en: Click the `Add to Dashboard` button to add the new panel to the bottom of the
    dashboard as a single value panel.
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击“添加到仪表板”按钮，将新面板添加到仪表板底部作为单个值面板。
- en: While the dashboard is in edit mode, you can move and resize the panels if needed
    and add extra headings or details. When you are happy with your new panel, click
    the `Save` button at the top-right of the screen.
  id: totrans-269
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在编辑模式下，您可以根据需要移动和调整面板的大小，并添加额外的标题或详细信息。当您对新面板感到满意时，请单击屏幕右上角的“保存”按钮。
- en: 'Your dashboard should hopefully look similar to the following:'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 希望您的仪表板看起来类似于以下内容：
- en: '![Figure 14.31: Adding new panels to your dashboards'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: '![图14.31：向您的仪表板添加新面板'
- en: '](image/B15021_14_31.jpg)'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_31.jpg)'
- en: 'Figure 14.31: Adding new panels to your dashboards'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.31：向您的仪表板添加新面板
- en: Finally, your dashboard panel has some extra functions, which you can find by
    clicking on the ellipses button at the top-right of the screen. If you are unhappy
    with your dashboard, you can delete it from here.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，您的仪表板面板具有一些额外的功能，您可以通过单击屏幕右上角的省略号按钮找到这些功能。如果您对您的仪表板不满意，您可以从这里删除它。
- en: 'Click the `Set as Home Dashboard Panel` option, which is available under the
    ellipses button. This will take you back to the Splunk home screen, where your
    `Log Container Dashboard` is now available and will be the first thing you see
    when you log in to Splunk:![Figure 14.32: Log Container Dashboard'
  id: totrans-275
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击“设置为主页仪表板面板”选项，该选项在省略号按钮下可用。这将带您回到Splunk主屏幕，在那里您的“日志容器仪表板”现在可用，并且在登录到Splunk时将是您看到的第一件事：![图14.32：日志容器仪表板
- en: '](image/B15021_14_32.jpg)'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_32.jpg)'
- en: 'Figure 14.32: Log Container Dashboard'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.32：日志容器仪表板
- en: This exercise has shown you how to perform basic queries, chain them together
    with functions, and start to create visualizations, dashboards, and panels. Although
    we've only spent a brief amount of time on this subject, it should give you a
    lot more confidence to work further with your Splunk queries.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 这个练习向您展示了如何执行基本查询，如何使用函数将它们链接在一起，并开始创建可视化效果、仪表板和面板。虽然我们只花了很短的时间来讨论这个主题，但它应该让您更有信心进一步处理Splunk查询。
- en: In the next section, we will look at what Splunk apps are and how they can help
    to separate your data, searches, reports, and dashboards into different areas.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将看看Splunk应用程序是什么，以及它们如何帮助将您的数据、搜索、报告和仪表板分隔到不同的区域。
- en: Splunk App and Saved Searches
  id: totrans-280
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Splunk应用程序和保存的搜索
- en: Splunk apps are a way for you to separate your data, searches, reports, and
    dashboards into separate areas where you can then configure who can access what.
    Splunk provides a large ecosystem to help third-party developers and companies
    provide these apps to the general public.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: Splunk应用程序是一种让您将数据、搜索、报告和仪表板分隔到不同区域的方式，然后您可以配置谁可以访问什么。Splunk提供了一个庞大的生态系统，帮助第三方开发人员和公司向公众提供这些应用程序。
- en: We mentioned earlier in this chapter that Splunk also provides "SplunkBase"
    for approved apps that have been certified for users by Splunk, such as apps for
    Cisco Network Devices. It doesn't need to be an approved app for it to be available
    for use on your system. Splunk allows you to create apps of your own, and if you
    need to, you can distribute them in a packaged file across to users who wish to
    use them. The whole point of Splunk apps, dashboards, and saved searches is to
    reduce the amount of work that is duplicated, as well as providing information
    to non-technical users when needed.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在本章前面提到过，Splunk还提供了“SplunkBase”，用于由Splunk为用户认证的已批准应用程序，例如用于思科网络设备的应用程序。它不需要是经过批准的应用程序才能在您的系统上使用。Splunk允许您创建自己的应用程序，如果需要，您可以将它们打包成文件分发给希望使用它们的用户。Splunk应用程序、仪表板和保存的搜索的整个目的是减少重复的工作量，并在需要时向非技术用户提供信息。
- en: The following exercise will provide you with some hands-on experience in terms
    of working with Splunk apps.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 以下练习将为您提供一些关于使用Splunk应用程序的实际经验。
- en: 'Exercise 14.04: Getting Familiar with Splunk Apps and Saved Searches'
  id: totrans-284
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习14.04：熟悉Splunk应用程序和保存搜索
- en: 'In this exercise, you will install new apps from SplunkBase and modify them
    to suit your needs. This exercise will also show you how to save your searches
    for future use:'
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，您将从SplunkBase安装新的应用程序，并对其进行修改以满足您的需求。这个练习还将向您展示如何保存您的搜索以备将来使用。
- en: Make sure your Splunk container is running and that the `log-generator` container
    is sending data to Splunk.
  id: totrans-286
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保您的Splunk容器正在运行，并且`log-generator`容器正在向Splunk发送数据。
- en: When you are logged back in to Splunk, click the cog icon next to the word `Apps`
    in the `Apps` menu. When you are taken to the `Apps` page, you should see something
    similar to the following. The page contains a list of all Splunk apps currently
    installed on your system. You'll notice that some are enabled, while some are
    disabled.
  id: totrans-287
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当您重新登录Splunk时，请单击“应用程序”菜单中“应用程序”旁边的齿轮图标。当您进入“应用程序”页面时，您应该会看到类似以下内容。该页面包含当前安装在系统上的所有Splunk应用程序的列表。您会注意到一些应用程序已启用，而一些已禁用。
- en: 'You also have the option to browse more apps from the Splunk app base, install
    an app from a file, or create your own Splunk app:'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以选择从Splunk应用程序库中浏览更多应用程序，安装来自文件的应用程序，或创建自己的Splunk应用程序：
- en: '![Figure 14.33: Working with the Apps page in Splunk'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: '![图14.33：在Splunk中使用应用程序页面'
- en: '](image/B15021_14_33.jpg)'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_33.jpg)'
- en: 'Figure 14.33: Working with the Apps page in Splunk'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.33：在Splunk中使用应用程序页面
- en: Click the `Browse more apps` button at the top of the screen.
  id: totrans-292
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击屏幕顶部的“浏览更多应用程序”按钮。
- en: 'You''ll be taken to a page that provides a list of all the Splunk apps available
    to your system. Some of them are paid, but the majority of them are free to use
    and install. You can also search by name, category, and support level. Enter `Departures
    Board Viz` in the search box at the top of the screen and click *Enter*:![Figure
    14.34: Departures Board Viz app'
  id: totrans-293
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将进入一个页面，该页面提供了系统中所有可用的Splunk应用程序的列表。其中一些是付费的，但大多数是免费使用和安装的。您还可以按名称、类别和支持级别进行搜索。在屏幕顶部的搜索框中输入“离港板Viz”，然后单击*Enter*：![图14.34：离港板Viz应用程序
- en: '](image/B15021_14_34.jpg)'
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_34.jpg)'
- en: 'Figure 14.34: Departures Board Viz app'
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.34：离港板Viz应用程序
- en: Note
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: This section uses the `Departures Board Viz` app as an example because it is
    easy to use and install, with minimal changes needed. Each app should give you
    some details on the type of information it uses and how to start working with
    the data needed. You'll notice there are hundreds of apps to choose from, so you're
    sure to find something that suits your needs.
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 本节以“Departures Board Viz”应用为例，因为它易于使用和安装，只需进行最小的更改。每个应用程序都应该为您提供有关其使用的信息类型以及如何开始使用所需数据的一些详细信息。您会注意到有数百种应用程序可供选择，因此您一定会找到适合您需求的东西。
- en: 'You need to have registered with Splunk to be able to install and use the apps
    available. Click the `Install` button for the `Departures Board Viz` app and follow
    the prompts to sign in, if needed:![Figure 14.35: Installing the Departures Board
    Viz app'
  id: totrans-298
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您需要在Splunk注册后才能安装和使用可用的应用程序。单击“Departures Board Viz”应用的“安装”按钮，并按照提示进行登录，如果需要的话：![图14.35：安装Departures
    Board Viz应用
- en: '](image/B15021_14_35.jpg)'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_35.jpg)'
- en: 'Figure 14.35: Installing the Departures Board Viz app'
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.35：安装Departures Board Viz应用
- en: If the installation was successful, you should be given the prompt to either
    open the app you have just installed or return to the Splunk home page. Return
    to the home page to see the changes you have made.
  id: totrans-301
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果安装成功，您应该会收到提示，要么打开您刚刚安装的应用程序，要么返回到Splunk主页。返回主页以查看您所做的更改。
- en: 'From the home page, you should now see that the new app, called `Departures
    Board Viz`, has been installed. This is simply a visualization extension. Click
    the `Departures Board Vis` button on the home screen to open the app:![Figure
    14.36: Opening the Departures Board Viz app'
  id: totrans-302
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从主页，您现在应该看到已安装了名为“Departures Board Viz”的新应用程序。这只是一个可视化扩展。单击主屏幕上的“Departures
    Board Vis”按钮以打开该应用程序：![图14.36：打开Departures Board Viz应用
- en: '](image/B15021_14_36.jpg)'
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_36.jpg)'
- en: 'Figure 14.36: Opening the Departures Board Viz app'
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.36：打开Departures Board Viz应用
- en: 'When you open the app, it will take you to the `About` page. This is simply
    a dashboard that provides details of the app and how to use it with your data.
    Click the `Edit` button at the top of the screen to continue:![Figure 14.37: The
    About page of the Departures Board Viz app'
  id: totrans-305
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当您打开应用程序时，它将带您到“关于”页面。这只是一个提供应用程序详细信息以及如何与您的数据一起使用的仪表板。单击屏幕顶部的“编辑”按钮以继续：![图14.37：Departures
    Board Viz应用的“关于”页面
- en: '](image/B15021_14_37.jpg)'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_37.jpg)'
- en: 'Figure 14.37: The About page of the Departures Board Viz app'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.37：Departures Board Viz应用的“关于”页面
- en: Click `Edit Search` to add a new search that displays data specific to you.
  id: totrans-308
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击“编辑搜索”以添加一个新的搜索，显示特定于您的数据。
- en: 'Remove the default search string and place the `sourcetype=httpevent | stats
    count by level | sort - count | head 1 | fields level` search query in the textbox.
    The query will look through your `log-generator` data and provide a count of each
    level. Then, sort the results from the highest to lowest order (`sort - count`)
    and provide the level with the top value (`head 1 | fields level`):![Figure 14.38:
    Adding a new search query'
  id: totrans-309
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 删除默认搜索字符串，并将“sourcetype=httpevent | stats count by level | sort - count | head
    1 | fields level”搜索查询放入文本框中。该查询将浏览您的“log-generator”数据，并提供每个级别的计数。然后，将结果从最高到最低排序（`sort
    - count`），并提供具有最高值的级别（`head 1 | fields level`）：![图14.38：添加新的搜索查询
- en: '](image/B15021_14_38.jpg)'
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_38.jpg)'
- en: 'Figure 14.38: Adding a new search query'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.38：添加新的搜索查询
- en: 'Click the `Save` button to save the changes you''ve made to the visualization.
    Instead of a city name that is provided by default by `Departures Board Viz`,
    you should see the top error level provided in our data. As shown in the following
    screenshot, the top error being reported in our logs is `INFO`:![Figure 14.39:
    Editing Splunk apps in Splunk'
  id: totrans-312
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击“保存”按钮以保存您对可视化所做的更改。您应该看到我们的数据提供的最高错误级别，而不是“Departures Board Viz”默认提供的城市名称。如下截图所示，我们日志中报告的最高错误是“INFO”：![图14.39：在Splunk中编辑应用程序
- en: '](image/B15021_14_39.jpg)'
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_39.jpg)'
- en: 'Figure 14.39: Editing Splunk apps in Splunk'
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.39：在Splunk中编辑应用程序
- en: Now that you've added a Splunk app, you will create a very basic app of your
    own to modify your environment further. Move back to the home screen and, once
    again, click on the cog next to the `Apps` menu.
  id: totrans-315
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在您已经添加了一个Splunk应用程序，您将创建一个非常基本的应用程序来进一步修改您的环境。返回到主屏幕，再次点击“应用程序”菜单旁边的齿轮。
- en: 'On the `Apps` page, click on the `Create app` button on the right-hand side
    of the screen:![Figure 14.40: Splunk apps'
  id: totrans-316
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在“应用程序”页面上，单击屏幕右侧的“创建应用程序”按钮：![图14.40：Splunk应用程序
- en: '](image/B15021_14_40.jpg)'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_40.jpg)'
- en: 'Figure 14.40: Splunk apps'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.40：Splunk应用程序
- en: 'When you create an app of your own, you''ll be presented with a form similar
    to the one shown here. You are going to create a test app for your Splunk install.
    Fill in the form using the information provided in the following screenshot, but
    make sure you add values for `Name` and `Folder Name`. The version is also a required
    field and needs to be in the form of `major_version.minor_version.patch_version`.
    Add the version number as `1.0.0`. The following example has also selected the
    `sample_app` option instead of the `barebones` template. This means the app will
    be filled with sample dashboards and reports that you can modify for the data
    you are working on. You won''t be working with any of these sample dashboards
    and reports, so you can choose either. The `Upload asset` option is only needed
    if you have a pre-created Splunk app available, but in our instance, it can be
    left blank:![Figure 14.41: Creating a Splunk app'
  id: totrans-319
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当您创建自己的应用程序时，您将看到一个类似于此处所示的表单。您将为您的Splunk安装创建一个测试应用程序。使用以下截图中提供的信息填写表单，但确保为“名称”和“文件夹名称”添加值。版本也是一个必填字段，需要以“major_version.minor_version.patch_version”的形式。将版本号添加为“1.0.0”。以下示例还选择了“sample_app”选项，而不是“barebones”模板。这意味着该应用程序将填充有示例仪表板和报告，您可以修改这些示例以适应您正在处理的数据。您不会使用任何这些示例仪表板和报告，因此您可以选择任何一个。如果您有预先创建的Splunk应用程序可用，则只需要“上传资产”选项，但在我们的实例中，可以将其留空：![图14.41：创建Splunk应用程序
- en: '](image/B15021_14_41.jpg)'
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_41.jpg)'
- en: 'Figure 14.41: Creating a Splunk app'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.41：创建Splunk应用程序
- en: 'Click the `Save` button to create your new app and then move back to the home
    screen of your installation. You''ll notice that you now have an app listed on
    your home screen called `Test Splunk App`. Click on your new app to open it up:![Figure
    14.42: Test Splunk app on the home screen'
  id: totrans-322
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击“保存”按钮以创建您的新应用程序，然后返回到您的安装的主屏幕。您会注意到现在在主屏幕上列出了一个名为“Test Splunk App”的应用程序。单击您的新应用程序以打开它：![图14.42：主屏幕上的测试Splunk应用程序
- en: '](image/B15021_14_42.jpg)'
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_42.jpg)'
- en: 'Figure 14.42: Test Splunk app on the home screen'
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.42：主屏幕上的测试Splunk应用程序
- en: The app won't look any different to the `Search & Reporting` app, but if you
    click the `Reports or Dashboards` tab at the top of the screen, you will notice
    that there will be some sample reports and dashboards in place. For the time being,
    though, create a report you can refer to at a later date. Start by making sure
    you are in the `Search` tab of your app.
  id: totrans-325
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 该应用程序在“搜索和报告”应用程序中看起来并无不同，但是如果您点击屏幕顶部的“报告或仪表板”选项卡，您会注意到已经有一些示例报告和仪表板。不过，暂时创建一个您以后可以参考的报告。首先确保您在应用程序的“搜索”选项卡中。
- en: Enter `sourcetype=httpevent earliest=-7d | timechart span=1d count by level`
    into the query bar. You'll notice we have set the value to `earliest=-7d`, which
    automatically selects the previous 7 days of data so that you do not need to specify
    the time range for your search. It will then create a time chart of your data,
    totaling the values by each day.
  id: totrans-326
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在查询栏中输入`sourcetype=httpevent earliest=-7d | timechart span=1d count by level`。您会注意到我们已将值设置为`earliest=-7d`，这样会自动选择过去7天的数据，因此您无需指定搜索的时间范围。然后它将创建您的数据的时间图表，按每天的值进行汇总。
- en: 'Click the `Save As` button at the top of the screen and select `Report` from
    the drop-down menu. You''ll be presented with the following form so that you can
    save your report. Simply name the report and provide a description before clicking
    on the `Save` button at the bottom of the screen:![Figure 14.43: Creating saved
    reports in your Splunk app'
  id: totrans-327
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击屏幕顶部的“另存为”按钮，然后从下拉菜单中选择“报告”。然后您将看到以下表单，以便保存您的报告。只需在点击屏幕底部的“保存”按钮之前命名报告并提供描述：![图14.43：在您的Splunk应用程序中创建保存的报告
- en: '](image/B15021_14_43.jpg)'
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_43.jpg)'
- en: 'Figure 14.43: Creating saved reports in your Splunk app'
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.43：在您的Splunk应用程序中创建保存的报告
- en: 'When you click `Save`, you''ll be given the option to view your new report.
    It should look similar to the following:![Figure 14.44: Daily Error Levels report
    in Splunk'
  id: totrans-330
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当您点击“保存”时，您将有选项查看您的新报告。它应该看起来类似于以下内容：![图14.44：Splunk中的每日错误级别报告
- en: '](image/B15021_14_44.jpg)'
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_44.jpg)'
- en: 'Figure 14.44: Daily Error Levels report in Splunk'
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.44：Splunk中的每日错误级别报告
- en: 'If you ever need to refer to this report again, you can click on the `Reports`
    tab of your new Splunk app, and it will be listed with the sample reports that
    were provided when the app was first created. The following screenshot shows the
    `Reports` tab of your app with the sample reports listed, but you also have the
    `Daily Errors` report you just created, which has been added to the top of the
    list:'
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您以后需要再次参考此报告，可以点击您的新Splunk应用程序的“报告”选项卡，它将与应用程序首次创建时提供的示例报告一起列出。以下屏幕截图显示了您的应用程序的“报告”选项卡，其中列出了示例报告，但您还有刚刚创建的“每日错误”报告，它已添加到列表的顶部：
- en: '![Figure 14.45: Reports page'
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: '![图14.45：报告页面'
- en: '](image/B15021_14_45.jpg)'
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_45.jpg)'
- en: 'Figure 14.45: Reports page'
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.45：报告页面
- en: This brings us to the end of this exercise, in which we have installed third-party
    Splunk apps and created our own. This also brings us to the end of this chapter.
    However, before you move on to the next chapter, make sure you work through the
    activities provided next to reaffirm everything you've learned in this chapter.
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 这就结束了这个练习，我们在其中安装了第三方Splunk应用程序并创建了自己的应用程序。这也是本章的结束。不过，在您继续下一章之前，请确保您通过下面提供的活动来重新确认您在本章学到的一切。
- en: 'Activity 14.01: Creating a docker-compose.yml File for Your Splunk Installation'
  id: totrans-338
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 活动14.01：为您的Splunk安装创建docker-compose.yml文件
- en: So far, you have been running Splunk on a Docker container by simply using the
    `docker run` command. It's time to use the knowledge you have gained in the previous
    sections of this book to create a `docker-compose.yml` file so that you can install
    and run our Splunk environment on your system when needed. As part of this activity,
    add one of the containers being run as a part of the Panoramic Trekking App. Also,
    ensure that you can view logs from the selected service.
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，您一直在使用`docker run`命令简单地在Docker容器上运行Splunk。现在是时候利用您在本书前几节中所学到的知识，创建一个`docker-compose.yml`文件，以便在需要时在您的系统上安装和运行我们的Splunk环境。作为这个活动的一部分，添加作为全景徒步应用程序一部分运行的一个容器。还要确保您可以查看所选服务的日志。
- en: 'Perform the following steps to complete this activity:'
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤以完成此活动：
- en: Decide how you would like your Splunk installation to look once it is running
    as part of your Docker Compose file. This will include mounting directories and
    ports that need to be exposed as part of the installation.
  id: totrans-341
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 决定一旦作为Docker Compose文件的一部分运行起来，您希望您的Splunk安装看起来如何。这将包括挂载目录和需要作为安装的一部分暴露的端口。
- en: Create your `docker-compose.yml` file and run `Docker Compose`. Make sure it
    starts up your Splunk installation as per your requirements in the previous step.
  id: totrans-342
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建您的`docker-compose.yml`文件并运行`Docker Compose`。确保它根据上一步中的要求启动您的Splunk安装。
- en: Once the Splunk installation is up and running, start up a service from the
    Panoramic Trekking App and make sure you can send log data to your Splunk setup.
  id: totrans-343
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦Splunk安装运行起来，启动全景徒步应用程序的一个服务，并确保您可以将日志数据发送到您的Splunk设置中。
- en: '**Expected Output:**'
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: '**预期输出：**'
- en: 'This should result in a screen similar to the following:'
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 这应该会产生一个类似以下的屏幕：
- en: '![Figure 14.46: Expected output for Activity 14.01'
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: '![图14.46：活动14.01的预期输出'
- en: '](image/B15021_14_46.jpg)'
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_46.jpg)'
- en: 'Figure 14.46: Expected output for Activity 14.01'
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.46：活动14.01的预期输出
- en: Note
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: The solution for this activity can be found via [this link](B15021_Solution_Final_SMP.xhtml#_idTextAnchor356).
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: 此活动的解决方案可以通过[此链接](B15021_Solution_Final_SMP.xhtml#_idTextAnchor356)找到。
- en: The next activity will allow you to create a Splunk app and dashboard for the
    new data being logged in Splunk.
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个活动将允许您为Splunk中记录的新数据创建一个Splunk应用程序和仪表板。
- en: 'Activity 14.02: Creating a Splunk App to Monitor the Panoramic Trekking App'
  id: totrans-352
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 活动14.02：创建一个Splunk应用程序来监视全景徒步应用程序
- en: In the previous activity, you made sure one of the services that had been set
    up as part of the Panoramic Trekking App was logging data with your Splunk environment.
    In this activity, you are required to create a new Splunk app within your installation
    to specifically monitor your services and create a dashboard relevant to the service
    logging data into Splunk.
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一个活动中，您确保了作为全景徒步应用程序的一部分设置的一个服务正在使用您的Splunk环境记录数据。在这个活动中，您需要在您的安装中创建一个新的Splunk应用程序，以专门监视您的服务，并创建一个与向Splunk记录数据的服务相关的仪表板。
- en: 'The steps you''ll need to follow in order to complete this activity are as
    follows:'
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要按照以下步骤完成此活动：
- en: Ensure your Splunk installation is running and that at least one service from
    the Panoramic Trekking App is logging data into Splunk.
  id: totrans-355
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保您的Splunk安装正在运行，并且来自全景徒步应用程序的至少一个服务正在向Splunk记录数据。
- en: Create a new Splunk app and name it something relevant to monitoring the Panoramic
    Trekking App. Make sure you can view it from the Splunk home screen.
  id: totrans-356
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新的Splunk应用程序，并为监视全景徒步应用程序命名一个相关的名称。确保您可以从Splunk主屏幕查看它。
- en: Create a dashboard relevant to the services you're monitoring and add some visualizations
    to help you monitor your service.
  id: totrans-357
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个与您正在监视的服务相关的仪表板，并添加一些可视化效果，以帮助您监视您的服务。
- en: '**Expected Output**:'
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: '**预期输出：**'
- en: 'A dashboard similar to the following should be displayed upon successful completion
    of this activity:'
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 成功完成此活动后，应显示类似以下的仪表板：
- en: '![Figure 14.47: Expected solution for Activity 14.02'
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: '![图14.47：活动14.02的预期解决方案'
- en: '](image/B15021_14_47.jpg)'
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: '](image/B15021_14_47.jpg)'
- en: 'Figure 14.47: Expected solution for Activity 14.02'
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.47：活动14.02的预期解决方案
- en: Note
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: The solution for this activity can be found via [this link](B15021_Solution_Final_SMP.xhtml#_idTextAnchor357).
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 此活动的解决方案可通过[此链接](B15021_Solution_Final_SMP.xhtml#_idTextAnchor357)找到。
- en: Summary
  id: totrans-365
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: This chapter taught you how applications such as Splunk can help you monitor
    and troubleshoot your applications by aggregating your container logs into one
    central area. We started this chapter with a discussion on the importance of a
    log management strategy when working with Docker, and then introduced Splunk by
    discussing its architecture, as well as some of the finer points on how to run
    the application.
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 本章教会了您如何使用诸如Splunk之类的应用程序来帮助您通过将容器日志聚合到一个中心区域来监视和排除故障您的应用程序。我们从讨论在使用Docker时日志管理策略的重要性开始了本章，然后通过讨论其架构以及如何运行该应用程序的一些要点来介绍了Splunk。
- en: We worked directly with Splunk, running the Docker container image, and started
    to forward logs from our running system. We then used the Splunk log driver to
    send our container logs directly to our Splunk container, mounting important directories
    to make sure our data was saved and available even after we stopped our container
    from running. Finally, we took a closer look at the Splunk query language, with
    which we created dashboards and saved searches and considered the advantages of
    the Splunk app ecosystem.
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: 我们直接使用Splunk运行Docker容器映像，并开始将日志从我们的运行系统转发。然后，我们使用Splunk日志驱动程序将我们的容器日志直接发送到我们的Splunk容器，挂载重要目录以确保我们的数据即使在停止容器运行后也能保存和可用。最后，我们更仔细地研究了Splunk查询语言，通过它我们创建了仪表板和保存搜索，并考虑了Splunk应用程序生态系统的优势。
- en: The next chapter will introduce Docker plugins and teach you how to utilize
    them to help extend your containers and the services running on them.
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: 下一章将介绍Docker插件，并教您如何利用它们来帮助扩展您的容器和运行在其上的服务。
