["```\napiVersion: audit.k8s.io/v1 # This is required.\nkind: Policy\n# Skip generating audit events for all requests in RequestReceived stage. This can be either set at the policy level or rule level.\nomitStages:\n\u00a0\u00a0- \"RequestReceived\"\nrules:\n\u00a0\u00a0# Log pod changes at RequestResponse level\n\u00a0\u00a0- level: RequestResponse\n\u00a0\u00a0\u00a0\u00a0verbs: [\"create\", \"update\"]\n\u00a0\u00a0\u00a0\u00a0namespace: [\"ns1\", \"ns2\", \"ns3\"]\n\u00a0\u00a0\u00a0\u00a0resources:\n\u00a0\u00a0\u00a0\u00a0- group: \"\"\n# Only check access to resource \"pods\", not the sub-resource of pods which is consistent with the RBAC policy.\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0resources: [\"pods\"]\n# Log \"pods/log\", \"pods/status\" at Metadata level\n\u00a0\u00a0- level: Metadata\n\u00a0\u00a0\u00a0\u00a0resources:\n\u00a0\u00a0\u00a0\u00a0- group: \"\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0resources: [\"pods/log\", \"pods/status\"]\n# Don't log authenticated requests to certain non-resource URL paths.\n\u00a0\u00a0- level: None\n\u00a0\u00a0\u00a0\u00a0userGroups: [\"system:authenticated\"]\n\u00a0\u00a0\u00a0\u00a0nonResourceURLs: [\"/api*\", \"/version\"]\n# Log configmap and secret changes in all other namespaces at the Metadata level.\n\u00a0\u00a0- level: Metadata\n\u00a0\u00a0\u00a0\u00a0resources:\n\u00a0\u00a0\u00a0\u00a0- group: \"\" # core API group\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0resources: [\"secrets\", \"configmaps\"]\n```", "```\n{\n\u00a0\u00a0\"kind\": \"Event\",\n\u00a0\u00a0\"apiVersion\": \"audit.k8s.io/v1\",\n\u00a0\u00a0\"level\": \"Metadata\",\n\u00a0\u00a0\"auditID\": \"05698e93-6ad7-4f4e-8ae9-046694bee469\",\n\u00a0\u00a0\"stage\": \"ResponseComplete\",\n\u00a0\u00a0\"requestURI\": \"/api/v1/namespaces/ns1/pods\",\n\u00a0\u00a0\"verb\": \"create\",\n\u00a0\u00a0\"user\": {\n\u00a0\u00a0\u00a0\u00a0\"username\": \"admin\",\n\u00a0\u00a0\u00a0\u00a0\"uid\": \"admin\",\n\u00a0\u00a0\u00a0\u00a0\"groups\": [\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"system:masters\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"system:authenticated\"\n\u00a0\u00a0\u00a0\u00a0]\n\u00a0\u00a0},\n\u00a0\u00a0\"sourceIPs\": [\n\u00a0\u00a0\u00a0\u00a0\"98.207.36.92\"\n\u00a0\u00a0],\n\u00a0\u00a0\"userAgent\": \"kubectl/v1.17.4 (darwin/amd64) kubernetes/8d8aa39\",\n\u00a0\u00a0\"objectRef\": {\n\u00a0\u00a0\u00a0\u00a0\"resource\": \"pods\",\n\u00a0\u00a0\u00a0\u00a0\"namespace\": \"ns1\",\n\u00a0\u00a0\u00a0\u00a0\"name\": \"pod-1\",\n\u00a0\u00a0\u00a0\u00a0\"apiVersion\": \"v1\"\n\u00a0\u00a0},\n\u00a0\u00a0\"responseStatus\": {\n\u00a0\u00a0\u00a0\u00a0\"metadata\": {},\n\u00a0\u00a0\u00a0\u00a0\"code\": 201\n\u00a0\u00a0},\n\u00a0\u00a0\"requestReceivedTimestamp\": \"2020-04-09T07:10:52.471720Z\",\n\u00a0\u00a0\"stageTimestamp\": \"2020-04-09T07:10:52.485551Z\",\n\u00a0\u00a0\"annotations\": {\n\u00a0\u00a0\u00a0\u00a0\"authorization.k8s.io/decision\": \"allow\",\n\u00a0\u00a0\u00a0\u00a0\"authorization.k8s.io/reason\": \"\"\n\u00a0\u00a0}\n}\n```", "```\n\u00a0\u00a0\"requestObject\": {\n\u00a0\u00a0\u00a0\u00a0\"kind\": \"Pod\",\n\u00a0\u00a0\u00a0\u00a0\"apiVersion\": \"v1\",\n\u00a0\u00a0\u00a0\u00a0\"metadata\": {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"name\": \"pod-2\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"namespace\": \"ns2\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"creationTimestamp\": null,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0...\n\u00a0\u00a0\u00a0\u00a0},\n\u00a0\u00a0\u00a0\u00a0\"spec\": {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"containers\": [\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"name\": \"echo\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"image\": \"busybox\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"command\": [\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"sh\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"-c\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"echo 'this is echo' && sleep 1h\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0],\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0...\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"imagePullPolicy\": \"Always\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0],\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0...\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"securityContext\": {},\n\u00a0\u00a0\u00a0\u00a0},\n```", "```\n{\n\u00a0\u00a0\"responseObject\": {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0...\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"selfLink\": \"/api/v1/namespaces/ns3/pods/pod-3\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"uid\": \"3fd18de1-7a31-11ea-9e8d-0a39f00d8287\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"resourceVersion\": \"217243\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"creationTimestamp\": \"2020-04-09T07:10:53Z\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"tolerations\": [\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"key\": \"node.kubernetes.io/not-ready\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"operator\": \"Exists\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"effect\": \"NoExecute\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"tolerationSeconds\": 300\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0},\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"key\": \"node.kubernetes.io/unreachable\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"operator\": \"Exists\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"effect\": \"NoExecute\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"tolerationSeconds\": 300\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0],\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0...\n\u00a0\u00a0\u00a0\u00a0},\n }\n```", "```\napiVersion: v1\nkind: Config\nclusters:\n- name: falco\n\u00a0\u00a0cluster:\n\u00a0\u00a0\u00a0\u00a0server: http://$FALCO_SERVICE_CLUSTERIP:8765/k8s_audit\ncontexts:\n- context:\n\u00a0\u00a0\u00a0\u00a0cluster: falco\n\u00a0\u00a0\u00a0\u00a0user: \"\"\n\u00a0\u00a0name: default-context\ncurrent-context: default-context\npreferences: {}\nusers: []\n```", "```\n$ kubectl get pods -n kube-system\n...\netcd-manager-events-ip-172-20-109-109.ec2.internal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 1/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a04h15m\netcd-manager-events-ip-172-20-43-65.ec2.internal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 1/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a04h16m\netcd-manager-events-ip-172-20-67-151.ec2.internal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a04h16m\netcd-manager-main-ip-172-20-109-109.ec2.internal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 1/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a04h15m\netcd-manager-main-ip-172-20-43-65.ec2.internal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 1/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a04h15m\netcd-manager-main-ip-172-20-67-151.ec2.internal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a04h16m\nkube-apiserver-ip-172-20-109-109.ec2.internal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 3\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a04h15m\nkube-apiserver-ip-172-20-43-65.ec2.internal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 4\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a04h16m\nkube-apiserver-ip-172-20-67-151.ec2.internal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 1/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 4\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a04h15m\nkube-controller-manager-ip-172-20-109-109.ec2.internal\u00a0\u00a0 1/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a04h15m\nkube-controller-manager-ip-172-20-43-65.ec2.internal\u00a0\u00a0\u00a0\u00a0 1/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a04h16m\nkube-controller-manager-ip-172-20-67-151.ec2.internal\u00a0\u00a0\u00a0\u00a01/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a04h15m\nkube-scheduler-ip-172-20-109-109.ec2.internal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a04h15m\nkube-scheduler-ip-172-20-43-65.ec2.internal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a04h15m\nkube-scheduler-ip-172-20-67-151.ec2.internal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 1/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a04h16m\n```", "```\nexport NODE_SIZE=${NODE_SIZE:-t2.large}\nexport MASTER_SIZE=${MASTER_SIZE:-t2.medium}\nexport ZONES=${ZONES:-\"us-east-1a,us-east-1b,us-east-1c\"}\nexport KOPS_STATE_STORE=\"s3://my-k8s-state-store2/\"\nkops create cluster k8s-clusters.k8s-demo-zone.com \\\n\u00a0\u00a0--cloud aws \\\n\u00a0\u00a0--node-count 3 \\\n\u00a0\u00a0--zones $ZONES \\\n\u00a0\u00a0--node-size $NODE_SIZE \\\n\u00a0\u00a0--master-size $MASTER_SIZE \\\n\u00a0\u00a0--master-zones $ZONES \\\n\u00a0\u00a0--networking calico \\\n\u00a0\u00a0--kubernetes-version 1.14.3 \\\n\u00a0\u00a0--yes \\\n```", "```\n$ kops validate cluster\n...\nINSTANCE GROUPS\nNAME\t\t\tROLE\tMACHINETYPE\tMIN\tMAX\tSUBNETS\nmaster-us-east-1a\tMaster\tt2.medium\t1\t1\tus-east-1a\nmaster-us-east-1b\tMaster\tt2.medium\t1\t1\tus-east-1b\nmaster-us-east-1c\tMaster\tt2.medium\t1\t1\tus-east-1c\nnodes\t\t\tNode\tt2.large\t3\t3\tus-east-1a,us-east-1b,us-east-1c\n```", "```\nhelm install vault --set='server.dev.enabled=true' https://github.com/hashicorp/vault-helm/archive/v0.4.0.tar.gz\n```", "```\n$ kubectl get pods\nNAME\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0READY\u00a0\u00a0 STATUS\u00a0\u00a0\u00a0\u00a0RESTARTS\u00a0\u00a0 AGE\nvault-0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 1/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a080s\nvault-agent-injector-7fd6b9588b-fgsnj\u00a0\u00a0 1/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a080s\n```", "```\nvault kv put secret/postgres username=alice password=pass\n```", "```\ncat <<EOF > /home/vault/app-policy.hcl\npath \"secret*\" {\n\u00a0\u00a0capabilities = [\"read\"]\n}\nEOF\nvault policy write app /home/vault/app-policy.hcl\n```", "```\nvault auth enable kubernetes\nvault write auth/kubernetes/config \\\n\u00a0\u00a0 token_reviewer_jwt=\"$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\" \\\n\u00a0\u00a0 kubernetes_host=https://${KUBERNETES_PORT_443_TCP_ADDR}:443 \\\n\u00a0\u00a0 kubernetes_ca_cert=@/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\nvault write auth/kubernetes/role/myapp \\\n\u00a0\u00a0 bound_service_account_names=app \\\n\u00a0\u00a0 bound_service_account_namespaces=demo \\\n\u00a0\u00a0 policies=app \\\n\u00a0\u00a0 ttl=24h\n```", "```\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n\u00a0\u00a0name: app\n\u00a0\u00a0labels:\n\u00a0\u00a0\u00a0\u00a0app: vault-agent-demo\nspec:\n\u00a0\u00a0selector:\n\u00a0\u00a0\u00a0\u00a0matchLabels:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0app: vault-agent-demo\n\u00a0\u00a0replicas: 1\n\u00a0\u00a0template:\n\u00a0\u00a0\u00a0\u00a0metadata:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0annotations:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0labels:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0app: vault-agent-demo\n\u00a0\u00a0\u00a0\u00a0spec:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0serviceAccountName: app\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0containers:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- name: app\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0image: jweissig/app:0.0.1\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n\u00a0\u00a0name: app\n\u00a0\u00a0labels:\n\u00a0\u00a0\u00a0\u00a0app: vault-agent-demo\n```", "```\n$ kubectl get pods\nNAME\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0READY\u00a0\u00a0 STATUS\u00a0\u00a0\u00a0\u00a0RESTARTS\u00a0\u00a0 AGE\napp-668b8bcdb9-js9mm\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a03m23s\n```", "```\n$ cat patch-template-annotation.yaml\nspec:\n\u00a0\u00a0template:\n\u00a0\u00a0\u00a0\u00a0metadata:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0annotations:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0vault.hashicorp.com/agent-inject: \"true\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0vault.hashicorp.com/agent-inject-status: \"update\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0vault.hashicorp.com/agent-inject-secret-postgres: \"secret/postgres\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0vault.hashicorp.com/agent-inject-template-postgres: |\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0{{- with secret \"secret/postgres\" -}}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0postgresql://{{ .Data.data.username }}:{{ .Data.data.password }}@postgres:5432/wizard\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0{{- end }}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0vault.hashicorp.com/role: \"myapp\"\n```", "```\n$ kubectl get pods\nNAME\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0READY\u00a0\u00a0 STATUS\u00a0\u00a0\u00a0\u00a0RESTARTS\u00a0\u00a0 AGE\napp-68d47bb844-2hlrb\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a02/2\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a013s\n$ kubectl -n demo exec -it app-68d47bb844-2hlrb -c app -- cat /vault/secrets/postgres\npostgresql://alice:pass@postgres:5432/wizard\n```", "```\n\u00a0\u00a0containers:\n\u00a0\u00a0- image: jweissig/app:0.0.1\n\u00a0\u00a0\u00a0\u00a0...\n\u00a0\u00a0\u00a0\u00a0volumeMounts:\n\u00a0\u00a0\u00a0\u00a0- mountPath: /vault/secrets\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0name: vault-secrets\n\u00a0\u00a0- args:\n\u00a0\u00a0\u00a0\u00a0- echo ${VAULT_CONFIG?} | base64 -d > /tmp/config.json && vault agent -config=/tmp/config.json\n\u00a0\u00a0\u00a0\u00a0command:\n\u00a0\u00a0\u00a0\u00a0- /bin/sh\n\u00a0\u00a0\u00a0\u00a0- -ec\n\u00a0\u00a0\u00a0\u00a0image: vault:1.3.2\n\u00a0\u00a0\u00a0\u00a0name: vault-agent\n\u00a0\u00a0\u00a0\u00a0volumeMounts:\n\u00a0\u00a0\u00a0\u00a0- mountPath: /vault/secrets\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0name: vault-secrets\n initContainers:\n\u00a0\u00a0- args:\n\u00a0\u00a0\u00a0\u00a0- echo ${VAULT_CONFIG?} | base64 -d > /tmp/config.json && vault agent -config=/tmp/config.json\n\u00a0\u00a0\u00a0\u00a0command:\n\u00a0\u00a0\u00a0\u00a0- /bin/sh\n\u00a0\u00a0\u00a0\u00a0- -ec\n\u00a0\u00a0\u00a0\u00a0image: vault:1.3.2\n\u00a0\u00a0\u00a0\u00a0name: vault-agent-init\n\u00a0\u00a0\u00a0\u00a0volumeMounts:\n\u00a0\u00a0\u00a0\u00a0- mountPath: /vault/secrets\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0name: vault-secrets\n\u00a0\u00a0volumes:\n\u00a0\u00a0\u00a0- emptyDir:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0medium: Memory\n\u00a0\u00a0\u00a0\u00a0name: vault-secrets\n```", "```\napiVersion: admissionregistration.k8s.io/v1beta1\nkind: MutatingWebhookConfiguration\nmetadata:\n\u00a0\u00a0...\n\u00a0\u00a0name: vault-agent-injector-cfg\nwebhooks:\n- admissionReviewVersions:\n\u00a0\u00a0- v1beta1\n\u00a0\u00a0clientConfig:\n\u00a0\u00a0\u00a0\u00a0caBundle: <CA_BUNDLE>\n\u00a0\u00a0\u00a0\u00a0service:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0name: vault-agent-injector-svc\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0namespace: demo\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0path: /mutate\n\u00a0\u00a0failurePolicy: Ignore\n\u00a0\u00a0name: vault.hashicorp.com\n\u00a0\u00a0namespaceSelector: {}\n\u00a0\u00a0rules:\n\u00a0\u00a0- apiGroups:\n\u00a0\u00a0\u00a0\u00a0- \"\"\n\u00a0\u00a0\u00a0\u00a0apiVersions:\n\u00a0\u00a0\u00a0\u00a0- v1\n\u00a0\u00a0\u00a0\u00a0operations:\n\u00a0\u00a0\u00a0\u00a0- CREATE\n\u00a0\u00a0\u00a0\u00a0- UPDATE\n\u00a0\u00a0\u00a0\u00a0resources:\n\u00a0\u00a0\u00a0\u00a0- pods\n\u00a0\u00a0\u00a0\u00a0scope: '*'\n```", "```\nvault kv put secret/postgres username=alice password=changeme\n```", "```\n$ kubectl -n demo exec -it app-68d47bb844-2hlrb -c app -- cat /vault/secrets/postgres\npostgresql://alice:changeme@postgres:5432/wizard\n```", "```\nhelm install --name falco stable/falco\n```", "```\n$ kubectl get pods\nNAME\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0READY\u00a0\u00a0 STATUS\u00a0\u00a0\u00a0\u00a0RESTARTS\u00a0\u00a0 AGE\nfalco-9h8tg\u00a0\u00a0 1/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 10\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 62m\nfalco-cnt47\u00a0\u00a0 1/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a03m45s\nfalco-mz6jg\u00a0\u00a0 1/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a06s\nfalco-t4cpw\u00a0\u00a0 1/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a010s\n```", "```\n\u00a0\u00a0\u00a0\u00a0- rule: Anomalous read in nginx pod\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0desc: Detect any anomalous file read activities in Nginx pod.\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0condition: (open_read and container and container.image.repository=\"kaizheh/insecure-nginx\" and fd.directory != \"/usr/share/nginx/html\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0output: Anomalous file read activity in Nginx pod (user=%user.name process=%proc.name file=%fd.name container_id=%container.id image=%container.image.repository)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0priority: WARNING\n```", "```\n# curl insecure-nginx.insecure-nginx.svc.cluster.local/files../etc/passwd\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\n_apt:x:100:65534::/nonexistent:/bin/false\n```", "```\n08:22:19.484698397: Warning Anomalous file read activity in Nginx pod (user=<NA> process=nginx file=/etc/passwd container_id=439e2e739868 image=kaizheh/insecure-nginx) k8s.ns=insecure-nginx k8s.pod=insecure-nginx-7c99fdf44b-gffp4 container=439e2e739868 k8s.ns=insecure-nginx k8s.pod=insecure-nginx-7c99fdf44b-gffp4 container=439e2e739868\n```", "```\n- list: trusted_images\n\u00a0\u00a0items: [calico/node, kopeio/etcd-manager, k8s.gcr.io/kube-apiserver, k8s.gcr.io/kube-controller-manager, k8s.gcr.io/kube-proxy, k8s.gcr.io/kube-scheduler]\n- rule: Untrusted Image Deployed in kube-system Namespace\n\u00a0\u00a0desc: >\n\u00a0\u00a0\u00a0\u00a0Detect an untrusted image deployed in kube-system namespace\n\u00a0\u00a0condition: >\n\u00a0\u00a0\u00a0\u00a0kevt and pod\n\u00a0\u00a0\u00a0\u00a0and kcreate\n\u00a0\u00a0\u00a0\u00a0and ka.target.namespace=kube-system\n\u00a0\u00a0\u00a0\u00a0and not ka.req.pod.containers.image.repository in (trusted_images)\n\u00a0\u00a0output: Untrusted image deployed in kube-system namespace (user=%ka.user.name image=%ka.req.pod.containers.image.repository resource=%ka.target.name)\n\u00a0\u00a0priority: WARNING\n\u00a0\u00a0source: k8s_audit\n\u00a0\u00a0tags: [k8s]\n```", "```\n21:47:15.063915008: Warning Untrusted image deployed in kube-system namespace (user=admin image=busybox resource=pod-1)\n```", "```\necho \"{\\\"experimental\\\":true}\" >> /etc/docker/daemon.json\n```", "```\n# docker checkpoint\nUsage:\tdocker checkpoint COMMAND\nManage checkpoints\nOptions:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0--help\u00a0\u00a0 Print usage\nCommands:\n\u00a0\u00a0create\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Create a checkpoint from a running container\n\u00a0\u00a0ls\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0List checkpoints for a container\n\u00a0\u00a0rm\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Remove a checkpoint\n```", "```\n# docker run -d --name looper --security-opt seccomp:unconfined busybox /bin/sh -c 'i=0; while true; do echo $i; i=$(expr $i + 1); sleep 1; done'\n91d68fafec8fcf11e7699539dec0b037220b1fcc856fb7050c58ab90ae8cbd13\n```", "```\n# sleep 5\n# docker logs looper\n0\n1\n2\n3\n4\n5\n```", "```\n# docker checkpoint create --checkpoint-dir=/tmp looper checkpoint\ncheckpoint\n```", "```\n# docker create --name looper-clone --security-opt seccomp:unconfined busybox /bin/sh -c 'i=0; while true; do echo $i; i=$(expr $i + 1); sleep 1; done'\n49b9ade200e7da6bbb07057da02570347ad6fefbfc1499652ed286b874b59f2b\n```", "```\n# docker start --checkpoint-dir=/tmp --checkpoint=checkpoint looper-clone\n# sleep 5\n# docker logs looper-clone\n6\n7\n8\n9\n10\n```", "```\n08:22:19.484698397: Warning Anomalous file read activity in Nginx pod (user=<NA> process=nginx file=/etc/passwd container_id=439e2e739868 image=kaizheh/insecure-nginx) k8s.ns=insecure-nginx k8s.pod=insecure-nginx-7c99fdf44b-gffp4 container=439e2e739868 k8s.ns=insecure-nginx k8s.pod=insecure-nginx-7c99fdf44b-gffp4 container=439e2e739868\n```", "```\n$ kubectl plugin list\nThe following compatible plugins are available:\n/Users/kaizhehuang/.krew/bin/kubectl-advise_psp\n/Users/kaizhehuang/.krew/bin/kubectl-capture\n/Users/kaizhehuang/.krew/bin/kubectl-ctx\n/Users/kaizhehuang/.krew/bin/kubectl-krew\n/Users/kaizhehuang/.krew/bin/kubectl-ns\n/Users/kaizhehuang/.krew/bin/kubectl-sniff\n```", "```\n$ kubectl capture insecure-nginx-7c99fdf44b-4fl5s -ns insecure-nginx\nSysdig is starting to capture system calls:\nNode: ip-172-20-42-49.ec2.internal\nPod: insecure-nginx-7c99fdf44b-4fl5s\nDuration: 120 seconds\nParameters for Sysdig: -S -M 120 -pk -z -w /capture-insecure-nginx-7c99fdf44b-4fl5s-1587337260.scap.gz\nThe capture has been downloaded to your hard disk at:\n/Users/kaizhehuang/demo/chapter11/sysdig/capture-insecure-nginx-7c99fdf44b-4fl5s-1587337260.scap.gz\n```", "```\n$ docker run -d -v /Users/kaizhehuang/demo/chapter11/sysdig:/captures -p3000:3000 sysdig/sysdig-inspect:latest\n17533f98a947668814ac6189908ff003475b10f340d8f3239cd3627fa9747769\n```", "```\n$ kubectl get pods -o wide\nNAME\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0READY\u00a0\u00a0 STATUS\u00a0\u00a0\u00a0\u00a0RESTARTS\u00a0\u00a0 AGE\u00a0\u00a0 IP\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 NODE\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 NOMINATED NODE\u00a0\u00a0 READINESS GATES\nanchore-cli\u00a0\u00a0 1/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 1\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a077m\u00a0\u00a0 100.123.226.66\u00a0\u00a0 ip-172-20-42-49.ec2.internal\u00a0\u00a0 <none>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 <none>\n$ kubectl get pods -n insecure-nginx -o wide\nNAME\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0READY\u00a0\u00a0 STATUS\u00a0\u00a0\u00a0\u00a0RESTARTS\u00a0\u00a0 AGE\u00a0\u00a0 IP\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 NODE\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 NOMINATED NODE\u00a0\u00a0 READINESS GATES\ninsecure-nginx-7c99fdf44b-4fl5s\u00a0\u00a0 1/1\u00a0\u00a0\u00a0\u00a0 Running\u00a0\u00a0 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a078m\u00a0\u00a0 100.123.226.65\u00a0\u00a0 ip-172-20-42-49.ec2.internal\u00a0\u00a0 <none>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 <none>\n```"]