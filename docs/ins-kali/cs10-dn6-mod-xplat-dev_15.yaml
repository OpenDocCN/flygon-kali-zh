- en: '15'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '15'
- en: Building Websites Using the Model-View-Controller Pattern
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用模型-视图-控制器模式构建网站
- en: This chapter is about building websites with a modern HTTP architecture on the
    server side using Microsoft ASP.NET Core MVC, including the startup configuration,
    authentication, authorization, routes, request and response pipeline, models,
    views, and controllers that make up an ASP.NET Core MVC project.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章介绍了如何使用 Microsoft ASP.NET Core MVC 在服务器端使用现代 HTTP 架构构建网站，包括启动配置、身份验证、授权、路由、请求和响应管道、模型、视图和控制器，这些组成了
    ASP.NET Core MVC 项目。
- en: 'This chapter will cover the following topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下主题：
- en: Setting up an ASP.NET Core MVC website
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置 ASP.NET Core MVC 网站
- en: Exploring an ASP.NET Core MVC website
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索 ASP.NET Core MVC 网站
- en: Customizing an ASP.NET Core MVC website
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自定义 ASP.NET Core MVC 网站
- en: Querying a database and using display templates
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查询数据库并使用显示模板
- en: Improving scalability using asynchronous tasks
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用异步任务来提高可伸缩性
- en: Setting up an ASP.NET Core MVC website
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置 ASP.NET Core MVC 网站
- en: ASP.NET Core Razor Pages are great for simple websites. For more complex websites,
    it would be better to have a more formal structure to manage that complexity.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: ASP.NET Core Razor Pages 非常适合简单的网站。对于更复杂的网站，最好有一个更正式的结构来管理复杂性。
- en: 'This is where the **Model-View-Controller** (**MVC** ) design pattern is useful.
    It uses technologies like Razor Pages, but allows a cleaner separation between
    technical concerns, as shown in the following list:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是 **模型-视图-控制器**（**MVC**）设计模式有用的地方。它使用像 Razor Pages 这样的技术，但允许在技术关注点之间进行更清晰的分离，如下列表所示：
- en: '**Models** : Classes that represent the data entities and view models used
    on the website.'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**模型**：代表网站上使用的数据实体和视图模型的类。'
- en: '**Views** : Razor files, that is, `.cshtml` files, that render data in view
    models into HTML web pages. Blazor uses the `.razor` file extension, but do not
    confuse them with Razor files!'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**视图**：Razor 文件，即 `.cshtml` 文件，用于将视图模型中的数据呈现为 HTML 网页。Blazor 使用 `.razor` 文件扩展名，但不要将它们与
    Razor 文件混淆！'
- en: '**Controllers** : Classes that execute code when an HTTP request arrives at
    the web server. The controller methods usually create a view model that may contain
    entity models and passes it to a view to generate an HTTP response to send back
    to the web browser or other client.'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**控制器**：当 HTTP 请求到达 Web 服务器时执行代码的类。控制器方法通常创建一个视图模型，其中可能包含实体模型，并将其传递给视图以生成要发送回
    Web 浏览器或其他客户端的 HTTP 响应。'
- en: The best way to understand using the MVC design pattern for web development
    is to see a working example.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 了解如何使用 MVC 设计模式进行 Web 开发的最佳方法是看一个实际的示例。
- en: Creating an ASP.NET Core MVC website
  id: totrans-16
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建 ASP.NET Core MVC 网站
- en: You will use a project template to create an ASP.NET Core MVC website project
    that has a database for authenticating and authorizing users. Visual Studio 2022
    defaults to using SQL Server LocalDB for the accounts database. Visual Studio
    Code (or more accurately the `dotnet` tool) uses SQLite by default and you can
    specify a switch to use SQL Server LocalDB instead.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 您将使用项目模板创建一个具有用于验证和授权用户的数据库的 ASP.NET Core MVC 网站项目。Visual Studio 2022 默认使用 SQL
    Server LocalDB 作为帐户数据库。Visual Studio Code（或更准确地说是 `dotnet` 工具）默认使用 SQLite，并且您可以指定一个开关来使用
    SQL Server LocalDB。
- en: 'Let''s see it in action:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看它的运行方式：
- en: 'Use your preferred code editor to add a MVC website project with authentication
    accounts stored in a database, as defined in the following list:'
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用您喜欢的代码编辑器添加一个具有存储在数据库中的身份验证帐户的 MVC 网站项目，如下列表所定义：
- en: 'Project template: **ASP.NET Core Web App (Model-View-Controller)** / `mvc`'
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 项目模板：**ASP.NET Core Web App (Model-View-Controller)** / `mvc`
- en: 'Language: C#'
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 语言：C#
- en: 'Workspace/solution file and folder: `PracticalApps`'
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 工作区/解决方案文件和文件夹：`PracticalApps`
- en: 'Project file and folder: `Northwind.Mvc`'
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 项目文件和文件夹：`Northwind.Mvc`
- en: 'Options: **Authentication Type: Individual Accounts** / `--auth Individual`'
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选项：**身份验证类型：个人帐户** / `--auth Individual`
- en: For Visual Studio, leave all other options as their defaults
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于 Visual Studio，将所有其他选项保留为默认值
- en: In Visual Studio Code, select `Northwind.Mvc` as the active OmniSharp project.
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Visual Studio Code 中，将 `Northwind.Mvc` 选择为活动的 OmniSharp 项目。
- en: Build the `Northwind.Mvc` project.
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建 `Northwind.Mvc` 项目。
- en: 'At the command line or terminal, use the `help` switch to see other options
    for this project template, as shown in the following command:'
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在命令行或终端中，使用 `help` 开关查看此项目模板的其他选项，如下命令所示：
- en: '```cs'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: dotnet new mvc --help
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: dotnet new mvc --help
- en: '```'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'Note the results, as shown in the following partial output:'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注意结果，如下部分输出所示：
- en: '```cs'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: ASP.NET Core Web App (Model-View-Controller) (C#)
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: ASP.NET Core Web App (Model-View-Controller) (C#)
- en: 'Author: Microsoft'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 作者：Microsoft
- en: 'Description: A project template for creating an ASP.NET Core application with
    example ASP.NET Core MVC Views and Controllers. This template can also be used
    for RESTful HTTP services.'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 描述：用于创建具有示例 ASP.NET Core MVC 视图和控制器的 ASP.NET Core 应用程序的项目模板。此模板也可用于 RESTful
    HTTP 服务。
- en: This template contains technologies from parties other than Microsoft, see https://aka.ms/aspnetcore/6.0-third-party-notices
    for details.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 此模板包含来自 Microsoft 以外的其他方的技术，请参阅 https://aka.ms/aspnetcore/6.0-third-party-notices
    了解详情。
- en: '```'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'There are many options, especially related to authentication, as shown in the
    following table:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 有许多选项，特别是与身份验证相关的选项，如下表所示：
- en: '| Switches | Description |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
  zh: '| 开关 | 描述 |'
- en: '| `-au&#124;--auth` | The type of authentication to use:`None` (default): This
    choice also allows you to disable HTTPS.`Individual` : Individual authentication
    that stores registered users and their passwords in a database (SQLite by default).
    We will use this in the project we create for this chapter.`IndividualB2C` : Individual
    authentication with Azure AD B2C.`SingleOrg` : Organizational authentication for
    a single tenant.`MultiOrg` : Organizational authentication for multiple tenants.`Windows`
    : Windows authentication. Mostly useful for intranets. |'
  id: totrans-41
  prefs: []
  type: TYPE_TB
  zh: '| `-au&#124;--auth` | 要使用的身份验证类型：`None`（默认）：此选择还允许您禁用HTTPS。`Individual`：将注册用户及其密码存储在数据库中（默认为SQLite）的个人身份验证。我们将在本章为此项目使用此选项。`IndividualB2C`：带有Azure
    AD B2C的个人身份验证。`SingleOrg`：单租户的组织身份验证。`MultiOrg`：多租户的组织身份验证。`Windows`：Windows身份验证。对于内部网络非常有用。|'
- en: '| `-uld&#124;--use-local-db` | Whether to use SQL Server LocalDB instead of
    SQLite. This option only applies if `--auth Individual` or `--auth IndividualB2C`
    is specified. The value is an optional `bool` with a default of `false` . |'
  id: totrans-42
  prefs: []
  type: TYPE_TB
  zh: '| `-uld&#124;--use-local-db` | 是否使用SQL Server LocalDB而不是SQLite。此选项仅适用于指定了`--auth
    Individual`或`--auth IndividualB2C`的情况。该值是一个可选的`bool`，默认值为`false`。|'
- en: '| `-rrc&#124;--razor-runtime-compilation` | Determines if the project is configured
    to use Razor runtime compilation in `Debug` builds. This can improve the performance
    of startup during debugging because it can defer the compilation of Razor views.
    The value is an optional `bool` with a default of `false` . |'
  id: totrans-43
  prefs: []
  type: TYPE_TB
  zh: '| `-rrc&#124;--razor-runtime-compilation` | 确定项目是否在`Debug`构建中配置为使用Razor运行时编译。这可以提高调试期间启动的性能，因为它可以推迟Razor视图的编译。该值是一个可选的`bool`，默认值为`false`。|'
- en: '| `-f&#124;--framework` | The target framework for the project. Values can
    be: `net6.0` (default), `net5.0` , or `netcoreapp3.1` |'
  id: totrans-44
  prefs: []
  type: TYPE_TB
  zh: '| `-f&#124;--framework` | 项目的目标框架。值可以是：`net6.0`（默认），`net5.0`或`netcoreapp3.1`|'
- en: Creating the authentication database for SQL Server LocalDB
  id: totrans-45
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 为SQL Server LocalDB创建身份验证数据库
- en: If you created the MVC project using Visual Studio 2022, or you used `dotnet
    new mvc` with the `-uld` or `--use-local-db` switch, then the database for authentication
    and authorization will be stored in SQL Server LocalDB. But the database does
    not yet exist. Let's create it now.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您使用Visual Studio 2022创建了MVC项目，或者使用了`dotnet new mvc`与`-uld`或`--use-local-db`开关，则用于身份验证和授权的数据库将存储在SQL
    Server LocalDB中。但是数据库尚不存在。现在让我们创建它。
- en: 'At a command prompt or terminal, in the `Northwind.Mvc` folder, enter the command
    to run database migrations so that the database used to store credentials for
    authentication is created, as shown in the following command:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 在`Northwind.Mvc`文件夹中的命令提示符或终端中，输入命令以运行数据库迁移，以便创建用于存储身份验证凭据的数据库，如下命令所示：
- en: '```cs'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: dotnet ef database update
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: dotnet ef database update
- en: '```'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: If you created the MVC project using `dotnet new` , then the database for authentication
    and authorization will be stored in SQLite and the file has already been created
    named `app.db` .
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您使用`dotnet new`创建了MVC项目，则用于身份验证和授权的数据库将存储在SQLite中，并且文件已经创建，名称为`app.db`。
- en: The connection string for the authentication database is named `DefaultConnection`
    and it is stored in the `appsettings.json` file in the root folder for the MVC
    website project.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 用于身份验证数据库的连接字符串名为`DefaultConnection`，存储在MVC网站项目的根文件夹中的`appsettings.json`文件中。
- en: 'For SQL Server LocalDB (with a truncated connection string), see the following
    markup:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 对于SQL Server LocalDB（带有截断的连接字符串），请参阅以下标记：
- en: '```cs'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '{'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: '"ConnectionStrings"'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '"ConnectionStrings"'
- en: ': {'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: ': {'
- en: '"DefaultConnection"'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '"DefaultConnection"'
- en: ': "Server=(localdb)\\mssqllocaldb;Database=aspnet-Northwind.Mvc-...;Trusted_Connection=True;MultipleActiveResultSets=true"'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: ': "Server=(localdb)\\mssqllocaldb;Database=aspnet-Northwind.Mvc-...;Trusted_Connection=True;MultipleActiveResultSets=true"'
- en: '},'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '},'
- en: '```'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'For SQLite, see the following markup:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 对于SQLite，请参阅以下标记：
- en: '```cs'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '{'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: '"ConnectionStrings"'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: '"ConnectionStrings"'
- en: ': {'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: ': {'
- en: '"DefaultConnection"'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '"DefaultConnection"'
- en: ': "DataSource=app.db;Cache=Shared"'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: ': "DataSource=app.db;Cache=Shared"'
- en: '},'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: '},'
- en: '```'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Exploring the default ASP.NET Core MVC website
  id: totrans-71
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 探索默认的ASP.NET Core MVC网站
- en: 'Let''s review the behavior of the default ASP.NET Core MVC website project
    template:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们回顾一下默认的ASP.NET Core MVC网站项目模板的行为：
- en: 'In the `Northwind.Mvc` project, expand the `Properties` folder, open the `launchSettings.json`
    file, and note the random port numbers (yours will be different) configured for
    the project for `HTTPS` and `HTTP` , as shown in the following markup:'
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Northwind.Mvc`项目中，展开`Properties`文件夹，打开`launchSettings.json`文件，并注意为项目配置的`HTTPS`和`HTTP`的随机端口号（您的端口号将不同），如下标记所示：
- en: '```cs'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '"profiles"'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '"profiles"'
- en: ': {'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: ': {'
- en: '"Northwind.Mvc"'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '"Northwind.Mvc"'
- en: ': {'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: ': {'
- en: '"commandName"'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: '"commandName"'
- en: ': "Project"'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: ': "Project"'
- en: ','
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: ，
- en: '"dotnetRunMessages"'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '"dotnetRunMessages"'
- en: ': true'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: ': true'
- en: ','
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: ，
- en: '"launchBrowser"'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: '"launchBrowser"'
- en: ': true'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: ': true'
- en: ','
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: ，
- en: '"applicationUrl"'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: '"applicationUrl"'
- en: ': "https://localhost:7274;http://localhost:5274"'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: ': "https://localhost:7274;http://localhost:5274"'
- en: ','
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: ，
- en: '"environmentVariables"'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '"environmentVariables"'
- en: ': {'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: ': {'
- en: '"ASPNETCORE_ENVIRONMENT"'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: '"ASPNETCORE_ENVIRONMENT"'
- en: ': "Development"'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: ': "Development"'
- en: '}'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '},'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '},'
- en: '```'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'Change the port numbers to `5001` for `HTTPS` and `5000` for `HTTP` , as shown
    in the following markup:'
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将端口号更改为`5001`（`HTTPS`）和`5000`（`HTTP`），如下标记所示：
- en: '```cs'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '"applicationUrl"'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: '"applicationUrl"'
- en: ': "https://localhost:5001;http://localhost:5000"'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: ': "https://localhost:5001;http://localhost:5000"'
- en: ','
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: ，
- en: '```'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Save the changes to the `launchSettings.json` file.
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存对`launchSettings.json`文件的更改。
- en: Start the website.
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动网站。
- en: Start Chrome and open **Developer Tools** .
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动Chrome并打开**Developer Tools**。
- en: 'Navigate to `http://localhost:5000/` and note the following, as shown in *Figure
    15.1* :'
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到`http://localhost:5000/`，并注意以下内容，如*图15.1*所示：
- en: Requests for HTTP are automatically redirected to HTTPS on port `5001` .
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: HTTP的请求会自动重定向到端口`5001`上的HTTPS。
- en: The top navigation menu with links to **Home** , **Privacy** , **Register**
    , and **Login** . If the viewport width is 575 pixels or less, then the navigation
    collapses into a hamburger menu.
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 顶部导航菜单链接到**Home**，**Privacy**，**Register**和**Login**。如果视口宽度小于或等于575像素，则导航会折叠成汉堡菜单。
- en: The title of the website, **Northwind.Mvc** , shown in the header and footer.![](img/Image00120.jpg)
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网站的标题**Northwind.Mvc**显示在页眉和页脚中。![](img/Image00120.jpg)
- en: 'Figure 15.1: The ASP.NET Core MVC project template website home page'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.1：ASP.NET Core MVC项目模板网站首页
- en: Understanding visitor registration
  id: totrans-112
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 理解访客注册
- en: By default, passwords must have at least one non-alphanumeric character, they
    must have at least one digit (0-9), and they must have at least one uppercase
    letter (A-Z). I use `Pa$$w0rd` in scenarios like this when I am just exploring.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，密码必须至少包含一个非字母数字字符，必须至少包含一个数字（0-9），并且必须至少包含一个大写字母（A-Z）。在这种情况下，我会使用`Pa$$w0rd`，因为我只是在探索。
- en: The MVC project template follows best practice for **double-opt-in** (**DOI**
    ), meaning that after filling in an email and password to register, an email is
    sent to the email address, and the visitor must click a link in that email to
    confirm that they want to register.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: MVC项目模板遵循**双重确认**（**DOI**）的最佳实践，这意味着在填写电子邮件和密码进行注册后，会向该电子邮件地址发送一封电子邮件，访客必须点击该电子邮件中的链接以确认他们想要注册。
- en: 'We have not yet configured an email provider to send that email, so we must
    simulate that step:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还没有配置电子邮件提供程序来发送该电子邮件，所以我们必须模拟该步骤：
- en: In the top navigation menu, click **Register** .
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在顶部导航菜单中，点击**注册**。
- en: Enter an email and password, and then click the **Register** button. (I used
    `test@example.com` and `Pa$$w0rd` .)
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入电子邮件和密码，然后点击**注册**按钮。（我使用了`test@example.com`和`Pa$$w0rd`。）
- en: Click the link with the text **Click here to confirm your account** and note
    that you are redirected to a **Confirm email** web page that you could customize.
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击带有文本**点击此处确认您的帐户**的链接，并注意您被重定向到一个**确认电子邮件**网页，您可以自定义。
- en: In the top navigation menu, click **Login** , enter your email and password
    (note that there is an optional checkbox to remember you, and there are links
    if the visitor has forgotten their password or they want to register as a new
    visitor), and then click the **Log in** button.
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在顶部导航菜单中，点击**登录**，输入您的电子邮件和密码（请注意，有一个可选的复选框可以记住您，如果访客忘记了密码或者想要注册为新访客，还有链接），然后点击**登录**按钮。
- en: Click your email address in the top navigation menu. This will navigate to an
    account management page. Note that you can set a phone number, change your email
    address, change your password, enable two-factor authentication (if you add an
    authenticator app), and download and delete your personal data.
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击顶部导航菜单中的您的电子邮件地址。这将导航到一个帐户管理页面。请注意，您可以设置电话号码，更改电子邮件地址，更改密码，启用双因素身份验证（如果您添加了身份验证器应用程序），以及下载和删除您的个人数据。
- en: Close Chrome and shut down the web server.
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭Chrome并关闭Web服务器。
- en: Reviewing an MVC website project structure
  id: totrans-122
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 审查MVC网站项目结构
- en: 'In your code editor, in Visual Studio **Solution Explorer** (toggle on **Show
    All Files** ) or in Visual Studio Code **EXPLORER** , review the structure of
    an MVC website project, as shown in *Figure 15.2* :'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 在您的代码编辑器中，在Visual Studio **Solution Explorer**（切换到**显示所有文件**）或在Visual Studio
    Code **EXPLORER**中，查看MVC网站项目的结构，如*图15.2*所示：
- en: '![](img/Image00121.jpg)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image00121.jpg)'
- en: 'Figure 15.2: The default folder structure of an ASP.NET Core MVC project'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.2：ASP.NET Core MVC项目的默认文件夹结构
- en: 'We will look in more detail at some of these parts later, but for now, note
    the following:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 我们稍后会更详细地查看其中的一些部分，但现在请注意以下内容：
- en: '`Areas` : This folder contains nested folders and a file needed to integrate
    your website project with **ASP.NET Core Identity** , which is used for authentication.'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Areas`：这个文件夹包含了用于将您的网站项目与**ASP.NET Core Identity**集成的必需的嵌套文件夹和文件，用于身份验证。'
- en: '`bin` , `obj` : These folders contain temporary files needed during the build
    process and the compiled assemblies for the project.'
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`bin`，`obj`：这些文件夹包含了在构建过程中需要的临时文件和项目的编译程序集。'
- en: '`Controllers` : This folder contains C# classes that have methods (known as
    actions) that fetch a model and pass it to a view, for example, `HomeController.cs`
    .'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Controllers`：这个文件夹包含了C#类，其中有方法（称为操作），用于获取模型并将其传递给视图，例如`HomeController.cs`。'
- en: '`Data` : This folder contains Entity Framework Core migration classes used
    by the ASP.NET Core Identity system to provide data storage for authentication
    and authorization, for example, `ApplicationDbContext.cs` .'
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Data`：这个文件夹包含了Entity Framework Core迁移类，用于ASP.NET Core Identity系统提供身份验证和授权的数据存储，例如`ApplicationDbContext.cs`。'
- en: '`Models` : This folder contains C# classes that represent all of the data gathered
    together by a controller and passed to a view, for example, `ErrorViewModel.cs`
    .'
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Models`：这个文件夹包含了代表控制器收集并传递给视图的所有数据的C#类，例如`ErrorViewModel.cs`。'
- en: '`Properties` : This folder contains a configuration file for IIS or IIS Express
    on Windows and for launching the website during development named `launchSettings.json`
    . This file is only used on the local development machine and is not deployed
    to your production website.'
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Properties`：这个文件夹包含了一个用于在Windows上启动网站时配置IIS或IIS Express的配置文件，名为`launchSettings.json`。这个文件只在本地开发机器上使用，不会部署到生产网站上。'
- en: '`Views` : This folder contains the `.cshtml` Razor files that combine HTML
    and C# code to dynamically generate HTML responses. The `_ViewStart` file sets
    the default layout and `_ViewImports` imports common namespaces used in all views
    like tag helpers:'
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Views`：这个文件夹包含了`.cshtml` Razor文件，用于动态生成HTML响应的HTML和C#代码。`_ViewStart`文件设置了默认布局，`_ViewImports`导入了所有视图中使用的常见命名空间，如标签助手：'
- en: '`Home` : This subfolder contains Razor files for the home and privacy pages.'
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Home`：这个子文件夹包含了主页和隐私页面的Razor文件。'
- en: '`Shared` : This subfolder contains Razor files for the shared layout, an error
    page, and two partial views for logging in and validation scripts.'
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Shared`：这个子文件夹包含了共享布局、错误页面以及用于登录和验证脚本的两个部分视图的Razor文件。'
- en: '`wwwroot` : This folder contains static content used by the website, such as
    CSS for styling, libraries of JavaScript, JavaScript for this website project,
    and a `favicon.ico` file. You also put images and other static file resources
    like PDF documents in here. The project template includes Bootstrap and jQuery
    libraries.'
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`wwwroot`：此文件夹包含网站使用的静态内容，例如用于样式的CSS，JavaScript库，用于此网站项目的JavaScript和`favicon.ico`文件。您还可以在此处放置图像和其他静态文件资源，如PDF文档。项目模板包括Bootstrap和jQuery库。'
- en: '`app.db` : This is the SQLite database that stores registered visitors. (If
    you used SQL Server LocalDB, then it will not be needed.)'
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`app.db`：这是存储注册访客的SQLite数据库。（如果您使用了SQL Server LocalDB，则将不需要。）'
- en: '`appsettings.json` and `appsettings.Development.json` : These files contain
    settings that your website can load at runtime, for example, the database connection
    string for the ASP.NET Core Identity system and logging levels.'
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`appsettings.json`和`appsettings.Development.json`：这些文件包含您的网站可以在运行时加载的设置，例如ASP.NET
    Core Identity系统的数据库连接字符串和日志级别。'
- en: '`Northwind.Mvc.csproj` : This file contains project settings like the use of
    the Web .NET SDK, an entry for SQLite to ensure that the `app.db` file is copied
    to the website''s output folder, and a list of NuGet packages that your project
    requires, including:'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Northwind.Mvc.csproj`：此文件包含项目设置，例如使用Web .NET SDK，SQLite的条目以确保`app.db`文件被复制到网站的输出文件夹，并且项目所需的NuGet包列表，包括：'
- en: '`Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore`'
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore`'
- en: '`Microsoft.AspNetCore.Identity.EntityFrameworkCore`'
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Microsoft.AspNetCore.Identity.EntityFrameworkCore`'
- en: '`Microsoft.AspNetCore.Identity.UI`'
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Microsoft.AspNetCore.Identity.UI`'
- en: '`Microsoft.EntityFrameworkCore.Sqlite` or `Microsoft.EntityFrameworkCore.SqlServer`'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Microsoft.EntityFrameworkCore.Sqlite`或`Microsoft.EntityFrameworkCore.SqlServer`'
- en: '`Microsoft.EntityFrameworkCore.Tools`'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Microsoft.EntityFrameworkCore.Tools`'
- en: '`Program.cs` : This file defines a hidden `Program` class that contains the
    `Main` entry point. It builds a pipeline for processing incoming HTTP requests
    and hosts the website using default options like configuring the Kestrel web server
    and loading `appsettings` . It adds and configures services that your website
    needs, for example, ASP.NET Core Identity for authentication, SQLite or SQL Server
    for identity data storage, and so on, and routes for your application.'
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Program.cs`：此文件定义了一个隐藏的`Program`类，其中包含`Main`入口点。它构建了一个用于处理传入HTTP请求的管道，并使用默认选项托管网站，例如配置Kestrel
    Web服务器和加载`appsettings`。它添加和配置了网站所需的服务，例如用于身份验证的ASP.NET Core Identity，用于身份数据存储的SQLite或SQL
    Server等，并为应用程序添加了路由。'
- en: Reviewing the ASP.NET Core Identity database
  id: totrans-146
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 审查ASP.NET Core Identity数据库
- en: 'Open `appsettings.json` to find the connection string used for the ASP.NET
    Core Identity database, as shown highlighted for SQL Server LocalDB in the following
    markup:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 打开`appsettings.json`以查找用于ASP.NET Core Identity数据库的连接字符串，如以下标记中对SQL Server LocalDB进行了突出显示的那样：
- en: '```cs'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '{'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: '"ConnectionStrings"'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: '"ConnectionStrings"'
- en: ': {'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: ': {'
- en: '"DefaultConnection"'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: '"DefaultConnection"'
- en: ': "'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: ': "'
- en: '**Server=(localdb)\\mssqllocaldb;Database=aspnet-Northwind.Mvc-2F6A1E12-F9CF-480C-987D-FEFB4827DE22;Trusted_Connection=True;MultipleActiveResultSets=true**'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: '**Server=(localdb)\\mssqllocaldb;Database=aspnet-Northwind.Mvc-2F6A1E12-F9CF-480C-987D-FEFB4827DE22;Trusted_Connection=True;MultipleActiveResultSets=true**'
- en: '"'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: '"'
- en: '},'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: '},'
- en: '"Logging"'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: '"Logging"'
- en: ': {'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: ': {'
- en: '"LogLevel"'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: '"LogLevel"'
- en: ': {'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: ': {'
- en: '"Default"'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: '"默认"'
- en: ': "Information"'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: ': "信息"'
- en: ','
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: ，
- en: '"Microsoft"'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: '"Microsoft"'
- en: ': "Warning"'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: ': "警告"'
- en: ','
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: ，
- en: '"Microsoft.Hosting.Lifetime"'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: '"Microsoft.Hosting.Lifetime"'
- en: ': "Information"'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: ': "信息"'
- en: '}'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '},'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: '},'
- en: '"AllowedHosts"'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: '"AllowedHosts"'
- en: ': "*"'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: ': "*"'
- en: '}'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '```'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: If you used SQL Server LocalDB for the identity data store, then you can use
    **Server Explorer** to connect to the database. You can copy and paste the connection
    string from the `appsettings.json` file (but remove the second backslash between
    `(localdb)` and `mssqllocaldb` ).
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您使用SQL Server LocalDB作为身份数据存储，则可以使用**服务器资源管理器**连接到数据库。您可以从`appsettings.json`文件中复制并粘贴连接字符串（但删除`(localdb)`和`mssqllocaldb`之间的第二个反斜杠）。
- en: If you installed an SQLite tool such as SQLiteStudio, then you can open the
    SQLite `app.db` database file.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您安装了SQLiteStudio等SQLite工具，则可以打开SQLite `app.db`数据库文件。
- en: You can then see the tables that the ASP.NET Core Identity system uses to register
    users and roles, including the `AspNetUsers` table used to store the registered
    visitor.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，您可以看到ASP.NET Core Identity系统用于注册用户和角色的表，包括用于存储注册访客的`AspNetUsers`表。
- en: '**Good Practice** : The ASP.NET Core MVC project template follows good practice
    by storing a hash of the password instead of the password itself, which you will
    learn more about in *Chapter 20* , *Protecting Your Data and Applications* (available
    at [https://github.com/markjprice/cs10dotnet6/blob/main/9781801077361_Bonus_Content.pdf](https://github.com/markjprice/cs10dotnet6/blob/main/9781801077361_Bonus_Content.pdf)
    ) .'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: '**良好实践**：ASP.NET Core MVC项目模板遵循良好实践，存储密码的哈希而不是密码本身，您将在*第20章* *保护您的数据和应用程序*中了解更多（可在[https://github.com/markjprice/cs10dotnet6/blob/main/9781801077361_Bonus_Content.pdf](https://github.com/markjprice/cs10dotnet6/blob/main/9781801077361_Bonus_Content.pdf)找到）。'
- en: Exploring an ASP.NET Core MVC website
  id: totrans-179
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索一个ASP.NET Core MVC网站
- en: Let's walk through the parts that make up a modern ASP.NET Core MVC website.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们逐步了解构成现代ASP.NET Core MVC网站的部分。
- en: Understanding ASP.NET Core MVC initialization
  id: totrans-181
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解ASP.NET Core MVC初始化
- en: 'Appropriately enough, we will start by exploring the MVC website''s default
    initialization and configuration:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 恰如其名，我们将从探索MVC网站的默认初始化和配置开始：
- en: Open the `Program.cs` file and note that it uses the top-level program feature
    (so there is a hidden `Program` class with a `Main` method). This file can be
    considered to be divided into four important sections from top to bottom.
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开`Program.cs`文件，并注意它使用了顶级程序功能（因此有一个隐藏的`Program`类和一个`Main`方法）。从上到下，可以将此文件分为四个重要部分。
- en: .NET 5 and earlier ASP.NET Core project templates used a `Startup` class to
    separate these parts into separate methods but with .NET 6, Microsoft encourages
    putting everything in a single `Program.cs` file.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: .NET 5及更早的ASP.NET Core项目模板使用`Startup`类将这些部分分开为单独的方法，但是在.NET 6中，Microsoft鼓励将所有内容放在单个`Program.cs`文件中。
- en: 'The first section imports some namespaces, as shown in the following code:'
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第一部分导入了一些命名空间，如下所示：
- en: '```cs'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: using
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 使用
- en: Microsoft.AspNetCore.Identity; // IdentityUser
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft.AspNetCore.Identity; // IdentityUser
- en: using
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 使用
- en: Microsoft.EntityFrameworkCore; // UseSqlServer, UseSqlite
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft.EntityFrameworkCore; // UseSqlServer, UseSqlite
- en: using
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 使用
- en: Northwind.Mvc.Data; // ApplicationDbContext
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: Northwind.Mvc.Data; // ApplicationDbContext
- en: '```'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'Remember that by default, many other namespaces are imported using the implicit
    usings feature of .NET 6 and later. Build the project and then the globally imported
    namespaces can be found in the following path: `obj\Debug\net6.0\Northwind.Mvc.GlobalUsings.g.cs`
    .'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，默认情况下，许多其他命名空间是使用.NET 6及更高版本的隐式使用功能导入的。构建项目，然后可以在以下路径找到全局导入的命名空间：`obj\Debug\net6.0\Northwind.Mvc.GlobalUsings.g.cs`。
- en: 'The second section creates and configures a web host builder. It registers
    an application database context using SQL Server or SQLite with its database connection
    string loaded from the `appsettings.json` file for its data storage, adds ASP.NET
    Core Identity for authentication and configures it to use the application database,
    and adds support for MVC controllers with views, as shown in the following code:'
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第二部分创建和配置Web主机生成器。它注册一个使用SQL Server或SQLite的应用程序数据库上下文，其数据库连接字符串从`appsettings.json`文件中加载用于数据存储，添加了ASP.NET
    Core Identity以进行身份验证并配置其使用应用程序数据库，并添加了对MVC控制器的视图支持，如下所示：
- en: '```cs'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: var
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: var
- en: builder = WebApplication.CreateBuilder(args);
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: builder = WebApplication.CreateBuilder(args);
- en: // Add services to the container.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: // 向容器添加服务。
- en: var
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: var
- en: connectionString = builder.Configuration
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: connectionString = builder.Configuration
- en: .GetConnectionString("DefaultConnection"
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 调用`GetConnectionString("DefaultConnection"`方法
- en: );
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: );
- en: builder.Services.AddDbContext<ApplicationDbContext>(options =>
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: builder.Services.AddDbContext<ApplicationDbContext>(options =>
- en: options.UseSqlServer(connectionString)); // or UseSqlite
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: options.UseSqlServer(connectionString)); // 或UseSqlite
- en: builder.Services.AddDatabaseDeveloperPageExceptionFilter();
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: builder.Services.AddDatabaseDeveloperPageExceptionFilter();
- en: builder.Services.AddDefaultIdentity<IdentityUser>(options =>
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: builder.Services.AddDefaultIdentity<IdentityUser>(options =>
- en: options.SignIn.RequireConfirmedAccount = true
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: options.SignIn.RequireConfirmedAccount = true
- en: )
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: ）
- en: .AddEntityFrameworkStores<ApplicationDbContext>();
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: .AddEntityFrameworkStores<ApplicationDbContext>();
- en: builder.Services.AddControllersWithViews();
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: builder.Services.AddControllersWithViews();
- en: '```'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'The `builder` object has two commonly used objects: `Configuration` and `Services`
    :'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: '`builder`对象有两个常用对象：`Configuration`和`Services`：'
- en: '`Configuration` contains merged values from all the places you could set configuration:
    `appsettings.json` , environment variables, command-line arguments, and so on'
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Configuration`包含您可以设置配置的所有位置的合并值：`appsettings.json`，环境变量，命令行参数等等'
- en: '`Services` is a collection of registered dependency services'
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Services`是已注册的依赖服务的集合'
- en: The call to `AddDbContext` is an example of registering a dependency service.
    ASP.NET Core implements the **dependency injection** (**DI** ) design pattern
    so that other components like controllers can request needed services through
    their constructors. Developers register those services in this section of `Program.cs`
    (or if using a `Startup` class then in its `ConfigureServices` method.)
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 对`AddDbContext`的调用是注册依赖服务的示例。ASP.NET Core实现了**依赖注入**（**DI**）设计模式，以便其他组件（如控制器）可以通过它们的构造函数请求所需的服务。开发人员在`Program.cs`的这一部分注册这些服务（或者如果使用`Startup`类，则在其`ConfigureServices`方法中）。
- en: 'The third section configures the HTTP request pipeline. It configures a relative
    URL path to run database migrations if the website runs in development, or a friendlier
    error page and HSTS for production. HTTPS redirection, static files, routing,
    and ASP.NET Identity are enabled, and an MVC default route and Razor Pages are
    configured, as shown in the following code:'
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第三部分配置HTTP请求管道。如果网站在开发中运行，则配置相对URL路径以运行数据库迁移，或者为生产环境配置更友好的错误页面和HSTS。启用了HTTPS重定向、静态文件、路由和ASP.NET
    Identity，并配置了MVC默认路由和Razor Pages，如下所示：
- en: '```cs'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: // Configure the HTTP request pipeline.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: // 配置HTTP请求管道。
- en: if
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 如果
- en: (app.Environment.IsDevelopment())
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: （app.Environment.IsDevelopment()）
- en: '{'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: app.UseMigrationsEndPoint();
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: app.UseMigrationsEndPoint();
- en: '}'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: else
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 否则
- en: '{'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: app.UseExceptionHandler("/Home/Error"
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: app.UseExceptionHandler("/Home/Error"
- en: );
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: );
- en: // The default HSTS value is 30 days. You may want to change this for production
    scenarios, see https://aka.ms/aspnetcore-hsts.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: // 默认的HSTS值为30天。您可能希望为生产场景更改此值，请参阅https://aka.ms/aspnetcore-hsts。
- en: app.UseHsts();
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: app.UseHsts();
- en: '}'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: app.UseHttpsRedirection();
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: app.UseHttpsRedirection();
- en: app.UseStaticFiles();
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: app.UseStaticFiles();
- en: app.UseRouting();
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: app.UseRouting();
- en: app.UseAuthentication();
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: app.UseAuthentication();
- en: app.UseAuthorization();
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: app.UseAuthorization();
- en: app.MapControllerRoute(
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: app.MapControllerRoute(
- en: 'name: "default"'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 'name: "default"'
- en: ','
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: ，
- en: 'pattern: "{controller=Home}/{action=Index}/{id?}"'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 模式："{controller=Home}/{action=Index}/{id?}"
- en: );
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: );
- en: app.MapRazorPages();
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: app.MapRazorPages();
- en: '```'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: We learned about most of these methods and features in *Chapter 14* , *Building
    Websites Using ASP.NET Core Razor Pages* .
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在*第14章*中学习了大多数这些方法和特性，*使用ASP.NET Core Razor Pages构建网站*。
- en: '**Good Practice** : What does the extension method `UseMigrationsEndPoint`
    do? You could read the official documentation, but it does not help much. For
    example, it does not tell us what relative URL path it defines by default: [https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.migrationsendpointextensions.usemigrationsendpoint](https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.migrationsendpointextensions.usemigrationsendpoint)
    . Luckily, ASP.NET Core is open source, so we can read the source code and discover
    what it does, at the following link: [https://github.com/dotnet/aspnetcore/blob/main/src/Middleware/Diagnostics.EntityFrameworkCore/src/MigrationsEndPointOptions.cs#L18](https://github.com/dotnet/aspnetcore/blob/main/src/Middleware/Diagnostics.EntityFrameworkCore/src/MigrationsEndPointOptions.cs#L18)
    . Get into the habit of exploring the source code for ASP.NET Core to understand
    how it works.'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: '**良好的实践**：扩展方法`UseMigrationsEndPoint`是做什么的？你可以阅读官方文档，但它并没有太大帮助。例如，它没有告诉我们默认定义的相对URL路径是什么：[https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.migrationsendpointextensions.usemigrationsendpoint](https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.migrationsendpointextensions.usemigrationsendpoint)。幸运的是，ASP.NET
    Core是开源的，所以我们可以阅读源代码并发现它的作用，链接如下：[https://github.com/dotnet/aspnetcore/blob/main/src/Middleware/Diagnostics.EntityFrameworkCore/src/MigrationsEndPointOptions.cs#L18](https://github.com/dotnet/aspnetcore/blob/main/src/Middleware/Diagnostics.EntityFrameworkCore/src/MigrationsEndPointOptions.cs#L18)。养成探索ASP.NET
    Core源代码的习惯，以了解它的工作原理。'
- en: Apart from the `UseAuthentication` and `UseAuthorization` methods, the most
    important new method in this section of `Program.cs` is `MapControllerRoute` ,
    which maps a default route for use by MVC. This route is very flexible because
    it will map to almost any incoming URL, as you will see in the next topic.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 除了`UseAuthentication`和`UseAuthorization`方法之外，在`Program.cs`的这一部分中最重要的新方法是`MapControllerRoute`，它映射了MVC可以使用的默认路由。这个路由非常灵活，因为它将映射到几乎任何传入的URL，你将在下一个主题中看到。
- en: Although we will not create any Razor Pages in this chapter, we need to leave
    the method call that maps Razor Page support because our MVC website uses ASP.NET
    Core Identity for authentication and authorization, and it uses a Razor Class
    Library for its user interface components, like visitor registration and login.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然我们在本章中不会创建任何Razor页面，但我们需要保留映射Razor页面支持的方法调用，因为我们的MVC网站使用ASP.NET Core Identity进行身份验证和授权，并且它使用Razor类库作为其用户界面组件，比如访客注册和登录。
- en: 'The fourth and final section has a thread-blocking method call that runs the
    website and waits for incoming HTTP requests to respond to, as shown in the following
    code:'
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第四部分有一个阻塞线程的方法调用，运行网站并等待传入的HTTP请求进行响应，如下面的代码所示：
- en: '```cs'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: app.Run(); // blocking call
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: app.Run(); // 阻塞调用
- en: '```'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Understanding the default MVC route
  id: totrans-252
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解默认的MVC路由
- en: The responsibility of a route is to discover the name of a controller class
    to instantiate and an action method to execute with an optional `id` parameter
    to pass into the method that will generate an HTTP response.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 路由的责任是发现要实例化的控制器类的名称，并执行一个操作方法，可选地传递一个`id`参数到将生成HTTP响应的方法中。
- en: 'A default route is configured for MVC, as shown in the following code:'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: MVC配置了默认路由，如下面的代码所示：
- en: '```cs'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: endpoints.MapControllerRoute(
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: endpoints.MapControllerRoute(
- en: 'name: "default"'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 'name: "default"'
- en: ','
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: ','
- en: 'pattern: "{controller=Home}/{action=Index}/{id?}"'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: '模式: "{controller=Home}/{action=Index}/{id?}"'
- en: );
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: );
- en: '```'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: The route pattern has parts in curly brackets `{}` called **segments** , and
    they are like named parameters of a method. The value of these segments can be
    any `string` . Segments in URLs are not case-sensitive.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 路由模式中有花括号`{}`中的部分称为**segments**，它们就像方法的命名参数。这些segments的值可以是任何`string`。URL中的segments不区分大小写。
- en: The route pattern looks at any URL path requested by the browser and matches
    it to extract the name of a `controller` , the name of an `action` , and an optional
    `id` value (the `?` symbol makes it optional).
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 路由模式查看浏览器请求的任何URL路径，并匹配以提取`controller`的名称，`action`的名称和可选的`id`值（`?`符号表示可选）。
- en: If the user hasn't entered these names, it uses defaults of `Home` for the controller
    and `Index` for the action (the `=` assignment sets a default for a named segment).
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 如果用户没有输入这些名称，则使用`Home`作为控制器的默认值，使用`Index`作为操作的默认值（`=`赋值为命名segment设置默认值）。
- en: 'The following table contains example URLs and how the default route would work
    out the names of a controller and action:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 以下表格包含示例URL以及默认路由如何确定控制器和操作的名称：
- en: '| URL | Controller | Action | ID |'
  id: totrans-266
  prefs: []
  type: TYPE_TB
  zh: '| URL | 控制器 | 操作 | ID |'
- en: '| `/` | Home | Index |  |'
  id: totrans-267
  prefs: []
  type: TYPE_TB
  zh: '| `/` | 主页 | 索引 |  |'
- en: '| `/Muppet` | Muppet | Index |  |'
  id: totrans-268
  prefs: []
  type: TYPE_TB
  zh: '| `/Muppet` | Muppet | Index |  |'
- en: '| `/Muppet/Kermit` | Muppet | Kermit |  |'
  id: totrans-269
  prefs: []
  type: TYPE_TB
  zh: '| `/Muppet/Kermit` | Muppet | Kermit |  |'
- en: '| `/Muppet/Kermit/Green` | Muppet | Kermit | Green |'
  id: totrans-270
  prefs: []
  type: TYPE_TB
  zh: '| `/Muppet/Kermit/Green` | Muppet | Kermit | Green |'
- en: '| `/Products` | Products | Index |  |'
  id: totrans-271
  prefs: []
  type: TYPE_TB
  zh: '| `/Products` | Products | Index |  |'
- en: '| `/Products/Detail` | Products | Detail |  |'
  id: totrans-272
  prefs: []
  type: TYPE_TB
  zh: '| `/Products/Detail` | Products | Detail |  |'
- en: '| `/Products/Detail/3` | Products | Detail | 3 |'
  id: totrans-273
  prefs: []
  type: TYPE_TB
  zh: '| `/Products/Detail/3` | Products | Detail | 3 |'
- en: Understanding controllers and actions
  id: totrans-274
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解控制器和操作
- en: 'In MVC, the C stands for *controller* . From the route and an incoming URL,
    ASP.NET Core knows the name of the controller, so it will then look for a class
    that is decorated with the `[Controller]` attribute or derives from a class decorated
    with that attribute, for example, the Microsoft-provided class named `ControllerBase`
    , as shown in the following code:'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 在MVC中，C代表*controller*。根据路由和传入的URL，ASP.NET Core知道控制器的名称，因此它将寻找一个带有`[Controller]`属性或从带有该属性的类派生的类，例如，Microsoft提供的名为`ControllerBase`的类，如下面的代码所示：
- en: '```cs'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: namespace
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: namespace
- en: Microsoft.AspNetCore.Mvc
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft.AspNetCore.Mvc
- en: '{'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: //
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: //
- en: '// Summary:'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: '// 摘要:'
- en: // A base class for an MVC controller without view support.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: // 一个没有视图支持的MVC控制器的基类。
- en: '[Controller'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: '[Controller'
- en: ']'
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: ']'
- en: public
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 公共
- en: abstract
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 抽象
- en: class
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: ControllerBase
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: ControllerBase
- en: '{'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: '...'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: '...'
- en: '```'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Understanding the ControllerBase class
  id: totrans-292
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 理解ControllerBase类
- en: As you can see in the XML comment, `ControllerBase` does not support views.
    It is used for creating web services, as you will see in *Chapter 16* , *Building
    and Consuming Web Services* .
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 正如您在XML注释中所看到的，`ControllerBase`不支持视图。它用于创建Web服务，正如您将在*第16章*，*构建和使用Web服务*中看到的。
- en: '`ControllerBase` has many useful properties for working with the current HTTP
    context, as shown in the following table:'
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: '`ControllerBase`有许多有用的属性用于处理当前HTTP上下文，如下表所示：'
- en: '| Property | Description |'
  id: totrans-295
  prefs: []
  type: TYPE_TB
  zh: '| 属性 | 描述 |'
- en: '| `Request` | Just the HTTP request. For example, headers, query string parameters,
    the body of the request as a stream that you can read from, the content type and
    length, and cookies. |'
  id: totrans-296
  prefs: []
  type: TYPE_TB
  zh: '| `Request` | 仅HTTP请求。例如，标头，查询字符串参数，请求正文作为可以读取的流，内容类型和长度，以及cookie。'
- en: '| `Response` | Just the HTTP response. For example, headers, the body of the
    response as a stream that you can write to, the content type and length, status
    code, and cookies. There are also delegates like `OnStarting` and `OnCompleted`
    that you can hook a method up to. |'
  id: totrans-297
  prefs: []
  type: TYPE_TB
  zh: '| `Response` | 仅HTTP响应。例如，标头，响应正文作为可以写入的流，内容类型和长度，状态代码和cookie。还有像`OnStarting`和`OnCompleted`这样的委托，您可以将方法连接到它们。'
- en: '| `HttpContext` | Everything about the current HTTP context including the request
    and response, information about the connection, a collection of features that
    have been enabled on the server with middleware, and a `User` object for authentication
    and authorization. |'
  id: totrans-298
  prefs: []
  type: TYPE_TB
  zh: '| `HttpContext` | 当前HTTP上下文的所有内容，包括请求和响应，有关连接的信息，已在服务器上启用中间件的功能集合，以及用于身份验证和授权的`User`对象。'
- en: Understanding the Controller class
  id: totrans-299
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 了解Controller类
- en: 'Microsoft provides another class named `Controller` that your classes can inherit
    from if they do need view support, as shown in the following code:'
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 微软提供了另一个名为`Controller`的类，如果您的类确实需要视图支持，可以从这个类继承，如下面的代码所示：
- en: '```cs'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: namespace
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: namespace
- en: Microsoft.AspNetCore.Mvc
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft.AspNetCore.Mvc
- en: '{'
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: //
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: //
- en: '// Summary:'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: // 摘要：
- en: // A base class for an MVC controller with view support.
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: // 一个带有视图支持的MVC控制器的基类。
- en: public
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: public
- en: abstract
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 抽象
- en: class
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 类
- en: Controller
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: Controller
- en: ': ControllerBase'
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: ': ControllerBase'
- en: ','
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: ，
- en: IActionFilter
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: IActionFilter
- en: ', IFilterMetadata'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: ', IFilterMetadata'
- en: ', IAsyncActionFilter'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: ', IAsyncActionFilter'
- en: ', IDisposable'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: ', IDisposable'
- en: '{'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: '...'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: '...'
- en: '```'
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: '`Controller` has many useful properties for working with views, as shown in
    the following table:'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: '`Controller`有许多有用的属性用于处理视图，如下表所示：'
- en: '| Property | Description |'
  id: totrans-322
  prefs: []
  type: TYPE_TB
  zh: '| 属性 | 描述 |'
- en: '| `ViewData` | A dictionary that the controller can store key/value pairs in
    that is accessible in a view. The dictionary''s lifetime is only for the current
    request/response. |'
  id: totrans-323
  prefs: []
  type: TYPE_TB
  zh: '| `ViewData` | 控制器可以在其中存储键/值对的字典，在视图中可以访问。该字典的生命周期仅限于当前请求/响应。'
- en: '| `ViewBag` | A dynamic object that wraps the `ViewData` to provide a friendlier
    syntax for setting and getting dictionary values. |'
  id: totrans-324
  prefs: []
  type: TYPE_TB
  zh: '| `ViewBag` | 包装`ViewData`的动态对象，以提供更友好的语法来设置和获取字典值。'
- en: '| `TempData` | A dictionary that the controller can store key/value pairs in
    that is accessible in a view. The dictionary''s lifetime is for the current request/response
    and the next request/response for the same visitor session. This is useful for
    storing a value during an initial request, responding with a redirect, and then
    reading the stored value in the subsequent request. |'
  id: totrans-325
  prefs: []
  type: TYPE_TB
  zh: '| `TempData` | 控制器可以在其中存储键/值对的字典，在视图中可以访问。该字典的生命周期限于当前请求/响应和同一访客会话的下一个请求/响应。这对于在初始请求期间存储值，响应重定向，然后在随后的请求中读取存储的值非常有用。'
- en: '`Controller` has many useful methods for working with views, as shown in the
    following table:'
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: '`Controller`有许多有用的方法用于处理视图，如下表所示：'
- en: '| Property | Description |'
  id: totrans-327
  prefs: []
  type: TYPE_TB
  zh: '| 属性 | 描述 |'
- en: '| `View` | Returns a `ViewResult` after executing a view that renders a full
    response, for example, a dynamically generated web page. The view can be selected
    using a convention or be specified with a string name. A model can be passed to
    the view. |'
  id: totrans-328
  prefs: []
  type: TYPE_TB
  zh: '| `View` | 在执行呈现完整响应的视图后返回`ViewResult`，例如，动态生成的网页。可以使用约定选择视图，也可以使用字符串名称指定。可以向视图传递模型。'
- en: '| `PartialView` | Returns a `PartialViewResult` after executing a view that
    is part of a full response, for example, a dynamically generated chunk of HTML.
    The view can be selected using a convention or be specified with a string name.
    A model can be passed to the view. |'
  id: totrans-329
  prefs: []
  type: TYPE_TB
  zh: '| `PartialView` | 在执行作为完整响应的一部分的视图后返回`PartialViewResult`，例如，动态生成的HTML块。可以使用约定选择视图，也可以使用字符串名称指定。可以向视图传递模型。'
- en: '| `ViewComponent` | Returns a `ViewComponentResult` after executing a component
    that dynamically generates HTML. The component must be selected by specifying
    its type or its name. An object can be passed as an argument. |'
  id: totrans-330
  prefs: []
  type: TYPE_TB
  zh: '| `ViewComponent` | 在执行动态生成HTML的组件后返回`ViewComponentResult`。必须通过指定其类型或名称来选择组件。可以将对象作为参数传递。'
- en: '| `Json` | Returns a `JsonResult` containing a JSON-serialized object. This
    can be useful for implementing a simple Web API as part of an MVC controller that
    primarily returns HTML for a human to view. |'
  id: totrans-331
  prefs: []
  type: TYPE_TB
  zh: '| `Json` | 返回包含JSON序列化对象的`JsonResult`。这对于在MVC控制器的一部分实现简单的Web API并主要返回供人查看的HTML非常有用。'
- en: Understanding the responsibilities of a controller
  id: totrans-332
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 了解控制器的职责
- en: 'The responsibilities of a controller are as follows:'
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 控制器的职责如下：
- en: Identify the services that the controller needs to be in a valid state and to
    function properly in their class constructor(s).
  id: totrans-334
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确定控制器在其类构造函数中需要的服务，以使其处于有效状态并能够正常运行。
- en: Use the action name to identify a method to execute.
  id: totrans-335
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用操作名称来标识要执行的方法。
- en: Extract parameters from the HTTP request.
  id: totrans-336
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从HTTP请求中提取参数。
- en: Use the parameters to fetch any additional data needed to construct a view model
    and pass it to the appropriate view for the client. For example, if the client
    is a web browser, then a view that renders HTML would be most appropriate. Other
    clients might prefer alternative renderings, like document formats such as a PDF
    file or an Excel file, or data formats, like JSON or XML.
  id: totrans-337
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用参数获取构造视图模型所需的任何其他数据，并将其传递给客户端的适当视图。例如，如果客户端是Web浏览器，则呈现HTML的视图最合适。其他客户端可能更喜欢替代呈现，比如文档格式，如PDF文件或Excel文件，或数据格式，如JSON或XML。
- en: Return the results from the view to the client as an HTTP response with an appropriate
    status code.
  id: totrans-338
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将视图的结果作为适当状态码的HTTP响应返回给客户端。
- en: 'Let''s review the controller used to generate the home, privacy, and error
    pages:'
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们回顾一下用于生成主页、隐私和错误页面的控制器：
- en: Expand the `Controllers` folder
  id: totrans-340
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 展开`Controllers`文件夹
- en: Open the file named `HomeController.cs`
  id: totrans-341
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开名为`HomeController.cs`的文件
- en: 'Note, as shown in the following code, that:'
  id: totrans-342
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请注意，如下面的代码所示：
- en: Extra namespaces are imported, which I have added comments for to show which
    types they are needed for.
  id: totrans-343
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 导入了额外的命名空间，我已经添加了注释以显示它们所需的类型。
- en: A private read-only field is declared to store a reference to a logger for the
    `HomeController` that is set in a constructor.
  id: totrans-344
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 声明一个私有的只读字段来存储对`HomeController`的记录器的引用，该引用在构造函数中设置。
- en: All three action methods call a method named `View` and return the results as
    an `IActionResult` interface to the client.
  id: totrans-345
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有三个操作方法都调用一个名为`View`的方法，并将结果作为`IActionResult`接口返回给客户端。
- en: 'The `Error` action method passes a view model into its view with a request
    ID used for tracing. The error response will not be cached:'
  id: totrans-346
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Error`操作方法将视图模型传递到其视图中，并使用用于跟踪的请求ID。错误响应不会被缓存：'
- en: '```cs'
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: using
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: using
- en: Microsoft.AspNetCore.Mvc; // Controller, IActionResult
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft.AspNetCore.Mvc; // Controller, IActionResult
- en: using
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: using
- en: Northwind.Mvc.Models; // ErrorViewModel
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: Northwind.Mvc.Models; // ErrorViewModel
- en: using
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: using
- en: System.Diagnostics; // Activity
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: System.Diagnostics; // Activity
- en: namespace
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: namespace
- en: Northwind.Mvc.Controllers
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: Northwind.Mvc.Controllers
- en: ;
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: ;
- en: public
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: public
- en: class
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: HomeController
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: HomeController
- en: ': Controller'
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: ：控制器
- en: '{'
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: private
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: private
- en: readonly
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: readonly
- en: ILogger<HomeController> _logger;
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: ILogger<HomeController> _logger;
- en: public
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: public
- en: HomeController
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: HomeController
- en: (
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: (
- en: ILogger<HomeController> logger
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: ILogger<HomeController> logger
- en: )
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: )
- en: '{'
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: _logger = logger;
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
  zh: _logger = logger;
- en: '}'
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: public
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: public
- en: IActionResult
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: IActionResult
- en: Index
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: Index
- en: ()
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: ()
- en: '{'
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: return
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: return
- en: View();
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: View();
- en: '}'
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: public
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: public
- en: IActionResult
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
  zh: IActionResult
- en: Privacy
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: Privacy
- en: ()
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
  zh: ()
- en: '{'
  id: totrans-385
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: return
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: return
- en: View();
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
  zh: View();
- en: '}'
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '[ResponseCache(Duration = 0,'
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: '[ResponseCache(Duration = 0,'
- en: Location = ResponseCacheLocation.None, NoStore = true)
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: Location = ResponseCacheLocation.None, NoStore = true)
- en: ']'
  id: totrans-391
  prefs: []
  type: TYPE_NORMAL
  zh: ']'
- en: public
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: public
- en: IActionResult
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: IActionResult
- en: Error
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: Error
- en: ()
  id: totrans-395
  prefs: []
  type: TYPE_NORMAL
  zh: ()
- en: '{'
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: return
  id: totrans-397
  prefs: []
  type: TYPE_NORMAL
  zh: return
- en: View(new
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
  zh: View(new
- en: ErrorViewModel { RequestId =
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
  zh: ErrorViewModel { RequestId =
- en: Activity.Current?.Id ?? HttpContext.TraceIdentifier });
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
  zh: Activity.Current?.Id ?? HttpContext.TraceIdentifier });
- en: '}'
  id: totrans-401
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '}'
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '```'
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: If the visitor navigates to a path of `/` or `/Home` , then it is the equivalent
    of `/Home/Index` because those were the default names for controller and action
    in the default route.
  id: totrans-404
  prefs: []
  type: TYPE_NORMAL
  zh: 如果访问者导航到路径`/`或`/Home`，那么它相当于`/Home/Index`，因为这些是默认路由中控制器和操作的默认名称。
- en: Understanding the view search path convention
  id: totrans-405
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解视图搜索路径约定
- en: The `Index` and `Privacy` methods are identical in implementation, yet they
    return different web pages. This is because of **conventions** . The call to the
    `View` method looks in different paths for the Razor file to generate the web
    page.
  id: totrans-406
  prefs: []
  type: TYPE_NORMAL
  zh: '`Index`和`Privacy`方法在实现上是相同的，但它们返回不同的网页。这是因为**约定**。对`View`方法的调用在不同的路径中查找Razor文件以生成网页。'
- en: 'Let''s deliberately break one of the page names so that we can see the paths
    searched by default:'
  id: totrans-407
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们故意破坏一个页面名称，以便我们可以看到默认搜索的路径：
- en: In the `Northwind.Mvc` project, expand the `Views` folder and then the `Home`
    folder.
  id: totrans-408
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Northwind.Mvc`项目中，展开`Views`文件夹，然后展开`Home`文件夹。
- en: Rename the `Privacy.cshtml` file to `Privacy2.cshtml` .
  id: totrans-409
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`Privacy.cshtml`文件重命名为`Privacy2.cshtml`。
- en: Start the website.
  id: totrans-410
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动网站。
- en: Start Chrome, navigate to `https://localhost:5001/` , click **Privacy** , and
    note the paths that are searched for a view to render the web page (including
    in `Shared` folders for MVC views and Razor Pages), as shown in *Figure 15.3*
    :![](img/Image00122.jpg)
  id: totrans-411
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动Chrome，导航到`https://localhost:5001/`，点击**隐私**，并注意搜索用于呈现网页的视图的路径（包括MVC视图和Razor页面的`Shared`文件夹），如*图15.3*所示：![](img/Image00122.jpg)
- en: 'Figure 15.3: An exception showing the default search path for views'
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.3：显示默认视图搜索路径的异常
- en: Close Chrome and shut down the web server.
  id: totrans-413
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭Chrome并关闭Web服务器。
- en: Rename the `Privacy2.cshtml` file back to `Privacy.cshtml` .
  id: totrans-414
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`Privacy2.cshtml`文件重命名为`Privacy.cshtml`。
- en: 'You have now seen the view search path convention, as shown in the following
    list:'
  id: totrans-415
  prefs: []
  type: TYPE_NORMAL
  zh: 您现在已经看到了视图搜索路径约定，如下面的列表所示：
- en: 'Specific Razor view: `/Views/{controller}/{action}.cshtml`'
  id: totrans-416
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 特定的Razor视图：`/Views/{controller}/{action}.cshtml`
- en: 'Shared Razor view: `/Views/Shared/{action}.cshtml`'
  id: totrans-417
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 共享的Razor视图：`/Views/Shared/{action}.cshtml`
- en: 'Shared Razor Page: `/Pages/Shared/{action}.cshtml`'
  id: totrans-418
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 共享的Razor页面：`/Pages/Shared/{action}.cshtml`
- en: Understanding logging
  id: totrans-419
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解日志记录
- en: You have just seen that some errors are caught and written to the console. You
    can write messages to the console in the same way by using the logger.
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
  zh: 您刚刚看到有些错误被捕获并写入控制台。您可以使用记录器以相同的方式向控制台写入消息。
- en: 'In the `Controllers` folder, in `HomeController.cs` , in the `Index` method,
    add statements to use the logger to write some messages of various levels to the
    console, as shown in the following code:'
  id: totrans-421
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Controllers`文件夹中，在`HomeController.cs`文件中，在`Index`方法中，添加语句使用记录器将各种级别的消息写入控制台，如下面的代码所示：
- en: '```cs'
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: _logger.LogError("This is a serious error (not really!)"
  id: totrans-423
  prefs: []
  type: TYPE_NORMAL
  zh: _logger.LogError("这是一个严重错误（并不是真的！）"
- en: );
  id: totrans-424
  prefs: []
  type: TYPE_NORMAL
  zh: );
- en: _logger.LogWarning("This is your first warning!"
  id: totrans-425
  prefs: []
  type: TYPE_NORMAL
  zh: _logger.LogWarning("这是你的第一个警告！"
- en: );
  id: totrans-426
  prefs: []
  type: TYPE_NORMAL
  zh: );
- en: _logger.LogWarning("Second warning!"
  id: totrans-427
  prefs: []
  type: TYPE_NORMAL
  zh: _logger.LogWarning("第二个警告！"
- en: );
  id: totrans-428
  prefs: []
  type: TYPE_NORMAL
  zh: );
- en: _logger.LogInformation("I am in the Index method of the HomeController."
  id: totrans-429
  prefs: []
  type: TYPE_NORMAL
  zh: _logger.LogInformation("我在HomeController的Index方法中。"
- en: );
  id: totrans-430
  prefs: []
  type: TYPE_NORMAL
  zh: );
- en: '```'
  id: totrans-431
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Start the `Northwind.Mvc` website project.
  id: totrans-432
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动`Northwind.Mvc`网站项目。
- en: Start a web browser and navigate to the home page for the website.
  id: totrans-433
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动Web浏览器，导航到网站的主页。
- en: 'At the command prompt or terminal, note the messages, as shown in the following
    output:'
  id: totrans-434
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在命令提示符或终端中，注意消息，如下面的输出所示：
- en: '```cs'
  id: totrans-435
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: 'fail: Northwind.Mvc.Controllers.HomeController[0]'
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
  zh: 失败：Northwind.Mvc.Controllers.HomeController[0]
- en: This is a serious error (not really!)
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个严重的错误（实际上并不是！）
- en: 'warn: Northwind.Mvc.Controllers.HomeController[0]'
  id: totrans-438
  prefs: []
  type: TYPE_NORMAL
  zh: 警告：Northwind.Mvc.Controllers.HomeController[0]
- en: This is your first warning!
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: 这是你的第一个警告！
- en: 'warn: Northwind.Mvc.Controllers.HomeController[0]'
  id: totrans-440
  prefs: []
  type: TYPE_NORMAL
  zh: 警告：Northwind.Mvc.Controllers.HomeController[0]
- en: Second warning!
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个警告！
- en: 'info: Northwind.Mvc.Controllers.HomeController[0]'
  id: totrans-442
  prefs: []
  type: TYPE_NORMAL
  zh: 信息：Northwind.Mvc.Controllers.HomeController[0]
- en: I am in the Index method of the HomeController.
  id: totrans-443
  prefs: []
  type: TYPE_NORMAL
  zh: 我在HomeController的Index方法中。
- en: '```'
  id: totrans-444
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Close Chrome and shut down the web server.
  id: totrans-445
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭Chrome并关闭Web服务器。
- en: Understanding filters
  id: totrans-446
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解过滤器
- en: When you need to add some functionality to multiple controllers and actions,
    you can use or define your own filters that are implemented as an attribute class.
  id: totrans-447
  prefs: []
  type: TYPE_NORMAL
  zh: 当您需要向多个控制器和操作添加一些功能时，您可以使用或定义自己的过滤器，这些过滤器被实现为属性类。
- en: 'Filters can be applied at the following levels:'
  id: totrans-448
  prefs: []
  type: TYPE_NORMAL
  zh: 过滤器可以应用在以下级别：
- en: At the action level by decorating an action method with the attribute. This
    will only affect the one action method.
  id: totrans-449
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过使用属性装饰一个操作方法来设置操作级别。这只会影响一个操作方法。
- en: At the controller level by decorating the controller class with the attribute.
    This will affect all methods of the controller.
  id: totrans-450
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过使用属性装饰控制器类来设置控制器级别。这将影响控制器的所有方法。
- en: 'At the global level by adding the attribute type to the `Filters` collection
    of the `MvcOptions` instance that can be used to configure MVC when calling the
    `AddControllersWithViews` method, as shown in the following code:'
  id: totrans-451
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过将属性类型添加到`MvcOptions`实例的`Filters`集合中，在调用`AddControllersWithViews`方法时可以用于配置MVC，如下面的代码所示：
- en: '```cs'
  id: totrans-452
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: builder.Services.AddControllersWithViews(options =>
  id: totrans-453
  prefs: []
  type: TYPE_NORMAL
  zh: builder.Services.AddControllersWithViews(options =>
- en: '{'
  id: totrans-454
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: options.Filters.Add(typeof
  id: totrans-455
  prefs: []
  type: TYPE_NORMAL
  zh: options.Filters.Add(typeof
- en: (MyCustomFilter));
  id: totrans-456
  prefs: []
  type: TYPE_NORMAL
  zh: （MyCustomFilter）;
- en: '});'
  id: totrans-457
  prefs: []
  type: TYPE_NORMAL
  zh: '});'
- en: '```'
  id: totrans-458
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Using a filter to secure an action method
  id: totrans-459
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用过滤器保护操作方法
- en: 'You might want to ensure that one particular action method of a controller
    class can only be called by members of certain security roles. You do this by
    decorating the method with the `[Authorize]` attribute, as described in the following
    list:'
  id: totrans-460
  prefs: []
  type: TYPE_NORMAL
  zh: 您可能希望确保控制器类的一个特定操作方法只能被某些安全角色的成员调用。您可以通过使用`[授权]`属性装饰该方法来实现这一点，如下列表所述：
- en: '`[Authorize]` : Only allow authenticated (non-anonymous, logged-in) visitors
    to access this action method.'
  id: totrans-461
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`[授权]`：只允许经过身份验证（非匿名，已登录）的访问者访问此操作方法。'
- en: '`[Authorize(Roles = "Sales,Marketing")]` : Only allow visitors who are members
    of the specified role(s) to access this action method.'
  id: totrans-462
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`[授权（角色 = "销售，市场营销")]`：只允许属于指定角色的访问者访问此操作方法。'
- en: 'Let''s see an example:'
  id: totrans-463
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看一个例子：
- en: In `HomeController.cs` , import the `Microsoft.AspNetCore.Authorization` namespace.
  id: totrans-464
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`HomeController.cs`中，导入`Microsoft.AspNetCore.Authorization`命名空间。
- en: 'Add an attribute to the `Privacy` method to only allow access to logged-in
    users who are members of a group/role named `Administrators` , as shown highlighted
    in the following code:'
  id: totrans-465
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向`Privacy`方法添加一个属性，只允许属于名为`Administrators`的组/角色的已登录用户访问，如下面的代码所示：
- en: '```cs'
  id: totrans-466
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '**[**'
  id: totrans-467
  prefs: []
  type: TYPE_NORMAL
  zh: '**[**'
- en: '**Authorize(Roles =**'
  id: totrans-468
  prefs: []
  type: TYPE_NORMAL
  zh: '**授权（角色 =**'
- en: '**"Administrators"**'
  id: totrans-469
  prefs: []
  type: TYPE_NORMAL
  zh: '**"Administrators"**'
- en: '**)**'
  id: totrans-470
  prefs: []
  type: TYPE_NORMAL
  zh: '**）**'
- en: '**]**'
  id: totrans-471
  prefs: []
  type: TYPE_NORMAL
  zh: '**]**'
- en: public
  id: totrans-472
  prefs: []
  type: TYPE_NORMAL
  zh: 公共
- en: IActionResult
  id: totrans-473
  prefs: []
  type: TYPE_NORMAL
  zh: IActionResult
- en: Privacy
  id: totrans-474
  prefs: []
  type: TYPE_NORMAL
  zh: 隐私
- en: ()
  id: totrans-475
  prefs: []
  type: TYPE_NORMAL
  zh: （）
- en: '```'
  id: totrans-476
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Start the website.
  id: totrans-477
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动网站。
- en: Click **Privacy** and note that you are redirected to the log in page.
  id: totrans-478
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**隐私**，注意您被重定向到登录页面。
- en: Enter your email and password.
  id: totrans-479
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入您的电子邮件和密码。
- en: Click **Log in** and note that you are denied access.
  id: totrans-480
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**登录**，注意您被拒绝访问。
- en: Close Chrome and shut down the web server.
  id: totrans-481
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭Chrome并关闭Web服务器。
- en: Enabling role management and creating a role programmatically
  id: totrans-482
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 启用角色管理并以编程方式创建角色
- en: 'By default, role management is not enabled in an ASP.NET Core MVC project,
    so we must first enable it before creating roles, and then we will create a controller
    that will programmatically create an `Administrators` role (if it does not already
    exist) and assign a test user to that role:'
  id: totrans-483
  prefs: []
  type: TYPE_NORMAL
  zh: 在ASP.NET Core MVC项目中，默认情况下未启用角色管理，因此我们必须在创建角色之前先启用它，然后我们将创建一个控制器，该控制器将以编程方式创建一个`Administrators`角色（如果尚不存在），并将一个测试用户分配给该角色：
- en: 'In `Program.cs` , in the setup of ASP.NET Core Identity and its database, add
    a call to `AddRoles` to enable role management, as shown highlighted in the following
    code:'
  id: totrans-484
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Program.cs`中，在设置ASP.NET Core Identity及其数据库时，添加一个调用`AddRoles`以启用角色管理，如下面的代码所示：
- en: '```cs'
  id: totrans-485
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: services.AddDefaultIdentity<IdentityUser>(
  id: totrans-486
  prefs: []
  type: TYPE_NORMAL
  zh: services.AddDefaultIdentity<IdentityUser>(
- en: options => options.SignIn.RequireConfirmedAccount = true
  id: totrans-487
  prefs: []
  type: TYPE_NORMAL
  zh: options => options.SignIn.RequireConfirmedAccount = true
- en: )
  id: totrans-488
  prefs: []
  type: TYPE_NORMAL
  zh: ）
- en: '**.AddRoles<IdentityRole>()**'
  id: totrans-489
  prefs: []
  type: TYPE_NORMAL
  zh: '**.AddRoles<IdentityRole>()**'
- en: '**// enable role management**'
  id: totrans-490
  prefs: []
  type: TYPE_NORMAL
  zh: '**// 启用角色管理**'
- en: .AddEntityFrameworkStores<ApplicationDbContext>();
  id: totrans-491
  prefs: []
  type: TYPE_NORMAL
  zh: .AddEntityFrameworkStores<ApplicationDbContext>();
- en: '```'
  id: totrans-492
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'In `Controllers` , add an empty controller class named `RolesController.cs`
    and modify its contents, as shown in the following code:'
  id: totrans-493
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Controllers`中，添加一个名为`RolesController.cs`的空控制器类，并修改其内容，如下面的代码所示：
- en: '```cs'
  id: totrans-494
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: using
  id: totrans-495
  prefs: []
  type: TYPE_NORMAL
  zh: 使用
- en: Microsoft.AspNetCore.Identity; // RoleManager, UserManager
  id: totrans-496
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft.AspNetCore.Identity; // RoleManager, UserManager
- en: using
  id: totrans-497
  prefs: []
  type: TYPE_NORMAL
  zh: 使用
- en: Microsoft.AspNetCore.Mvc; // Controller, IActionResult
  id: totrans-498
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft.AspNetCore.Mvc; // Controller, IActionResult
- en: using
  id: totrans-499
  prefs: []
  type: TYPE_NORMAL
  zh: 使用
- en: static
  id: totrans-500
  prefs: []
  type: TYPE_NORMAL
  zh: 静态的
- en: System.Console;
  id: totrans-501
  prefs: []
  type: TYPE_NORMAL
  zh: System.Console;
- en: namespace
  id: totrans-502
  prefs: []
  type: TYPE_NORMAL
  zh: 命名空间
- en: Northwind.Mvc.Controllers
  id: totrans-503
  prefs: []
  type: TYPE_NORMAL
  zh: Northwind.Mvc.Controllers
- en: ;
  id: totrans-504
  prefs: []
  type: TYPE_NORMAL
  zh: ;
- en: public
  id: totrans-505
  prefs: []
  type: TYPE_NORMAL
  zh: 公共
- en: class
  id: totrans-506
  prefs: []
  type: TYPE_NORMAL
  zh: 类
- en: RolesController
  id: totrans-507
  prefs: []
  type: TYPE_NORMAL
  zh: RolesController
- en: ': Controller'
  id: totrans-508
  prefs: []
  type: TYPE_NORMAL
  zh: 控制器
- en: '{'
  id: totrans-509
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: private
  id: totrans-510
  prefs: []
  type: TYPE_NORMAL
  zh: 私人的
- en: string
  id: totrans-511
  prefs: []
  type: TYPE_NORMAL
  zh: 字符串
- en: AdminRole = "Administrators"
  id: totrans-512
  prefs: []
  type: TYPE_NORMAL
  zh: AdminRole = "Administrators"
- en: ;
  id: totrans-513
  prefs: []
  type: TYPE_NORMAL
  zh: ;
- en: private
  id: totrans-514
  prefs: []
  type: TYPE_NORMAL
  zh: 私人的
- en: string
  id: totrans-515
  prefs: []
  type: TYPE_NORMAL
  zh: 字符串
- en: UserEmail = "test@example.com"
  id: totrans-516
  prefs: []
  type: TYPE_NORMAL
  zh: UserEmail = "test@example.com"
- en: ;
  id: totrans-517
  prefs: []
  type: TYPE_NORMAL
  zh: ;
- en: private
  id: totrans-518
  prefs: []
  type: TYPE_NORMAL
  zh: 私人的
- en: readonly
  id: totrans-519
  prefs: []
  type: TYPE_NORMAL
  zh: 只读
- en: RoleManager<IdentityRole> roleManager;
  id: totrans-520
  prefs: []
  type: TYPE_NORMAL
  zh: RoleManager<IdentityRole> roleManager;
- en: private
  id: totrans-521
  prefs: []
  type: TYPE_NORMAL
  zh: 私人的
- en: readonly
  id: totrans-522
  prefs: []
  type: TYPE_NORMAL
  zh: 只读
- en: UserManager<IdentityUser> userManager;
  id: totrans-523
  prefs: []
  type: TYPE_NORMAL
  zh: UserManager<IdentityUser> userManager;
- en: public
  id: totrans-524
  prefs: []
  type: TYPE_NORMAL
  zh: 公共
- en: RolesController
  id: totrans-525
  prefs: []
  type: TYPE_NORMAL
  zh: RolesController
- en: (
  id: totrans-526
  prefs: []
  type: TYPE_NORMAL
  zh: （
- en: RoleManager<IdentityRole> roleManager,
  id: totrans-527
  prefs: []
  type: TYPE_NORMAL
  zh: RoleManager<IdentityRole> roleManager，
- en: UserManager<IdentityUser> userManager
  id: totrans-528
  prefs: []
  type: TYPE_NORMAL
  zh: UserManager<IdentityUser> userManager
- en: )
  id: totrans-529
  prefs: []
  type: TYPE_NORMAL
  zh: ）
- en: '{'
  id: totrans-530
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: this
  id: totrans-531
  prefs: []
  type: TYPE_NORMAL
  zh: 这个
- en: .roleManager = roleManager;
  id: totrans-532
  prefs: []
  type: TYPE_NORMAL
  zh: .roleManager = roleManager;
- en: this
  id: totrans-533
  prefs: []
  type: TYPE_NORMAL
  zh: 这个
- en: .userManager = userManager;
  id: totrans-534
  prefs: []
  type: TYPE_NORMAL
  zh: .userManager = userManager;
- en: '}'
  id: totrans-535
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: public
  id: totrans-536
  prefs: []
  type: TYPE_NORMAL
  zh: 公共
- en: async
  id: totrans-537
  prefs: []
  type: TYPE_NORMAL
  zh: async
- en: Task<IActionResult>
  id: totrans-538
  prefs: []
  type: TYPE_NORMAL
  zh: Task<IActionResult>
- en: Index
  id: totrans-539
  prefs: []
  type: TYPE_NORMAL
  zh: 索引
- en: ()
  id: totrans-540
  prefs: []
  type: TYPE_NORMAL
  zh: （）
- en: '{'
  id: totrans-541
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: if
  id: totrans-542
  prefs: []
  type: TYPE_NORMAL
  zh: 如果
- en: (!(await
  id: totrans-543
  prefs: []
  type: TYPE_NORMAL
  zh: （！（等待
- en: roleManager.RoleExistsAsync(AdminRole)))
  id: totrans-544
  prefs: []
  type: TYPE_NORMAL
  zh: roleManager.RoleExistsAsync(AdminRole)))
- en: '{'
  id: totrans-545
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: await
  id: totrans-546
  prefs: []
  type: TYPE_NORMAL
  zh: await
- en: roleManager.CreateAsync(new
  id: totrans-547
  prefs: []
  type: TYPE_NORMAL
  zh: roleManager.CreateAsync(new
- en: IdentityRole(AdminRole));
  id: totrans-548
  prefs: []
  type: TYPE_NORMAL
  zh: IdentityRole(AdminRole));
- en: '}'
  id: totrans-549
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: IdentityUser user = await
  id: totrans-550
  prefs: []
  type: TYPE_NORMAL
  zh: IdentityUser user = await
- en: userManager.FindByEmailAsync(UserEmail);
  id: totrans-551
  prefs: []
  type: TYPE_NORMAL
  zh: userManager.FindByEmailAsync(UserEmail);
- en: if
  id: totrans-552
  prefs: []
  type: TYPE_NORMAL
  zh: 如果
- en: (user == null
  id: totrans-553
  prefs: []
  type: TYPE_NORMAL
  zh: （user == null
- en: )
  id: totrans-554
  prefs: []
  type: TYPE_NORMAL
  zh: ）
- en: '{'
  id: totrans-555
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: user = new
  id: totrans-556
  prefs: []
  type: TYPE_NORMAL
  zh: user = new
- en: ();
  id: totrans-557
  prefs: []
  type: TYPE_NORMAL
  zh: ();
- en: user.UserName = UserEmail;
  id: totrans-558
  prefs: []
  type: TYPE_NORMAL
  zh: user.UserName = UserEmail;
- en: user.Email = UserEmail;
  id: totrans-559
  prefs: []
  type: TYPE_NORMAL
  zh: user.Email = UserEmail;
- en: IdentityResult result = await
  id: totrans-560
  prefs: []
  type: TYPE_NORMAL
  zh: IdentityResult result = await
- en: userManager.CreateAsync(
  id: totrans-561
  prefs: []
  type: TYPE_NORMAL
  zh: userManager.CreateAsync(
- en: user, "Pa$$w0rd"
  id: totrans-562
  prefs: []
  type: TYPE_NORMAL
  zh: user, "Pa$$w0rd"
- en: );
  id: totrans-563
  prefs: []
  type: TYPE_NORMAL
  zh: );
- en: if
  id: totrans-564
  prefs: []
  type: TYPE_NORMAL
  zh: 如果
- en: (result.Succeeded)
  id: totrans-565
  prefs: []
  type: TYPE_NORMAL
  zh: （result.Succeeded）
- en: '{'
  id: totrans-566
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: WriteLine($"User
  id: totrans-567
  prefs: []
  type: TYPE_NORMAL
  zh: WriteLine($"用户
- en: '{user.UserName}'
  id: totrans-568
  prefs: []
  type: TYPE_NORMAL
  zh: '{user.UserName}'
- en: created successfully."
  id: totrans-569
  prefs: []
  type: TYPE_NORMAL
  zh: 成功创建。"
- en: );
  id: totrans-570
  prefs: []
  type: TYPE_NORMAL
  zh: );
- en: '}'
  id: totrans-571
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: else
  id: totrans-572
  prefs: []
  type: TYPE_NORMAL
  zh: 否则
- en: '{'
  id: totrans-573
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: foreach
  id: totrans-574
  prefs: []
  type: TYPE_NORMAL
  zh: foreach
- en: (IdentityError error in
  id: totrans-575
  prefs: []
  type: TYPE_NORMAL
  zh: （IdentityError error in
- en: result.Errors)
  id: totrans-576
  prefs: []
  type: TYPE_NORMAL
  zh: result.Errors)
- en: '{'
  id: totrans-577
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: WriteLine(error.Description);
  id: totrans-578
  prefs: []
  type: TYPE_NORMAL
  zh: WriteLine(error.Description);
- en: '}'
  id: totrans-579
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '}'
  id: totrans-580
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '}'
  id: totrans-581
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: if
  id: totrans-582
  prefs: []
  type: TYPE_NORMAL
  zh: 如果
- en: (!user.EmailConfirmed)
  id: totrans-583
  prefs: []
  type: TYPE_NORMAL
  zh: （！user.EmailConfirmed）
- en: '{'
  id: totrans-584
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: string
  id: totrans-585
  prefs: []
  type: TYPE_NORMAL
  zh: 字符串
- en: token = await
  id: totrans-586
  prefs: []
  type: TYPE_NORMAL
  zh: token = await
- en: userManager
  id: totrans-587
  prefs: []
  type: TYPE_NORMAL
  zh: userManager
- en: .GenerateEmailConfirmationTokenAsync(user);
  id: totrans-588
  prefs: []
  type: TYPE_NORMAL
  zh: .GenerateEmailConfirmationTokenAsync(user);
- en: IdentityResult result = await
  id: totrans-589
  prefs: []
  type: TYPE_NORMAL
  zh: IdentityResult result = await
- en: userManager
  id: totrans-590
  prefs: []
  type: TYPE_NORMAL
  zh: userManager
- en: .ConfirmEmailAsync(user, token);
  id: totrans-591
  prefs: []
  type: TYPE_NORMAL
  zh: .ConfirmEmailAsync(user, token);
- en: if
  id: totrans-592
  prefs: []
  type: TYPE_NORMAL
  zh: 如果
- en: (result.Succeeded)
  id: totrans-593
  prefs: []
  type: TYPE_NORMAL
  zh: （result.Succeeded）
- en: '{'
  id: totrans-594
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: WriteLine($"User
  id: totrans-595
  prefs: []
  type: TYPE_NORMAL
  zh: WriteLine($"用户
- en: '{user.UserName}'
  id: totrans-596
  prefs: []
  type: TYPE_NORMAL
  zh: '{user.UserName}'
- en: email confirmed successfully."
  id: totrans-597
  prefs: []
  type: TYPE_NORMAL
  zh: 电子邮件成功确认。"
- en: );
  id: totrans-598
  prefs: []
  type: TYPE_NORMAL
  zh: );
- en: '}'
  id: totrans-599
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: else
  id: totrans-600
  prefs: []
  type: TYPE_NORMAL
  zh: 否则
- en: '{'
  id: totrans-601
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: foreach
  id: totrans-602
  prefs: []
  type: TYPE_NORMAL
  zh: foreach
- en: (IdentityError error in
  id: totrans-603
  prefs: []
  type: TYPE_NORMAL
  zh: （IdentityError error in
- en: result.Errors)
  id: totrans-604
  prefs: []
  type: TYPE_NORMAL
  zh: result.Errors)
- en: '{'
  id: totrans-605
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: WriteLine(error.Description);
  id: totrans-606
  prefs: []
  type: TYPE_NORMAL
  zh: WriteLine(error.Description);
- en: '}'
  id: totrans-607
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '}'
  id: totrans-608
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '}'
  id: totrans-609
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: if
  id: totrans-610
  prefs: []
  type: TYPE_NORMAL
  zh: 如果
- en: (!(await
  id: totrans-611
  prefs: []
  type: TYPE_NORMAL
  zh: （！（await
- en: userManager.IsInRoleAsync(user, AdminRole)))
  id: totrans-612
  prefs: []
  type: TYPE_NORMAL
  zh: userManager.IsInRoleAsync(user, AdminRole)))
- en: '{'
  id: totrans-613
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: IdentityResult result = await
  id: totrans-614
  prefs: []
  type: TYPE_NORMAL
  zh: IdentityResult result = await
- en: userManager
  id: totrans-615
  prefs: []
  type: TYPE_NORMAL
  zh: userManager
- en: .AddToRoleAsync(user, AdminRole);
  id: totrans-616
  prefs: []
  type: TYPE_NORMAL
  zh: .AddToRoleAsync(user, AdminRole);
- en: if
  id: totrans-617
  prefs: []
  type: TYPE_NORMAL
  zh: 如果
- en: (result.Succeeded)
  id: totrans-618
  prefs: []
  type: TYPE_NORMAL
  zh: （result.Succeeded）
- en: '{'
  id: totrans-619
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: WriteLine($"User
  id: totrans-620
  prefs: []
  type: TYPE_NORMAL
  zh: WriteLine($"用户
- en: '{user.UserName}'
  id: totrans-621
  prefs: []
  type: TYPE_NORMAL
  zh: '{user.UserName}'
- en: added to
  id: totrans-622
  prefs: []
  type: TYPE_NORMAL
  zh: 添加到
- en: '{AdminRole}'
  id: totrans-623
  prefs: []
  type: TYPE_NORMAL
  zh: '{AdminRole}'
- en: successfully."
  id: totrans-624
  prefs: []
  type: TYPE_NORMAL
  zh: 成功。"
- en: );
  id: totrans-625
  prefs: []
  type: TYPE_NORMAL
  zh: );
- en: '}'
  id: totrans-626
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: else
  id: totrans-627
  prefs: []
  type: TYPE_NORMAL
  zh: 否则
- en: '{'
  id: totrans-628
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: foreach
  id: totrans-629
  prefs: []
  type: TYPE_NORMAL
  zh: foreach
- en: (IdentityError error in
  id: totrans-630
  prefs: []
  type: TYPE_NORMAL
  zh: （IdentityError error in
- en: result.Errors)
  id: totrans-631
  prefs: []
  type: TYPE_NORMAL
  zh: result.Errors)
- en: '{'
  id: totrans-632
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: WriteLine(error.Description);
  id: totrans-633
  prefs: []
  type: TYPE_NORMAL
  zh: WriteLine(error.Description);
- en: '}'
  id: totrans-634
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '}'
  id: totrans-635
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '}'
  id: totrans-636
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: return
  id: totrans-637
  prefs: []
  type: TYPE_NORMAL
  zh: 返回
- en: Redirect("/"
  id: totrans-638
  prefs: []
  type: TYPE_NORMAL
  zh: 重定向“/”
- en: );
  id: totrans-639
  prefs: []
  type: TYPE_NORMAL
  zh: ）;
- en: '}'
  id: totrans-640
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '}'
  id: totrans-641
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '```'
  id: totrans-642
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'Note the following:'
  id: totrans-643
  prefs: []
  type: TYPE_NORMAL
  zh: 注意以下内容：
- en: Two fields for the name of the role and email of the user.
  id: totrans-644
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 角色名称和用户电子邮件的两个字段。
- en: The constructor gets and stores the registered user and role manager dependency
    services.
  id: totrans-645
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 构造函数获取并存储注册用户和角色管理器依赖服务。
- en: If the `Administrators` role does not exist, we use the role manager to create
    it.
  id: totrans-646
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果`Administrators`角色不存在，我们使用角色管理器来创建它。
- en: We try to find a test user by its email, create it if it does not exist, and
    then assign the user to the `Administrators` role.
  id: totrans-647
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们尝试通过其电子邮件找到测试用户，如果不存在则创建用户，然后将用户分配给`Administrators`角色。
- en: Since the website uses DOI, we must generate an email confirmation token and
    use it to confirm the new users email address.
  id: totrans-648
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于网站使用DOI，我们必须生成电子邮件确认令牌，并使用它来确认新用户的电子邮件地址。
- en: Success messages and any errors are written out to the console.
  id: totrans-649
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 成功消息和任何错误都会写入控制台。
- en: You will be automatically redirected to the home page.
  id: totrans-650
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您将被自动重定向到主页。
- en: Start the website.
  id: totrans-651
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动网站。
- en: Click **Privacy** and note that you are redirected to the login page.
  id: totrans-652
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**隐私**，注意您被重定向到登录页面。
- en: Enter your email and password. (I used `mark@example.com` .)
  id: totrans-653
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入您的电子邮件和密码。（我使用了`mark@example.com`。）
- en: Click **Log in** and note that you are denied access as before.
  id: totrans-654
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**登录**，注意您仍然被拒绝访问。
- en: Click **Home** .
  id: totrans-655
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**主页**。
- en: 'In the address bar, manually enter `roles` as a relative URL path, as shown
    in the following link: `https://localhost:5001/roles` .'
  id: totrans-656
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在地址栏中，手动输入`roles`作为相对URL路径，如下面的链接所示：`https://localhost:5001/roles`。
- en: 'View the success messages written to the console, as shown in the following
    output:'
  id: totrans-657
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看写入控制台的成功消息，如下面的输出所示：
- en: '```cs'
  id: totrans-658
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: User test@example.com created successfully.
  id: totrans-659
  prefs: []
  type: TYPE_NORMAL
  zh: 用户test@example.com成功创建。
- en: User test@example.com email confirmed successfully.
  id: totrans-660
  prefs: []
  type: TYPE_NORMAL
  zh: 用户test@example.com的电子邮件成功确认。
- en: User test@example.com added to Administrators successfully.
  id: totrans-661
  prefs: []
  type: TYPE_NORMAL
  zh: 用户test@example.com成功添加到管理员。
- en: '```'
  id: totrans-662
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Click **Logout** , because you must log out and log back in to load your role
    memberships when they are created after you have already logged in.
  id: totrans-663
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**注销**，因为您必须注销并重新登录以在已经登录后创建角色成员资格时加载它们。
- en: Try accessing the **Privacy** page again, enter the email for the new user that
    was programmatically created, for example, `test@example.com` , and their password,
    and then click **Log in** , and you should now have access.
  id: totrans-664
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 尝试再次访问**隐私**页面，输入以编程方式创建的新用户的电子邮件，例如`test@example.com`，以及他们的密码，然后单击**登录**，现在您应该可以访问。
- en: Close Chrome and shut down the web server.
  id: totrans-665
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭Chrome并关闭Web服务器。
- en: Using a filter to cache a response
  id: totrans-666
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用过滤器缓存响应
- en: To improve response times and scalability, you might want to cache the HTTP
    response that is generated by an action method by decorating the method with the
    `[ResponseCache]` attribute.
  id: totrans-667
  prefs: []
  type: TYPE_NORMAL
  zh: 为了提高响应时间和可伸缩性，您可能希望通过使用`[ResponseCache]`属性装饰方法来缓存由操作方法生成的HTTP响应。
- en: 'You control where the response is cached and for how long by setting parameters,
    as shown in the following list:'
  id: totrans-668
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过设置参数来控制响应的缓存位置和持续时间，如下面的列表所示：
- en: '`Duration` : In seconds. This sets the `max-age` HTTP response header measured
    in seconds. Common choices are one hour (3600 seconds) and one day (86400 seconds).'
  id: totrans-669
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Duration`：以秒为单位。这将设置以秒为单位的`max-age` HTTP响应标头。常见选择是一小时（3600秒）和一天（86400秒）。'
- en: '`Location` : One of the `ResponseCacheLocation` values, `Any` , `Client` ,
    or `None` . This sets the `cache-control` HTTP response header.'
  id: totrans-670
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`位置`：`ResponseCacheLocation`值之一，`Any`，`Client`或`None`。这将设置`cache-control` HTTP响应标头。'
- en: '`NoStore` : If `true` , this ignores `Duration` and `Location` and sets the
    cache-control HTTP response header to `no-store` .'
  id: totrans-671
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`NoStore`：如果为`true`，则会忽略`Duration`和`Location`，并将`cache-control` HTTP响应标头设置为`no-store`。'
- en: 'Let''s see an example:'
  id: totrans-672
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看一个例子：
- en: 'In `HomeController.cs` , add an attribute to the `Index` method to cache the
    response for 10 seconds on the browser or any proxies between the server and browser,
    as shown highlighted in the following code:'
  id: totrans-673
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`HomeController.cs`中，为`Index`方法添加一个属性，以在浏览器或服务器和浏览器之间的任何代理上缓存响应10秒，如下面的代码中所示：
- en: '```cs'
  id: totrans-674
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '**[**'
  id: totrans-675
  prefs: []
  type: TYPE_NORMAL
  zh: '**[**'
- en: '**ResponseCache(Duration = 10, Location = ResponseCacheLocation.Any)**'
  id: totrans-676
  prefs: []
  type: TYPE_NORMAL
  zh: '**ResponseCache(Duration = 10, Location = ResponseCacheLocation.Any)**'
- en: '**]**'
  id: totrans-677
  prefs: []
  type: TYPE_NORMAL
  zh: '**]**'
- en: public
  id: totrans-678
  prefs: []
  type: TYPE_NORMAL
  zh: 公共
- en: IActionResult
  id: totrans-679
  prefs: []
  type: TYPE_NORMAL
  zh: IActionResult
- en: Index
  id: totrans-680
  prefs: []
  type: TYPE_NORMAL
  zh: 索引
- en: ()
  id: totrans-681
  prefs: []
  type: TYPE_NORMAL
  zh: ()
- en: '```'
  id: totrans-682
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'In `Views` , in `Home` , open `Index.cshtml` , and add a paragraph to output
    the current time in long format to include seconds, as shown in the following
    markup:'
  id: totrans-683
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Views`中，在`Home`中，打开`Index.cshtml`，并添加一个段落，以长格式输出当前时间，包括秒，如下面的标记所示：
- en: '```cs'
  id: totrans-684
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: <
  id: totrans-685
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: p
  id: totrans-686
  prefs: []
  type: TYPE_NORMAL
  zh: p
- en: class
  id: totrans-687
  prefs: []
  type: TYPE_NORMAL
  zh: 类
- en: '='
  id: totrans-688
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"alert alert-primary"'
  id: totrans-689
  prefs: []
  type: TYPE_NORMAL
  zh: '"警报警报-主要"'
- en: '>'
  id: totrans-690
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@DateTime.Now.ToLongTimeString()</'
  id: totrans-691
  prefs: []
  type: TYPE_NORMAL
  zh: '@DateTime.Now.ToLongTimeString()</'
- en: p
  id: totrans-692
  prefs: []
  type: TYPE_NORMAL
  zh: p
- en: '>'
  id: totrans-693
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '```'
  id: totrans-694
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Start the website.
  id: totrans-695
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动网站。
- en: Note the time on the home page.
  id: totrans-696
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注意主页上的时间。
- en: Click **Register** .
  id: totrans-697
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**注册**。
- en: Click **Home** and note the time on the home page is the same because a cached
    version of the page is used.
  id: totrans-698
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**主页**，注意主页上的时间相同，因为使用了页面的缓存版本。
- en: Click **Register** . Wait at least ten seconds.
  id: totrans-699
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**注册**。等待至少十秒。
- en: Click **Home** and note the time has now updated.
  id: totrans-700
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**主页**，注意时间现在已更新。
- en: Click **Log in** , enter your email and password, and then click **Log in**
    .
  id: totrans-701
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**登录**，输入您的电子邮件和密码，然后单击**登录**。
- en: Note the time on the home page.
  id: totrans-702
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注意主页上的时间。
- en: Click **Privacy** .
  id: totrans-703
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**隐私**。
- en: Click **Home** and note the page is not cached.
  id: totrans-704
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**主页**，注意页面未被缓存。
- en: 'View the console and note the warning message explaining that your caching
    has been overridden because the visitor is logged in and, in this scenario, ASP.NET
    Core uses anti-forgery tokens and they should not be cached, as shown in the following
    output:'
  id: totrans-705
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看控制台，并注意警告消息，解释您的缓存已被覆盖，因为访问者已登录，在这种情况下，ASP.NET Core使用防伪令牌，它们不应该被缓存，如下面的输出所示：
- en: '```cs'
  id: totrans-706
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: 'warn: Microsoft.AspNetCore.Antiforgery.DefaultAntiforgery[8]'
  id: totrans-707
  prefs: []
  type: TYPE_NORMAL
  zh: 警告：Microsoft.AspNetCore.Antiforgery.DefaultAntiforgery[8]
- en: The 'Cache-Control' and 'Pragma' headers have been overridden and set to 'no-cache,
    no-store' and 'no-cache' respectively to prevent caching of this response. Any
    response that uses antiforgery should not be cached.
  id: totrans-708
  prefs: []
  type: TYPE_NORMAL
  zh: 已覆盖'Cache-Control'和'Pragma'标头，并分别设置为'no-cache, no-store'和'no-cache'，以防止缓存此响应。任何使用防伪的响应都不应该被缓存。
- en: '```'
  id: totrans-709
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Close Chrome and shut down the web server.
  id: totrans-710
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭Chrome并关闭Web服务器。
- en: Using a filter to define a custom route
  id: totrans-711
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用过滤器定义自定义路由
- en: You might want to define a simplified route for an action method instead of
    using the default route.
  id: totrans-712
  prefs: []
  type: TYPE_NORMAL
  zh: 您可能希望为操作方法定义一个简化的路由，而不是使用默认路由。
- en: 'For example, to show the privacy page currently requires the following URL
    path, which specifies both the controller and action:'
  id: totrans-713
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，要显示隐私页面当前需要以下URL路径，其中指定了控制器和操作：
- en: '```cs'
  id: totrans-714
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: https://localhost:5001/home/privacy
  id: totrans-715
  prefs: []
  type: TYPE_NORMAL
  zh: https://localhost:5001/home/privacy
- en: '```'
  id: totrans-716
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'We could make the route simpler, as shown in the following link:'
  id: totrans-717
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以简化路由，如下面的链接所示：
- en: '```cs'
  id: totrans-718
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: https://localhost:5001/private
  id: totrans-719
  prefs: []
  type: TYPE_NORMAL
  zh: https://localhost:5001/private
- en: '```'
  id: totrans-720
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'Let''s see how to do that:'
  id: totrans-721
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看如何做到这一点：
- en: 'In `HomeController.cs` , add an attribute to the `Privacy` method to define
    a simplified route, as shown highlighted in the following code:'
  id: totrans-722
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`HomeController.cs`中，向`Privacy`方法添加属性以定义简化路由，如下面的代码中突出显示的那样：
- en: '```cs'
  id: totrans-723
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '**[**'
  id: totrans-724
  prefs: []
  type: TYPE_NORMAL
  zh: '**[**'
- en: '**Route(**'
  id: totrans-725
  prefs: []
  type: TYPE_NORMAL
  zh: '**Route（**'
- en: '**"private"**'
  id: totrans-726
  prefs: []
  type: TYPE_NORMAL
  zh: '**"私人"**'
- en: '**)**'
  id: totrans-727
  prefs: []
  type: TYPE_NORMAL
  zh: '**)**'
- en: '**]**'
  id: totrans-728
  prefs: []
  type: TYPE_NORMAL
  zh: '**]**'
- en: '[Authorize(Roles ='
  id: totrans-729
  prefs: []
  type: TYPE_NORMAL
  zh: '[授权（角色='
- en: '"Administrators"'
  id: totrans-730
  prefs: []
  type: TYPE_NORMAL
  zh: '"管理员"'
- en: )
  id: totrans-731
  prefs: []
  type: TYPE_NORMAL
  zh: ）
- en: ']'
  id: totrans-732
  prefs: []
  type: TYPE_NORMAL
  zh: ']'
- en: public
  id: totrans-733
  prefs: []
  type: TYPE_NORMAL
  zh: 公共
- en: IActionResult
  id: totrans-734
  prefs: []
  type: TYPE_NORMAL
  zh: IActionResult
- en: Privacy
  id: totrans-735
  prefs: []
  type: TYPE_NORMAL
  zh: 隐私
- en: ()
  id: totrans-736
  prefs: []
  type: TYPE_NORMAL
  zh: （）
- en: '```'
  id: totrans-737
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Start the website.
  id: totrans-738
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动网站。
- en: 'In the address bar, enter the following URL path:'
  id: totrans-739
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在地址栏中，输入以下URL路径：
- en: '```cs'
  id: totrans-740
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: https://localhost:5001/private
  id: totrans-741
  prefs: []
  type: TYPE_NORMAL
  zh: https://localhost:5001/private
- en: '```'
  id: totrans-742
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Enter your email and password, click **Log in** , and note that the simplified
    path shows the **Privacy** page.
  id: totrans-743
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入您的电子邮件和密码，单击**登录**，注意简化路径显示**隐私**页面。
- en: Close Chrome and shut down the web server.
  id: totrans-744
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭Chrome并关闭Web服务器。
- en: Understanding entity and view models
  id: totrans-745
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解实体和视图模型
- en: 'In MVC, the M stands for *model* . Models represent the data required to respond
    to a request. There are two types of models commonly used: entity models and view
    models.'
  id: totrans-746
  prefs: []
  type: TYPE_NORMAL
  zh: 在MVC中，M代表*模型*。模型表示响应请求所需的数据。通常使用两种类型的模型：实体模型和视图模型。
- en: '**Entity models** represent entities in a database like SQL Server or SQLite.
    Based on the request, one or more entities might need to be retrieved from data
    storage. Entity models are defined using classes since they might need to change
    and then be used to update the underlying data store.'
  id: totrans-747
  prefs: []
  type: TYPE_NORMAL
  zh: '**实体模型**表示数据库中的实体，如SQL Server或SQLite。根据请求，可能需要从数据存储中检索一个或多个实体。实体模型是使用类定义的，因为它们可能需要更改，然后用于更新底层数据存储。'
- en: All the data that we want to show in response to a request is the **MVC model**
    , sometimes called a **view model** , because it is a model that is passed into
    a view for rendering into a response format like HTML or JSON. View models should
    be immutable, so they are commonly defined using records.
  id: totrans-748
  prefs: []
  type: TYPE_NORMAL
  zh: 我们希望在响应请求时显示的所有数据都是**MVC模型**，有时称为**视图模型**，因为它是传递到视图以呈现为HTML或JSON等响应格式的模型。视图模型应该是不可变的，因此通常使用记录来定义。
- en: 'For example, the following HTTP `GET` request might mean that the browser is
    asking for the product details page for product number 3:'
  id: totrans-749
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，以下HTTP `GET`请求可能意味着浏览器正在请求产品编号为3的产品详情页面：
- en: '[http://www.example.com/products/details/3](http://www.example.com/products/details/3)'
  id: totrans-750
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://www.example.com/products/details/3](http://www.example.com/products/details/3)'
- en: The controller would need to use the ID route value 3 to retrieve the entity
    for that product and pass it to a view that can then turn the model into HTML
    for display in a browser.
  id: totrans-751
  prefs: []
  type: TYPE_NORMAL
  zh: 控制器需要使用ID路由值3来检索该产品的实体，并将其传递给一个视图，然后可以将模型转换为HTML以在浏览器中显示。
- en: Imagine that when a user comes to our website, we want to show them a carousel
    of categories, a list of products, and a count of the number of visitors we have
    had this month.
  id: totrans-752
  prefs: []
  type: TYPE_NORMAL
  zh: 想象一下，当用户来到我们的网站时，我们想向他们展示一个类别的轮播图，产品列表以及本月我们有多少访问者的计数。
- en: 'We will reference the Entity Framework Core entity data model for the Northwind
    database that you created in *Chapter 13* , *Introducing Practical Applications
    of C# and .NET* :'
  id: totrans-753
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将引用您在*第13章*中创建的Northwind数据库的Entity Framework Core实体数据模型，*介绍C#和.NET的实际应用*：
- en: 'In the `Northwind.Mvc` project, add a project reference to `Northwind.Common.DataContext`
    for either SQLite or SQL Server, as shown in the following markup:'
  id: totrans-754
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Northwind.Mvc`项目中，向`Northwind.Common.DataContext`添加对SQLite或SQL Server的项目引用，如下面的标记所示：
- en: '```cs'
  id: totrans-755
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: <ItemGroup>
  id: totrans-756
  prefs: []
  type: TYPE_NORMAL
  zh: <ItemGroup>
- en: <!-- change Sqlite to SqlServer if
  id: totrans-757
  prefs: []
  type: TYPE_NORMAL
  zh: <!--如果要切换到SqlServer，请将Sqlite更改为SqlServer
- en: you prefer -->
  id: totrans-758
  prefs: []
  type: TYPE_NORMAL
  zh: 您喜欢的-->
- en: <ProjectReference Include=
  id: totrans-759
  prefs: []
  type: TYPE_NORMAL
  zh: <ProjectReference Include=
- en: '"..\Northwind.Common.DataContext.Sqlite\Northwind.Common.DataContext.Sqlite.csproj"'
  id: totrans-760
  prefs: []
  type: TYPE_NORMAL
  zh: '"..\Northwind.Common.DataContext.Sqlite\Northwind.Common.DataContext.Sqlite.csproj"'
- en: />
  id: totrans-761
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: </ItemGroup>
  id: totrans-762
  prefs: []
  type: TYPE_NORMAL
  zh: </ItemGroup>
- en: '```'
  id: totrans-763
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Build the `Northwind.Mvc` project to compile its dependencies.
  id: totrans-764
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建`Northwind.Mvc`项目以编译其依赖项。
- en: 'If you are using SQL Server, or might want to switch between SQL Server and
    SQLite, then in `appsettings.json` , add a connection string for the Northwind
    database using SQL Server, as shown highlighted in the following markup:'
  id: totrans-765
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您正在使用SQL Server，或者可能想要在SQL Server和SQLite之间切换，那么在`appsettings.json`中，添加一个连接字符串，用SQL
    Server连接到Northwind数据库，如下面标记的部分所示：
- en: '```cs'
  id: totrans-766
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '{'
  id: totrans-767
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: '"ConnectionStrings"'
  id: totrans-768
  prefs: []
  type: TYPE_NORMAL
  zh: '"ConnectionStrings"'
- en: ': {'
  id: totrans-769
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: '"DefaultConnection"'
  id: totrans-770
  prefs: []
  type: TYPE_NORMAL
  zh: '"DefaultConnection"'
- en: ': "Server=(localdb)\\mssqllocaldb;Database=aspnet-Northwind.Mvc-DC9C4FAF-DD84-4FC9-B925-69A61240EDA7;Trusted_Connection=True;MultipleActiveResultSets=true"'
  id: totrans-771
  prefs: []
  type: TYPE_NORMAL
  zh: ': "Server=(localdb)\\mssqllocaldb;Database=aspnet-Northwind.Mvc-DC9C4FAF-DD84-4FC9-B925-69A61240EDA7;Trusted_Connection=True;MultipleActiveResultSets=true"'
- en: ','
  id: totrans-772
  prefs: []
  type: TYPE_NORMAL
  zh: ','
- en: '**"NorthwindConnection"**'
  id: totrans-773
  prefs: []
  type: TYPE_NORMAL
  zh: '**"NorthwindConnection"**'
- en: '**:**'
  id: totrans-774
  prefs: []
  type: TYPE_NORMAL
  zh: '**:**'
- en: '**"Server=.;Database=Northwind;Trusted_Connection=True;MultipleActiveResultSets=true"**'
  id: totrans-775
  prefs: []
  type: TYPE_NORMAL
  zh: '**"Server=.;Database=Northwind;Trusted_Connection=True;MultipleActiveResultSets=true"**'
- en: '},'
  id: totrans-776
  prefs: []
  type: TYPE_NORMAL
  zh: '},'
- en: '```'
  id: totrans-777
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'In `Program.cs` , import the namespace to work with your entity model types,
    as shown in the following code:'
  id: totrans-778
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Program.cs`中，导入命名空间以使用您的实体模型类型，如下面的代码所示：
- en: '```cs'
  id: totrans-779
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: using
  id: totrans-780
  prefs: []
  type: TYPE_NORMAL
  zh: using
- en: Packt.Shared; // AddNorthwindContext extension method
  id: totrans-781
  prefs: []
  type: TYPE_NORMAL
  zh: Packt.Shared; // AddNorthwindContext扩展方法
- en: '```'
  id: totrans-782
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'Before the `builder.Build` method call, add statements to load the appropriate
    connection string and then to register the `Northwind` database context, as shown
    in the following code:'
  id: totrans-783
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`builder.Build`方法调用之前，添加语句来加载适当的连接字符串，然后注册`Northwind`数据库上下文，如下面的代码所示：
- en: '```cs'
  id: totrans-784
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: // if you are using SQL Server
  id: totrans-785
  prefs: []
  type: TYPE_NORMAL
  zh: //如果您正在使用SQL Server
- en: string
  id: totrans-786
  prefs: []
  type: TYPE_NORMAL
  zh: string
- en: sqlServerConnection = builder.Configuration
  id: totrans-787
  prefs: []
  type: TYPE_NORMAL
  zh: sqlServerConnection = builder.Configuration
- en: .GetConnectionString("NorthwindConnection"
  id: totrans-788
  prefs: []
  type: TYPE_NORMAL
  zh: .GetConnectionString("NorthwindConnection"
- en: );
  id: totrans-789
  prefs: []
  type: TYPE_NORMAL
  zh: );
- en: builder.Services.AddNorthwindContext(sqlServerConnection);
  id: totrans-790
  prefs: []
  type: TYPE_NORMAL
  zh: builder.Services.AddNorthwindContext(sqlServerConnection);
- en: // if you are using SQLite default is ..\Northwind.db
  id: totrans-791
  prefs: []
  type: TYPE_NORMAL
  zh: //如果您使用的是SQLite，默认是..\Northwind.db
- en: builder.Services.AddNorthwindContext();
  id: totrans-792
  prefs: []
  type: TYPE_NORMAL
  zh: builder.Services.AddNorthwindContext();
- en: '```'
  id: totrans-793
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Add a class file to the `Models` folder and name it `HomeIndexViewModel.cs`
    .
  id: totrans-794
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将一个类文件添加到`Models`文件夹，并将其命名为`HomeIndexViewModel.cs`。
- en: '**Good Practice** : Although the `ErrorViewModel` class created by the MVC
    project template does not follow this convention, I recommend that you use the
    naming convention `{Controller}{Action}ViewModel` for your view model classes.'
  id: totrans-795
  prefs: []
  type: TYPE_NORMAL
  zh: '**良好的实践**：虽然MVC项目模板创建的`ErrorViewModel`类不遵循此约定，但我建议您为视图模型类使用命名约定`{Controller}{Action}ViewModel`。'
- en: 'Modify the statements to define a record that has three properties for a count
    of the number of visitors, and lists of categories and products, as shown in the
    following code:'
  id: totrans-796
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改语句以定义一个记录，该记录具有三个属性，用于统计访问者数量，以及类别和产品的列表，如下面的代码所示：
- en: '```cs'
  id: totrans-797
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: using
  id: totrans-798
  prefs: []
  type: TYPE_NORMAL
  zh: using
- en: Packt.Shared; // Category, Product
  id: totrans-799
  prefs: []
  type: TYPE_NORMAL
  zh: Packt.Shared; // Category, Product
- en: namespace
  id: totrans-800
  prefs: []
  type: TYPE_NORMAL
  zh: namespace
- en: Northwind.Mvc.Models
  id: totrans-801
  prefs: []
  type: TYPE_NORMAL
  zh: Northwind.Mvc.Models
- en: ;
  id: totrans-802
  prefs: []
  type: TYPE_NORMAL
  zh: ;
- en: public
  id: totrans-803
  prefs: []
  type: TYPE_NORMAL
  zh: public
- en: record
  id: totrans-804
  prefs: []
  type: TYPE_NORMAL
  zh: 记录
- en: HomeIndexViewModel
  id: totrans-805
  prefs: []
  type: TYPE_NORMAL
  zh: HomeIndexViewModel
- en: (
  id: totrans-806
  prefs: []
  type: TYPE_NORMAL
  zh: (
- en: int
  id: totrans-807
  prefs: []
  type: TYPE_NORMAL
  zh: int
- en: VisitorCount,
  id: totrans-808
  prefs: []
  type: TYPE_NORMAL
  zh: VisitorCount,
- en: IList<Category> Categories,
  id: totrans-809
  prefs: []
  type: TYPE_NORMAL
  zh: IList<Category> Categories,
- en: IList<Product> Products
  id: totrans-810
  prefs: []
  type: TYPE_NORMAL
  zh: IList<Product> Products
- en: )
  id: totrans-811
  prefs: []
  type: TYPE_NORMAL
  zh: )
- en: ;
  id: totrans-812
  prefs: []
  type: TYPE_NORMAL
  zh: ;
- en: '```'
  id: totrans-813
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'In `HomeController.cs` , import the `Packt.Shared` namespace, as shown in the
    following code:'
  id: totrans-814
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`HomeController.cs`中，导入`Packt.Shared`命名空间，如下面的代码所示：
- en: '```cs'
  id: totrans-815
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: using
  id: totrans-816
  prefs: []
  type: TYPE_NORMAL
  zh: using
- en: Packt.Shared; // NorthwindContext
  id: totrans-817
  prefs: []
  type: TYPE_NORMAL
  zh: Packt.Shared; // NorthwindContext
- en: '```'
  id: totrans-818
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'Add a field to store a reference to a `Northwind` instance, and initialize
    it in the constructor, as shown highlighted in the following code:'
  id: totrans-819
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加一个字段来存储对`Northwind`实例的引用，并在构造函数中进行初始化，如下面标记的部分所示：
- en: '```cs'
  id: totrans-820
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: public
  id: totrans-821
  prefs: []
  type: TYPE_NORMAL
  zh: public
- en: class
  id: totrans-822
  prefs: []
  type: TYPE_NORMAL
  zh: 类
- en: HomeController
  id: totrans-823
  prefs: []
  type: TYPE_NORMAL
  zh: HomeController
- en: ': Controller'
  id: totrans-824
  prefs: []
  type: TYPE_NORMAL
  zh: ': 控制器'
- en: '{'
  id: totrans-825
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: private
  id: totrans-826
  prefs: []
  type: TYPE_NORMAL
  zh: private
- en: readonly
  id: totrans-827
  prefs: []
  type: TYPE_NORMAL
  zh: readonly
- en: ILogger<HomeController> _logger;
  id: totrans-828
  prefs: []
  type: TYPE_NORMAL
  zh: ILogger<HomeController> _logger;
- en: '**private**'
  id: totrans-829
  prefs: []
  type: TYPE_NORMAL
  zh: '**private**'
- en: '**readonly**'
  id: totrans-830
  prefs: []
  type: TYPE_NORMAL
  zh: '**readonly**'
- en: '**NorthwindContext db;**'
  id: totrans-831
  prefs: []
  type: TYPE_NORMAL
  zh: '**NorthwindContext db;**'
- en: public
  id: totrans-832
  prefs: []
  type: TYPE_NORMAL
  zh: public
- en: HomeController
  id: totrans-833
  prefs: []
  type: TYPE_NORMAL
  zh: HomeController
- en: (
  id: totrans-834
  prefs: []
  type: TYPE_NORMAL
  zh: (
- en: ILogger<HomeController> logger,
  id: totrans-835
  prefs: []
  type: TYPE_NORMAL
  zh: ILogger<HomeController> logger,
- en: '**NorthwindContext injectedContext**'
  id: totrans-836
  prefs: []
  type: TYPE_NORMAL
  zh: '**NorthwindContext injectedContext**'
- en: '**)**'
  id: totrans-837
  prefs: []
  type: TYPE_NORMAL
  zh: '**)**'
- en: '{'
  id: totrans-838
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: _logger = logger;
  id: totrans-839
  prefs: []
  type: TYPE_NORMAL
  zh: _logger = logger;
- en: '**db = injectedContext;**'
  id: totrans-840
  prefs: []
  type: TYPE_NORMAL
  zh: '**db = injectedContext;**'
- en: '}'
  id: totrans-841
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '...'
  id: totrans-842
  prefs: []
  type: TYPE_NORMAL
  zh: '...'
- en: '```'
  id: totrans-843
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: ASP.NET Core will use constructor parameter injection to pass an instance of
    the `NorthwindContext` database context using the connection string you specified
    in `Program.cs` .
  id: totrans-844
  prefs: []
  type: TYPE_NORMAL
  zh: ASP.NET Core将使用构造函数参数注入来传递`NorthwindContext`数据库上下文的实例，使用您在`Program.cs`中指定的连接字符串。
- en: 'Modify the statements in the `Index` action method to create an instance of
    the view model for this method, simulating a visitor count using the `Random`
    class to generate a number between 1 and 1000, and using the `Northwind` database
    to get lists of categories and products, and then pass the model to the view,
    as shown highlighted in the following code:'
  id: totrans-845
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改`Index`操作方法中的语句，以创建此方法的视图模型的实例，使用`Random`类模拟访问者计数生成1到1000之间的数字，并使用`Northwind`数据库获取类别和产品的列表，然后将模型传递给视图，如下面的代码所示：
- en: '```cs'
  id: totrans-846
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '[ResponseCache(Duration = 10, Location = ResponseCacheLocation.Any)'
  id: totrans-847
  prefs: []
  type: TYPE_NORMAL
  zh: '[ResponseCache(Duration = 10, Location = ResponseCacheLocation.Any)'
- en: ']'
  id: totrans-848
  prefs: []
  type: TYPE_NORMAL
  zh: ']'
- en: public
  id: totrans-849
  prefs: []
  type: TYPE_NORMAL
  zh: public
- en: IActionResult
  id: totrans-850
  prefs: []
  type: TYPE_NORMAL
  zh: IActionResult
- en: Index
  id: totrans-851
  prefs: []
  type: TYPE_NORMAL
  zh: Index
- en: ()
  id: totrans-852
  prefs: []
  type: TYPE_NORMAL
  zh: ()
- en: '{'
  id: totrans-853
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: _logger.LogError("This is a serious error (not really!)"
  id: totrans-854
  prefs: []
  type: TYPE_NORMAL
  zh: _logger.LogError("这是一个严重的错误（实际上并不是！）"
- en: );
  id: totrans-855
  prefs: []
  type: TYPE_NORMAL
  zh: );
- en: _logger.LogWarning("This is your first warning!"
  id: totrans-856
  prefs: []
  type: TYPE_NORMAL
  zh: _logger.LogWarning("这是您的第一个警告！"
- en: );
  id: totrans-857
  prefs: []
  type: TYPE_NORMAL
  zh: );
- en: _logger.LogWarning("Second warning!"
  id: totrans-858
  prefs: []
  type: TYPE_NORMAL
  zh: _logger.LogWarning("第二个警告！"
- en: );
  id: totrans-859
  prefs: []
  type: TYPE_NORMAL
  zh: );
- en: _logger.LogInformation("I am in the Index method of the HomeController."
  id: totrans-860
  prefs: []
  type: TYPE_NORMAL
  zh: _logger.LogInformation("我在HomeController的Index方法中。"
- en: );
  id: totrans-861
  prefs: []
  type: TYPE_NORMAL
  zh: );
- en: '**HomeIndexViewModel model =**'
  id: totrans-862
  prefs: []
  type: TYPE_NORMAL
  zh: '**HomeIndexViewModel model =**'
- en: '**new**'
  id: totrans-863
  prefs: []
  type: TYPE_NORMAL
  zh: '**new**'
- en: '**(**'
  id: totrans-864
  prefs: []
  type: TYPE_NORMAL
  zh: '**(**'
- en: '**VisitorCount: (**'
  id: totrans-865
  prefs: []
  type: TYPE_NORMAL
  zh: '**VisitorCount: (**'
- en: '**new**'
  id: totrans-866
  prefs: []
  type: TYPE_NORMAL
  zh: '**new**'
- en: '**Random()).Next(**'
  id: totrans-867
  prefs: []
  type: TYPE_NORMAL
  zh: '**Random()).Next(**'
- en: '**1**'
  id: totrans-868
  prefs: []
  type: TYPE_NORMAL
  zh: '**1**'
- en: '**,**'
  id: totrans-869
  prefs: []
  type: TYPE_NORMAL
  zh: '**,**'
- en: '**1001**'
  id: totrans-870
  prefs: []
  type: TYPE_NORMAL
  zh: '**1001**'
- en: '**),**'
  id: totrans-871
  prefs: []
  type: TYPE_NORMAL
  zh: '**),**'
- en: '**Categories: db.Categories.ToList(),**'
  id: totrans-872
  prefs: []
  type: TYPE_NORMAL
  zh: '**Categories: db.Categories.ToList(),**'
- en: '**Products: db.Products.ToList()**'
  id: totrans-873
  prefs: []
  type: TYPE_NORMAL
  zh: '**Products: db.Products.ToList()**'
- en: '**);**'
  id: totrans-874
  prefs: []
  type: TYPE_NORMAL
  zh: '**);**'
- en: '**return**'
  id: totrans-875
  prefs: []
  type: TYPE_NORMAL
  zh: '**return**'
- en: '**View(model);**'
  id: totrans-876
  prefs: []
  type: TYPE_NORMAL
  zh: '**View(model);**'
- en: '**// pass model to view**'
  id: totrans-877
  prefs: []
  type: TYPE_NORMAL
  zh: '**//将模型传递给视图**'
- en: '}'
  id: totrans-878
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '```'
  id: totrans-879
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'Remember the view search convention: when the `View` method is called in a
    controller''s action method, ASP.NET Core MVC looks in the `Views` folder for
    a subfolder with the same name as the current controller, that is, `Home` . It
    then looks for a file with the same name as the current action, that is, `Index.cshtml`
    . It will also search for views that match the action method name in the `Shared`
    folder and for Razor Pages in the `Pages` folder.'
  id: totrans-880
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住视图搜索约定：当在控制器的操作方法中调用`View`方法时，ASP.NET Core MVC会在`Views`文件夹中查找与当前控制器相同名称的子文件夹，即`Home`。然后，它会查找与当前操作相同名称的文件，即`Index.cshtml`。它还将在`Shared`文件夹中查找与操作方法名称匹配的视图，并在`Pages`文件夹中查找Razor
    Pages。
- en: Understanding views
  id: totrans-881
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解视图
- en: In MVC, the V stands for *view* . The responsibility of a view is to transform
    a model into HTML or other formats.
  id: totrans-882
  prefs: []
  type: TYPE_NORMAL
  zh: 在MVC中，V代表*视图*。视图的责任是将模型转换为HTML或其他格式。
- en: There are multiple **view engines** that could be used to do this. The default
    view engine is called **Razor** , and it uses the `@` symbol to indicate server-side
    code execution. The Razor Pages feature introduced with ASP.NET Core 2.0 uses
    the same view engine and so can use the same Razor syntax.
  id: totrans-883
  prefs: []
  type: TYPE_NORMAL
  zh: 有多个**视图引擎**可用于执行此操作。默认视图引擎称为**Razor**，它使用`@`符号来指示服务器端代码执行。与ASP.NET Core 2.0一起引入的Razor
    Pages功能使用相同的视图引擎，因此可以使用相同的Razor语法。
- en: 'Let''s modify the home page view to render the lists of categories and products:'
  id: totrans-884
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们修改主页视图以呈现类别和产品的列表：
- en: Expand the `Views` folder, and then expand the `Home` folder.
  id: totrans-885
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 展开`Views`文件夹，然后展开`Home`文件夹。
- en: 'Open the `Index.cshtml` file and note the block of C# code wrapped in `@{ }`
    . This will execute first and can be used to store data that needs to be passed
    into a shared layout file like the title of the web page, as shown in the following
    code:'
  id: totrans-886
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开`Index.cshtml`文件，注意用`@{ }`包装的C#代码块。这将首先执行，并且可以用于存储需要传递到共享布局文件中的数据，例如网页的标题，如下面的代码所示：
- en: '```cs'
  id: totrans-887
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '@{'
  id: totrans-888
  prefs: []
  type: TYPE_NORMAL
  zh: '@{'
- en: ViewData["Title"
  id: totrans-889
  prefs: []
  type: TYPE_NORMAL
  zh: ViewData["Title"
- en: '] = "Home Page"'
  id: totrans-890
  prefs: []
  type: TYPE_NORMAL
  zh: '] = "主页"'
- en: ;
  id: totrans-891
  prefs: []
  type: TYPE_NORMAL
  zh: ;
- en: '}'
  id: totrans-892
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '```'
  id: totrans-893
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Note the static HTML content in the `<div>` element that uses Bootstrap for
    styling.
  id: totrans-894
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请注意在使用Bootstrap进行样式设置的`<div>`元素中的静态HTML内容。
- en: '**Good Practice** : As well as defining your own styles, base your styles on
    a common library, such as Bootstrap, that implements responsive design.'
  id: totrans-895
  prefs: []
  type: TYPE_NORMAL
  zh: '**良好实践**：除了定义自己的样式外，还应基于实现响应式设计的常见库（例如Bootstrap）来定义样式。'
- en: Just as with Razor Pages, there is a file named `_ViewStart.cshtml` that gets
    executed by the `View` method. It is used to set defaults that apply to all views.
  id: totrans-896
  prefs: []
  type: TYPE_NORMAL
  zh: 就像Razor Pages一样，有一个名为`_ViewStart.cshtml`的文件，它由`View`方法执行。它用于设置适用于所有视图的默认值。
- en: 'For example, it sets the `Layout` property of all views to a shared layout
    file, as shown in the following markup:'
  id: totrans-897
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，它将所有视图的`Layout`属性设置为共享布局文件，如下面的标记所示：
- en: '```cs'
  id: totrans-898
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '@{'
  id: totrans-899
  prefs: []
  type: TYPE_NORMAL
  zh: '@{'
- en: Layout = "_Layout"
  id: totrans-900
  prefs: []
  type: TYPE_NORMAL
  zh: Layout = "_Layout"
- en: ;
  id: totrans-901
  prefs: []
  type: TYPE_NORMAL
  zh: ;
- en: '}'
  id: totrans-902
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '```'
  id: totrans-903
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'In the `Views` folder, open the `_ViewImports.cshtml` file and note that it
    imports some namespaces and then adds the ASP.NET Core tag helpers, as shown in
    the following code:'
  id: totrans-904
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Views`文件夹中，打开`_ViewImports.cshtml`文件，并注意它导入了一些命名空间，然后添加了ASP.NET Core标记助手，如下面的代码所示：
- en: '```cs'
  id: totrans-905
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '@using Northwind.Mvc'
  id: totrans-906
  prefs: []
  type: TYPE_NORMAL
  zh: '@using Northwind.Mvc'
- en: '@using Northwind.Mvc.Models'
  id: totrans-907
  prefs: []
  type: TYPE_NORMAL
  zh: '@using Northwind.Mvc.Models'
- en: '@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers'
  id: totrans-908
  prefs: []
  type: TYPE_NORMAL
  zh: '@addTagHelper *，Microsoft.AspNetCore.Mvc.TagHelpers'
- en: '```'
  id: totrans-909
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: In the `Shared` folder, open the `_Layout.cshtml` file.
  id: totrans-910
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Shared`文件夹中，打开`_Layout.cshtml`文件。
- en: 'Note that the title is being read from the `ViewData` dictionary that was set
    earlier in the `Index.cshtml` view, as shown in the following markup:'
  id: totrans-911
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请注意标题是从`ViewData`字典中读取的，该字典是在`Index.cshtml`视图中设置的，如下面的标记所示：
- en: '```cs'
  id: totrans-912
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: <
  id: totrans-913
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: title
  id: totrans-914
  prefs: []
  type: TYPE_NORMAL
  zh: title
- en: '>'
  id: totrans-915
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@ViewData["Title"] – Northwind.Mvc</'
  id: totrans-916
  prefs: []
  type: TYPE_NORMAL
  zh: '@ViewData["Title"] – Northwind.Mvc</'
- en: title
  id: totrans-917
  prefs: []
  type: TYPE_NORMAL
  zh: title
- en: '>'
  id: totrans-918
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '```'
  id: totrans-919
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'Note the rendering of links to support Bootstrap and a site stylesheet, where
    `~` means the `wwwroot` folder, as shown in the following markup:'
  id: totrans-920
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请注意链接的呈现以支持Bootstrap和站点样式表，其中`〜`表示`wwwroot`文件夹，如下面的标记所示：
- en: '```cs'
  id: totrans-921
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: <
  id: totrans-922
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: link
  id: totrans-923
  prefs: []
  type: TYPE_NORMAL
  zh: link
- en: rel
  id: totrans-924
  prefs: []
  type: TYPE_NORMAL
  zh: rel
- en: '='
  id: totrans-925
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"stylesheet"'
  id: totrans-926
  prefs: []
  type: TYPE_NORMAL
  zh: '"stylesheet"'
- en: href
  id: totrans-927
  prefs: []
  type: TYPE_NORMAL
  zh: href
- en: '='
  id: totrans-928
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"~/lib/bootstrap/dist/css/bootstrap.css"'
  id: totrans-929
  prefs: []
  type: TYPE_NORMAL
  zh: '"〜/lib/bootstrap/dist/css/bootstrap.css"'
- en: />
  id: totrans-930
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: <
  id: totrans-931
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: link
  id: totrans-932
  prefs: []
  type: TYPE_NORMAL
  zh: link
- en: rel
  id: totrans-933
  prefs: []
  type: TYPE_NORMAL
  zh: rel
- en: '='
  id: totrans-934
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"stylesheet"'
  id: totrans-935
  prefs: []
  type: TYPE_NORMAL
  zh: '"stylesheet"'
- en: href
  id: totrans-936
  prefs: []
  type: TYPE_NORMAL
  zh: href
- en: '='
  id: totrans-937
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"~/css/site.css"'
  id: totrans-938
  prefs: []
  type: TYPE_NORMAL
  zh: '"〜/css/site.css"'
- en: />
  id: totrans-939
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: '```'
  id: totrans-940
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'Note the rendering of a navigation bar in the header, as shown in the following
    markup:'
  id: totrans-941
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请注意标题中导航栏的呈现，如下面的标记所示：
- en: '```cs'
  id: totrans-942
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: <
  id: totrans-943
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: body
  id: totrans-944
  prefs: []
  type: TYPE_NORMAL
  zh: body
- en: '>'
  id: totrans-945
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-946
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: header
  id: totrans-947
  prefs: []
  type: TYPE_NORMAL
  zh: header
- en: '>'
  id: totrans-948
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-949
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: nav
  id: totrans-950
  prefs: []
  type: TYPE_NORMAL
  zh: nav
- en: class
  id: totrans-951
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-952
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"navbar ..."'
  id: totrans-953
  prefs: []
  type: TYPE_NORMAL
  zh: '"navbar ..."'
- en: '>'
  id: totrans-954
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '```'
  id: totrans-955
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'Note the rendering of a collapsible `<div>` containing a partial view for logging
    in and hyperlinks to allow users to navigate between pages using ASP.NET Core
    tag helpers with attributes like `asp-controller` and `asp-action` , as shown
    in the following markup:'
  id: totrans-956
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请注意呈现可折叠的`<div>`，其中包含用于登录的部分视图和使用ASP.NET Core标记助手的超链接，以允许用户在页面之间导航，属性如`asp-controller`和`asp-action`，如下面的标记所示：
- en: '```cs'
  id: totrans-957
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: <
  id: totrans-958
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: div
  id: totrans-959
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: class
  id: totrans-960
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-961
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"navbar-collapse collapse d-sm-inline-flex justify-content-between"'
  id: totrans-962
  prefs: []
  type: TYPE_NORMAL
  zh: '"navbar-collapse collapse d-sm-inline-flex justify-content-between"'
- en: '>'
  id: totrans-963
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-964
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: ul
  id: totrans-965
  prefs: []
  type: TYPE_NORMAL
  zh: ul
- en: class
  id: totrans-966
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-967
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"navbar-nav flex-grow-1"'
  id: totrans-968
  prefs: []
  type: TYPE_NORMAL
  zh: '"navbar-nav flex-grow-1"'
- en: '>'
  id: totrans-969
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-970
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: li
  id: totrans-971
  prefs: []
  type: TYPE_NORMAL
  zh: li
- en: class
  id: totrans-972
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-973
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"nav-item"'
  id: totrans-974
  prefs: []
  type: TYPE_NORMAL
  zh: '"nav-item"'
- en: '>'
  id: totrans-975
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-976
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: a
  id: totrans-977
  prefs: []
  type: TYPE_NORMAL
  zh: a
- en: class
  id: totrans-978
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-979
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"nav-link text-dark"'
  id: totrans-980
  prefs: []
  type: TYPE_NORMAL
  zh: '"nav-link text-dark"'
- en: asp-area
  id: totrans-981
  prefs: []
  type: TYPE_NORMAL
  zh: asp-area
- en: '='
  id: totrans-982
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '""'
  id: totrans-983
  prefs: []
  type: TYPE_NORMAL
  zh: '""'
- en: asp-controller
  id: totrans-984
  prefs: []
  type: TYPE_NORMAL
  zh: asp-controller
- en: '='
  id: totrans-985
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"Home"'
  id: totrans-986
  prefs: []
  type: TYPE_NORMAL
  zh: '"Home"'
- en: asp-action
  id: totrans-987
  prefs: []
  type: TYPE_NORMAL
  zh: asp-action
- en: '='
  id: totrans-988
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"Index"'
  id: totrans-989
  prefs: []
  type: TYPE_NORMAL
  zh: '"Index"'
- en: '>'
  id: totrans-990
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Home</
  id: totrans-991
  prefs: []
  type: TYPE_NORMAL
  zh: Home</
- en: a
  id: totrans-992
  prefs: []
  type: TYPE_NORMAL
  zh: a
- en: '>'
  id: totrans-993
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-994
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: li
  id: totrans-995
  prefs: []
  type: TYPE_NORMAL
  zh: li
- en: '>'
  id: totrans-996
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-997
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: li
  id: totrans-998
  prefs: []
  type: TYPE_NORMAL
  zh: li
- en: class
  id: totrans-999
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1000
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"nav-item"'
  id: totrans-1001
  prefs: []
  type: TYPE_NORMAL
  zh: '"nav-item"'
- en: '>'
  id: totrans-1002
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1003
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: a
  id: totrans-1004
  prefs: []
  type: TYPE_NORMAL
  zh: a
- en: class
  id: totrans-1005
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1006
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"nav-link text-dark"'
  id: totrans-1007
  prefs: []
  type: TYPE_NORMAL
  zh: '"nav-link text-dark"'
- en: asp-area
  id: totrans-1008
  prefs: []
  type: TYPE_NORMAL
  zh: asp-area
- en: '='
  id: totrans-1009
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '""'
  id: totrans-1010
  prefs: []
  type: TYPE_NORMAL
  zh: '""'
- en: asp-controller
  id: totrans-1011
  prefs: []
  type: TYPE_NORMAL
  zh: asp-controller
- en: '='
  id: totrans-1012
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"Home"'
  id: totrans-1013
  prefs: []
  type: TYPE_NORMAL
  zh: '"Home"'
- en: asp-action
  id: totrans-1014
  prefs: []
  type: TYPE_NORMAL
  zh: asp-action
- en: '='
  id: totrans-1015
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"Privacy"'
  id: totrans-1016
  prefs: []
  type: TYPE_NORMAL
  zh: '"Privacy"'
- en: '>'
  id: totrans-1017
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Privacy</
  id: totrans-1018
  prefs: []
  type: TYPE_NORMAL
  zh: Privacy</
- en: a
  id: totrans-1019
  prefs: []
  type: TYPE_NORMAL
  zh: a
- en: '>'
  id: totrans-1020
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-1021
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: li
  id: totrans-1022
  prefs: []
  type: TYPE_NORMAL
  zh: li
- en: '>'
  id: totrans-1023
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-1024
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: ul
  id: totrans-1025
  prefs: []
  type: TYPE_NORMAL
  zh: ul
- en: '>'
  id: totrans-1026
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1027
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: partial
  id: totrans-1028
  prefs: []
  type: TYPE_NORMAL
  zh: partial
- en: name
  id: totrans-1029
  prefs: []
  type: TYPE_NORMAL
  zh: name
- en: '='
  id: totrans-1030
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"_LoginPartial"'
  id: totrans-1031
  prefs: []
  type: TYPE_NORMAL
  zh: '"_LoginPartial"'
- en: />
  id: totrans-1032
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: </
  id: totrans-1033
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: div
  id: totrans-1034
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-1035
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '```'
  id: totrans-1036
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: The `<a>` elements use tag helper attributes named `asp-controller` and `asp-action`
    to specify the controller name and action name that will execute when the link
    is clicked on. If you want to navigate to a feature in a Razor Class Library,
    like the `employees` component that you created in the previous chapter, then
    you use `asp-area` to specify the feature name.
  id: totrans-1037
  prefs: []
  type: TYPE_NORMAL
  zh: '`<a>`元素使用名为`asp-controller`和`asp-action`的标记助手属性来指定单击链接时将执行的控制器名称和操作名称。如果要导航到Razor类库中的功能，例如在上一章中创建的`employees`组件，则使用`asp-area`来指定功能名称。'
- en: 'Note the rendering of the body inside the `<main>` element, as shown in the
    following markup:'
  id: totrans-1038
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注意在`<main>`元素内部呈现主体，如下面的标记所示：
- en: '```cs'
  id: totrans-1039
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: <
  id: totrans-1040
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: div
  id: totrans-1041
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: class
  id: totrans-1042
  prefs: []
  type: TYPE_NORMAL
  zh: 类
- en: '='
  id: totrans-1043
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"container"'
  id: totrans-1044
  prefs: []
  type: TYPE_NORMAL
  zh: '"容器"'
- en: '>'
  id: totrans-1045
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1046
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: main
  id: totrans-1047
  prefs: []
  type: TYPE_NORMAL
  zh: 主要
- en: role
  id: totrans-1048
  prefs: []
  type: TYPE_NORMAL
  zh: 角色
- en: '='
  id: totrans-1049
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"main"'
  id: totrans-1050
  prefs: []
  type: TYPE_NORMAL
  zh: '"主要"'
- en: class
  id: totrans-1051
  prefs: []
  type: TYPE_NORMAL
  zh: 类
- en: '='
  id: totrans-1052
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"pb-3"'
  id: totrans-1053
  prefs: []
  type: TYPE_NORMAL
  zh: '"pb-3"'
- en: '>'
  id: totrans-1054
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@RenderBody()'
  id: totrans-1055
  prefs: []
  type: TYPE_NORMAL
  zh: '@RenderBody()'
- en: </
  id: totrans-1056
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: main
  id: totrans-1057
  prefs: []
  type: TYPE_NORMAL
  zh: 主要
- en: '>'
  id: totrans-1058
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-1059
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: div
  id: totrans-1060
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-1061
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '```'
  id: totrans-1062
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: The `RenderBody` method injects the contents of a specific Razor view for a
    page like the `Index.cshtml` file at that point in the shared layout.
  id: totrans-1063
  prefs: []
  type: TYPE_NORMAL
  zh: '`RenderBody`方法在共享布局的特定Razor视图中注入内容，例如`Index.cshtml`文件。'
- en: 'Note the rendering of `<script>` elements at the bottom of the page so that
    it does not slow down the display of the page and that you can add your own script
    blocks into an optional defined section named `scripts` , as shown in the following
    markup:'
  id: totrans-1064
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注意在页面底部呈现`<script>`元素，以便不会减慢页面的显示，并且您可以将自己的脚本块添加到一个名为`scripts`的可选定义部分中，如下面的标记所示：
- en: '```cs'
  id: totrans-1065
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: <
  id: totrans-1066
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: script
  id: totrans-1067
  prefs: []
  type: TYPE_NORMAL
  zh: 脚本
- en: src
  id: totrans-1068
  prefs: []
  type: TYPE_NORMAL
  zh: src
- en: '='
  id: totrans-1069
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"~/lib/jquery/dist/jquery.min.js"'
  id: totrans-1070
  prefs: []
  type: TYPE_NORMAL
  zh: '"〜/lib/jquery/dist/jquery.min.js"'
- en: '></'
  id: totrans-1071
  prefs: []
  type: TYPE_NORMAL
  zh: '></'
- en: script
  id: totrans-1072
  prefs: []
  type: TYPE_NORMAL
  zh: 脚本
- en: '>'
  id: totrans-1073
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1074
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: script
  id: totrans-1075
  prefs: []
  type: TYPE_NORMAL
  zh: 脚本
- en: src
  id: totrans-1076
  prefs: []
  type: TYPE_NORMAL
  zh: src
- en: '='
  id: totrans-1077
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"'
  id: totrans-1078
  prefs: []
  type: TYPE_NORMAL
  zh: '"〜/lib/bootstrap/dist/js/bootstrap.bundle.min.js"'
- en: '>'
  id: totrans-1079
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-1080
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: script
  id: totrans-1081
  prefs: []
  type: TYPE_NORMAL
  zh: 脚本
- en: '>'
  id: totrans-1082
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1083
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: script
  id: totrans-1084
  prefs: []
  type: TYPE_NORMAL
  zh: 脚本
- en: src
  id: totrans-1085
  prefs: []
  type: TYPE_NORMAL
  zh: src
- en: '='
  id: totrans-1086
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"~/js/site.js"'
  id: totrans-1087
  prefs: []
  type: TYPE_NORMAL
  zh: '"〜/js/site.js"'
- en: asp-append-version
  id: totrans-1088
  prefs: []
  type: TYPE_NORMAL
  zh: asp-append-version
- en: '='
  id: totrans-1089
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"true"'
  id: totrans-1090
  prefs: []
  type: TYPE_NORMAL
  zh: '"真"'
- en: '></'
  id: totrans-1091
  prefs: []
  type: TYPE_NORMAL
  zh: '></'
- en: script
  id: totrans-1092
  prefs: []
  type: TYPE_NORMAL
  zh: 脚本
- en: '>'
  id: totrans-1093
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@await RenderSectionAsync("scripts", required: false)'
  id: totrans-1094
  prefs: []
  type: TYPE_NORMAL
  zh: '@await RenderSectionAsync("scripts", required: false)'
- en: '```'
  id: totrans-1095
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: When `asp-append-version` is specified with a `true` value in any element like
    `<img>` or `<script>` along with a `src` attribute, the Image Tag Helper is invoked
    (this helper is poorly named because it does not only affect images!).
  id: totrans-1096
  prefs: []
  type: TYPE_NORMAL
  zh: 当`asp-append-version`与`true`值一起在任何元素中指定，如`<img>`或`<script>`以及`src`属性时，将调用Image
    Tag Helper（此助手命名不当，因为它不仅影响图像！）。
- en: 'It works by automatically appending a query string value named `v` that is
    generated from a hash of the referenced source file, as shown in the following
    example generated output:'
  id: totrans-1097
  prefs: []
  type: TYPE_NORMAL
  zh: 它通过自动附加一个名为`v`的查询字符串值来工作，该值是从引用源文件的哈希生成的，如下面的示例生成的输出所示：
- en: '```cs'
  id: totrans-1098
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: <script src="img/site.js? v=Kl_dqr9NVtnMdsM2MUg4qthUnWZm5T1fCEimBPWDNgM"></script>
  id: totrans-1099
  prefs: []
  type: TYPE_NORMAL
  zh: <script src="img/site.js? v=Kl_dqr9NVtnMdsM2MUg4qthUnWZm5T1fCEimBPWDNgM"></script>
- en: '```'
  id: totrans-1100
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: If even a single byte within the `site.js` file changes, then its hash value
    will be different, and therefore if a browser or CDN is caching the script file,
    then it will bust the cached copy and replace it with the new version.
  id: totrans-1101
  prefs: []
  type: TYPE_NORMAL
  zh: 如果`site.js`文件中的任何一个字节发生变化，那么它的哈希值将不同，因此如果浏览器或CDN缓存了脚本文件，它将破坏缓存副本并用新版本替换它。
- en: Customizing an ASP.NET Core MVC website
  id: totrans-1102
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 自定义ASP.NET Core MVC网站
- en: Now that you've reviewed the structure of a basic MVC website, you will customize
    and extend it. You have already registered an EF Core model for the `Northwind`
    database, so the next task is to output some of that data on the home page.
  id: totrans-1103
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经审查了基本MVC网站的结构，您将对其进行自定义和扩展。您已经为`Northwind`数据库注册了一个EF Core模型，因此下一个任务是在主页上输出一些数据。
- en: Defining a custom style
  id: totrans-1104
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 定义自定义样式
- en: 'The home page will show a list of the 77 products in the Northwind database.
    To make efficient use of space, we want to show the list in three columns. To
    do this, we need to customize the stylesheet for the website:'
  id: totrans-1105
  prefs: []
  type: TYPE_NORMAL
  zh: 主页将显示北风数据库中的77个产品列表。为了有效利用空间，我们希望以三列显示列表。为此，我们需要自定义网站的样式表：
- en: In the `wwwroot\css` folder, open the `site.css` file.
  id: totrans-1106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`wwwroot\css`文件夹中，打开`site.css`文件。
- en: 'At the bottom of the file, add a new style that will apply to an element with
    the `product-columns` ID, as shown in the following code:'
  id: totrans-1107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在文件底部，添加一个新的样式，将应用于具有`product-columns` ID的元素，如下面的代码所示：
- en: '```cs'
  id: totrans-1108
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '#product-columns'
  id: totrans-1109
  prefs: []
  type: TYPE_NORMAL
  zh: '#product-columns'
- en: '{'
  id: totrans-1110
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: column-count
  id: totrans-1111
  prefs: []
  type: TYPE_NORMAL
  zh: 列数
- en: ': 3'
  id: totrans-1112
  prefs: []
  type: TYPE_NORMAL
  zh: ：3
- en: ;
  id: totrans-1113
  prefs: []
  type: TYPE_NORMAL
  zh: ;
- en: '}'
  id: totrans-1114
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '```'
  id: totrans-1115
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Setting up the category images
  id: totrans-1116
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 设置类别图片
- en: 'The Northwind database includes a table of eight categories, but they do not
    have images, and websites look better with some colorful pictures:'
  id: totrans-1117
  prefs: []
  type: TYPE_NORMAL
  zh: 北风数据库包括一个包含八个类别的表，但它们没有图像，网站看起来更好看一些有些丰富多彩的图片：
- en: In the `wwwroot` folder, create a folder named `images` .
  id: totrans-1118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`wwwroot`文件夹中，创建一个名为`images`的文件夹。
- en: In the `images` folder, add eight image files named `category1.jpeg` , `category2.jpeg`
    , and so on, up to `category8.jpeg` .
  id: totrans-1119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`images`文件夹中，添加八个图像文件，命名为`category1.jpeg`，`category2.jpeg`等，直到`category8.jpeg`。
- en: 'You can download images from the GitHub repository for this book at the following
    link: [https://github.com/markjprice/cs10dotnet6/tree/master/Assets/Categories](https://github.com/markjprice/cs10dotnet6/tree/master/Assets/Categories)'
  id: totrans-1120
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以从本书的GitHub存储库中下载图像，链接如下：[https://github.com/markjprice/cs10dotnet6/tree/master/Assets/Categories](https://github.com/markjprice/cs10dotnet6/tree/master/Assets/Categories)
- en: Understanding Razor syntax
  id: totrans-1121
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解Razor语法
- en: 'Before we customize the home page view, let''s review an example Razor file
    that has an initial Razor code block that instantiates an order with price and
    quantity and then outputs information about the order on the web page, as shown
    in the following markup:'
  id: totrans-1122
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们自定义主页视图之前，让我们回顾一个初始的Razor文件示例，该文件具有一个初始的Razor代码块，用于实例化具有价格和数量的订单，然后在网页上输出有关订单的信息，如下面的标记所示：
- en: '```cs'
  id: totrans-1123
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '@{'
  id: totrans-1124
  prefs: []
  type: TYPE_NORMAL
  zh: '@{'
- en: Order order = new
  id: totrans-1125
  prefs: []
  type: TYPE_NORMAL
  zh: 订单订单=新的
- en: ()
  id: totrans-1126
  prefs: []
  type: TYPE_NORMAL
  zh: （）
- en: '{'
  id: totrans-1127
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: OrderId = 123
  id: totrans-1128
  prefs: []
  type: TYPE_NORMAL
  zh: 订单ID = 123
- en: ','
  id: totrans-1129
  prefs: []
  type: TYPE_NORMAL
  zh: ，
- en: Product = "Sushi"
  id: totrans-1130
  prefs: []
  type: TYPE_NORMAL
  zh: 产品=“寿司”
- en: ','
  id: totrans-1131
  prefs: []
  type: TYPE_NORMAL
  zh: ，
- en: Price = 8.49
  id: totrans-1132
  prefs: []
  type: TYPE_NORMAL
  zh: 价格= 8.49
- en: M,
  id: totrans-1133
  prefs: []
  type: TYPE_NORMAL
  zh: M，
- en: Quantity = 3
  id: totrans-1134
  prefs: []
  type: TYPE_NORMAL
  zh: 数量= 3
- en: '};'
  id: totrans-1135
  prefs: []
  type: TYPE_NORMAL
  zh: '};'
- en: '}'
  id: totrans-1136
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: <div
  id: totrans-1137
  prefs: []
  type: TYPE_NORMAL
  zh: <div
- en: '>Your order for @order.Quantity of @order.Product has a total cost of $@ order.Price
    * @order.Quantity</div'
  id: totrans-1138
  prefs: []
  type: TYPE_NORMAL
  zh: 您的@order.Quantity @order.Product的订单总成本为$@ order.Price * @order.Quantity</div
- en: '>'
  id: totrans-1139
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '```'
  id: totrans-1140
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'The preceding Razor file would result in the following incorrect output:'
  id: totrans-1141
  prefs: []
  type: TYPE_NORMAL
  zh: 上述的Razor文件将导致以下不正确的输出：
- en: '```cs'
  id: totrans-1142
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: Your order for 3 of Sushi has a total cost of $8.49 * 3
  id: totrans-1143
  prefs: []
  type: TYPE_NORMAL
  zh: 您的寿司3份订单总成本为$8.49 * 3
- en: '```'
  id: totrans-1144
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'Although Razor markup can include the value of any single property using the
    `@object.property` syntax, you should wrap expressions in parentheses, as shown
    in the following markup:'
  id: totrans-1145
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管Razor标记可以使用`@object.property`语法包括任何单个属性的值，但你应该用括号括起表达式，如下面的标记所示：
- en: '```cs'
  id: totrans-1146
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: <
  id: totrans-1147
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: div
  id: totrans-1148
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-1149
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Your order for @order.Quantity of @order.Product has a total cost of $@ (order.Price
    * order.Quantity)</
  id: totrans-1150
  prefs: []
  type: TYPE_NORMAL
  zh: 您的@order.Quantity @order.Product的订单总成本为$@（order.Price * order.Quantity）</
- en: div
  id: totrans-1151
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-1152
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '```'
  id: totrans-1153
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'The preceding Razor expression results in the following correct output:'
  id: totrans-1154
  prefs: []
  type: TYPE_NORMAL
  zh: 上述的Razor表达式将导致以下正确的输出：
- en: '```cs'
  id: totrans-1155
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: Your order for 3 of Sushi has a total cost of $25.47
  id: totrans-1156
  prefs: []
  type: TYPE_NORMAL
  zh: 您3份寿司的订单总成本为$25.47
- en: '```'
  id: totrans-1157
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Defining a typed view
  id: totrans-1158
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 定义一个类型化视图
- en: 'To improve the IntelliSense when writing a view, you can define what type the
    view can expect using an `@model` directive at the top:'
  id: totrans-1159
  prefs: []
  type: TYPE_NORMAL
  zh: 为了在编写视图时改进智能感知，您可以在顶部使用`@model`指令定义视图可以期望的类型：
- en: In the `Views\Home` folder, open `Index.cshtml` .
  id: totrans-1160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Views\Home`文件夹中，打开`Index.cshtml`。
- en: 'At the top of the file, add a statement to set the model type to use the `HomeIndexViewModel`
    , as shown in the following code:'
  id: totrans-1161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在文件顶部，添加一个语句来设置模型类型，以使用`HomeIndexViewModel`，如下面的代码所示：
- en: '```cs'
  id: totrans-1162
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '@model HomeIndexViewModel'
  id: totrans-1163
  prefs: []
  type: TYPE_NORMAL
  zh: '@model HomeIndexViewModel'
- en: '```'
  id: totrans-1164
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Now, whenever we type `Model` in this view, your code editor will know the correct
    type for the model and will provide IntelliSense for it.
  id: totrans-1165
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，每当我们在这个视图中输入`Model`时，您的代码编辑器将知道模型的正确类型，并为其提供智能感知。
- en: 'While entering code in a view, remember the following:'
  id: totrans-1166
  prefs: []
  type: TYPE_NORMAL
  zh: 在视图中输入代码时，请记住以下内容：
- en: Declare the type for the model, use `@model` (with a lowercase m).
  id: totrans-1167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 声明模型的类型，请使用`@model`（小写m）。
- en: Interact with the instance of the model, use `@Model` (with an uppercase M).
  id: totrans-1168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与模型的实例交互，使用`@Model`（大写M）。
- en: Let's continue customizing the view for the home page.
  id: totrans-1169
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们继续定制主页的视图。
- en: 'In the initial Razor code block, add a statement to declare a `string` variable
    for the current item and under the existing `<div>` element add new markup to
    output categories in a carousel and products as an unordered list, as shown in
    the following markup:'
  id: totrans-1170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在初始的Razor代码块中，添加一个语句来声明当前项目的`string`变量，并在现有的`<div>`元素下添加新的标记，以输出轮播中的类别和产品作为无序列表，如下面的标记所示：
- en: '```cs'
  id: totrans-1171
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '@using Packt.Shared'
  id: totrans-1172
  prefs: []
  type: TYPE_NORMAL
  zh: '@using Packt.Shared'
- en: '@model HomeIndexViewModel'
  id: totrans-1173
  prefs: []
  type: TYPE_NORMAL
  zh: '@model HomeIndexViewModel'
- en: '@{'
  id: totrans-1174
  prefs: []
  type: TYPE_NORMAL
  zh: '@{'
- en: ViewData["Title"
  id: totrans-1175
  prefs: []
  type: TYPE_NORMAL
  zh: ViewData["Title"
- en: '] = "Home Page"'
  id: totrans-1176
  prefs: []
  type: TYPE_NORMAL
  zh: '] = "主页"'
- en: ;
  id: totrans-1177
  prefs: []
  type: TYPE_NORMAL
  zh: ;
- en: string
  id: totrans-1178
  prefs: []
  type: TYPE_NORMAL
  zh: string
- en: currentItem = ""
  id: totrans-1179
  prefs: []
  type: TYPE_NORMAL
  zh: currentItem = ""
- en: ;
  id: totrans-1180
  prefs: []
  type: TYPE_NORMAL
  zh: ;
- en: '}'
  id: totrans-1181
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: <
  id: totrans-1182
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: div
  id: totrans-1183
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: class
  id: totrans-1184
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1185
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"text-center"'
  id: totrans-1186
  prefs: []
  type: TYPE_NORMAL
  zh: '"text-center"'
- en: '>'
  id: totrans-1187
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1188
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: h1
  id: totrans-1189
  prefs: []
  type: TYPE_NORMAL
  zh: h1
- en: class
  id: totrans-1190
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1191
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"display-4"'
  id: totrans-1192
  prefs: []
  type: TYPE_NORMAL
  zh: '"display-4"'
- en: '>'
  id: totrans-1193
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Welcome</
  id: totrans-1194
  prefs: []
  type: TYPE_NORMAL
  zh: 欢迎</
- en: h1
  id: totrans-1195
  prefs: []
  type: TYPE_NORMAL
  zh: h1
- en: '>'
  id: totrans-1196
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1197
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: p
  id: totrans-1198
  prefs: []
  type: TYPE_NORMAL
  zh: p
- en: '>'
  id: totrans-1199
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Learn about <
  id: totrans-1200
  prefs: []
  type: TYPE_NORMAL
  zh: 了解 <
- en: a
  id: totrans-1201
  prefs: []
  type: TYPE_NORMAL
  zh: a
- en: href
  id: totrans-1202
  prefs: []
  type: TYPE_NORMAL
  zh: href
- en: '='
  id: totrans-1203
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"https://docs.microsoft.com/aspnet/core"'
  id: totrans-1204
  prefs: []
  type: TYPE_NORMAL
  zh: '"https://docs.microsoft.com/aspnet/core"'
- en: '>'
  id: totrans-1205
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: building Web apps with ASP.NET Core</
  id: totrans-1206
  prefs: []
  type: TYPE_NORMAL
  zh: 使用ASP.NET Core构建Web应用程序</
- en: a
  id: totrans-1207
  prefs: []
  type: TYPE_NORMAL
  zh: a
- en: '>'
  id: totrans-1208
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: .</
  id: totrans-1209
  prefs: []
  type: TYPE_NORMAL
  zh: 。</
- en: p
  id: totrans-1210
  prefs: []
  type: TYPE_NORMAL
  zh: p
- en: '>'
  id: totrans-1211
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1212
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: p
  id: totrans-1213
  prefs: []
  type: TYPE_NORMAL
  zh: p
- en: class
  id: totrans-1214
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1215
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"alert alert-primary"'
  id: totrans-1216
  prefs: []
  type: TYPE_NORMAL
  zh: '"alert alert-primary"'
- en: '>'
  id: totrans-1217
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@DateTime.Now.ToLongTimeString()</'
  id: totrans-1218
  prefs: []
  type: TYPE_NORMAL
  zh: '@DateTime.Now.ToLongTimeString()</'
- en: p
  id: totrans-1219
  prefs: []
  type: TYPE_NORMAL
  zh: p
- en: '>'
  id: totrans-1220
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-1221
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: div
  id: totrans-1222
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-1223
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@if (Model is not null)'
  id: totrans-1224
  prefs: []
  type: TYPE_NORMAL
  zh: '@if (Model is not null)'
- en: '{'
  id: totrans-1225
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: <
  id: totrans-1226
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: div
  id: totrans-1227
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: id
  id: totrans-1228
  prefs: []
  type: TYPE_NORMAL
  zh: id
- en: '='
  id: totrans-1229
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"categories"'
  id: totrans-1230
  prefs: []
  type: TYPE_NORMAL
  zh: '"categories"'
- en: class
  id: totrans-1231
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1232
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"carousel slide"'
  id: totrans-1233
  prefs: []
  type: TYPE_NORMAL
  zh: '"carousel slide"'
- en: data-ride
  id: totrans-1234
  prefs: []
  type: TYPE_NORMAL
  zh: data-ride
- en: '='
  id: totrans-1235
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"carousel"'
  id: totrans-1236
  prefs: []
  type: TYPE_NORMAL
  zh: '"carousel"'
- en: data-interval
  id: totrans-1237
  prefs: []
  type: TYPE_NORMAL
  zh: data-interval
- en: '='
  id: totrans-1238
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"3000"'
  id: totrans-1239
  prefs: []
  type: TYPE_NORMAL
  zh: '"3000"'
- en: data-keyboard
  id: totrans-1240
  prefs: []
  type: TYPE_NORMAL
  zh: data-keyboard
- en: '='
  id: totrans-1241
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"true"'
  id: totrans-1242
  prefs: []
  type: TYPE_NORMAL
  zh: '"true"'
- en: '>'
  id: totrans-1243
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1244
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: ol
  id: totrans-1245
  prefs: []
  type: TYPE_NORMAL
  zh: ol
- en: class
  id: totrans-1246
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1247
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"carousel-indicators"'
  id: totrans-1248
  prefs: []
  type: TYPE_NORMAL
  zh: '"carousel-indicators"'
- en: '>'
  id: totrans-1249
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@for (int'
  id: totrans-1250
  prefs: []
  type: TYPE_NORMAL
  zh: '@for (int'
- en: c = 0
  id: totrans-1251
  prefs: []
  type: TYPE_NORMAL
  zh: c = 0
- en: ; c < Model.Categories.Count; c++)
  id: totrans-1252
  prefs: []
  type: TYPE_NORMAL
  zh: ; c < Model.Categories.Count; c++)
- en: '{'
  id: totrans-1253
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: if
  id: totrans-1254
  prefs: []
  type: TYPE_NORMAL
  zh: if
- en: (c == 0
  id: totrans-1255
  prefs: []
  type: TYPE_NORMAL
  zh: (c == 0
- en: )
  id: totrans-1256
  prefs: []
  type: TYPE_NORMAL
  zh: )
- en: '{'
  id: totrans-1257
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: currentItem = "active";
  id: totrans-1258
  prefs: []
  type: TYPE_NORMAL
  zh: currentItem = "active";
- en: '}'
  id: totrans-1259
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: else
  id: totrans-1260
  prefs: []
  type: TYPE_NORMAL
  zh: else
- en: '{'
  id: totrans-1261
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: currentItem = "";
  id: totrans-1262
  prefs: []
  type: TYPE_NORMAL
  zh: currentItem = "";
- en: '}'
  id: totrans-1263
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: <
  id: totrans-1264
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: li
  id: totrans-1265
  prefs: []
  type: TYPE_NORMAL
  zh: li
- en: data-target
  id: totrans-1266
  prefs: []
  type: TYPE_NORMAL
  zh: data-target
- en: '='
  id: totrans-1267
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"#categories"'
  id: totrans-1268
  prefs: []
  type: TYPE_NORMAL
  zh: '"#categories"'
- en: data-slide-to
  id: totrans-1269
  prefs: []
  type: TYPE_NORMAL
  zh: data-slide-to
- en: '='
  id: totrans-1270
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"@c"'
  id: totrans-1271
  prefs: []
  type: TYPE_NORMAL
  zh: '"@c"'
- en: class
  id: totrans-1272
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1273
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"@currentItem"'
  id: totrans-1274
  prefs: []
  type: TYPE_NORMAL
  zh: '"@currentItem"'
- en: '></'
  id: totrans-1275
  prefs: []
  type: TYPE_NORMAL
  zh: '></'
- en: li
  id: totrans-1276
  prefs: []
  type: TYPE_NORMAL
  zh: li
- en: '>'
  id: totrans-1277
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '}'
  id: totrans-1278
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: </
  id: totrans-1279
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: ol
  id: totrans-1280
  prefs: []
  type: TYPE_NORMAL
  zh: ol
- en: '>'
  id: totrans-1281
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1282
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: div
  id: totrans-1283
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: class
  id: totrans-1284
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1285
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"carousel-inner"'
  id: totrans-1286
  prefs: []
  type: TYPE_NORMAL
  zh: '"carousel-inner"'
- en: '>'
  id: totrans-1287
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@for (int c = 0'
  id: totrans-1288
  prefs: []
  type: TYPE_NORMAL
  zh: '@for (int c = 0'
- en: ; c < Model.Categories.Count; c++)
  id: totrans-1289
  prefs: []
  type: TYPE_NORMAL
  zh: ; c < Model.Categories.Count; c++)
- en: '{'
  id: totrans-1290
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: if
  id: totrans-1291
  prefs: []
  type: TYPE_NORMAL
  zh: if
- en: (c == 0
  id: totrans-1292
  prefs: []
  type: TYPE_NORMAL
  zh: (c == 0
- en: )
  id: totrans-1293
  prefs: []
  type: TYPE_NORMAL
  zh: )
- en: '{'
  id: totrans-1294
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: currentItem = "active";
  id: totrans-1295
  prefs: []
  type: TYPE_NORMAL
  zh: currentItem = "active";
- en: '}'
  id: totrans-1296
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: else
  id: totrans-1297
  prefs: []
  type: TYPE_NORMAL
  zh: else
- en: '{'
  id: totrans-1298
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: currentItem = "";
  id: totrans-1299
  prefs: []
  type: TYPE_NORMAL
  zh: currentItem = "";
- en: '}'
  id: totrans-1300
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: <
  id: totrans-1301
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: div
  id: totrans-1302
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: class
  id: totrans-1303
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1304
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"carousel-item @currentItem"'
  id: totrans-1305
  prefs: []
  type: TYPE_NORMAL
  zh: '"carousel-item @currentItem"'
- en: '>'
  id: totrans-1306
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1307
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: img
  id: totrans-1308
  prefs: []
  type: TYPE_NORMAL
  zh: img
- en: class
  id: totrans-1309
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1310
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"d-block w-100"'
  id: totrans-1311
  prefs: []
  type: TYPE_NORMAL
  zh: '"d-block w-100"'
- en: src
  id: totrans-1312
  prefs: []
  type: TYPE_NORMAL
  zh: src
- en: '='
  id: totrans-1313
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"~/images/category@(Model.Categories[c].CategoryId).jpeg"'
  id: totrans-1314
  prefs: []
  type: TYPE_NORMAL
  zh: '"~/images/category@(Model.Categories[c].CategoryId).jpeg"'
- en: alt
  id: totrans-1315
  prefs: []
  type: TYPE_NORMAL
  zh: alt
- en: '='
  id: totrans-1316
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"@Model.Categories[c].CategoryName"'
  id: totrans-1317
  prefs: []
  type: TYPE_NORMAL
  zh: '"@Model.Categories[c].CategoryName"'
- en: />
  id: totrans-1318
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: <
  id: totrans-1319
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: div
  id: totrans-1320
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: class
  id: totrans-1321
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1322
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"carousel-caption d-none d-md-block"'
  id: totrans-1323
  prefs: []
  type: TYPE_NORMAL
  zh: '"carousel-caption d-none d-md-block"'
- en: '>'
  id: totrans-1324
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1325
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: h2
  id: totrans-1326
  prefs: []
  type: TYPE_NORMAL
  zh: h2
- en: '>'
  id: totrans-1327
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@Model.Categories[c].CategoryName</'
  id: totrans-1328
  prefs: []
  type: TYPE_NORMAL
  zh: '@Model.Categories[c].CategoryName</'
- en: h2
  id: totrans-1329
  prefs: []
  type: TYPE_NORMAL
  zh: h2
- en: '>'
  id: totrans-1330
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1331
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: h3
  id: totrans-1332
  prefs: []
  type: TYPE_NORMAL
  zh: h3
- en: '>'
  id: totrans-1333
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@Model.Categories[c].Description</'
  id: totrans-1334
  prefs: []
  type: TYPE_NORMAL
  zh: '@Model.Categories[c].Description</'
- en: h3
  id: totrans-1335
  prefs: []
  type: TYPE_NORMAL
  zh: h3
- en: '>'
  id: totrans-1336
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1337
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: p
  id: totrans-1338
  prefs: []
  type: TYPE_NORMAL
  zh: p
- en: '>'
  id: totrans-1339
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1340
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: a
  id: totrans-1341
  prefs: []
  type: TYPE_NORMAL
  zh: a
- en: class
  id: totrans-1342
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1343
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"btn btn-primary"'
  id: totrans-1344
  prefs: []
  type: TYPE_NORMAL
  zh: '"btn btn-primary"'
- en: href
  id: totrans-1345
  prefs: []
  type: TYPE_NORMAL
  zh: href
- en: '='
  id: totrans-1346
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"/category/@Model.Categories[c].CategoryId"'
  id: totrans-1347
  prefs: []
  type: TYPE_NORMAL
  zh: '"/category/@Model.Categories[c].CategoryId"'
- en: '>'
  id: totrans-1348
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: View</
  id: totrans-1349
  prefs: []
  type: TYPE_NORMAL
  zh: View</
- en: a
  id: totrans-1350
  prefs: []
  type: TYPE_NORMAL
  zh: a
- en: '>'
  id: totrans-1351
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-1352
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: p
  id: totrans-1353
  prefs: []
  type: TYPE_NORMAL
  zh: p
- en: '>'
  id: totrans-1354
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-1355
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: div
  id: totrans-1356
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-1357
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-1358
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: div
  id: totrans-1359
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-1360
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '}'
  id: totrans-1361
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: </
  id: totrans-1362
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: div
  id: totrans-1363
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-1364
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1365
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: a
  id: totrans-1366
  prefs: []
  type: TYPE_NORMAL
  zh: a
- en: class
  id: totrans-1367
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1368
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"carousel-control-prev"'
  id: totrans-1369
  prefs: []
  type: TYPE_NORMAL
  zh: '"carousel-control-prev"'
- en: href
  id: totrans-1370
  prefs: []
  type: TYPE_NORMAL
  zh: href
- en: '='
  id: totrans-1371
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"#categories"'
  id: totrans-1372
  prefs: []
  type: TYPE_NORMAL
  zh: '"#categories"'
- en: role
  id: totrans-1373
  prefs: []
  type: TYPE_NORMAL
  zh: role
- en: '='
  id: totrans-1374
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"button"'
  id: totrans-1375
  prefs: []
  type: TYPE_NORMAL
  zh: '"button"'
- en: data-slide
  id: totrans-1376
  prefs: []
  type: TYPE_NORMAL
  zh: data-slide
- en: '='
  id: totrans-1377
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"prev"'
  id: totrans-1378
  prefs: []
  type: TYPE_NORMAL
  zh: '"prev"'
- en: '>'
  id: totrans-1379
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1380
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: span
  id: totrans-1381
  prefs: []
  type: TYPE_NORMAL
  zh: span
- en: class
  id: totrans-1382
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1383
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"carousel-control-prev-icon"'
  id: totrans-1384
  prefs: []
  type: TYPE_NORMAL
  zh: '"carousel-control-prev-icon"'
- en: aria-hidden
  id: totrans-1385
  prefs: []
  type: TYPE_NORMAL
  zh: aria-hidden
- en: '='
  id: totrans-1386
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"true"'
  id: totrans-1387
  prefs: []
  type: TYPE_NORMAL
  zh: '"true"'
- en: '></'
  id: totrans-1388
  prefs: []
  type: TYPE_NORMAL
  zh: '></'
- en: span
  id: totrans-1389
  prefs: []
  type: TYPE_NORMAL
  zh: span
- en: '>'
  id: totrans-1390
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1391
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: span
  id: totrans-1392
  prefs: []
  type: TYPE_NORMAL
  zh: span
- en: class
  id: totrans-1393
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1394
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"sr-only"'
  id: totrans-1395
  prefs: []
  type: TYPE_NORMAL
  zh: '"sr-only"'
- en: '>'
  id: totrans-1396
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Previous</
  id: totrans-1397
  prefs: []
  type: TYPE_NORMAL
  zh: Previous</
- en: span
  id: totrans-1398
  prefs: []
  type: TYPE_NORMAL
  zh: span
- en: '>'
  id: totrans-1399
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-1400
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: a
  id: totrans-1401
  prefs: []
  type: TYPE_NORMAL
  zh: a
- en: '>'
  id: totrans-1402
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1403
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: a
  id: totrans-1404
  prefs: []
  type: TYPE_NORMAL
  zh: a
- en: class
  id: totrans-1405
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1406
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"carousel-control-next"'
  id: totrans-1407
  prefs: []
  type: TYPE_NORMAL
  zh: '"carousel-control-next"'
- en: href
  id: totrans-1408
  prefs: []
  type: TYPE_NORMAL
  zh: href
- en: '='
  id: totrans-1409
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"#categories"'
  id: totrans-1410
  prefs: []
  type: TYPE_NORMAL
  zh: '"#categories"'
- en: role
  id: totrans-1411
  prefs: []
  type: TYPE_NORMAL
  zh: role
- en: '='
  id: totrans-1412
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"button"'
  id: totrans-1413
  prefs: []
  type: TYPE_NORMAL
  zh: '"button"'
- en: data-slide
  id: totrans-1414
  prefs: []
  type: TYPE_NORMAL
  zh: data-slide
- en: '='
  id: totrans-1415
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"next"'
  id: totrans-1416
  prefs: []
  type: TYPE_NORMAL
  zh: '"next"'
- en: '>'
  id: totrans-1417
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1418
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: span
  id: totrans-1419
  prefs: []
  type: TYPE_NORMAL
  zh: span
- en: class
  id: totrans-1420
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1421
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"carousel-control-next-icon"'
  id: totrans-1422
  prefs: []
  type: TYPE_NORMAL
  zh: '"carousel-control-next-icon"'
- en: aria-hidden
  id: totrans-1423
  prefs: []
  type: TYPE_NORMAL
  zh: aria-hidden
- en: '='
  id: totrans-1424
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"true"'
  id: totrans-1425
  prefs: []
  type: TYPE_NORMAL
  zh: '"true"'
- en: '></'
  id: totrans-1426
  prefs: []
  type: TYPE_NORMAL
  zh: '></'
- en: span
  id: totrans-1427
  prefs: []
  type: TYPE_NORMAL
  zh: span
- en: '>'
  id: totrans-1428
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1429
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: span
  id: totrans-1430
  prefs: []
  type: TYPE_NORMAL
  zh: span
- en: class
  id: totrans-1431
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1432
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"sr-only"'
  id: totrans-1433
  prefs: []
  type: TYPE_NORMAL
  zh: '"sr-only"'
- en: '>'
  id: totrans-1434
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Next</
  id: totrans-1435
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个</
- en: span
  id: totrans-1436
  prefs: []
  type: TYPE_NORMAL
  zh: span
- en: '>'
  id: totrans-1437
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-1438
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: a
  id: totrans-1439
  prefs: []
  type: TYPE_NORMAL
  zh: a
- en: '>'
  id: totrans-1440
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-1441
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: div
  id: totrans-1442
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-1443
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '}'
  id: totrans-1444
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: <
  id: totrans-1445
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: div
  id: totrans-1446
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: class
  id: totrans-1447
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1448
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"row"'
  id: totrans-1449
  prefs: []
  type: TYPE_NORMAL
  zh: '"row"'
- en: '>'
  id: totrans-1450
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1451
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: div
  id: totrans-1452
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: class
  id: totrans-1453
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1454
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"col-md-12"'
  id: totrans-1455
  prefs: []
  type: TYPE_NORMAL
  zh: '"col-md-12"'
- en: '>'
  id: totrans-1456
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1457
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: h1
  id: totrans-1458
  prefs: []
  type: TYPE_NORMAL
  zh: h1
- en: '>'
  id: totrans-1459
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Northwind</
  id: totrans-1460
  prefs: []
  type: TYPE_NORMAL
  zh: Northwind</
- en: h1
  id: totrans-1461
  prefs: []
  type: TYPE_NORMAL
  zh: h1
- en: '>'
  id: totrans-1462
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1463
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: p
  id: totrans-1464
  prefs: []
  type: TYPE_NORMAL
  zh: p
- en: class
  id: totrans-1465
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: '='
  id: totrans-1466
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"lead"'
  id: totrans-1467
  prefs: []
  type: TYPE_NORMAL
  zh: '"lead"'
- en: '>'
  id: totrans-1468
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: We have had @Model?.VisitorCount visitors this month.
  id: totrans-1469
  prefs: []
  type: TYPE_NORMAL
  zh: 本月我们有@Model?.VisitorCount位访客。
- en: </
  id: totrans-1470
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: p
  id: totrans-1471
  prefs: []
  type: TYPE_NORMAL
  zh: p
- en: '>'
  id: totrans-1472
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@if (Model is not null)'
  id: totrans-1473
  prefs: []
  type: TYPE_NORMAL
  zh: '@if (Model is not null)'
- en: '{'
  id: totrans-1474
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: <
  id: totrans-1475
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: h2
  id: totrans-1476
  prefs: []
  type: TYPE_NORMAL
  zh: h2
- en: '>'
  id: totrans-1477
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Products</
  id: totrans-1478
  prefs: []
  type: TYPE_NORMAL
  zh: Products</
- en: h2
  id: totrans-1479
  prefs: []
  type: TYPE_NORMAL
  zh: h2
- en: '>'
  id: totrans-1480
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1481
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: div
  id: totrans-1482
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: id
  id: totrans-1483
  prefs: []
  type: TYPE_NORMAL
  zh: id
- en: '='
  id: totrans-1484
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"product-columns"'
  id: totrans-1485
  prefs: []
  type: TYPE_NORMAL
  zh: '"product-columns"'
- en: '>'
  id: totrans-1486
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1487
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: ul
  id: totrans-1488
  prefs: []
  type: TYPE_NORMAL
  zh: ul
- en: '>'
  id: totrans-1489
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@foreach (Product p in @Model.Products)'
  id: totrans-1490
  prefs: []
  type: TYPE_NORMAL
  zh: '@foreach (Product p in @Model.Products)'
- en: '{'
  id: totrans-1491
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: <
  id: totrans-1492
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: li
  id: totrans-1493
  prefs: []
  type: TYPE_NORMAL
  zh: li
- en: '>'
  id: totrans-1494
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1495
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: a
  id: totrans-1496
  prefs: []
  type: TYPE_NORMAL
  zh: a
- en: asp-controller
  id: totrans-1497
  prefs: []
  type: TYPE_NORMAL
  zh: asp-controller
- en: '='
  id: totrans-1498
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"Home"'
  id: totrans-1499
  prefs: []
  type: TYPE_NORMAL
  zh: '"Home"'
- en: asp-action
  id: totrans-1500
  prefs: []
  type: TYPE_NORMAL
  zh: asp-action
- en: '='
  id: totrans-1501
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"ProductDetail"'
  id: totrans-1502
  prefs: []
  type: TYPE_NORMAL
  zh: '"ProductDetail"'
- en: asp-route-id
  id: totrans-1503
  prefs: []
  type: TYPE_NORMAL
  zh: asp-route-id
- en: '='
  id: totrans-1504
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"@p.ProductId"'
  id: totrans-1505
  prefs: []
  type: TYPE_NORMAL
  zh: '"@p.ProductId"'
- en: '>'
  id: totrans-1506
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@p.ProductName costs'
  id: totrans-1507
  prefs: []
  type: TYPE_NORMAL
  zh: '@p.ProductName costs'
- en: '@(p.UnitPrice is null ? "zero" : p.UnitPrice.Value.ToString("C"))'
  id: totrans-1508
  prefs: []
  type: TYPE_NORMAL
  zh: '@(p.UnitPrice is null ? "zero" : p.UnitPrice.Value.ToString("C"))'
- en: </
  id: totrans-1509
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: a
  id: totrans-1510
  prefs: []
  type: TYPE_NORMAL
  zh: a
- en: '>'
  id: totrans-1511
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-1512
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: li
  id: totrans-1513
  prefs: []
  type: TYPE_NORMAL
  zh: li
- en: '>'
  id: totrans-1514
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '}'
  id: totrans-1515
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: </
  id: totrans-1516
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: ul
  id: totrans-1517
  prefs: []
  type: TYPE_NORMAL
  zh: ul
- en: '>'
  id: totrans-1518
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-1519
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: div
  id: totrans-1520
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-1521
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '}'
  id: totrans-1522
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: </
  id: totrans-1523
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: div
  id: totrans-1524
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-1525
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-1526
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: div
  id: totrans-1527
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-1528
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '```'
  id: totrans-1529
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'While reviewing the preceding Razor markup, note the following:'
  id: totrans-1530
  prefs: []
  type: TYPE_NORMAL
  zh: 在审查上述的Razor标记时，请注意以下内容：
- en: It is easy to mix static HTML elements such as `<ul>` and `<li>` with C# code
    to output the carousel of categories and the list of product names.
  id: totrans-1531
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 很容易将静态HTML元素（如`<ul>`和`<li>`）与C#代码混合，以输出类别的轮播和产品名称的列表。
- en: The `<div>` element with the `id` attribute of `product-columns` will use the
    custom style that we defined earlier, so all of the content in that element will
    display in three columns.
  id: totrans-1532
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 具有`id`属性为`product-columns`的`<div>`元素将使用我们之前定义的自定义样式，因此该元素中的所有内容将以三列显示。
- en: 'The `<img>` element for each category uses parentheses around a Razor expression
    to ensure that the compiler does not include the `.jpeg` as part of the expression,
    as shown in the following markup: `"~/images/category@(Model.Categories[c].CategoryID).jpeg"`'
  id: totrans-1533
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个类别的`<img>`元素使用Razor表达式周围的括号，以确保编译器不将`.jpeg`包含在表达式中，如下面的标记所示：`"~/images/category@(Model.Categories[c].CategoryID).jpeg"`
- en: 'The `<a>` elements for the product links use tag helpers to generate URL paths.
    Clicks on these hyperlinks will be handled by the `HomeController` and its `ProductDetail`
    action method. This action method does not exist yet, but you will add it later
    in this chapter. The ID of the product is passed as a route segment named `id`
    , as shown in the following URL path for Ipoh Coffee: `https://localhost:5001/Home/ProductDetail/43`
    .'
  id: totrans-1534
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 产品链接的`<a>`元素使用标签助手生成URL路径。点击这些超链接将由`HomeController`及其`ProductDetail`操作方法处理。这个操作方法目前还不存在，但你将在本章后面添加它。产品的ID作为名为`id`的路由段传递，如Ipoh
    Coffee的以下URL路径所示：`https://localhost:5001/Home/ProductDetail/43`。
- en: Reviewing the customized home page
  id: totrans-1535
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 审查定制的主页
- en: 'Let''s see the result of our customized home page:'
  id: totrans-1536
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看我们定制的主页的结果：
- en: Start the `Northwind.Mvc` website project.
  id: totrans-1537
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动`Northwind.Mvc`网站项目。
- en: Note the home page has a rotating carousel showing categories, a random number
    of visitors, and a list of products in three columns, as shown in *Figure 15.4*
    :![](img/Image00123.jpg)
  id: totrans-1538
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请注意主页上有一个旋转的轮播图显示类别，随机数量的访客，以及以三列显示的产品列表，如*图15.4*所示：![](img/Image00123.jpg)
- en: 'Figure 15.4: The updated Northwind MVC website home page'
  id: totrans-1539
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.4：更新后的Northwind MVC网站主页
- en: For now, clicking on any of the categories or product links gives **404 Not
    Found** errors, so let's see how we can implement pages that use the passed parameters
    to see the details of a product or category.
  id: totrans-1540
  prefs: []
  type: TYPE_NORMAL
  zh: 目前，点击任何类别或产品链接都会出现**404 Not Found**错误，所以让我们看看如何实现使用传递的参数来查看产品或类别的详细信息的页面。
- en: Close Chrome and shut down the web server.
  id: totrans-1541
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭Chrome并关闭Web服务器。
- en: Passing parameters using a route value
  id: totrans-1542
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用路由值传递参数
- en: 'One way to pass a simple parameter is to use the `id` segment defined in the
    default route:'
  id: totrans-1543
  prefs: []
  type: TYPE_NORMAL
  zh: 传递简单参数的一种方法是使用默认路由中定义的`id`段：
- en: 'In the `HomeController` class, add an action method named `ProductDetail` ,
    as shown in the following code:'
  id: totrans-1544
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`HomeController`类中，添加一个名为`ProductDetail`的操作方法，如下所示：
- en: '```cs'
  id: totrans-1545
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: public
  id: totrans-1546
  prefs: []
  type: TYPE_NORMAL
  zh: 公共的
- en: IActionResult
  id: totrans-1547
  prefs: []
  type: TYPE_NORMAL
  zh: IActionResult
- en: ProductDetail
  id: totrans-1548
  prefs: []
  type: TYPE_NORMAL
  zh: ProductDetail
- en: (
  id: totrans-1549
  prefs: []
  type: TYPE_NORMAL
  zh: (
- en: int
  id: totrans-1550
  prefs: []
  type: TYPE_NORMAL
  zh: int
- en: '? id'
  id: totrans-1551
  prefs: []
  type: TYPE_NORMAL
  zh: '? id'
- en: )
  id: totrans-1552
  prefs: []
  type: TYPE_NORMAL
  zh: )
- en: '{'
  id: totrans-1553
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: if
  id: totrans-1554
  prefs: []
  type: TYPE_NORMAL
  zh: 如果
- en: (!id.HasValue)
  id: totrans-1555
  prefs: []
  type: TYPE_NORMAL
  zh: (!id.HasValue)
- en: '{'
  id: totrans-1556
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: return
  id: totrans-1557
  prefs: []
  type: TYPE_NORMAL
  zh: 返回
- en: BadRequest("You must pass a product ID in the route, for example, /Home/ProductDetail/21"
  id: totrans-1558
  prefs: []
  type: TYPE_NORMAL
  zh: BadRequest("您必须在路由中传递产品ID，例如，/Home/ProductDetail/21"
- en: );
  id: totrans-1559
  prefs: []
  type: TYPE_NORMAL
  zh: );
- en: '}'
  id: totrans-1560
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: Product? model = db.Products
  id: totrans-1561
  prefs: []
  type: TYPE_NORMAL
  zh: Product? model = db.Products
- en: .SingleOrDefault(p => p.ProductId == id);
  id: totrans-1562
  prefs: []
  type: TYPE_NORMAL
  zh: .SingleOrDefault(p => p.ProductId == id);
- en: if
  id: totrans-1563
  prefs: []
  type: TYPE_NORMAL
  zh: 如果
- en: (model == null
  id: totrans-1564
  prefs: []
  type: TYPE_NORMAL
  zh: (model == null
- en: )
  id: totrans-1565
  prefs: []
  type: TYPE_NORMAL
  zh: )
- en: '{'
  id: totrans-1566
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: return
  id: totrans-1567
  prefs: []
  type: TYPE_NORMAL
  zh: 返回
- en: NotFound($"ProductId
  id: totrans-1568
  prefs: []
  type: TYPE_NORMAL
  zh: NotFound($"ProductId
- en: '{id}'
  id: totrans-1569
  prefs: []
  type: TYPE_NORMAL
  zh: '{id}'
- en: not found."
  id: totrans-1570
  prefs: []
  type: TYPE_NORMAL
  zh: 未找到。"
- en: );
  id: totrans-1571
  prefs: []
  type: TYPE_NORMAL
  zh: );
- en: '}'
  id: totrans-1572
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: return
  id: totrans-1573
  prefs: []
  type: TYPE_NORMAL
  zh: 返回
- en: View(model); // pass model to view and then return result
  id: totrans-1574
  prefs: []
  type: TYPE_NORMAL
  zh: View(model); //将模型传递给视图，然后返回结果
- en: '}'
  id: totrans-1575
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '```'
  id: totrans-1576
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'Note the following:'
  id: totrans-1577
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意以下内容：
- en: This method uses a feature of ASP.NET Core called **model binding** to automatically
    match the `id` passed in the route to the parameter named `id` in the method.
  id: totrans-1578
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这种方法使用了ASP.NET Core的一个特性，叫做**模型绑定**，自动将路由中传递的`id`与方法中命名为`id`的参数匹配。
- en: Inside the method, we check to see whether `id` does not have a value, and if
    so, we call the `BadRequest` method to return a `400` status code with a custom
    message explaining the correct URL path format.
  id: totrans-1579
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在方法内部，我们检查`id`是否没有值，如果是，我们调用`BadRequest`方法返回一个带有自定义消息的`400`状态码，解释正确的URL路径格式。
- en: Otherwise, we can connect to the database and try to retrieve a product using
    the `id` value.
  id: totrans-1580
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 否则，我们可以连接到数据库并尝试使用`id`值检索产品。
- en: If we find a product, we pass it to a view; otherwise, we call the `NotFound`
    method to return a `404` status code and a custom message explaining that a product
    with that ID was not found in the database.
  id: totrans-1581
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果我们找到了产品，我们将其传递给视图；否则，我们调用`NotFound`方法返回`404`状态码和一个自定义消息，解释数据库中没有找到该ID的产品。
- en: Inside the `Views/Home` folder, add a new file named `ProductDetail.cshtml`
    .
  id: totrans-1582
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Views/Home`文件夹中，添加一个名为`ProductDetail.cshtml`的新文件。
- en: 'Modify the contents, as shown in the following markup:'
  id: totrans-1583
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改内容，如下面的标记所示：
- en: '```cs'
  id: totrans-1584
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '@model Packt.Shared.Product'
  id: totrans-1585
  prefs: []
  type: TYPE_NORMAL
  zh: '@model Packt.Shared.Product'
- en: '@{'
  id: totrans-1586
  prefs: []
  type: TYPE_NORMAL
  zh: '@{'
- en: ViewData["Title"
  id: totrans-1587
  prefs: []
  type: TYPE_NORMAL
  zh: ViewData["Title"
- en: '] = "Product Detail - "'
  id: totrans-1588
  prefs: []
  type: TYPE_NORMAL
  zh: '] = "产品详情 - "'
- en: + Model.ProductName;
  id: totrans-1589
  prefs: []
  type: TYPE_NORMAL
  zh: + Model.ProductName;
- en: '}'
  id: totrans-1590
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: <
  id: totrans-1591
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: h2
  id: totrans-1592
  prefs: []
  type: TYPE_NORMAL
  zh: h2
- en: '>'
  id: totrans-1593
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Product Detail</
  id: totrans-1594
  prefs: []
  type: TYPE_NORMAL
  zh: 产品详情</
- en: h2
  id: totrans-1595
  prefs: []
  type: TYPE_NORMAL
  zh: h2
- en: '>'
  id: totrans-1596
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1597
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: hr
  id: totrans-1598
  prefs: []
  type: TYPE_NORMAL
  zh: hr
- en: />
  id: totrans-1599
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: <
  id: totrans-1600
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: div
  id: totrans-1601
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-1602
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1603
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dl
  id: totrans-1604
  prefs: []
  type: TYPE_NORMAL
  zh: dl
- en: class
  id: totrans-1605
  prefs: []
  type: TYPE_NORMAL
  zh: 类
- en: '='
  id: totrans-1606
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"dl-horizontal"'
  id: totrans-1607
  prefs: []
  type: TYPE_NORMAL
  zh: '"dl-horizontal"'
- en: '>'
  id: totrans-1608
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1609
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dt
  id: totrans-1610
  prefs: []
  type: TYPE_NORMAL
  zh: dt
- en: '>'
  id: totrans-1611
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Product Id</
  id: totrans-1612
  prefs: []
  type: TYPE_NORMAL
  zh: 产品ID</
- en: dt
  id: totrans-1613
  prefs: []
  type: TYPE_NORMAL
  zh: dt
- en: '>'
  id: totrans-1614
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1615
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dd
  id: totrans-1616
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-1617
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@Model.ProductId</'
  id: totrans-1618
  prefs: []
  type: TYPE_NORMAL
  zh: '@Model.ProductId</'
- en: dd
  id: totrans-1619
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-1620
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1621
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dt
  id: totrans-1622
  prefs: []
  type: TYPE_NORMAL
  zh: dt
- en: '>'
  id: totrans-1623
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Product Name</
  id: totrans-1624
  prefs: []
  type: TYPE_NORMAL
  zh: 产品名称</
- en: dt
  id: totrans-1625
  prefs: []
  type: TYPE_NORMAL
  zh: dt
- en: '>'
  id: totrans-1626
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1627
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dd
  id: totrans-1628
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-1629
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@Model.ProductName</'
  id: totrans-1630
  prefs: []
  type: TYPE_NORMAL
  zh: '@Model.ProductName</'
- en: dd
  id: totrans-1631
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-1632
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1633
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dt
  id: totrans-1634
  prefs: []
  type: TYPE_NORMAL
  zh: dt
- en: '>'
  id: totrans-1635
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Category Id</
  id: totrans-1636
  prefs: []
  type: TYPE_NORMAL
  zh: 类别ID</
- en: dt
  id: totrans-1637
  prefs: []
  type: TYPE_NORMAL
  zh: dt
- en: '>'
  id: totrans-1638
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1639
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dd
  id: totrans-1640
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-1641
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@Model.CategoryId</'
  id: totrans-1642
  prefs: []
  type: TYPE_NORMAL
  zh: '@Model.CategoryId</'
- en: dd
  id: totrans-1643
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-1644
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1645
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dt
  id: totrans-1646
  prefs: []
  type: TYPE_NORMAL
  zh: dt
- en: '>'
  id: totrans-1647
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Unit Price</
  id: totrans-1648
  prefs: []
  type: TYPE_NORMAL
  zh: 单价</
- en: dt
  id: totrans-1649
  prefs: []
  type: TYPE_NORMAL
  zh: dt
- en: '>'
  id: totrans-1650
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1651
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dd
  id: totrans-1652
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-1653
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@Model.UnitPrice.Value.ToString("C")</'
  id: totrans-1654
  prefs: []
  type: TYPE_NORMAL
  zh: '@Model.UnitPrice.Value.ToString("C")</'
- en: dd
  id: totrans-1655
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-1656
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1657
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dt
  id: totrans-1658
  prefs: []
  type: TYPE_NORMAL
  zh: dt
- en: '>'
  id: totrans-1659
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Units In Stock</
  id: totrans-1660
  prefs: []
  type: TYPE_NORMAL
  zh: 库存单位</
- en: dt
  id: totrans-1661
  prefs: []
  type: TYPE_NORMAL
  zh: dt
- en: '>'
  id: totrans-1662
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1663
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dd
  id: totrans-1664
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-1665
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@Model.UnitsInStock</'
  id: totrans-1666
  prefs: []
  type: TYPE_NORMAL
  zh: '@Model.UnitsInStock</'
- en: dd
  id: totrans-1667
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-1668
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-1669
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: dl
  id: totrans-1670
  prefs: []
  type: TYPE_NORMAL
  zh: dl
- en: '>'
  id: totrans-1671
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-1672
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: div
  id: totrans-1673
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-1674
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '```'
  id: totrans-1675
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Start the `Northwind.Mvc` project.
  id: totrans-1676
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动`Northwind.Mvc`项目。
- en: When the home page appears with the list of products, click on one of them,
    for example, the second product, **Chang** .
  id: totrans-1677
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当主页显示产品列表时，点击其中一个，例如第二个产品，**Chang**。
- en: Note the URL path in the browser's address bar, the page title shown in the
    browser tab, and the product details page, as shown in *Figure 15.5* :![](img/Image00124.jpg)
  id: totrans-1678
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注意浏览器地址栏中的URL路径，浏览器标签中显示的页面标题，以及产品详细信息页面，如*图15.5*所示：![](img/Image00124.jpg)
- en: 'Figure 15.5: The product detail page for Chang'
  id: totrans-1679
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.5：Chang的产品详细页面
- en: View **Developer tools** .
  id: totrans-1680
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看**开发者工具**。
- en: Edit the URL in the address box of Chrome to request a product ID that does
    not exist, like 99, and note the 404 Not Found status code and custom error response.
  id: totrans-1681
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 编辑Chrome地址栏中的URL，请求一个不存在的产品ID，比如99，注意404 Not Found状态码和自定义错误响应。
- en: Understanding model binders in more detail
  id: totrans-1682
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更详细地了解模型绑定器
- en: Model binders are powerful, and the default one does a lot for you. After the
    default route identifies a controller class to instantiate and an action method
    to call, if that method has parameters, then those parameters need to have values
    set.
  id: totrans-1683
  prefs: []
  type: TYPE_NORMAL
  zh: 模型绑定器功能强大，默认绑定器为您做了很多事情。在默认路由确定要实例化的控制器类和要调用的操作方法之后，如果该方法有参数，则这些参数需要设置值。
- en: 'Model binders do this by looking for parameter values passed in the HTTP request
    as any of the following types of parameters:'
  id: totrans-1684
  prefs: []
  type: TYPE_NORMAL
  zh: 模型绑定器通过查找HTTP请求中传递的参数值来设置参数值，这些参数值可以是以下类型之一：
- en: '**Route parameter** , like `id` as we did in the previous section, as shown
    in the following URL path: `/Home/ProductDetail/2`'
  id: totrans-1685
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**路由参数**，如我们在上一节中所做的`id`，如下面的URL路径所示：`/Home/ProductDetail/2`'
- en: '**Query string parameter** , as shown in the following URL path: `/Home/ProductDetail?id=2`'
  id: totrans-1686
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**查询字符串参数**，如下面的URL路径所示：`/Home/ProductDetail?id=2`'
- en: '**Form parameter** , as shown in the following markup:'
  id: totrans-1687
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**表单参数**，如下面的标记所示：'
- en: '```cs'
  id: totrans-1688
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: <
  id: totrans-1689
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: form
  id: totrans-1690
  prefs: []
  type: TYPE_NORMAL
  zh: form
- en: action
  id: totrans-1691
  prefs: []
  type: TYPE_NORMAL
  zh: 操作
- en: '='
  id: totrans-1692
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"post"'
  id: totrans-1693
  prefs: []
  type: TYPE_NORMAL
  zh: '"post"'
- en: action
  id: totrans-1694
  prefs: []
  type: TYPE_NORMAL
  zh: 操作
- en: '='
  id: totrans-1695
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"/Home/ProductDetail"'
  id: totrans-1696
  prefs: []
  type: TYPE_NORMAL
  zh: '"/Home/ProductDetail"'
- en: '>'
  id: totrans-1697
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1698
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: input
  id: totrans-1699
  prefs: []
  type: TYPE_NORMAL
  zh: 输入
- en: type
  id: totrans-1700
  prefs: []
  type: TYPE_NORMAL
  zh: 类型
- en: '='
  id: totrans-1701
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"text"'
  id: totrans-1702
  prefs: []
  type: TYPE_NORMAL
  zh: '"text"'
- en: name
  id: totrans-1703
  prefs: []
  type: TYPE_NORMAL
  zh: 名称
- en: '='
  id: totrans-1704
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"id"'
  id: totrans-1705
  prefs: []
  type: TYPE_NORMAL
  zh: '"id"'
- en: value
  id: totrans-1706
  prefs: []
  type: TYPE_NORMAL
  zh: 值
- en: '='
  id: totrans-1707
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"2"'
  id: totrans-1708
  prefs: []
  type: TYPE_NORMAL
  zh: '"2"'
- en: />
  id: totrans-1709
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: <
  id: totrans-1710
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: input
  id: totrans-1711
  prefs: []
  type: TYPE_NORMAL
  zh: 输入
- en: type
  id: totrans-1712
  prefs: []
  type: TYPE_NORMAL
  zh: 类型
- en: '='
  id: totrans-1713
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"submit"'
  id: totrans-1714
  prefs: []
  type: TYPE_NORMAL
  zh: '"submit"'
- en: />
  id: totrans-1715
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: </
  id: totrans-1716
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: form
  id: totrans-1717
  prefs: []
  type: TYPE_NORMAL
  zh: form
- en: '>'
  id: totrans-1718
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '```'
  id: totrans-1719
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'Model binders can populate almost any type:'
  id: totrans-1720
  prefs: []
  type: TYPE_NORMAL
  zh: 模型绑定器可以填充几乎任何类型：
- en: Simple types, like `int` , `string` , `DateTime` , and `bool` .
  id: totrans-1721
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 简单类型，如`int`，`string`，`DateTime`和`bool`。
- en: Complex types defined by `class` , `record` , or `struct` .
  id: totrans-1722
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由`class`，`record`或`struct`定义的复杂类型。
- en: Collection types, like arrays and lists.
  id: totrans-1723
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 集合类型，如数组和列表。
- en: 'Let''s create a somewhat artificial example to illustrate what can be achieved
    using the default model binder:'
  id: totrans-1724
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们创建一个有点人为的例子来说明默认模型绑定器可以实现的功能：
- en: In the `Models` folder, add a new file named `Thing.cs` .
  id: totrans-1725
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Models`文件夹中，添加一个名为`Thing.cs`的新文件。
- en: 'Modify the contents to define a class with two properties for a nullable integer
    named `Id` and a `string` named `Color` , as shown in the following code:'
  id: totrans-1726
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改内容以定义一个具有两个属性的类，用于可空整数`Id`和名为`Color`的`string`，如下面的代码所示：
- en: '```cs'
  id: totrans-1727
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: namespace
  id: totrans-1728
  prefs: []
  type: TYPE_NORMAL
  zh: 命名空间
- en: Northwind.Mvc.Models
  id: totrans-1729
  prefs: []
  type: TYPE_NORMAL
  zh: Northwind.Mvc.Models
- en: ;
  id: totrans-1730
  prefs: []
  type: TYPE_NORMAL
  zh: ;
- en: public
  id: totrans-1731
  prefs: []
  type: TYPE_NORMAL
  zh: 公共
- en: class
  id: totrans-1732
  prefs: []
  type: TYPE_NORMAL
  zh: 类
- en: Thing
  id: totrans-1733
  prefs: []
  type: TYPE_NORMAL
  zh: 事物
- en: '{'
  id: totrans-1734
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: public
  id: totrans-1735
  prefs: []
  type: TYPE_NORMAL
  zh: public
- en: int
  id: totrans-1736
  prefs: []
  type: TYPE_NORMAL
  zh: int
- en: '? Id { get'
  id: totrans-1737
  prefs: []
  type: TYPE_NORMAL
  zh: '? Id { get'
- en: ; set
  id: totrans-1738
  prefs: []
  type: TYPE_NORMAL
  zh: ; 设置
- en: ; }
  id: totrans-1739
  prefs: []
  type: TYPE_NORMAL
  zh: ; }
- en: public
  id: totrans-1740
  prefs: []
  type: TYPE_NORMAL
  zh: 公共
- en: string
  id: totrans-1741
  prefs: []
  type: TYPE_NORMAL
  zh: 字符串
- en: '? Color { get'
  id: totrans-1742
  prefs: []
  type: TYPE_NORMAL
  zh: '? Color { get'
- en: ; set
  id: totrans-1743
  prefs: []
  type: TYPE_NORMAL
  zh: ; 设置
- en: ; }
  id: totrans-1744
  prefs: []
  type: TYPE_NORMAL
  zh: ; }
- en: '}'
  id: totrans-1745
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '```'
  id: totrans-1746
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'In `HomeController` , add two new action methods, one to show a page with a
    form and one to display a thing with a parameter using your new model type, as
    shown in the following code:'
  id: totrans-1747
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`HomeController`中，添加两个新的操作方法，一个用于显示带有表单的页面，另一个用于使用新模型类型显示带有参数的事物，如下面的代码所示：
- en: '```cs'
  id: totrans-1748
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: public
  id: totrans-1749
  prefs: []
  type: TYPE_NORMAL
  zh: 公共
- en: IActionResult
  id: totrans-1750
  prefs: []
  type: TYPE_NORMAL
  zh: IActionResult
- en: ModelBinding
  id: totrans-1751
  prefs: []
  type: TYPE_NORMAL
  zh: ModelBinding
- en: ()
  id: totrans-1752
  prefs: []
  type: TYPE_NORMAL
  zh: ()
- en: '{'
  id: totrans-1753
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: return
  id: totrans-1754
  prefs: []
  type: TYPE_NORMAL
  zh: 返回
- en: View(); // the page with a form to submit
  id: totrans-1755
  prefs: []
  type: TYPE_NORMAL
  zh: View(); // 带有表单的页面
- en: '}'
  id: totrans-1756
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: public
  id: totrans-1757
  prefs: []
  type: TYPE_NORMAL
  zh: 公共
- en: IActionResult
  id: totrans-1758
  prefs: []
  type: TYPE_NORMAL
  zh: IActionResult
- en: ModelBinding
  id: totrans-1759
  prefs: []
  type: TYPE_NORMAL
  zh: ModelBinding
- en: (
  id: totrans-1760
  prefs: []
  type: TYPE_NORMAL
  zh: (
- en: Thing thing
  id: totrans-1761
  prefs: []
  type: TYPE_NORMAL
  zh: 事物
- en: )
  id: totrans-1762
  prefs: []
  type: TYPE_NORMAL
  zh: )
- en: '{'
  id: totrans-1763
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: return
  id: totrans-1764
  prefs: []
  type: TYPE_NORMAL
  zh: 返回
- en: View(thing); // show the model bound thing
  id: totrans-1765
  prefs: []
  type: TYPE_NORMAL
  zh: View(thing); // 显示模型绑定的事物
- en: '}'
  id: totrans-1766
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '```'
  id: totrans-1767
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: In the `Views\Home` folder, add a new file named `ModelBinding.cshtml` .
  id: totrans-1768
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Views\Home`文件夹中，添加一个名为`ModelBinding.cshtml`的新文件。
- en: 'Modify its contents, as shown in the following markup:'
  id: totrans-1769
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改其内容，如下面的标记所示：
- en: '```cs'
  id: totrans-1770
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '@model Thing'
  id: totrans-1771
  prefs: []
  type: TYPE_NORMAL
  zh: '@model Thing'
- en: '@{'
  id: totrans-1772
  prefs: []
  type: TYPE_NORMAL
  zh: '@{'
- en: ViewData["Title"
  id: totrans-1773
  prefs: []
  type: TYPE_NORMAL
  zh: ViewData["Title"
- en: '] = "Model Binding Demo"'
  id: totrans-1774
  prefs: []
  type: TYPE_NORMAL
  zh: '] = "模型绑定演示"'
- en: ;
  id: totrans-1775
  prefs: []
  type: TYPE_NORMAL
  zh: ;
- en: '}'
  id: totrans-1776
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: <
  id: totrans-1777
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: h1
  id: totrans-1778
  prefs: []
  type: TYPE_NORMAL
  zh: h1
- en: '>'
  id: totrans-1779
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@ViewData["Title"'
  id: totrans-1780
  prefs: []
  type: TYPE_NORMAL
  zh: '@ViewData["Title"'
- en: ']</'
  id: totrans-1781
  prefs: []
  type: TYPE_NORMAL
  zh: ']</'
- en: h1
  id: totrans-1782
  prefs: []
  type: TYPE_NORMAL
  zh: h1
- en: '>'
  id: totrans-1783
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1784
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: div
  id: totrans-1785
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-1786
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: 'Enter values for your thing in the following form:'
  id: totrans-1787
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下表单中输入您的事物的值：
- en: </
  id: totrans-1788
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: div
  id: totrans-1789
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-1790
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1791
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: form
  id: totrans-1792
  prefs: []
  type: TYPE_NORMAL
  zh: form
- en: method
  id: totrans-1793
  prefs: []
  type: TYPE_NORMAL
  zh: 方法
- en: '='
  id: totrans-1794
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"POST"'
  id: totrans-1795
  prefs: []
  type: TYPE_NORMAL
  zh: '"POST"'
- en: action
  id: totrans-1796
  prefs: []
  type: TYPE_NORMAL
  zh: 操作
- en: '='
  id: totrans-1797
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"/home/modelbinding?id=3"'
  id: totrans-1798
  prefs: []
  type: TYPE_NORMAL
  zh: '"/home/modelbinding?id=3"'
- en: '>'
  id: totrans-1799
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1800
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: input
  id: totrans-1801
  prefs: []
  type: TYPE_NORMAL
  zh: 输入
- en: name
  id: totrans-1802
  prefs: []
  type: TYPE_NORMAL
  zh: 名称
- en: '='
  id: totrans-1803
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"color"'
  id: totrans-1804
  prefs: []
  type: TYPE_NORMAL
  zh: '"color"'
- en: value
  id: totrans-1805
  prefs: []
  type: TYPE_NORMAL
  zh: 值
- en: '='
  id: totrans-1806
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"Red"'
  id: totrans-1807
  prefs: []
  type: TYPE_NORMAL
  zh: '"Red"'
- en: />
  id: totrans-1808
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: <
  id: totrans-1809
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: input
  id: totrans-1810
  prefs: []
  type: TYPE_NORMAL
  zh: 输入
- en: type
  id: totrans-1811
  prefs: []
  type: TYPE_NORMAL
  zh: 类型
- en: '='
  id: totrans-1812
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"submit"'
  id: totrans-1813
  prefs: []
  type: TYPE_NORMAL
  zh: '"submit"'
- en: />
  id: totrans-1814
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: </
  id: totrans-1815
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: form
  id: totrans-1816
  prefs: []
  type: TYPE_NORMAL
  zh: form
- en: '>'
  id: totrans-1817
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@if (Model != null)'
  id: totrans-1818
  prefs: []
  type: TYPE_NORMAL
  zh: '@if (Model != null)'
- en: '{'
  id: totrans-1819
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: <
  id: totrans-1820
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: h2
  id: totrans-1821
  prefs: []
  type: TYPE_NORMAL
  zh: h2
- en: '>'
  id: totrans-1822
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Submitted Thing</
  id: totrans-1823
  prefs: []
  type: TYPE_NORMAL
  zh: 提交的事物</
- en: h2
  id: totrans-1824
  prefs: []
  type: TYPE_NORMAL
  zh: h2```
- en: '>'
  id: totrans-1825
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1826
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: hr
  id: totrans-1827
  prefs: []
  type: TYPE_NORMAL
  zh: hr
- en: />
  id: totrans-1828
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: <
  id: totrans-1829
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: div
  id: totrans-1830
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-1831
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1832
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dl
  id: totrans-1833
  prefs: []
  type: TYPE_NORMAL
  zh: dl
- en: class
  id: totrans-1834
  prefs: []
  type: TYPE_NORMAL
  zh: 类
- en: '='
  id: totrans-1835
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"dl-horizontal"'
  id: totrans-1836
  prefs: []
  type: TYPE_NORMAL
  zh: '"dl-horizontal"'
- en: '>'
  id: totrans-1837
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1838
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dt
  id: totrans-1839
  prefs: []
  type: TYPE_NORMAL
  zh: dt
- en: '>'
  id: totrans-1840
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Model.Id</
  id: totrans-1841
  prefs: []
  type: TYPE_NORMAL
  zh: Model.Id</
- en: dt
  id: totrans-1842
  prefs: []
  type: TYPE_NORMAL
  zh: dt
- en: '>'
  id: totrans-1843
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1844
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dd
  id: totrans-1845
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-1846
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@Model.Id</'
  id: totrans-1847
  prefs: []
  type: TYPE_NORMAL
  zh: '@Model.Id</'
- en: dd
  id: totrans-1848
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-1849
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1850
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dt
  id: totrans-1851
  prefs: []
  type: TYPE_NORMAL
  zh: dt
- en: '>'
  id: totrans-1852
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Model.Color</
  id: totrans-1853
  prefs: []
  type: TYPE_NORMAL
  zh: Model.Color</
- en: dt
  id: totrans-1854
  prefs: []
  type: TYPE_NORMAL
  zh: dt
- en: '>'
  id: totrans-1855
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-1856
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dd
  id: totrans-1857
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-1858
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@Model.Color</'
  id: totrans-1859
  prefs: []
  type: TYPE_NORMAL
  zh: '@Model.Color</'
- en: dd
  id: totrans-1860
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-1861
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-1862
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: dl
  id: totrans-1863
  prefs: []
  type: TYPE_NORMAL
  zh: dl
- en: '>'
  id: totrans-1864
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-1865
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: div
  id: totrans-1866
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-1867
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '}'
  id: totrans-1868
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '```'
  id: totrans-1869
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'In `Views/Home` , open `Index.cshtml` , and in the first `<div>` , add a new
    paragraph with a link to the model binding page, as shown in the following markup:'
  id: totrans-1870
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Views/Home`中，打开`Index.cshtml`，并在第一个`<div>`中添加一个指向模型绑定页面的链接的新段落，如下面的标记所示：
- en: '```cs'
  id: totrans-1871
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: <
  id: totrans-1872
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: p
  id: totrans-1873
  prefs: []
  type: TYPE_NORMAL
  zh: p
- en: '><'
  id: totrans-1874
  prefs: []
  type: TYPE_NORMAL
  zh: '><'
- en: a
  id: totrans-1875
  prefs: []
  type: TYPE_NORMAL
  zh: a
- en: asp-action
  id: totrans-1876
  prefs: []
  type: TYPE_NORMAL
  zh: asp-action
- en: '='
  id: totrans-1877
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"ModelBinding"'
  id: totrans-1878
  prefs: []
  type: TYPE_NORMAL
  zh: '"ModelBinding"'
- en: asp-controller
  id: totrans-1879
  prefs: []
  type: TYPE_NORMAL
  zh: asp-controller
- en: '='
  id: totrans-1880
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"Home"'
  id: totrans-1881
  prefs: []
  type: TYPE_NORMAL
  zh: '"Home"'
- en: '>'
  id: totrans-1882
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Binding</
  id: totrans-1883
  prefs: []
  type: TYPE_NORMAL
  zh: 绑定</
- en: a
  id: totrans-1884
  prefs: []
  type: TYPE_NORMAL
  zh: a
- en: '></'
  id: totrans-1885
  prefs: []
  type: TYPE_NORMAL
  zh: '></'
- en: p
  id: totrans-1886
  prefs: []
  type: TYPE_NORMAL
  zh: p
- en: '>'
  id: totrans-1887
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '```'
  id: totrans-1888
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Start the website.
  id: totrans-1889
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动网站。
- en: On the home page, click **Binding** .
  id: totrans-1890
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主页上，单击**绑定**。
- en: Note the unhandled exception about an ambiguous match, as shown in *Figure 15.6*
    :![](img/Image00125.jpg)
  id: totrans-1891
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注意未处理的关于模糊匹配的异常，如*图15.6*所示：![](img/Image00125.jpg)
- en: 'Figure 15.6: An unhandled ambiguous action method mismatch exception'
  id: totrans-1892
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.6：未处理的模糊操作方法不匹配异常
- en: Close Chrome and shut down the web server.
  id: totrans-1893
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭Chrome并关闭Web服务器。
- en: Disambiguating action methods
  id: totrans-1894
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 消除歧义的操作方法
- en: Although the C# compiler can differentiate between the two methods by noting
    that the signatures are different, from the routing of an HTTP request's point
    of view, both methods are potential matches. We need an HTTP-specific way to disambiguate
    the action methods.
  id: totrans-1895
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管C#编译器可以通过注意到签名不同来区分两种方法，但从HTTP请求路由的角度来看，这两种方法都是潜在的匹配项。我们需要一种HTTP特定的方法来消除操作方法的歧义。
- en: 'We could do this by creating different names for the actions or by specifying
    that one method should be used for a specific HTTP verb, like `GET` , `POST` ,
    or `DELETE` . That is how we will solve the problem:'
  id: totrans-1896
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过为操作创建不同的名称或指定一个方法应用于特定的HTTP动词（如`GET`，`POST`，`DELETE`）来解决这个问题。这就是我们将解决问题的方式：
- en: 'In `HomeController` , decorate the second `ModelBinding` action method to indicate
    that it should be used for processing HTTP `POST` requests, that is, when a form
    is submitted, as shown highlighted in the following code:'
  id: totrans-1897
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`HomeController`中，装饰第二个`ModelBinding`操作方法，指示它应用于处理HTTP `POST`请求，也就是说，当提交表单时，如下面的代码中所突出显示的那样：
- en: '```cs'
  id: totrans-1898
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '**[**'
  id: totrans-1899
  prefs: []
  type: TYPE_NORMAL
  zh: '**[**'
- en: '**HttpPost**'
  id: totrans-1900
  prefs: []
  type: TYPE_NORMAL
  zh: '**HttpPost**'
- en: '**]**'
  id: totrans-1901
  prefs: []
  type: TYPE_NORMAL
  zh: '**]**'
- en: public
  id: totrans-1902
  prefs: []
  type: TYPE_NORMAL
  zh: 公共
- en: IActionResult
  id: totrans-1903
  prefs: []
  type: TYPE_NORMAL
  zh: IActionResult
- en: ModelBinding
  id: totrans-1904
  prefs: []
  type: TYPE_NORMAL
  zh: ModelBinding
- en: (
  id: totrans-1905
  prefs: []
  type: TYPE_NORMAL
  zh: (
- en: Thing thing
  id: totrans-1906
  prefs: []
  type: TYPE_NORMAL
  zh: 事物
- en: )
  id: totrans-1907
  prefs: []
  type: TYPE_NORMAL
  zh: )
- en: '```'
  id: totrans-1908
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: The other `ModelBinding` action method will implicitly be used for all other
    types of HTTP request, like `GET` , `PUT` , `DELETE` , and so on.
  id: totrans-1909
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个`ModelBinding`操作方法将隐式用于所有其他类型的HTTP请求，如`GET`，`PUT`，`DELETE`等。
- en: Start the website.
  id: totrans-1910
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动网站。
- en: On the home page, click **Binding** .
  id: totrans-1911
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主页上，单击**Binding**。
- en: Click the **Submit** button and note the value for the `Id` property is set
    from the query string parameter and the value for the color property is set from
    the form parameter, as shown in *Figure 15.7* :![](img/Image00126.jpg)
  id: totrans-1912
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**提交**按钮，注意`Id`属性的值是从查询字符串参数设置的，`color`属性的值是从表单参数设置的，如*图15.7*所示：![](img/Image00126.jpg)
- en: 'Figure 15.7: The Model Binding Demo page'
  id: totrans-1913
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.7：模型绑定演示页面
- en: Close Chrome and shut down the web server.
  id: totrans-1914
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭Chrome并关闭Web服务器。
- en: Passing a route parameter
  id: totrans-1915
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 传递路由参数
- en: 'Now we will set the property using a route parameter:'
  id: totrans-1916
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将使用路由参数设置属性：
- en: 'Modify the action for the form to pass the value `2` as a route parameter,
    as shown highlighted in the following markup:'
  id: totrans-1917
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改表单的动作，将值`2`作为路由参数传递，如下面的标记所示：
- en: '```cs'
  id: totrans-1918
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: <
  id: totrans-1919
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: form
  id: totrans-1920
  prefs: []
  type: TYPE_NORMAL
  zh: form
- en: method
  id: totrans-1921
  prefs: []
  type: TYPE_NORMAL
  zh: method
- en: '='
  id: totrans-1922
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"POST"'
  id: totrans-1923
  prefs: []
  type: TYPE_NORMAL
  zh: '"POST"'
- en: action
  id: totrans-1924
  prefs: []
  type: TYPE_NORMAL
  zh: 动作
- en: '='
  id: totrans-1925
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"/home/modelbinding'
  id: totrans-1926
  prefs: []
  type: TYPE_NORMAL
  zh: '"/home/modelbinding'
- en: '**/2**'
  id: totrans-1927
  prefs: []
  type: TYPE_NORMAL
  zh: '**/2**'
- en: ?id=3"
  id: totrans-1928
  prefs: []
  type: TYPE_NORMAL
  zh: ?id=3"
- en: '>'
  id: totrans-1929
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '```'
  id: totrans-1930
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Start the website.
  id: totrans-1931
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动网站。
- en: On the home page, click **Binding** .
  id: totrans-1932
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主页上，单击**Binding**。
- en: Click the **Submit** button and note the value for the `Id` property is set
    from the route parameter and the value for the `Color` property is set from the
    form parameter.
  id: totrans-1933
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**提交**按钮，注意`Id`属性的值是从路由参数设置的，`Color`属性的值是从表单参数设置的。
- en: Close Chrome and shut down the web server.
  id: totrans-1934
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭Chrome并关闭Web服务器。
- en: Passing a form parameter
  id: totrans-1935
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 传递表单参数
- en: 'Now we will set the property using a form parameter:'
  id: totrans-1936
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将使用表单参数设置属性：
- en: 'Modify the action for the form to pass the value 1 as a form parameter, as
    shown highlighted in the following markup:'
  id: totrans-1937
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改表单的动作，将值1作为表单参数传递，如下面的标记所示：
- en: '```cs'
  id: totrans-1938
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: <form method="POST"
  id: totrans-1939
  prefs: []
  type: TYPE_NORMAL
  zh: <form method="POST"
- en: action="/home/modelbinding/2?id=3"
  id: totrans-1940
  prefs: []
  type: TYPE_NORMAL
  zh: action="/home/modelbinding/2?id=3"
- en: '>'
  id: totrans-1941
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '**<input name=**'
  id: totrans-1942
  prefs: []
  type: TYPE_NORMAL
  zh: '**<input name=**'
- en: '**"id"**'
  id: totrans-1943
  prefs: []
  type: TYPE_NORMAL
  zh: '**"id"**'
- en: '**value**'
  id: totrans-1944
  prefs: []
  type: TYPE_NORMAL
  zh: '**value**'
- en: '**=**'
  id: totrans-1945
  prefs: []
  type: TYPE_NORMAL
  zh: '**=**'
- en: '**"1"**'
  id: totrans-1946
  prefs: []
  type: TYPE_NORMAL
  zh: '**"1"**'
- en: '**/>**'
  id: totrans-1947
  prefs: []
  type: TYPE_NORMAL
  zh: '**/>**'
- en: <input name="color"
  id: totrans-1948
  prefs: []
  type: TYPE_NORMAL
  zh: <input name="color"
- en: value
  id: totrans-1949
  prefs: []
  type: TYPE_NORMAL
  zh: value
- en: ="Red"
  id: totrans-1950
  prefs: []
  type: TYPE_NORMAL
  zh: ="Red"
- en: />
  id: totrans-1951
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: <input type="submit"
  id: totrans-1952
  prefs: []
  type: TYPE_NORMAL
  zh: <input type="submit"
- en: />
  id: totrans-1953
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: </form>
  id: totrans-1954
  prefs: []
  type: TYPE_NORMAL
  zh: </form>
- en: '```'
  id: totrans-1955
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Start the website.
  id: totrans-1956
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动网站。
- en: On the home page, click **Binding** .
  id: totrans-1957
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主页上，单击**Binding**。
- en: Click the **Submit** button and note the values for the `Id` and `Color` properties
    are both set from the form parameters.
  id: totrans-1958
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**提交**按钮，注意`Id`和`Color`属性的值都是从表单参数设置的。
- en: '**Good Practice** : If you have multiple parameters with the same name, then
    remember that form parameters have the highest priority and query string parameters
    have the lowest priority for automatic model binding.'
  id: totrans-1959
  prefs: []
  type: TYPE_NORMAL
  zh: '**良好实践**：如果您有多个同名参数，请记住，表单参数具有最高优先级，查询字符串参数具有自动模型绑定的最低优先级。'
- en: Validating the model
  id: totrans-1960
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 验证模型
- en: The process of model binding can cause errors, for example, data type conversions
    or validation errors if the model has been decorated with validation rules. What
    data has been bound and any binding or validation errors are stored in `ControllerBase.ModelState`
    .
  id: totrans-1961
  prefs: []
  type: TYPE_NORMAL
  zh: 模型绑定过程可能会导致错误，例如，如果模型已经使用验证规则进行了装饰，则可能会出现数据类型转换或验证错误。已绑定的数据以及任何绑定或验证错误都存储在`ControllerBase.ModelState`中。
- en: 'Let''s explore what we can do with model state by applying some validation
    rules to the bound model and then showing invalid data messages in the view:'
  id: totrans-1962
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过对绑定模型应用一些验证规则，然后在视图中显示无效数据消息来探索我们可以使用模型状态做什么：
- en: In the `Models` folder, open `Thing.cs` .
  id: totrans-1963
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Models`文件夹中，打开`Thing.cs`。
- en: Import the `System.ComponentModel.DataAnnotations` namespace.
  id: totrans-1964
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入`System.ComponentModel.DataAnnotations`命名空间。
- en: 'Decorate the `Id` property with a validation attribute to limit the range of
    allowed numbers to 1 to 10, and one to ensure that the visitor supplies a color,
    and add a new `Email` property with a regular expression for validation, as shown
    highlighted in the following code:'
  id: totrans-1965
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用验证属性装饰`Id`属性，限制允许的数字范围为1到10，并确保访问者提供颜色，并添加一个新的`Email`属性，其中包含用于验证的正则表达式，如下面的代码中所示：
- en: '```cs'
  id: totrans-1966
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: public
  id: totrans-1967
  prefs: []
  type: TYPE_NORMAL
  zh: public
- en: class
  id: totrans-1968
  prefs: []
  type: TYPE_NORMAL
  zh: class
- en: Thing
  id: totrans-1969
  prefs: []
  type: TYPE_NORMAL
  zh: Thing
- en: '{'
  id: totrans-1970
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: '**[**'
  id: totrans-1971
  prefs: []
  type: TYPE_NORMAL
  zh: '**[**'
- en: '**Range(1, 10)**'
  id: totrans-1972
  prefs: []
  type: TYPE_NORMAL
  zh: '**Range(1, 10)**'
- en: '**]**'
  id: totrans-1973
  prefs: []
  type: TYPE_NORMAL
  zh: '**]**'
- en: public
  id: totrans-1974
  prefs: []
  type: TYPE_NORMAL
  zh: public
- en: int
  id: totrans-1975
  prefs: []
  type: TYPE_NORMAL
  zh: int
- en: '? Id { get'
  id: totrans-1976
  prefs: []
  type: TYPE_NORMAL
  zh: '? Id { get'
- en: ; set
  id: totrans-1977
  prefs: []
  type: TYPE_NORMAL
  zh: ; set
- en: ; }
  id: totrans-1978
  prefs: []
  type: TYPE_NORMAL
  zh: ; }
- en: '**[**'
  id: totrans-1979
  prefs: []
  type: TYPE_NORMAL
  zh: '**[**'
- en: '**Required**'
  id: totrans-1980
  prefs: []
  type: TYPE_NORMAL
  zh: '**Required**'
- en: '**]**'
  id: totrans-1981
  prefs: []
  type: TYPE_NORMAL
  zh: '**]**'
- en: public
  id: totrans-1982
  prefs: []
  type: TYPE_NORMAL
  zh: public
- en: string
  id: totrans-1983
  prefs: []
  type: TYPE_NORMAL
  zh: string
- en: '? Color { get'
  id: totrans-1984
  prefs: []
  type: TYPE_NORMAL
  zh: '? Color { get'
- en: ; set
  id: totrans-1985
  prefs: []
  type: TYPE_NORMAL
  zh: ; set
- en: ; }
  id: totrans-1986
  prefs: []
  type: TYPE_NORMAL
  zh: ; }
- en: '**[**'
  id: totrans-1987
  prefs: []
  type: TYPE_NORMAL
  zh: '**[**'
- en: '**EmailAddress**'
  id: totrans-1988
  prefs: []
  type: TYPE_NORMAL
  zh: '**EmailAddress**'
- en: '**]**'
  id: totrans-1989
  prefs: []
  type: TYPE_NORMAL
  zh: '**]**'
- en: '**public**'
  id: totrans-1990
  prefs: []
  type: TYPE_NORMAL
  zh: '**public**'
- en: '**string**'
  id: totrans-1991
  prefs: []
  type: TYPE_NORMAL
  zh: '**string**'
- en: '**? Email {**'
  id: totrans-1992
  prefs: []
  type: TYPE_NORMAL
  zh: '**? Email {**'
- en: '**get**'
  id: totrans-1993
  prefs: []
  type: TYPE_NORMAL
  zh: '**get**'
- en: '**;**'
  id: totrans-1994
  prefs: []
  type: TYPE_NORMAL
  zh: '**;**'
- en: '**set**'
  id: totrans-1995
  prefs: []
  type: TYPE_NORMAL
  zh: '**set**'
- en: '**; }**'
  id: totrans-1996
  prefs: []
  type: TYPE_NORMAL
  zh: '**; }**'
- en: '}'
  id: totrans-1997
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '```'
  id: totrans-1998
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: In the `Models` folder, add a new file named `HomeModelBindingViewModel.cs`
    .
  id: totrans-1999
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Models`文件夹中，添加一个名为`HomeModelBindingViewModel.cs`的新文件。
- en: 'Modify its contents to define a record with properties to store the bound model,
    a flag to indicate that there are errors, and a sequence of error messages, as
    shown in the following code:'
  id: totrans-2000
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改其内容以定义一个记录，其中包含存储绑定模型的属性，指示是否存在错误的标志，以及一系列错误消息，如下面的代码所示：
- en: '```cs'
  id: totrans-2001
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: namespace
  id: totrans-2002
  prefs: []
  type: TYPE_NORMAL
  zh: namespace
- en: Northwind.Mvc.Models
  id: totrans-2003
  prefs: []
  type: TYPE_NORMAL
  zh: Northwind.Mvc.Models
- en: ;
  id: totrans-2004
  prefs: []
  type: TYPE_NORMAL
  zh: ;
- en: public
  id: totrans-2005
  prefs: []
  type: TYPE_NORMAL
  zh: public
- en: record
  id: totrans-2006
  prefs: []
  type: TYPE_NORMAL
  zh: 记录
- en: HomeModelBindingViewModel
  id: totrans-2007
  prefs: []
  type: TYPE_NORMAL
  zh: HomeModelBindingViewModel
- en: (
  id: totrans-2008
  prefs: []
  type: TYPE_NORMAL
  zh: (
- en: Thing Thing,
  id: totrans-2009
  prefs: []
  type: TYPE_NORMAL
  zh: Thing Thing,
- en: bool
  id: totrans-2010
  prefs: []
  type: TYPE_NORMAL
  zh: bool
- en: HasErrors,
  id: totrans-2011
  prefs: []
  type: TYPE_NORMAL
  zh: HasErrors,
- en: IEnumerable<
  id: totrans-2012
  prefs: []
  type: TYPE_NORMAL
  zh: IEnumerable<
- en: string
  id: totrans-2013
  prefs: []
  type: TYPE_NORMAL
  zh: string
- en: ValidationErrors
  id: totrans-2014
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ValidationErrors
- en: )
  id: totrans-2015
  prefs: []
  type: TYPE_NORMAL
  zh: )
- en: ;
  id: totrans-2016
  prefs: []
  type: TYPE_NORMAL
  zh: ;
- en: '```'
  id: totrans-2017
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'In `HomeController` , in the `ModelBinding` method that handles HTTP `POST`
    , comment out the previous statement that passed the thing to the view, and instead
    add statements to create an instance of the view model. Validate the model and
    store an array of error messages, and then pass the view model to the view, as
    shown highlighted in the following code:'
  id: totrans-2018
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`HomeController`中，处理HTTP `POST`的`ModelBinding`方法中，注释掉之前传递thing到视图的语句，而是添加语句来创建视图模型的实例。验证模型并存储错误消息的数组，然后将视图模型传递给视图，如下面的代码中所示：
- en: '```cs'
  id: totrans-2019
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '[HttpPost'
  id: totrans-2020
  prefs: []
  type: TYPE_NORMAL
  zh: '[HttpPost'
- en: ']'
  id: totrans-2021
  prefs: []
  type: TYPE_NORMAL
  zh: ']'
- en: public
  id: totrans-2022
  prefs: []
  type: TYPE_NORMAL
  zh: public
- en: IActionResult
  id: totrans-2023
  prefs: []
  type: TYPE_NORMAL
  zh: IActionResult
- en: ModelBinding
  id: totrans-2024
  prefs: []
  type: TYPE_NORMAL
  zh: ModelBinding
- en: (
  id: totrans-2025
  prefs: []
  type: TYPE_NORMAL
  zh: (
- en: Thing thing
  id: totrans-2026
  prefs: []
  type: TYPE_NORMAL
  zh: Thing thing
- en: )
  id: totrans-2027
  prefs: []
  type: TYPE_NORMAL
  zh: )
- en: '{'
  id: totrans-2028
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: '**HomeModelBindingViewModel model =**'
  id: totrans-2029
  prefs: []
  type: TYPE_NORMAL
  zh: '**HomeModelBindingViewModel model =**'
- en: '**new**'
  id: totrans-2030
  prefs: []
  type: TYPE_NORMAL
  zh: '**new**'
- en: '**(**'
  id: totrans-2031
  prefs: []
  type: TYPE_NORMAL
  zh: '**(**'
- en: '**thing,**'
  id: totrans-2032
  prefs: []
  type: TYPE_NORMAL
  zh: '**thing,**'
- en: '**!ModelState.IsValid,**'
  id: totrans-2033
  prefs: []
  type: TYPE_NORMAL
  zh: '**!ModelState.IsValid,**'
- en: '**ModelState.Values**'
  id: totrans-2034
  prefs: []
  type: TYPE_NORMAL
  zh: '**ModelState.Values**'
- en: '**.SelectMany(state => state.Errors)**'
  id: totrans-2035
  prefs: []
  type: TYPE_NORMAL
  zh: '**.SelectMany(state => state.Errors)**'
- en: '**.Select(error => error.ErrorMessage)**'
  id: totrans-2036
  prefs: []
  type: TYPE_NORMAL
  zh: '**.Select(error => error.ErrorMessage)**'
- en: '**);**'
  id: totrans-2037
  prefs: []
  type: TYPE_NORMAL
  zh: '**);**'
- en: '**return**'
  id: totrans-2038
  prefs: []
  type: TYPE_NORMAL
  zh: '**return**'
- en: '**View(model);**'
  id: totrans-2039
  prefs: []
  type: TYPE_NORMAL
  zh: '**View(model);**'
- en: '}'
  id: totrans-2040
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '```'
  id: totrans-2041
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: In `Views\Home` , open `ModelBinding.cshtml` .
  id: totrans-2042
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Views\Home`中，打开`ModelBinding.cshtml`。
- en: 'Modify the model type declaration to use the view model class, as shown in
    the following markup:'
  id: totrans-2043
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改模型类型声明以使用视图模型类，如下面的标记所示：
- en: '```cs'
  id: totrans-2044
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '@model Northwind.Mvc.Models.HomeModelBindingViewModel'
  id: totrans-2045
  prefs: []
  type: TYPE_NORMAL
  zh: '@model Northwind.Mvc.Models.HomeModelBindingViewModel'
- en: '```'
  id: totrans-2046
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'Add a `<div>` to show any model validation errors, and change the output of
    the thing''s properties because the view model has changed, as shown highlighted
    in the following markup:'
  id: totrans-2047
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加一个`<div>`以显示任何模型验证错误，并更改事物属性的输出，因为视图模型已更改，如下面的标记中所示：
- en: '```cs'
  id: totrans-2048
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: <
  id: totrans-2049
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: form
  id: totrans-2050
  prefs: []
  type: TYPE_NORMAL
  zh: 形式
- en: method
  id: totrans-2051
  prefs: []
  type: TYPE_NORMAL
  zh: 方法
- en: '='
  id: totrans-2052
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"POST"'
  id: totrans-2053
  prefs: []
  type: TYPE_NORMAL
  zh: '"POST"'
- en: action
  id: totrans-2054
  prefs: []
  type: TYPE_NORMAL
  zh: 行动
- en: '='
  id: totrans-2055
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"/home/modelbinding/2?id=3"'
  id: totrans-2056
  prefs: []
  type: TYPE_NORMAL
  zh: '"/home/modelbinding/2?id=3"'
- en: '>'
  id: totrans-2057
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2058
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: input
  id: totrans-2059
  prefs: []
  type: TYPE_NORMAL
  zh: 输入
- en: name
  id: totrans-2060
  prefs: []
  type: TYPE_NORMAL
  zh: 名称
- en: '='
  id: totrans-2061
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"id"'
  id: totrans-2062
  prefs: []
  type: TYPE_NORMAL
  zh: '"id"'
- en: value
  id: totrans-2063
  prefs: []
  type: TYPE_NORMAL
  zh: 价值
- en: '='
  id: totrans-2064
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"1"'
  id: totrans-2065
  prefs: []
  type: TYPE_NORMAL
  zh: '"1"'
- en: />
  id: totrans-2066
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: <
  id: totrans-2067
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: input
  id: totrans-2068
  prefs: []
  type: TYPE_NORMAL
  zh: 输入
- en: name
  id: totrans-2069
  prefs: []
  type: TYPE_NORMAL
  zh: 名称
- en: '='
  id: totrans-2070
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"color"'
  id: totrans-2071
  prefs: []
  type: TYPE_NORMAL
  zh: '"颜色"'
- en: value
  id: totrans-2072
  prefs: []
  type: TYPE_NORMAL
  zh: 价值
- en: '='
  id: totrans-2073
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"Red"'
  id: totrans-2074
  prefs: []
  type: TYPE_NORMAL
  zh: '"红色"'
- en: />
  id: totrans-2075
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: <
  id: totrans-2076
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: input
  id: totrans-2077
  prefs: []
  type: TYPE_NORMAL
  zh: 输入
- en: name
  id: totrans-2078
  prefs: []
  type: TYPE_NORMAL
  zh: 名称
- en: '='
  id: totrans-2079
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"email"'
  id: totrans-2080
  prefs: []
  type: TYPE_NORMAL
  zh: '"电子邮件"'
- en: value
  id: totrans-2081
  prefs: []
  type: TYPE_NORMAL
  zh: 价值
- en: '='
  id: totrans-2082
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"test@example.com"'
  id: totrans-2083
  prefs: []
  type: TYPE_NORMAL
  zh: '"test@example.com"'
- en: />
  id: totrans-2084
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: <
  id: totrans-2085
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: input
  id: totrans-2086
  prefs: []
  type: TYPE_NORMAL
  zh: 输入
- en: type
  id: totrans-2087
  prefs: []
  type: TYPE_NORMAL
  zh: 类型
- en: '='
  id: totrans-2088
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"submit"'
  id: totrans-2089
  prefs: []
  type: TYPE_NORMAL
  zh: '"提交"'
- en: />
  id: totrans-2090
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: </
  id: totrans-2091
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: form
  id: totrans-2092
  prefs: []
  type: TYPE_NORMAL
  zh: 形式
- en: '>'
  id: totrans-2093
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@if (Model != null)'
  id: totrans-2094
  prefs: []
  type: TYPE_NORMAL
  zh: '@if (Model != null)'
- en: '{'
  id: totrans-2095
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: <
  id: totrans-2096
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: h2
  id: totrans-2097
  prefs: []
  type: TYPE_NORMAL
  zh: h2
- en: '>'
  id: totrans-2098
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Submitted Thing</
  id: totrans-2099
  prefs: []
  type: TYPE_NORMAL
  zh: 提交的事物</
- en: h2
  id: totrans-2100
  prefs: []
  type: TYPE_NORMAL
  zh: h2
- en: '>'
  id: totrans-2101
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2102
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: hr
  id: totrans-2103
  prefs: []
  type: TYPE_NORMAL
  zh: hr
- en: />
  id: totrans-2104
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: <
  id: totrans-2105
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: div
  id: totrans-2106
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-2107
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2108
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dl
  id: totrans-2109
  prefs: []
  type: TYPE_NORMAL
  zh: dl
- en: class
  id: totrans-2110
  prefs: []
  type: TYPE_NORMAL
  zh: 类
- en: '='
  id: totrans-2111
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"dl-horizontal"'
  id: totrans-2112
  prefs: []
  type: TYPE_NORMAL
  zh: '"dl-horizontal"'
- en: '>'
  id: totrans-2113
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2114
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dt
  id: totrans-2115
  prefs: []
  type: TYPE_NORMAL
  zh: dt
- en: '>'
  id: totrans-2116
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Model
  id: totrans-2117
  prefs: []
  type: TYPE_NORMAL
  zh: 模型
- en: '**.Thing**'
  id: totrans-2118
  prefs: []
  type: TYPE_NORMAL
  zh: '**.Thing**'
- en: .Id</
  id: totrans-2119
  prefs: []
  type: TYPE_NORMAL
  zh: .Id</
- en: dt
  id: totrans-2120
  prefs: []
  type: TYPE_NORMAL
  zh: dt
- en: '>'
  id: totrans-2121
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2122
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dd
  id: totrans-2123
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-2124
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@Model'
  id: totrans-2125
  prefs: []
  type: TYPE_NORMAL
  zh: '@Model'
- en: '**.Thing**'
  id: totrans-2126
  prefs: []
  type: TYPE_NORMAL
  zh: '**.Thing**'
- en: .Id</
  id: totrans-2127
  prefs: []
  type: TYPE_NORMAL
  zh: .Id</
- en: dd
  id: totrans-2128
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-2129
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2130
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dt
  id: totrans-2131
  prefs: []
  type: TYPE_NORMAL
  zh: dt
- en: '>'
  id: totrans-2132
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Model
  id: totrans-2133
  prefs: []
  type: TYPE_NORMAL
  zh: 模型
- en: '**.Thing**'
  id: totrans-2134
  prefs: []
  type: TYPE_NORMAL
  zh: '**.Thing**'
- en: .Color</
  id: totrans-2135
  prefs: []
  type: TYPE_NORMAL
  zh: .Color</
- en: dt
  id: totrans-2136
  prefs: []
  type: TYPE_NORMAL
  zh: dt
- en: '>'
  id: totrans-2137
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2138
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dd
  id: totrans-2139
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-2140
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@Model'
  id: totrans-2141
  prefs: []
  type: TYPE_NORMAL
  zh: '@Model'
- en: '**.Thing**'
  id: totrans-2142
  prefs: []
  type: TYPE_NORMAL
  zh: '**.Thing**'
- en: .Color</
  id: totrans-2143
  prefs: []
  type: TYPE_NORMAL
  zh: .Color</
- en: dd
  id: totrans-2144
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-2145
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '**<**'
  id: totrans-2146
  prefs: []
  type: TYPE_NORMAL
  zh: '**<**'
- en: '**dt**'
  id: totrans-2147
  prefs: []
  type: TYPE_NORMAL
  zh: '**dt**'
- en: '**>**'
  id: totrans-2148
  prefs: []
  type: TYPE_NORMAL
  zh: '**>**'
- en: '**Model.Thing.Email**'
  id: totrans-2149
  prefs: []
  type: TYPE_NORMAL
  zh: '**Model.Thing.Email**'
- en: '**</**'
  id: totrans-2150
  prefs: []
  type: TYPE_NORMAL
  zh: '**</**'
- en: '**dt**'
  id: totrans-2151
  prefs: []
  type: TYPE_NORMAL
  zh: '**dt**'
- en: '**>**'
  id: totrans-2152
  prefs: []
  type: TYPE_NORMAL
  zh: '**>**'
- en: '**<**'
  id: totrans-2153
  prefs: []
  type: TYPE_NORMAL
  zh: '**<**'
- en: '**dd**'
  id: totrans-2154
  prefs: []
  type: TYPE_NORMAL
  zh: '**dd**'
- en: '**>**'
  id: totrans-2155
  prefs: []
  type: TYPE_NORMAL
  zh: '**>**'
- en: '**@Model.Thing.Email**'
  id: totrans-2156
  prefs: []
  type: TYPE_NORMAL
  zh: '**@Model.Thing.Email**'
- en: '**</**'
  id: totrans-2157
  prefs: []
  type: TYPE_NORMAL
  zh: '**</**'
- en: '**dd**'
  id: totrans-2158
  prefs: []
  type: TYPE_NORMAL
  zh: '**dd**'
- en: '**>**'
  id: totrans-2159
  prefs: []
  type: TYPE_NORMAL
  zh: '**>**'
- en: </
  id: totrans-2160
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: dl
  id: totrans-2161
  prefs: []
  type: TYPE_NORMAL
  zh: dl
- en: '>'
  id: totrans-2162
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-2163
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: div
  id: totrans-2164
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-2165
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@if (Model.HasErrors)'
  id: totrans-2166
  prefs: []
  type: TYPE_NORMAL
  zh: '@if (Model.HasErrors)'
- en: '{'
  id: totrans-2167
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: <
  id: totrans-2168
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: div
  id: totrans-2169
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-2170
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@foreach(string errorMessage in Model.ValidationErrors)'
  id: totrans-2171
  prefs: []
  type: TYPE_NORMAL
  zh: '@foreach(string errorMessage in Model.ValidationErrors)'
- en: '{'
  id: totrans-2172
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: <
  id: totrans-2173
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: div
  id: totrans-2174
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: class
  id: totrans-2175
  prefs: []
  type: TYPE_NORMAL
  zh: 类
- en: '='
  id: totrans-2176
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"alert alert-danger"'
  id: totrans-2177
  prefs: []
  type: TYPE_NORMAL
  zh: '"alert alert-danger"'
- en: role
  id: totrans-2178
  prefs: []
  type: TYPE_NORMAL
  zh: 角色
- en: '='
  id: totrans-2179
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"alert"'
  id: totrans-2180
  prefs: []
  type: TYPE_NORMAL
  zh: '"警报"'
- en: '>'
  id: totrans-2181
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@errorMessage</'
  id: totrans-2182
  prefs: []
  type: TYPE_NORMAL
  zh: '@errorMessage</'
- en: div
  id: totrans-2183
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-2184
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '}'
  id: totrans-2185
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: </
  id: totrans-2186
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: div
  id: totrans-2187
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-2188
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '}'
  id: totrans-2189
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '}'
  id: totrans-2190
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '```'
  id: totrans-2191
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Start the website.
  id: totrans-2192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动网站。
- en: On the home page, click **Binding** .
  id: totrans-2193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主页上，单击**绑定**。
- en: Click the **Submit** button and note that `1` , `Red` , and `test@example.com`
    are valid values.
  id: totrans-2194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**提交**按钮，注意`1`，`红色`和`test@example.com`是有效值。
- en: Enter an `Id` of `13` , clear the color textbox, delete the `@` from the email
    address, click the **Submit** button, and note the error messages, as shown in
    *Figure 15.8* :![](img/Image00127.jpg)
  id: totrans-2195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入`Id`为`13`，清除颜色文本框，从电子邮件地址中删除`@`，单击**提交**按钮，并注意错误消息，如*图15.8*所示：![](img/Image00127.jpg)
- en: 'Figure 15.8: The Model Binding Demo page with field validations'
  id: totrans-2196
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.8：具有字段验证的模型绑定演示页面
- en: Close Chrome and shut down the web server.
  id: totrans-2197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭Chrome并关闭Web服务器。
- en: '**Good Practice** : What regular expression does Microsoft use for the implementation
    of the `EmailAddress` validation attribute? Find out at the following link: [https://github.com/microsoft/referencesource/blob/5697c29004a34d80acdaf5742d7e699022c64ecd/System.ComponentModel.DataAnnotations/DataAnnotations/EmailAddressAttribute.cs#L54](https://github.com/microsoft/referencesource/blob/5697c29004a34d80acdaf5742d7e699022c64ecd/System.ComponentModel.DataAnnotations/DataAnnotations/EmailAddressAttribute.cs#L54)'
  id: totrans-2198
  prefs: []
  type: TYPE_NORMAL
  zh: '**良好的做法**：Microsoft在`EmailAddress`验证属性的实现中使用了什么正则表达式？请在以下链接找到：[https://github.com/microsoft/referencesource/blob/5697c29004a34d80acdaf5742d7e699022c64ecd/System.ComponentModel.DataAnnotations/DataAnnotations/EmailAddressAttribute.cs#L54](https://github.com/microsoft/referencesource/blob/5697c29004a34d80acdaf5742d7e699022c64ecd/System.ComponentModel.DataAnnotations/DataAnnotations/EmailAddressAttribute.cs#L54)'
- en: Understanding view helper methods
  id: totrans-2199
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解视图助手方法
- en: While creating a view for ASP.NET Core MVC, you can use the `Html` object and
    its methods to generate markup.
  id: totrans-2200
  prefs: []
  type: TYPE_NORMAL
  zh: 在为ASP.NET Core MVC创建视图时，您可以使用`Html`对象及其方法生成标记。
- en: 'Some useful methods include the following:'
  id: totrans-2201
  prefs: []
  type: TYPE_NORMAL
  zh: 一些有用的方法包括以下内容：
- en: '`ActionLink` : Use this to generate an anchor `<a>` element that contains a
    URL path to the specified controller and action. For example, `Html.ActionLink(linkText:
    "Binding", actionName: "ModelBinding", controllerName: "Home")` would generate
    `<a href="/home/modelbinding">Binding</a>` . You can achieve the same result using
    the anchor tag helper: `<a asp-action="ModelBinding" asp-controller="Home">Binding</a>`
    .'
  id: totrans-2202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ActionLink`：使用此功能生成包含指定控制器和操作的URL路径的锚`<a>`元素。例如，`Html.ActionLink(linkText:
    "Binding", actionName: "ModelBinding", controllerName: "Home")`将生成`<a href="/home/modelbinding">Binding</a>`。您可以使用锚标签助手实现相同的结果：`<a
    asp-action="ModelBinding" asp-controller="Home">Binding</a>`。'
- en: '`AntiForgeryToken` : Use this inside a `<form>` to insert a `<hidden>` element
    containing an anti-forgery token that will be validated when the form is submitted.'
  id: totrans-2203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`AntiForgeryToken`：在`<form>`内使用此功能插入包含防伪标记的`<hidden>`元素，当提交表单时将对其进行验证。'
- en: '`Display` and `DisplayFor` : Use this to generate HTML markup for the expression
    relative to the current model using a display template. There are built-in display
    templates for .NET types and custom templates can be created in the `DisplayTemplates`
    folder. The folder name is case-sensitive on case-sensitive filesystems.'
  id: totrans-2204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Display`和`DisplayFor`：使用此功能为相对于当前模型的表达式生成HTML标记，使用显示模板。 .NET类型和自定义模板有内置的显示模板可以在`DisplayTemplates`文件夹中创建。文件夹名称在区分大小写的文件系统上区分大小写。'
- en: '`DisplayForModel` : Use this to generate HTML markup for an entire model instead
    of a single expression.'
  id: totrans-2205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`DisplayForModel`：使用此功能为整个模型生成HTML标记，而不是单个表达式。'
- en: '`Editor` and `EditorFor` : Use this to generate HTML markup for the expression
    relative to the current model using an editor template. There are built-in editor
    templates for .NET types that use `<label>` and `<input>` elements, and custom
    templates can be created in the `EditorTemplates` folder. The folder name is case-sensitive
    on case-sensitive filesystems.'
  id: totrans-2206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Editor`和`EditorFor`：使用此功能为相对于当前模型的表达式生成HTML标记，使用编辑器模板。 .NET类型有内置的编辑器模板，使用`<label>`和`<input>`元素，自定义模板可以在`EditorTemplates`文件夹中创建。文件夹名称在区分大小写的文件系统上区分大小写。'
- en: '`EditorForModel` : Use this to generate HTML markup for an entire model instead
    of a single expression.'
  id: totrans-2207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`EditorForModel`：使用此功能为整个模型生成HTML标记，而不是单个表达式。'
- en: '`Encode` : Use this to safely encode an object or string into HTML. For example,
    the string value `"<script>"` would be encoded as `"&lt;script&gt;"` . This is
    not normally necessary since the Razor `@` symbol encodes string values by default.'
  id: totrans-2208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Encode`：使用此功能将对象或字符串安全地编码为HTML。例如，字符串值`"<script>"`将被编码为`"&lt;script&gt;"`。这通常是不必要的，因为Razor的`@`符号默认情况下会对字符串值进行编码。'
- en: '`Raw` : Use this to render a string value *without* encoding as HTML.'
  id: totrans-2209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Raw`：使用此功能呈现字符串值*不*编码为HTML。'
- en: '`PartialAsync` and `RenderPartialAsync` : Use these to generate HTML markup
    for a partial view. You can optionally pass a model and view data.'
  id: totrans-2210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`PartialAsync`和`RenderPartialAsync`：使用这些方法为部分视图生成HTML标记。您可以选择传递模型和视图数据。'
- en: 'Let''s see an example:'
  id: totrans-2211
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看一个例子：
- en: In `Views/Home` , open `ModelBinding.cshtml` .
  id: totrans-2212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Views/Home`中，打开`ModelBinding.cshtml`。
- en: 'Modify the rendering of the `Email` property to use `DisplayFor` , as shown
    in the following markup:'
  id: totrans-2213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改`Email`属性的渲染以使用`DisplayFor`，如下所示：
- en: '```cs'
  id: totrans-2214
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: <
  id: totrans-2215
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: dd
  id: totrans-2216
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-2217
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@Html.DisplayFor(model => model.Thing.Email)</'
  id: totrans-2218
  prefs: []
  type: TYPE_NORMAL
  zh: '@Html.DisplayFor（model => model.Thing.Email）</'
- en: dd
  id: totrans-2219
  prefs: []
  type: TYPE_NORMAL
  zh: dd
- en: '>'
  id: totrans-2220
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '```'
  id: totrans-2221
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Start the website.
  id: totrans-2222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动网站。
- en: Click **Binding** .
  id: totrans-2223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**绑定**。
- en: Click **Submit** .
  id: totrans-2224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**提交**。
- en: Note the email address is a clickable hyperlink instead of just text.
  id: totrans-2225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请注意电子邮件地址是可点击的超链接，而不仅仅是文本。
- en: Close Chrome and shut down the web server.
  id: totrans-2226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭Chrome并关闭Web服务器。
- en: In `Models/Thing.cs` , comment out the `[EmailAddress]` attribute above the
    `Email` property.
  id: totrans-2227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Models/Thing.cs`中，注释掉`Email`属性上方的`[EmailAddress]`属性。
- en: Start the website.
  id: totrans-2228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动网站。
- en: Click **Binding** .
  id: totrans-2229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**绑定**。
- en: Click **Submit** .
  id: totrans-2230
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**提交**。
- en: Note the email address is just text.
  id: totrans-2231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请注意电子邮件地址只是文本。
- en: Close Chrome and shut down the web server.
  id: totrans-2232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭Chrome并关闭Web服务器。
- en: In `Models/Thing.cs` , uncomment the `[EmailAddress]` attribute.
  id: totrans-2233
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Models/Thing.cs`中取消注释`[EmailAddress]`属性。
- en: It is the combination of decorating the `Email` property with the `[EmailAddress]`
    validation attribute and rendering it using `DisplayFor` that notifies ASP.NET
    Core to treat the value as an email address and therefore render it as a clickable
    link.
  id: totrans-2234
  prefs: []
  type: TYPE_NORMAL
  zh: 这是将`Email`属性与`[EmailAddress]`验证属性装饰并使用`DisplayFor`渲染它的组合，通知ASP.NET Core将该值视为电子邮件地址，因此将其呈现为可点击链接。
- en: Querying a database and using display templates
  id: totrans-2235
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 查询数据库并使用显示模板
- en: Let's create a new action method that can have a query string parameter passed
    to it and use that to query the Northwind database for products that cost more
    than a specified price.
  id: totrans-2236
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们创建一个新的操作方法，可以将查询字符串参数传递给它，并使用它来查询Northwind数据库中价格高于指定价格的产品。
- en: 'In previous examples, we defined a view model that contained properties for
    every value that needed to be rendered in the view. In this example, there will
    be two values: a list of products and the price the visitor entered. To avoid
    having to define a class or record for the view model, we will pass the list of
    products as the model and store the maximum price in the `ViewData` collection.'
  id: totrans-2237
  prefs: []
  type: TYPE_NORMAL
  zh: 在以前的示例中，我们定义了一个视图模型，其中包含了需要在视图中呈现的每个值的属性。在本例中，将有两个值：产品列表和访客输入的价格。为了避免必须为视图模型定义一个类或记录，我们将产品列表作为模型传递，并将最高价格存储在`ViewData`集合中。
- en: 'Let''s implement this feature:'
  id: totrans-2238
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们实现这个功能：
- en: In `HomeController` , import the `Microsoft.EntityFrameworkCore` namespace.
    We need this to add the `Include` extension method so that we can include related
    entities, as you learned in *Chapter 10* , *Working with Data Using Entity Framework
    Core* .
  id: totrans-2239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`HomeController`中，导入`Microsoft.EntityFrameworkCore`命名空间。我们需要这样做以添加`Include`扩展方法，以便我们可以包含相关实体，正如您在*第10章*，*使用Entity
    Framework Core处理数据*中所学到的那样。
- en: 'Add a new action method, as shown in the following code:'
  id: totrans-2240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据以下代码添加新的操作方法：
- en: '```cs'
  id: totrans-2241
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: public
  id: totrans-2242
  prefs: []
  type: TYPE_NORMAL
  zh: 公共
- en: IActionResult
  id: totrans-2243
  prefs: []
  type: TYPE_NORMAL
  zh: IActionResult
- en: ProductsThatCostMoreThan
  id: totrans-2244
  prefs: []
  type: TYPE_NORMAL
  zh: ProductsThatCostMoreThan
- en: (
  id: totrans-2245
  prefs: []
  type: TYPE_NORMAL
  zh: （
- en: decimal
  id: totrans-2246
  prefs: []
  type: TYPE_NORMAL
  zh: decimal
- en: '? price'
  id: totrans-2247
  prefs: []
  type: TYPE_NORMAL
  zh: ？价格
- en: )
  id: totrans-2248
  prefs: []
  type: TYPE_NORMAL
  zh: ）
- en: '{'
  id: totrans-2249
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: if
  id: totrans-2250
  prefs: []
  type: TYPE_NORMAL
  zh: 如果
- en: (!price.HasValue)
  id: totrans-2251
  prefs: []
  type: TYPE_NORMAL
  zh: （！price.HasValue）
- en: '{'
  id: totrans-2252
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: return
  id: totrans-2253
  prefs: []
  type: TYPE_NORMAL
  zh: 返回
- en: BadRequest("You must pass a product price in the query string, for example,
    /Home/ProductsThatCostMoreThan?price=50"
  id: totrans-2254
  prefs: []
  type: TYPE_NORMAL
  zh: BadRequest（“您必须在查询字符串中传递产品价格，例如，/Home/ProductsThatCostMoreThan？price=50”
- en: );
  id: totrans-2255
  prefs: []
  type: TYPE_NORMAL
  zh: ）；
- en: '}'
  id: totrans-2256
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: IEnumerable<Product> model = db.Products
  id: totrans-2257
  prefs: []
  type: TYPE_NORMAL
  zh: IEnumerable<Product> model = db.Products
- en: .Include(p => p.Category)
  id: totrans-2258
  prefs: []
  type: TYPE_NORMAL
  zh: .Include（p => p.Category）
- en: .Include(p => p.Supplier)
  id: totrans-2259
  prefs: []
  type: TYPE_NORMAL
  zh: .Include（p => p.Supplier）
- en: .Where(p => p.UnitPrice > price);
  id: totrans-2260
  prefs: []
  type: TYPE_NORMAL
  zh: .Where(p => p.UnitPrice > price);
- en: if
  id: totrans-2261
  prefs: []
  type: TYPE_NORMAL
  zh: 如果
- en: (!model.Any())
  id: totrans-2262
  prefs: []
  type: TYPE_NORMAL
  zh: （！model.Any（））
- en: '{'
  id: totrans-2263
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: return
  id: totrans-2264
  prefs: []
  type: TYPE_NORMAL
  zh: 返回
- en: NotFound(
  id: totrans-2265
  prefs: []
  type: TYPE_NORMAL
  zh: 未找到（
- en: $"No products cost more than
  id: totrans-2266
  prefs: []
  type: TYPE_NORMAL
  zh: “没有产品的成本超过
- en: '{price:C}'
  id: totrans-2267
  prefs: []
  type: TYPE_NORMAL
  zh: '{price:C}'
- en: ."
  id: totrans-2268
  prefs: []
  type: TYPE_NORMAL
  zh: 。”
- en: );
  id: totrans-2269
  prefs: []
  type: TYPE_NORMAL
  zh: ）；
- en: '}'
  id: totrans-2270
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: ViewData["MaxPrice"
  id: totrans-2271
  prefs: []
  type: TYPE_NORMAL
  zh: ViewData[“MaxPrice”
- en: '] = price.Value.ToString("C"'
  id: totrans-2272
  prefs: []
  type: TYPE_NORMAL
  zh: '] = price.Value.ToString（“C”'
- en: );
  id: totrans-2273
  prefs: []
  type: TYPE_NORMAL
  zh: ）；
- en: return
  id: totrans-2274
  prefs: []
  type: TYPE_NORMAL
  zh: 返回
- en: View(model); // pass model to view
  id: totrans-2275
  prefs: []
  type: TYPE_NORMAL
  zh: 视图（模型）；//将模型传递给视图
- en: '}'
  id: totrans-2276
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '```'
  id: totrans-2277
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: In the `Views/Home` folder, add a new file named `ProductsThatCostMoreThan.cshtml`
    .
  id: totrans-2278
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Views/Home`文件夹中，添加名为`ProductsThatCostMoreThan.cshtml`的新文件。
- en: 'Modify the contents, as shown in the following code:'
  id: totrans-2279
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据以下代码修改内容：
- en: '```cs'
  id: totrans-2280
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: '@using Packt.Shared'
  id: totrans-2281
  prefs: []
  type: TYPE_NORMAL
  zh: '@using Packt.Shared'
- en: '@model IEnumerable<'
  id: totrans-2282
  prefs: []
  type: TYPE_NORMAL
  zh: '@model IEnumerable<'
- en: Product
  id: totrans-2283
  prefs: []
  type: TYPE_NORMAL
  zh: 产品
- en: '>'
  id: totrans-2284
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@{'
  id: totrans-2285
  prefs: []
  type: TYPE_NORMAL
  zh: '@{'
- en: string
  id: totrans-2286
  prefs: []
  type: TYPE_NORMAL
  zh: 字符串
- en: title =
  id: totrans-2287
  prefs: []
  type: TYPE_NORMAL
  zh: 标题=
- en: '"Products That Cost More Than "'
  id: totrans-2288
  prefs: []
  type: TYPE_NORMAL
  zh: “成本超过的产品”
- en: + ViewData["MaxPrice"
  id: totrans-2289
  prefs: []
  type: TYPE_NORMAL
  zh: + ViewData[“MaxPrice”
- en: '];'
  id: totrans-2290
  prefs: []
  type: TYPE_NORMAL
  zh: '];'
- en: ViewData["Title"
  id: totrans-2291
  prefs: []
  type: TYPE_NORMAL
  zh: ViewData[“Title”
- en: '] = title;'
  id: totrans-2292
  prefs: []
  type: TYPE_NORMAL
  zh: '] =标题；'
- en: '}'
  id: totrans-2293
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: <
  id: totrans-2294
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: h2
  id: totrans-2295
  prefs: []
  type: TYPE_NORMAL
  zh: h2
- en: '>'
  id: totrans-2296
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@title</'
  id: totrans-2297
  prefs: []
  type: TYPE_NORMAL
  zh: '@title</'
- en: h2
  id: totrans-2298
  prefs: []
  type: TYPE_NORMAL
  zh: h2
- en: '>'
  id: totrans-2299
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@if (Model is null)'
  id: totrans-2300
  prefs: []
  type: TYPE_NORMAL
  zh: '@if（模型为空）'
- en: '{'
  id: totrans-2301
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: <
  id: totrans-2302
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: div
  id: totrans-2303
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-2304
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: No products found.</
  id: totrans-2305
  prefs: []
  type: TYPE_NORMAL
  zh: 未找到产品。</
- en: div
  id: totrans-2306
  prefs: []
  type: TYPE_NORMAL
  zh: div
- en: '>'
  id: totrans-2307
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '}'
  id: totrans-2308
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: else
  id: totrans-2309
  prefs: []
  type: TYPE_NORMAL
  zh: 否则
- en: '{'
  id: totrans-2310
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: <
  id: totrans-2311
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: table
  id: totrans-2312
  prefs: []
  type: TYPE_NORMAL
  zh: 表
- en: class
  id: totrans-2313
  prefs: []
  type: TYPE_NORMAL
  zh: 类
- en: '='
  id: totrans-2314
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"table"'
  id: totrans-2315
  prefs: []
  type: TYPE_NORMAL
  zh: “表”
- en: '>'
  id: totrans-2316
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2317
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: thead
  id: totrans-2318
  prefs: []
  type: TYPE_NORMAL
  zh: 标题
- en: '>'
  id: totrans-2319
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2320
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: tr
  id: totrans-2321
  prefs: []
  type: TYPE_NORMAL
  zh: tr
- en: '>'
  id: totrans-2322
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2323
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: th
  id: totrans-2324
  prefs: []
  type: TYPE_NORMAL
  zh: th
- en: '>'
  id: totrans-2325
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Category Name</
  id: totrans-2326
  prefs: []
  type: TYPE_NORMAL
  zh: 类别名称</
- en: th
  id: totrans-2327
  prefs: []
  type: TYPE_NORMAL
  zh: th
- en: '>'
  id: totrans-2328
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2329
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: th
  id: totrans-2330
  prefs: []
  type: TYPE_NORMAL
  zh: th
- en: '>'
  id: totrans-2331
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Supplier's Company Name</
  id: totrans-2332
  prefs: []
  type: TYPE_NORMAL
  zh: 供应商的公司名称</
- en: th
  id: totrans-2333
  prefs: []
  type: TYPE_NORMAL
  zh: th
- en: '>'
  id: totrans-2334
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2335
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: th
  id: totrans-2336
  prefs: []
  type: TYPE_NORMAL
  zh: th
- en: '>'
  id: totrans-2337
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Product Name</
  id: totrans-2338
  prefs: []
  type: TYPE_NORMAL
  zh: 产品名称</
- en: th
  id: totrans-2339
  prefs: []
  type: TYPE_NORMAL
  zh: th
- en: '>'
  id: totrans-2340
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2341
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: th
  id: totrans-2342
  prefs: []
  type: TYPE_NORMAL
  zh: th
- en: '>'
  id: totrans-2343
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Unit Price</
  id: totrans-2344
  prefs: []
  type: TYPE_NORMAL
  zh: 单价</
- en: th
  id: totrans-2345
  prefs: []
  type: TYPE_NORMAL
  zh: th
- en: '>'
  id: totrans-2346
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2347
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: th
  id: totrans-2348
  prefs: []
  type: TYPE_NORMAL
  zh: th
- en: '>'
  id: totrans-2349
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Units In Stock</
  id: totrans-2350
  prefs: []
  type: TYPE_NORMAL
  zh: 库存单位</
- en: th
  id: totrans-2351
  prefs: []
  type: TYPE_NORMAL
  zh: th
- en: '>'
  id: totrans-2352
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-2353
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: tr
  id: totrans-2354
  prefs: []
  type: TYPE_NORMAL
  zh: tr
- en: '>'
  id: totrans-2355
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-2356
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: thead
  id: totrans-2357
  prefs: []
  type: TYPE_NORMAL
  zh: 标题
- en: '>'
  id: totrans-2358
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2359
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: tbody
  id: totrans-2360
  prefs: []
  type: TYPE_NORMAL
  zh: tbody
- en: '>'
  id: totrans-2361
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@foreach (Product p in Model)'
  id: totrans-2362
  prefs: []
  type: TYPE_NORMAL
  zh: '@foreach（Product p in Model）'
- en: '{'
  id: totrans-2363
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: <
  id: totrans-2364
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: tr
  id: totrans-2365
  prefs: []
  type: TYPE_NORMAL
  zh: tr
- en: '>'
  id: totrans-2366
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2367
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: td
  id: totrans-2368
  prefs: []
  type: TYPE_NORMAL
  zh: td
- en: '>'
  id: totrans-2369
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@Html.DisplayFor(modelItem => p.Category.CategoryName)'
  id: totrans-2370
  prefs: []
  type: TYPE_NORMAL
  zh: '@Html.DisplayFor（modelItem => p.Category.CategoryName）'
- en: </
  id: totrans-2371
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: td
  id: totrans-2372
  prefs: []
  type: TYPE_NORMAL
  zh: td
- en: '>'
  id: totrans-2373
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2374
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: td
  id: totrans-2375
  prefs: []
  type: TYPE_NORMAL
  zh: td
- en: '>'
  id: totrans-2376
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@Html.DisplayFor(modelItem => p.Supplier.CompanyName)'
  id: totrans-2377
  prefs: []
  type: TYPE_NORMAL
  zh: '@Html.DisplayFor（modelItem => p.Supplier.CompanyName）'
- en: </
  id: totrans-2378
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: td
  id: totrans-2379
  prefs: []
  type: TYPE_NORMAL
  zh: td
- en: '>'
  id: totrans-2380
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2381
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: td
  id: totrans-2382
  prefs: []
  type: TYPE_NORMAL
  zh: td
- en: '>'
  id: totrans-2383
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@Html.DisplayFor(modelItem => p.ProductName)'
  id: totrans-2384
  prefs: []
  type: TYPE_NORMAL
  zh: '@Html.DisplayFor（modelItem => p.ProductName）'
- en: </
  id: totrans-2385
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: td
  id: totrans-2386
  prefs: []
  type: TYPE_NORMAL
  zh: td
- en: '>'
  id: totrans-2387
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2388
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: td
  id: totrans-2389
  prefs: []
  type: TYPE_NORMAL
  zh: td
- en: '>'
  id: totrans-2390
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@Html.DisplayFor(modelItem => p.UnitPrice)'
  id: totrans-2391
  prefs: []
  type: TYPE_NORMAL
  zh: '@Html.DisplayFor（modelItem => p.UnitPrice）'
- en: </
  id: totrans-2392
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: td
  id: totrans-2393
  prefs: []
  type: TYPE_NORMAL
  zh: td
- en: '>'
  id: totrans-2394
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2395
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: td
  id: totrans-2396
  prefs: []
  type: TYPE_NORMAL
  zh: td
- en: '>'
  id: totrans-2397
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '@Html.DisplayFor(modelItem => p.UnitsInStock)'
  id: totrans-2398
  prefs: []
  type: TYPE_NORMAL
  zh: '@Html.DisplayFor（modelItem => p.UnitsInStock）'
- en: </
  id: totrans-2399
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: td
  id: totrans-2400
  prefs: []
  type: TYPE_NORMAL
  zh: td
- en: '>'
  id: totrans-2401
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-2402
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: tr
  id: totrans-2403
  prefs: []
  type: TYPE_NORMAL
  zh: tr
- en: '>'
  id: totrans-2404
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '}'
  id: totrans-2405
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: <
  id: totrans-2406
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: tbody
  id: totrans-2407
  prefs: []
  type: TYPE_NORMAL
  zh: tbody
- en: '>'
  id: totrans-2408
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: </
  id: totrans-2409
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: table
  id: totrans-2410
  prefs: []
  type: TYPE_NORMAL
  zh: 表
- en: '>'
  id: totrans-2411
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '}'
  id: totrans-2412
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '```'
  id: totrans-2413
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: In the `Views/Home` folder, open `Index.cshtml` .
  id: totrans-2414
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Views/Home`文件夹中，打开`Index.cshtml`。
- en: 'Add the following form element below the visitor count and above the **Products**
    heading and its listing of products. This will provide a form for the user to
    enter a price. The user can then click **Submit** to call the action method that
    shows only products that cost more than the entered price:'
  id: totrans-2415
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在访客计数下方和**产品**标题上方添加以下表单元素。这将为用户提供一个输入价格的表单。然后用户可以单击**提交**来调用仅显示高于输入价格的产品的操作方法：
- en: '```cs'
  id: totrans-2416
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: <
  id: totrans-2417
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: h3
  id: totrans-2418
  prefs: []
  type: TYPE_NORMAL
  zh: h3
- en: '>'
  id: totrans-2419
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: Query products by price</
  id: totrans-2420
  prefs: []
  type: TYPE_NORMAL
  zh: 按价格查询产品</
- en: h3
  id: totrans-2421
  prefs: []
  type: TYPE_NORMAL
  zh: h3
- en: '>'
  id: totrans-2422
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2423
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: form
  id: totrans-2424
  prefs: []
  type: TYPE_NORMAL
  zh: 形式
- en: asp-action
  id: totrans-2425
  prefs: []
  type: TYPE_NORMAL
  zh: asp-action
- en: '='
  id: totrans-2426
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"ProductsThatCostMoreThan"'
  id: totrans-2427
  prefs: []
  type: TYPE_NORMAL
  zh: “成本超过的产品”
- en: method
  id: totrans-2428
  prefs: []
  type: TYPE_NORMAL
  zh: 方法
- en: '='
  id: totrans-2429
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"GET"'
  id: totrans-2430
  prefs: []
  type: TYPE_NORMAL
  zh: “GET”
- en: '>'
  id: totrans-2431
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: <
  id: totrans-2432
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: input
  id: totrans-2433
  prefs: []
  type: TYPE_NORMAL
  zh: 输入
- en: name
  id: totrans-2434
  prefs: []
  type: TYPE_NORMAL
  zh: 名称
- en: '='
  id: totrans-2435
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"price"'
  id: totrans-2436
  prefs: []
  type: TYPE_NORMAL
  zh: “价格”
- en: placeholder
  id: totrans-2437
  prefs: []
  type: TYPE_NORMAL
  zh: 占位符
- en: '='
  id: totrans-2438
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"Enter a product price"'
  id: totrans-2439
  prefs: []
  type: TYPE_NORMAL
  zh: “输入产品价格”
- en: />
  id: totrans-2440
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: <
  id: totrans-2441
  prefs: []
  type: TYPE_NORMAL
  zh: <
- en: input
  id: totrans-2442
  prefs: []
  type: TYPE_NORMAL
  zh: 输入
- en: type
  id: totrans-2443
  prefs: []
  type: TYPE_NORMAL
  zh: 类型
- en: '='
  id: totrans-2444
  prefs: []
  type: TYPE_NORMAL
  zh: '='
- en: '"submit"'
  id: totrans-2445
  prefs: []
  type: TYPE_NORMAL
  zh: “提交”
- en: />
  id: totrans-2446
  prefs: []
  type: TYPE_NORMAL
  zh: />
- en: </
  id: totrans-2447
  prefs: []
  type: TYPE_NORMAL
  zh: </
- en: form
  id: totrans-2448
  prefs: []
  type: TYPE_NORMAL
  zh: 形式
- en: '>'
  id: totrans-2449
  prefs: []
  type: TYPE_NORMAL
  zh: '>'
- en: '```'
  id: totrans-2450
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Start the website.
  id: totrans-2451
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动网站。
- en: On the home page, enter a price in the form, for example, `50` , and then click
    on **Submit** .
  id: totrans-2452
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主页上，在表单中输入一个价格，例如`50`，然后单击**提交**。
- en: Note the table of the products that cost more than the price that you entered,
    as shown in *Figure 15.9* :![](img/Image00128.jpg)
  id: totrans-2453
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注意输入的价格高于您输入的价格的产品的表格，如*图15.9*所示：！[](img/Image00128.jpg)
- en: 'Figure 15.9: A filtered list of products that cost more than £50'
  id: totrans-2454
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.9：成本超过50英镑的产品的过滤列表
- en: Close Chrome and shut down the web server.
  id: totrans-2455
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭Chrome并关闭Web服务器。
- en: Improving scalability using asynchronous tasks
  id: totrans-2456
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用异步任务提高可伸缩性
- en: When building a desktop or mobile app, multiple tasks (and their underlying
    threads) can be used to improve responsiveness, because while one thread is busy
    with the task, another can handle interactions with the user.
  id: totrans-2457
  prefs: []
  type: TYPE_NORMAL
  zh: 构建桌面或移动应用程序时，可以使用多个任务（及其基础线程）来提高响应性，因为当一个线程忙于任务时，另一个可以处理与用户的交互。
- en: Tasks and their threads can be useful on the server side too, especially with
    websites that work with files, or request data from a store or a web service that
    could take a while to respond. But they are detrimental to complex calculations
    that are CPU-bound, so leave these to be processed synchronously as normal.
  id: totrans-2458
  prefs: []
  type: TYPE_NORMAL
  zh: 任务及其线程在服务器端也可以很有用，特别是对于需要处理文件的网站，或者从商店或Web服务请求数据可能需要一段时间来响应。但它们对于CPU密集型的复杂计算是有害的，因此将这些留给正常的同步处理。
- en: When an HTTP request arrives at the web server, a thread from its pool is allocated
    to handle the request. But if that thread must wait for a resource, then it is
    blocked from handling any more incoming requests. If a website receives more simultaneous
    requests than it has threads in its pool, then some of those requests will respond
    with a server timeout error, **503 Service Unavailable** .
  id: totrans-2459
  prefs: []
  type: TYPE_NORMAL
  zh: 当HTTP请求到达Web服务器时，将从其池中分配一个线程来处理该请求。但是，如果该线程必须等待资源，那么它将被阻止处理更多的传入请求。如果网站接收的同时请求多于其池中的线程，则其中一些请求将响应服务器超时错误，**503服务不可用**。
- en: The threads that are locked are not doing useful work. They *could* handle one
    of those other requests but only if we implement asynchronous code in our websites.
  id: totrans-2460
  prefs: []
  type: TYPE_NORMAL
  zh: 被锁定的线程没有做有用的工作。 *可以*处理其他请求中的一个，但前提是我们在网站中实现了异步代码。
- en: Whenever a thread is waiting for a resource it needs, it can return to the thread
    pool and handle a different incoming request, improving the scalability of the
    website, that is, increasing the number of simultaneous requests it can handle.
  id: totrans-2461
  prefs: []
  type: TYPE_NORMAL
  zh: 每当一个线程在等待它需要的资源时，它可以返回到线程池并处理不同的传入请求，从而提高网站的可伸缩性，即增加它可以处理的同时请求的数量。
- en: Why not just have a larger thread pool? In modern operating systems, every thread
    in the pool has a 1 MB stack. An asynchronous method uses a smaller amount of
    memory. It also removes the need to create new threads in the pool, which takes
    time. The rate at which new threads are added to the pool is typically one every
    two seconds, which is a loooooong time compared to switching between asynchronous
    threads.
  id: totrans-2462
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么不只是有一个更大的线程池？在现代操作系统中，池中的每个线程都有1 MB的堆栈。异步方法使用较小的内存量。它还消除了在池中创建新线程的需要，这需要时间。向池中添加新线程的速率通常是每两秒一个，与切换异步线程相比，这是一个很长的时间。
- en: '**Good Practice** : Make your controller action methods asynchronous.'
  id: totrans-2463
  prefs: []
  type: TYPE_NORMAL
  zh: '**良好实践**：使您的控制器操作方法异步化。'
- en: Making controller action methods asynchronous
  id: totrans-2464
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使控制器操作方法异步化
- en: 'It is easy to make an existing action method asynchronous:'
  id: totrans-2465
  prefs: []
  type: TYPE_NORMAL
  zh: 现有操作方法异步化很容易：
- en: 'Modify the `Index` action method to be asynchronous, to return a task, and
    to await the calls to asynchronous methods to get the categories and products,
    as shown highlighted in the following code:'
  id: totrans-2466
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改`Index`操作方法为异步，返回一个任务，并等待异步方法调用以获取类别和产品，如下面的代码中所示：
- en: '```cs'
  id: totrans-2467
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: public
  id: totrans-2468
  prefs: []
  type: TYPE_NORMAL
  zh: 公共
- en: '**async**'
  id: totrans-2469
  prefs: []
  type: TYPE_NORMAL
  zh: '**异步**'
- en: '**Task<IActionResult>**'
  id: totrans-2470
  prefs: []
  type: TYPE_NORMAL
  zh: '**任务<IActionResult>**'
- en: Index
  id: totrans-2471
  prefs: []
  type: TYPE_NORMAL
  zh: 索引
- en: ()
  id: totrans-2472
  prefs: []
  type: TYPE_NORMAL
  zh: （）
- en: '{'
  id: totrans-2473
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: HomeIndexViewModel model = new
  id: totrans-2474
  prefs: []
  type: TYPE_NORMAL
  zh: HomeIndexViewModel model = new
- en: (
  id: totrans-2475
  prefs: []
  type: TYPE_NORMAL
  zh: （
- en: VisitorCount = (new
  id: totrans-2476
  prefs: []
  type: TYPE_NORMAL
  zh: 访客计数=（新的
- en: Random()).Next(1
  id: totrans-2477
  prefs: []
  type: TYPE_NORMAL
  zh: Random（）。下一个（1
- en: ', 1001'
  id: totrans-2478
  prefs: []
  type: TYPE_NORMAL
  zh: ，1001
- en: ),
  id: totrans-2479
  prefs: []
  type: TYPE_NORMAL
  zh: ），
- en: Categories =
  id: totrans-2480
  prefs: []
  type: TYPE_NORMAL
  zh: 类别=
- en: '**await**'
  id: totrans-2481
  prefs: []
  type: TYPE_NORMAL
  zh: '**等待**'
- en: db.Categories.ToList
  id: totrans-2482
  prefs: []
  type: TYPE_NORMAL
  zh: db.Categories.ToList
- en: '**Async**'
  id: totrans-2483
  prefs: []
  type: TYPE_NORMAL
  zh: '**异步**'
- en: (),
  id: totrans-2484
  prefs: []
  type: TYPE_NORMAL
  zh: （），
- en: Products =
  id: totrans-2485
  prefs: []
  type: TYPE_NORMAL
  zh: 产品=
- en: '**await**'
  id: totrans-2486
  prefs: []
  type: TYPE_NORMAL
  zh: '**等待**'
- en: db.Products.ToList
  id: totrans-2487
  prefs: []
  type: TYPE_NORMAL
  zh: db.Products.ToList
- en: '**Async**'
  id: totrans-2488
  prefs: []
  type: TYPE_NORMAL
  zh: '**异步**'
- en: ()
  id: totrans-2489
  prefs: []
  type: TYPE_NORMAL
  zh: （）
- en: );
  id: totrans-2490
  prefs: []
  type: TYPE_NORMAL
  zh: ）;
- en: return
  id: totrans-2491
  prefs: []
  type: TYPE_NORMAL
  zh: 返回
- en: View(model); // pass model to view
  id: totrans-2492
  prefs: []
  type: TYPE_NORMAL
  zh: View（model）; //将模型传递给视图
- en: '}'
  id: totrans-2493
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '```'
  id: totrans-2494
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: 'Modify the `ProductDetail` action method in a similar way, as shown highlighted
    in the following code:'
  id: totrans-2495
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以类似的方式修改`ProductDetail`操作方法，如下面代码中所示：
- en: '```cs'
  id: totrans-2496
  prefs: []
  type: TYPE_NORMAL
  zh: '```cs'
- en: public
  id: totrans-2497
  prefs: []
  type: TYPE_NORMAL
  zh: 公共
- en: '**async**'
  id: totrans-2498
  prefs: []
  type: TYPE_NORMAL
  zh: '**异步**'
- en: '**Task<IActionResult>**'
  id: totrans-2499
  prefs: []
  type: TYPE_NORMAL
  zh: '**任务<IActionResult>**'
- en: ProductDetail
  id: totrans-2500
  prefs: []
  type: TYPE_NORMAL
  zh: 产品详情
- en: (
  id: totrans-2501
  prefs: []
  type: TYPE_NORMAL
  zh: （
- en: int
  id: totrans-2502
  prefs: []
  type: TYPE_NORMAL
  zh: int
- en: '? id'
  id: totrans-2503
  prefs: []
  type: TYPE_NORMAL
  zh: ？id
- en: )
  id: totrans-2504
  prefs: []
  type: TYPE_NORMAL
  zh: ）
- en: '{'
  id: totrans-2505
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: if
  id: totrans-2506
  prefs: []
  type: TYPE_NORMAL
  zh: 如果
- en: (!id.HasValue)
  id: totrans-2507
  prefs: []
  type: TYPE_NORMAL
  zh: （！id.HasValue）
- en: '{'
  id: totrans-2508
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: return
  id: totrans-2509
  prefs: []
  type: TYPE_NORMAL
  zh: 返回
- en: BadRequest("You must pass a product ID in the route, for example,
  id: totrans-2510
  prefs: []
  type: TYPE_NORMAL
  zh: BadRequest（“您必须在路由中传递产品ID，例如，
- en: /Home/ProductDetail/21"
  id: totrans-2511
  prefs: []
  type: TYPE_NORMAL
  zh: /Home/ProductDetail/21"
- en: );
  id: totrans-2512
  prefs: []
  type: TYPE_NORMAL
  zh: ）;
- en: '}'
  id: totrans-2513
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: Product? model =
  id: totrans-2514
  prefs: []
  type: TYPE_NORMAL
  zh: 产品？模型=
- en: '**await**'
  id: totrans-2515
  prefs: []
  type: TYPE_NORMAL
  zh: '**等待**'
- en: db.Products
  id: totrans-2516
  prefs: []
  type: TYPE_NORMAL
  zh: db.Products
- en: .SingleOrDefault
  id: totrans-2517
  prefs: []
  type: TYPE_NORMAL
  zh: .SingleOrDefault
- en: '**Async**'
  id: totrans-2518
  prefs: []
  type: TYPE_NORMAL
  zh: '**异步**'
- en: (p => p.ProductId == id);
  id: totrans-2519
  prefs: []
  type: TYPE_NORMAL
  zh: （p => p.ProductId == id);
- en: if
  id: totrans-2520
  prefs: []
  type: TYPE_NORMAL
  zh: 如果
- en: (model == null
  id: totrans-2521
  prefs: []
  type: TYPE_NORMAL
  zh: （模型== null
- en: )
  id: totrans-2522
  prefs: []
  type: TYPE_NORMAL
  zh: ）
- en: '{'
  id: totrans-2523
  prefs: []
  type: TYPE_NORMAL
  zh: '{'
- en: return
  id: totrans-2524
  prefs: []
  type: TYPE_NORMAL
  zh: 返回
- en: NotFound($"ProductId
  id: totrans-2525
  prefs: []
  type: TYPE_NORMAL
  zh: 未找到（“ProductId
- en: '{id}'
  id: totrans-2526
  prefs: []
  type: TYPE_NORMAL
  zh: '{id}'
- en: not found."
  id: totrans-2527
  prefs: []
  type: TYPE_NORMAL
  zh: 未找到。”
- en: );
  id: totrans-2528
  prefs: []
  type: TYPE_NORMAL
  zh: ）;
- en: '}'
  id: totrans-2529
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: return
  id: totrans-2530
  prefs: []
  type: TYPE_NORMAL
  zh: 返回
- en: View(model); // pass model to view and then return result
  id: totrans-2531
  prefs: []
  type: TYPE_NORMAL
  zh: View（model）; //将模型传递给视图，然后返回结果
- en: '}'
  id: totrans-2532
  prefs: []
  type: TYPE_NORMAL
  zh: '}'
- en: '```'
  id: totrans-2533
  prefs: []
  type: TYPE_NORMAL
  zh: '```'
- en: Start the website and note that the functionality of the website is the same,
    but trust that it will now scale better.
  id: totrans-2534
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动网站并注意网站的功能相同，但相信现在它将更好地扩展。
- en: Close Chrome and shut down the web server.
  id: totrans-2535
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭Chrome并关闭Web服务器。
- en: Practicing and exploring
  id: totrans-2536
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 练习和探索
- en: Test your knowledge and understanding by answering some questions, get some
    hands-on practice, and explore this chapter's topics with deeper research.
  id: totrans-2537
  prefs: []
  type: TYPE_NORMAL
  zh: 通过回答一些问题来测试您的知识和理解，进行一些实践，并通过更深入的研究来探索本章的主题。
- en: Exercise 15.1 – Test your knowledge
  id: totrans-2538
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习15.1-测试您的知识
- en: 'Answer the following questions:'
  id: totrans-2539
  prefs: []
  type: TYPE_NORMAL
  zh: 回答以下问题：
- en: What do the files with the special names `_ViewStart` and `_ViewImports` do
    when created in the `Views` folder?
  id: totrans-2540
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`Views`文件夹中创建具有特殊名称`_ViewStart`和`_ViewImports`的文件时，它们会做什么？
- en: What are the names of the three segments defined in the default ASP.NET Core
    MVC route, what do they represent, and which are optional?
  id: totrans-2541
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 默认的ASP.NET Core MVC路由中定义了三个段的名称是什么，它们代表什么，哪些是可选的？
- en: What does the default model binder do, and what data types can it handle?
  id: totrans-2542
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 默认的模型绑定器是做什么的，它可以处理哪些数据类型？
- en: In a shared layout file like `_Layout.cshtml` , how do you output the content
    of the current view?
  id: totrans-2543
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在像`_Layout.cshtml` 这样的共享布局文件中，如何输出当前视图的内容？
- en: In a shared layout file like `_Layout.cshtml` , how do you output a section
    that the current view can supply content for, and how does the view supply the
    contents for that section?
  id: totrans-2544
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在像`_Layout.cshtml` 这样的共享布局文件中，如何输出当前视图可以提供内容的部分，视图如何提供该部分的内容？
- en: When calling the `View` method inside a controller's action method, what paths
    are searched for the view by convention?
  id: totrans-2545
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在控制器的操作方法中调用`View`方法时，按照惯例会搜索哪些路径来查找视图？
- en: How can you instruct the visitor's browser to cache the response for 24 hours?
  id: totrans-2546
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如何指示访问者的浏览器将响应缓存24小时？
- en: Why might you enable Razor Pages even if you are not creating any yourself?
  id: totrans-2547
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 即使您不创建Razor页面，为什么可能要启用Razor页面？
- en: How does ASP.NET Core MVC identify classes that can act as controllers?
  id: totrans-2548
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ASP.NET Core MVC如何识别可以充当控制器的类？
- en: In what ways does ASP.NET Core MVC make it easier to test a website?
  id: totrans-2549
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ASP.NET Core MVC有哪些方面使得网站测试更容易？
- en: Exercise 15.2 – Practice implementing MVC by implementing a category detail
    page
  id: totrans-2550
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习15.2 – 通过实现类别详细页面来实现MVC的练习
- en: 'The `Northwind.Mvc` project has a home page that shows categories, but when
    the `View` button is clicked, the website returns a `404 Not Found` error, for
    example, for the following URL:'
  id: totrans-2551
  prefs: []
  type: TYPE_NORMAL
  zh: '`Northwind.Mvc` 项目有一个显示类别的主页，但当单击`View`按钮时，网站返回`404 Not Found`错误，例如以下URL：'
- en: '`https://localhost:5001/category/1`'
  id: totrans-2552
  prefs: []
  type: TYPE_NORMAL
  zh: '`https://localhost:5001/category/1`'
- en: Extend the `Northwind.Mvc` project by adding the ability to show a detail page
    for a category.
  id: totrans-2553
  prefs: []
  type: TYPE_NORMAL
  zh: 通过添加显示类别详细信息页面的功能来扩展`Northwind.Mvc`项目。
- en: Exercise 15.3 – Practice improving scalability by understanding and implementing
    async action methods
  id: totrans-2554
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习15.3 – 通过理解和实现异步操作方法来练习提高可伸缩性
- en: A few years ago, Stephen Cleary wrote an excellent article for MSDN Magazine
    explaining the scalability benefits of implementing async action methods for ASP.NET.
    The same principles apply to ASP.NET Core, but even more so, because unlike the
    old ASP.NET as described in the article, ASP.NET Core supports asynchronous filters
    and other components.
  id: totrans-2555
  prefs: []
  type: TYPE_NORMAL
  zh: 几年前，Stephen Cleary在MSDN杂志上撰写了一篇关于实现ASP.NET异步操作方法的可伸缩性好处的优秀文章。相同的原则适用于ASP.NET
    Core，但更甚，因为与文章中描述的旧ASP.NET不同，ASP.NET Core支持异步过滤器和其他组件。
- en: 'Read the article at the following link:'
  id: totrans-2556
  prefs: []
  type: TYPE_NORMAL
  zh: 阅读以下链接中的文章：
- en: '[https://docs.microsoft.com/en-us/archive/msdn-magazine/2014/october/async-programming-introduction-to-async-await-on-asp-net](https://docs.microsoft.com/en-us/archive/msdn-magazine/2014/october/async-programming-introduction-to-async-await-on-asp-net)'
  id: totrans-2557
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://docs.microsoft.com/en-us/archive/msdn-magazine/2014/october/async-programming-introduction-to-async-await-on-asp-net](https://docs.microsoft.com/en-us/archive/msdn-magazine/2014/october/async-programming-introduction-to-async-await-on-asp-net)'
- en: Exercise 15.4 – Practice unit testing MVC controllers
  id: totrans-2558
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习15.4 – 练习单元测试MVC控制器
- en: Controllers are where the business logic of your website runs, so it is important
    to test the correctness of that logic using unit tests, as you learned in *Chapter
    4* , *Writing, Debugging, and Testing Functions* .
  id: totrans-2559
  prefs: []
  type: TYPE_NORMAL
  zh: 控制器是网站业务逻辑运行的地方，因此通过单元测试测试该逻辑的正确性非常重要，就像您在*第4章*，*编写、调试和测试函数*中学到的那样。
- en: Write some unit tests for `HomeController` .
  id: totrans-2560
  prefs: []
  type: TYPE_NORMAL
  zh: 为`HomeController`编写一些单元测试。
- en: '**Good Practice** : You can read more about how to unit test controllers at
    the following link: [https://docs.microsoft.com/en-us/aspnet/core/mvc/controllers/testing](https://docs.microsoft.com/en-us/aspnet/core/mvc/controllers/testing)'
  id: totrans-2561
  prefs: []
  type: TYPE_NORMAL
  zh: '**良好实践**：您可以在以下链接中阅读有关如何对控制器进行单元测试的更多信息：[https://docs.microsoft.com/en-us/aspnet/core/mvc/controllers/testing](https://docs.microsoft.com/en-us/aspnet/core/mvc/controllers/testing)'
- en: Exercise 15.5 – Explore topics
  id: totrans-2562
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 练习15.5 – 探索主题
- en: 'Use the links on the following page to learn more about the topics covered
    in this chapter:'
  id: totrans-2563
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下页面上的链接了解本章涵盖的主题：
- en: '[https://github.com/markjprice/cs10dotnet6/blob/main/book-links.md#chapter-15---building-websites-using-the-model-view-controller-pattern](https://github.com/markjprice/cs10dotnet6/blob/main/book-links.md#chapter-15---building-websites-using-the-model-view-controller-pattern)'
  id: totrans-2564
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://github.com/markjprice/cs10dotnet6/blob/main/book-links.md#chapter-15---building-websites-using-the-model-view-controller-pattern](https://github.com/markjprice/cs10dotnet6/blob/main/book-links.md#chapter-15---building-websites-using-the-model-view-controller-pattern)'
- en: Summary
  id: totrans-2565
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, you learned how to build large, complex websites in a way that
    is easy to unit test by registering and injecting dependency services like database
    contexts and loggers and is easier to manage with teams of programmers using ASP.NET
    Core MVC. You learned about configuration, authentication, routes, models, views,
    and controllers.
  id: totrans-2566
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您学习了如何以易于进行单元测试的方式构建大型、复杂的网站，方法是通过注册和注入依赖服务，如数据库上下文和记录器，并且使用ASP.NET Core
    MVC更容易管理程序员团队。您学习了有关配置、身份验证、路由、模型、视图和控制器的知识。
- en: In the next chapter, you will learn how to build and consume services that use
    HTTP as the communication layer, aka web services.
  id: totrans-2567
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，您将学习如何构建和使用使用HTTP作为通信层的服务，也就是Web服务。
