- en: Chapter 2. Application Container Management
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第2章 应用容器管理
- en: In this lesson, we will scale one of the containers we built into a multi-tier
    setup. This will involve splitting the application into different logical sections.
    For example, we could have an application running on a Docker container and the
    application's data in a separate database container; however, both should work
    as a single entity. For this, we will use Docker's tool for running multi-container
    applications. The tool goes by the name `docker-compose`. In summary, `docker-compose`
    is the tool used for defining and running multi-container Docker applications.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本课程中，我们将把我们构建的一个容器扩展为多层设置。这将涉及将应用程序拆分为不同的逻辑部分。例如，我们可以在一个Docker容器上运行一个应用程序，并将应用程序的数据放在一个单独的数据库容器中；但是，两者应该作为一个单一实体工作。为此，我们将使用Docker的工具来运行多容器应用程序。该工具名为`docker-compose`。简而言之，`docker-compose`是用于定义和运行多容器Docker应用程序的工具。
- en: Lesson Objectives
  id: totrans-2
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 课程目标
- en: 'By the end of this lesson, you will be able to:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 通过本课程，您将能够：
- en: Get an overview of a multi-container application setup
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解多容器应用程序设置的概述
- en: Work through the `docker-compose` file and CLI
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过`docker-compose`文件和CLI进行工作
- en: Manage multiple containers and distributed application bundles
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理多个容器和分布式应用程序包
- en: Set up a network with `docker-compose`
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`docker-compose`设置网络
- en: Handle and debug the different application layers
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 处理和调试不同的应用程序层
- en: The docker-compose Tool
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: docker-compose工具
- en: Let's begin the lesson by looking at what a multi-container setup is, why it
    is important, and how Docker, with the tool `docker-compose`, works like a charm
    in such scenarios.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过查看多容器设置是什么，为什么它很重要，以及Docker如何在这种情况下与`docker-compose`工具一起运行得很好来开始本课程。
- en: 'We have recently been introduced to how applications work, with their separate
    elements: frontend, backend, and database.'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 我们最近介绍了应用程序如何工作，以及它们的各个部分：前端、后端和数据库。
- en: 'To run such a multi-tier application using Docker, one would need to run the
    following commands to spin up the containers in different terminal sessions:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用Docker运行这样的多层应用程序，需要在不同的终端会话中运行以下命令来启动容器：
- en: '[PRE0]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Note
  id: totrans-14
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'You can run `docker run` with (`-d`) as detached to prevent us from running
    the three commands in separate sessions, for example: `docker run <front-end>
    -d`'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用（-d）作为分离运行`docker run`，以防止我们在单独的会话中运行三个命令，例如：`docker run <front-end> -d`
- en: That said, it even becomes particularly tasking linking different containers
    (networking).
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 也就是说，链接不同的容器（网络）甚至变得特别繁重。
- en: '`docker-compose` comes in to save the day. We can define and run multi-containers
    from one file - `docker-compose.yml`. In the following topics, we''ll discuss
    this further. First, let''s install it.'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: '`docker-compose`进来拯救了我们。我们可以从一个文件 - `docker-compose.yml`中定义和运行多个容器。在接下来的主题中，我们将进一步讨论这个问题。首先，让我们安装它。'
- en: Installing docker-compose
  id: totrans-18
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装docker-compose
- en: If you went through the installation of Docker in *Lesson 1*, *Images and Containers,*
    `docker-compose` was most likely installed with Docker. To confirm this, run `docker-compose`
    in your terminal.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您在*第1课*中安装了Docker的话，`docker-compose`很可能已经与Docker一起安装了。要确认这一点，请在终端中运行`docker-compose`。
- en: 'If the command is recognized, you should have an output like the following:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 如果命令被识别，您应该会得到以下输出：
- en: '![Installing docker-compose](graphics/image02_01.jpg)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![安装docker-compose](graphics/image02_01.jpg)'
- en: Windows users should install the Community Edition of Docker to install `docker-compose`
    alongside it. Docker Toolbox includes `docker-compose` in its installation.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: Windows用户应安装Docker的社区版，以便在其旁边安装`docker-compose`。 Docker Toolbox在其安装中包括`docker-compose`。
- en: Note
  id: totrans-23
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'For further `docker-compose` installation steps, check out the documentation
    at: [https://docs.docker.com/compose/install/](https://docs.docker.com/compose/install/).'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 有关进一步的`docker-compose`安装步骤，请查看文档：[https://docs.docker.com/compose/install/](https://docs.docker.com/compose/install/)。
- en: 'While on this subject, please note the various ways of uninstalling it. In
    order to uninstall the program:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个主题上，请注意卸载它的各种方法。为了卸载程序：
- en: Go to **Programs and Features**.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 转到**程序和功能**。
- en: Look for Docker, right-click, and **Uninstall**.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 寻找Docker，右键单击，然后**卸载**。
- en: Overview of a Multi-Container Application Setup
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 多容器应用程序设置概述
- en: In the previous lesson, we introduced Docker and containerization. We ran sample
    Python and JavaScript scripts as demonstrations of how applications can be containerized
    and how images can be built. We are now ready to run an application that goes
    beyond that.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一课中，我们介绍了Docker和容器化。我们运行了一些Python和JavaScript脚本作为应用程序可以被容器化以及镜像可以被构建的演示。现在我们准备运行一个超越这一点的应用程序。
- en: In a Dockerfile, every line describes a layer. The union filesystem used in
    Docker allows different directories to transparently overlay, forming a single,
    coherent filesystem. The foundational layer is always an image which you build
    upon. Each additional line with a command, say, RUN, CMD, and so on, adds a layer
    to it. The advantage of layers is that as long as the layer has not been modified,
    it will not bother building that part of the image. Secondly, as an image is pulled
    from a Docker image registry, it is pulled in layers, therefore mitigating issues
    such as connection cuts during pulling and pushing of images.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 在Dockerfile中，每一行描述一个层。Docker中使用的联合文件系统允许不同的目录透明地叠加，形成一个统一的文件系统。基础层始终是一个镜像，你可以在其上构建。每个带有命令（比如RUN、CMD等）的额外行都会向其添加一个层。层的优势在于，只要层没有被修改，就不会影响构建镜像的那部分。其次，当从Docker镜像注册表中拉取镜像时，它是以层的形式拉取的，因此可以减轻拉取和推送镜像时的连接中断等问题。
- en: 'Many applications are built under a common structure: **frontend, backend**,
    and **database**. Let''s break this down further and understand how we can set
    this up.'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 许多应用程序都是在一个常见的结构下构建的：**前端，后端**和**数据库**。让我们进一步分解并了解如何设置这个结构。
- en: The Frontend
  id: totrans-32
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 前端
- en: When you open a web application, the page that you see is part of the frontend.
    Sometimes, the frontend has the controller (the logical end) and the view layer
    (the dumb end). The styling of the layout and content (Read, HTML, and CSS) is
    the view layer. The content here is managed by the controller.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 当你打开一个Web应用程序时，你看到的页面是前端的一部分。有时，前端有控制器（逻辑端）和视图层（哑端）。布局和内容的样式（即HTML和CSS）是视图层。这里的内容由控制器管理。
- en: 'The controller influences what is presented in the view layer based on the
    user''s action and/or database changes. Take, for example, an application like
    Twitter: if someone follows you, your data has changed. The controller will pick
    up this change and update the view layer with the new number of followers.'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 控制器根据用户的操作和/或数据库更改影响视图层中呈现的内容。举个例子，像Twitter这样的应用程序：如果有人关注你，你的数据就会发生变化。控制器将捕捉到这个变化，并用新的关注者数量更新视图层。
- en: The Backend
  id: totrans-35
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 后端
- en: 'You might have heard of the term Model-view-controller (MVC) **.** The model
    sits on the backend side of things in an application. With the earlier example
    of Twitter, the model does not concern itself with the HTML or its layout. It
    handles the state of the application: the number of followers and people you are
    following, the tweets, images, videos, and so on.'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能听说过模型-视图-控制器（MVC）**。**模型位于应用程序的后端。以Twitter的早期示例为例，模型不关心HTML或其布局。它处理应用程序的状态：关注者和你正在关注的人的数量，推文，图片，视频等。
- en: Note
  id: totrans-37
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: This is a summary of what the backend layer includes. The backend mainly deals
    with the application's logic. This includes the code that is manipulating the
    database; that means all queries come from the backend. However, requests come
    from the **frontend**. This happens when a user clicks a button, for example.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 这是后端层包括的内容摘要。后端主要处理应用程序的逻辑。这包括操纵数据库的代码；这意味着所有查询都来自后端。但是，请求来自**前端**。例如，当用户点击按钮时。
- en: You might have also heard of the term API. API is an acronym standing for **Application
    Program Interface**. This also sits at the backend. APIs expose the internal workings
    of an application.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 您可能也听说过API这个术语。API是**应用程序接口**的缩写。这也位于后端。API公开应用程序的内部工作原理。
- en: This means the API can also be an application's backend or logical layer.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 这意味着API也可以是应用程序的后端或逻辑层。
- en: Let's use the Twitter example so that this is clear. Actions such as posting
    a tweet and searching for tweets can easily be in an API as methods which can
    be called from any frontend application if the API is made public.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们以Twitter为例来说明。例如发布推文和搜索推文等操作可以很容易地作为API中的方法存在，如果API被公开，可以从任何前端应用程序调用。
- en: Note
  id: totrans-42
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The Docker and `docker-compose` CLIs are actually API calls, for instance when
    interacting with external resources or content, such as Docker Hub.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: Docker和`docker-compose` CLI实际上是API调用，例如与外部资源或内容进行交互时，比如Docker Hub。
- en: The Database
  id: totrans-44
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数据库
- en: The database contains organized data (information) that is easily accessible,
    managed, and updated. We have file-based databases and server-based databases.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 数据库包含组织良好的数据（信息），易于访问、管理和更新。我们有基于文件的数据库和基于服务器的数据库。
- en: Server-based databases involve a server process running, accepting requests
    and reading and writing the database files themselves. The databases could be
    in the cloud, for example.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 基于服务器的数据库涉及运行服务器进程，接受请求并读写数据库文件本身。例如，数据库可以在云中。
- en: Note
  id: totrans-47
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Server-based databases are hosted on virtual hosts, mostly on cloud platforms
    such as Google Cloud Platform and Amazon Web Services. Examples are Amazon RDS
    and Google Cloud SQL for PostgreSQL.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 基于服务器的数据库托管在虚拟主机上，主要在云平台上，例如Google Cloud Platform和Amazon Web Services。例如，Amazon
    RDS和Google Cloud SQL for PostgreSQL。
- en: 'Obtain server-based databases from the following links:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 从以下链接获取基于服务器的数据库：
- en: '[https://aws.amazon.com/rds/postgresql/](https://aws.amazon.com/rds/postgresql/)'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://aws.amazon.com/rds/postgresql/](https://aws.amazon.com/rds/postgresql/)'
- en: '[https://cloud.google.com/sql/docs/postgres](https://cloud.google.com/sql/docs/postgres)'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://cloud.google.com/sql/docs/postgres](https://cloud.google.com/sql/docs/postgres)'
- en: In a nutshell, development has always involved building application layers,
    and shipping has always been a hassle considering the price of the cloud platforms
    and development and operations (DevOps, for short) involved.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 简而言之，开发一直涉及构建应用程序层，而交付一直是一项麻烦，考虑到云平台的价格以及涉及的开发和运营（简称DevOps）。
- en: Docker and `docker-compose` help us manage all our application components as
    a single bundle, which is cheaper, faster, and easier to manage. `docker-compose`
    helps us coordinate all the application layers through a single file and in very
    simple definitions.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: Docker和`docker-compose`帮助我们将所有应用程序组件作为一个单一捆绑包进行管理，这样更便宜、更快速、更容易管理。`docker-compose`帮助我们通过一个文件协调所有应用程序层，并且使用非常简单的定义。
- en: 'As we conclude this overview, it is important to know that developers, over
    time, have coined different stack variations to summarize the frontend, backend,
    and database structure of their apps. Here''s a list of them with their meaning
    (we will not delve further than this during this course):'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 随着我们结束这个概述，重要的是要知道开发人员随着时间的推移，已经创造了不同的堆栈变体来总结他们应用程序的前端、后端和数据库结构。以下是它们的列表及其含义（在本课程中我们不会深入探讨）：
- en: PREN - PostgresDB, React, Express, Node.js
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PREN - PostgresDB，React，Express，Node.js
- en: MEAN - MongoDB, Express, Angular, Node.js
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MEAN - MongoDB，Express，Angular，Node.js
- en: VPEN - VueJS, PostgresDB, Express, Node.js
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: VPEN - VueJS，PostgresDB，Express，Node.js
- en: LAMP - Linux, Apache, MySQL, PHP
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: LAMP - Linux，Apache，MySQL，PHP
- en: Note
  id: totrans-59
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: It is important to know that applications are structured in this manner to manage
    separation of concerns.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 重要的是要知道应用程序以这种方式结构化，以管理关注点的分离。
- en: With the knowledge of application structures, we can get to the `docker-compose`
    CLI and put this knowledge to work.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 有了应用程序结构的知识，我们可以使用`docker-compose` CLI并将这些知识付诸实践。
- en: Using docker-compose
  id: totrans-62
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用docker-compose
- en: 'Using `docker-compose` requires three steps:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`docker-compose`需要三个步骤：
- en: Build an application's environment as an image using a `Dockerfile`.
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`Dockerfile`构建应用程序的环境作为一个镜像。
- en: Use the `docker-compose.yml` file to define the services your app requires to
    run.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`docker-compose.yml`文件来定义应用程序运行所需的服务。
- en: Run `docker-compose up` to run the app.
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行`docker-compose up`来运行应用程序。
- en: Note
  id: totrans-67
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '`docker-compose` is a **command-line interface (CLI)** just like the Docker
    CLI. Running `docker-compose` gives a list of commands and how to use each.'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '`docker-compose`就像Docker CLI一样是一个**命令行界面（CLI）**。运行`docker-compose`会给出一系列命令以及如何使用每个命令。'
- en: We went through images in the previous lesson, so step 1 is checked off.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在上一课中已经讨论了镜像，所以第1步已经完成。
- en: Some `docker-compose` versions are incompatible with some Docker versions.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 一些`docker-compose`版本与某些Docker版本不兼容。
- en: We'll dwell on step 2 for some time.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在第2步上停留一段时间。
- en: 'Here is the `docker-compose` file:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 这是`docker-compose`文件：
- en: 'One that runs the two images we created in our previous lesson:'
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行我们在上一课中创建的两个镜像的命令：
- en: '![Using docker-compose](graphics/image02_02.jpg)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![使用docker-compose](graphics/image02_02.jpg)'
- en: Note
  id: totrans-75
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Refer the complete code placed at `Code/Lesson-2/example-docker-compose.yml`.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 参考放置在`Code/Lesson-2/example-docker-compose.yml`的完整代码。
- en: Go to [https://goo.gl/11rwXV](https://goo.gl/11rwXV) to access the code.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 访问[https://goo.gl/11rwXV](https://goo.gl/11rwXV)来获取代码。
- en: docker-compose first run
  id: totrans-78
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: docker-compose首次运行
- en: Create a new directory and name it `py-js`; you can have a different directory
    name if you prefer.
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新目录并将其命名为`py-js`；如果您喜欢，也可以使用不同的目录名。
- en: Create a new file in the directory and name it `docker-compose.yml`. Copy the
    content of the image above or the example shared on example-`docker-compose.yml`.
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在目录中创建一个新文件并将其命名为`docker-compose.yml`。复制上面的图片内容或在`example-docker-compose.yml`中分享的示例。
- en: Run the command `docker-compose up` from the directory.
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从目录中运行命令`docker-compose up`。
- en: Notice the outputs of running both `js-docker` and `python-docker`. This is
    also because we have both images built locally from the previous lesson.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 注意运行`js-docker`和`python-docker`的输出。这也是因为我们在上一课中都本地构建了这两个镜像。
- en: 'If you do not have the images, running `docker-compose up` will result in an
    error or an attempt to pull it from Docker Hub if it exists online:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您没有这些镜像，运行`docker-compose up`将导致错误，或者尝试从Docker Hub上拉取它（如果在线存在）：
- en: '![docker-compose first run](graphics/image02_03.jpg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![docker-compose首次运行](graphics/image02_03.jpg)'
- en: A `docker-compose.yml` that runs **WordPress**. WordPress is a free and open
    source **content** **management system** **(CMS)** based on PHP and MySQL.
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个运行**WordPress**的`docker-compose.yml`。WordPress是一个基于PHP和MySQL的免费开源**内容管理系统（CMS）**。
- en: Activity 1 — Running WordPress Using docker-compose
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 活动1 — 使用docker-compose运行WordPress
- en: To get you conversant with running `docker-compose` commands.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 让您熟悉运行`docker-compose`命令。
- en: You have been asked to build a WordPress website using `docker-compose`.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 有人要求您使用`docker-compose`构建WordPress网站。
- en: Create a new directory and name it `sandbox`.
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新目录并命名为`sandbox`。
- en: Create a new file and name it `docker-compose.yml.` Add the code in `wordpress-docker-compose.yml`
    or copy the following figure:![Activity 1 — Running WordPress Using docker-compose](graphics/image02_04.jpg)
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新文件并命名为`docker-compose.yml`。添加`wordpress-docker-compose.yml`中的代码或复制以下图示：![使用docker-compose运行WordPress的活动1](graphics/image02_04.jpg)
- en: Note
  id: totrans-91
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Refer the complete code placed at `Code/Lesson-2/wordpress-docker-compose.yml`.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 参考放置在`Code/Lesson-2/wordpress-docker-compose.yml`的完整代码。
- en: Go to [https://goo.gl/t7UGvy](https://goo.gl/t7UGvy) to access the code.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 访问[https://goo.gl/t7UGvy](https://goo.gl/t7UGvy)获取代码。
- en: Note
  id: totrans-94
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Take heed of the indentation in the file. It is advised to use an equal number
    of tabs and spaces when indenting the lines.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 注意文件中的缩进。建议在缩进行时使用相等数量的制表符和空格。
- en: 'Run `docker-compose up` in the `sandbox` directory:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 在`sandbox`目录中运行`docker-compose up`：
- en: '![Activity 1 — Running WordPress Using docker-compose](graphics/image02_05.jpg)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![使用docker-compose运行WordPress的活动1](graphics/image02_05.jpg)'
- en: Note
  id: totrans-98
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: You'll notice that, based on one file, we have an application running. This
    example is the perfect showcase of the power of `docker-compose`.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 您会注意到，基于一个文件，我们有一个应用程序正在运行。这个例子是`docker-compose`强大功能的完美展示。
- en: 'Run `docker ps`. You''ll see the containers running:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 运行`docker ps`。您会看到正在运行的容器：
- en: '![Activity 1 — Running WordPress Using docker-compose](graphics/image02_06.jpg)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![使用docker-compose运行WordPress的活动1](graphics/image02_06.jpg)'
- en: 'Open your browser and go to the address at: `http://0.0.0.0:8000/`. We''ll
    have the WordPress website set up ready.'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 打开浏览器，转到地址：`http://0.0.0.0:8000/`。我们将准备好设置WordPress网站。
- en: Proceed with the set up and, in an instant, you have a WordPress site up and
    ready.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 继续设置，一会儿，您就会有一个准备好的WordPress网站。
- en: 'The docker-compose file: docker-compose.yml'
  id: totrans-104
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: docker-compose文件：docker-compose.yml
- en: '`docker-compose.yml` is a YAML file. It defines **services, networks**, and
    **volumes**.'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: '`docker-compose.yml`是一个YAML文件。它定义了**服务、网络**和**卷**。'
- en: Note
  id: totrans-106
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Services are application container definitions that include all components that
    relate to an application, for example, **DB, frontend**, or **backend**. What
    really weighs in when defining services is the components, which are networks,
    volumes, and environment variables.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 服务是应用程序容器定义，包括与应用程序相关的所有组件，例如**DB，前端**或**后端**。在定义服务时真正重要的是组件，这些组件是网络、卷和环境变量。
- en: The first line of any `docker-compose.yml` defines the version of the `docker-compose`
    file format.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 任何`docker-compose.yml`的第一行都定义了`docker-compose`文件格式的版本。
- en: By running `docker -v`, you can tell which Docker version is running and thus
    know which version to put on the first line of the file.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 通过运行`docker -v`，您可以知道正在运行的Docker版本，从而知道应在文件的第一行上放置哪个版本。
- en: For `docker-compose` file format 1.0, the first line was not necessary. Each
    `docker-compose` file introduced a new configuration or deprecated an earlier
    one.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 对于`docker-compose`文件格式1.0，第一行是不必要的。每个`docker-compose`文件都引入了一个新的配置或废弃了早期的配置。
- en: We will use version 3.3 and the program should be compatible with version 3.0
    and above.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用版本3.3，并且程序应与版本3.0及以上兼容。
- en: Make sure everyone is running version 3 and at least a Docker that's 1.13.0+.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 确保每个人都在运行版本3，至少是1.13.0+的Docker。
- en: 'Next up is **services**. Let''s use this simplified skeleton:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来是**服务**。让我们使用这个简化的框架：
- en: '![The docker-compose file: docker-compose.yml](graphics/image02_07.jpg)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
  zh: '![docker-compose文件：docker-compose.yml](graphics/image02_07.jpg)'
- en: Note
  id: totrans-115
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Take heed of the indentation.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 注意缩进。
- en: In the above example, we have two services, that is, `db` and `web`. These two
    are indented just once.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 在上面的示例中，我们有两个服务，即`db`和`web`。这两个服务只缩进了一次。
- en: The next lines after defining the services defines the image or the Dockerfile
    from which the image is to be built.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 定义服务后的下一行定义了要构建镜像的图像或Dockerfile。
- en: Line 4 will specify the image from which the `db` service container will run
    from. We earlier mentioned a number of stacks; the `db` image can be any of the
    server-based databases.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 第4行将指定`db`服务容器将从哪个图像运行。我们之前提到了许多堆栈；`db`图像可以是任何基于服务器的数据库。
- en: Note
  id: totrans-120
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: To confirm whether a stack you want to use exists, run the following:`docker
    search <image or name of your preferred stack`> (for example, `docker search mongo
    or docker search postgres`).
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 要确认您想要使用的堆栈是否存在，请运行以下命令：`docker search <image or name of your preferred stack>`（例如，`docker
    search mongo`或`docker search postgres`）。
- en: Line 6 explains that the web services image will be built from the Dockerfile
    in the location (`.`) relative to the `docker-compose.yml`.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 第6行解释了web服务图像将从相对于docker-compose.yml的位置（`。`）中的Dockerfile构建。
- en: 'We can also define the name of the Dockerfile in line 6\. `docker-compose`
    will search for the file with a name as listed, for example, in the `docker-compose.yml`:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以在第6行定义Dockerfile的名称。例如，在docker-compose.yml中，`docker-compose`将搜索具有列出的名称的文件：
- en: '[PRE1]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Lines 7 to 10 gives more definition to the web services.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 第7到10行为web服务提供了更多的定义。
- en: 'As evidenced in the `docker-compose.yml` we used to build and run WordPress,
    there are two services: `db` and `wordpress`. In the output of `docker ps,` these
    are the container names: `sandbox_wordpress_1` and `sandbox_db_1`.'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 如在我们用来构建和运行WordPress的docker-compose.yml中所示，有两个服务：`db`和`wordpress`。在`docker ps`的输出中，这些是容器名称：`sandbox_wordpress_1`和`sandbox_db_1`。
- en: The first word before the underscore signifies the name of the directory holding
    the `docker-compose.yml`. The second word in that container name is the service
    name, as defined in `docker-compose.yml`.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 下划线之前的第一个单词表示包含`docker-compose.yml`的目录的名称。该容器名称中的第二个单词是`docker-compose.yml`中定义的服务名称。
- en: We'll go into more context in the following topic.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在接下来的主题中更详细地讨论。
- en: The docker-compose CLI
  id: totrans-129
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: docker-compose CLI
- en: As soon as `docker-compose` is installed, I mentioned that you expect a list
    of options when you run `docker-compose`. Run `docker-compose –v`.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦安装了`docker-compose`，我提到当您运行`docker-compose`时，您可以期望看到一系列选项。运行`docker-compose
    –v`。
- en: Note
  id: totrans-131
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: These two commands, `docker-compose` and `docker-compose -v`, are the only ones
    that can be ran from whichever working directory is open on your terminal command
    line or Git bash.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 这两个命令，`docker-compose`和`docker-compose -v`，是唯一可以从终端命令行或Git bash中打开的任何工作目录中运行的命令。
- en: Otherwise, the other options in `docker-compose` are only run in the presence
    of the `docker-compose.yml` file.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 否则，在`docker-compose`中的其他选项只能在存在`docker-compose.yml`文件的情况下运行。
- en: 'Let''s dig deep into the common commands: `docker-compose build`.'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们深入了解常见命令：`docker-compose build`。
- en: 'This command builds images referenced in the `docker-compose line: (build:
    .)` in the template `docker-compose.ym`.'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令构建了模板`docker-compose.ym`中`docker-compose`行中引用的图像（构建：.）。
- en: Building images can also be achieved through the command `docker-compose up`.
    Take note that this doesn't happen unless the image has not been built yet, or
    there has been a recent change that affects the container to be run.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 构建图像也可以通过命令`docker-compose up`来实现。请注意，除非尚未构建图像，或者最近有影响要运行的容器的更改，否则不会发生这种情况。
- en: Note
  id: totrans-137
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: This command will also work for the WordPress example, even though both services
    run from images in the Docker registry and not Dockerfiles within the directory.
    This would be **pulling** an image and **not building** because we build from
    a Dockerfile.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令也适用于WordPress示例，即使两个服务都是从Docker注册表中的镜像运行，而不是目录中的Dockerfiles。这将是**拉取**一个镜像而不是构建，因为我们是从Dockerfile构建的。
- en: 'This command lists the services as configured in the `docker-compose.yml`:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令列出了在`docker-compose.yml`中配置的服务：
- en: '`docker-compose config --services`'
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`docker-compose config --services`'
- en: 'This command lists the images used by the created containers:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令列出了创建的容器使用的镜像：
- en: '`docker-compose images`'
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`docker-compose images`'
- en: 'This command lists the logs from the services:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令列出了来自服务的日志：
- en: '`docker-compose logs`'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`docker-compose logs`'
- en: '`docker-compose logs <service>` lists the logs of a specific service, for example,
    `docker-compose logs db`.'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: '`docker-compose logs <service>`列出特定服务的日志，例如，`docker-compose logs db`。'
- en: 'This command lists the containers running based on the `docker-compose`:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令列出了基于`docker-compose`运行的容器：
- en: '`docker-compose ps`'
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`docker-compose ps`'
- en: Note that in most cases, there is a difference between the results of `docker-compose
    ps` and `docker ps`. Containers that were not running in the context of `docker-compose`
    will not be displayed by the command `docker-compose ps`.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，在大多数情况下，`docker-compose ps`和`docker ps`的结果是不同的。在`docker-compose`的上下文中没有运行的容器不会被`docker-compose
    ps`命令显示出来。
- en: 'This command builds, creates, recreates, and runs services:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令构建，创建，重新创建和运行服务：
- en: '`docker-compose up`'
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`docker-compose up`'
- en: Note
  id: totrans-151
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: When running `docker-compose up`, if one service exits, the entire command exits.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 当运行`docker-compose up`时，如果一个服务退出，整个命令都会退出。
- en: Running `docker-compose up -d` is running `docker-compose up` in detached mode.
    That is, the command will be running in the background.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 运行`docker-compose up -d`相当于以分离模式运行`docker-compose up`。也就是说，该命令将在后台运行。
- en: Activity 2 — Analyzing the docker- compose CLI
  id: totrans-154
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 活动2 - 分析docker-compose CLI
- en: To get you conversant with the `docker-compose` CLI.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 让您熟悉`docker-compose` CLI。
- en: You have been asked to demonstrate the difference in changes resulting from
    running two containers.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 您被要求演示运行两个容器产生的更改的差异。
- en: 'While still within the directory with the WordPress `docker-compose.yml`--
    in my case, sandbox -- run the commands of *Activity B-1*, then the following
    commands:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 在带有WordPress `docker-compose.yml`的目录中，例如sandbox，运行*Activity B-1*的命令，然后运行以下命令：
- en: '[PRE2]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Managing Multiple Containers and Distributed Application Bundles
  id: totrans-159
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 管理多个容器和分布式应用程序包
- en: This is the `docker-compose.yml` for running a Django application. A similar
    application can be found in the `docker-compose` documentation under the Django
    example.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 这是运行Django应用程序的`docker-compose.yml`。类似的应用程序可以在`docker-compose`文档的Django示例下找到。
- en: 'Download the Django example from: [ttps://docs.docker.com/compose/django/](https://docs.docker.com/compose/django/):'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 从[ttps://docs.docker.com/compose/django/](https://docs.docker.com/compose/django/)下载Django示例：
- en: '![Managing Multiple Containers and Distributed Application Bundles](graphics/image02_08.jpg)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![管理多个容器和分布式应用程序包](graphics/image02_08.jpg)'
- en: Note
  id: totrans-163
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Refer the complete code placed at `Code/Lesson-2/django-docker-compose.yml`.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 参考放置在`Code/Lesson-2/django-docker-compose.yml`的完整代码。
- en: Go to [https://goo.gl/H624J1](https://goo.gl/H624J1) to access the code.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 访问[https://goo.gl/H624J1](https://goo.gl/H624J1)以访问代码。
- en: Improve a Docker Workflow
  id: totrans-166
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 改进Docker工作流程
- en: To give more context on how `docker-compose` is involved and how it improves
    a Docker workflow.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更多地了解`docker-compose`是如何参与并改进Docker工作流程的。
- en: Create a new directory and name it `django_docker`.
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新目录并命名为`django_docker`。
- en: In the `django-docker` directory, create a new `docker-compose.yml` and add
    the information in the figure above, or in the `django-docker-compose.yml` script
    provided.
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`django-docker`目录中，创建一个新的`docker-compose.yml`并添加上图中的信息，或者添加提供的`django-docker-compose.yml`脚本中的信息。
- en: Create a new Dockerfile and add the content in the Dockerfile script provided.
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新的Dockerfile并添加提供的Dockerfile脚本中的内容。
- en: Create a requirements file; simply copy the `django-requirements.txt` file provided.
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个requirements文件；简单地复制提供的`django-requirements.txt`文件。
- en: Run `docker-compose` up and observe the logs.
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行`docker-compose` up并观察日志。
- en: Notice that we are able to spin up both containers with one simple command,
    docker-compose up.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，我们能够用一个简单的命令docker-compose up来启动两个容器。
- en: Note
  id: totrans-174
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: No prior experience with Django is needed; this is for basic demo purposes.
    `Code/Lesson-2/django-requirements.txt`.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 不需要有Django的先验经验；这是为了基本演示目的。`Code/Lesson-2/django-requirements.txt`。
- en: '**The Django Compose File Broken Down**'
  id: totrans-176
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**拆解Django Compose文件**'
- en: 'First things first, how many services does this file have? Yes, two: `db` and
    `web`. The service `db` is based on the Postgres image. The service web is built
    from the Dockerfile in the same directory that contains this `docker-compose.yml`.'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，这个文件有多少个服务？是的，有两个：`db`和`web`。服务`db`基于Postgres镜像。服务web是从包含此`docker-compose.yml`的相同目录中的Dockerfile构建的。
- en: 'Without the `docker-compose` file, the `db` service container would have otherwise
    been run in this way:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 没有`docker-compose`文件，`db`服务容器将以以下方式运行：
- en: '![The Django Compose File Broken Down](graphics/image02_09.jpg)'
  id: totrans-179
  prefs: []
  type: TYPE_IMG
  zh: '![拆解Django Compose文件](graphics/image02_09.jpg)'
- en: 'This command is translated to the following:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令被翻译为以下内容：
- en: '![The Django Compose File Broken Down](graphics/image02_10.jpg)'
  id: totrans-181
  prefs: []
  type: TYPE_IMG
  zh: '![拆解Django Compose文件](graphics/image02_10.jpg)'
- en: Open another tab or window in the terminal and run `docker ps`. You'll see the
    container running.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 在终端中打开另一个标签页或窗口，运行`docker ps`。你会看到容器正在运行。
- en: 'On the other hand, the `web` service container as per the example would be
    run in the following steps:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，根据示例，`web`服务容器将按以下步骤运行：
- en: '![The Django Compose File Broken Down](graphics/image02_11.jpg)'
  id: totrans-184
  prefs: []
  type: TYPE_IMG
  zh: '![拆解Django Compose文件](graphics/image02_11.jpg)'
- en: 'The second command, broken down, is in the following format:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个命令，拆解后的格式如下：
- en: '[PRE3]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Therefore, the aforementioned command is translated to the following:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，上述命令被翻译为以下内容：
- en: '![The Django Compose File Broken Down](graphics/image02_12.jpg)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![拆解Django Compose文件](graphics/image02_12.jpg)'
- en: One advantage of using `docker-compose.yml` is that instead of running the commands
    in the terminal again and again, you have one command to run as many containers
    as you've included in the file.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`docker-compose.yml`的一个优势是，不需要在终端中一遍又一遍地运行命令，你只需要运行一个命令，就可以运行文件中包含的所有容器。
- en: We did not cover volumes and ports in the last lesson. I'll take time to help
    us understand this.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在上一课没有涵盖卷和端口。我会花时间帮助我们理解这一点。
- en: Endure Data Using Volumes
  id: totrans-191
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用卷持久化数据
- en: Volumes are used to persist data generated and used by Docker containers.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 卷用于持久化Docker容器生成和使用的数据。
- en: Note
  id: totrans-193
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Volumes persist any update to a local file or script. This makes an equal change
    on the container side.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 卷持久化本地文件或脚本的任何更新。这会在容器端产生相同的变化。
- en: 'In this case, the command is the following:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，命令如下：
- en: '![Endure Data Using Volumes](graphics/image02_13.jpg)'
  id: totrans-196
  prefs: []
  type: TYPE_IMG
  zh: '![使用卷持久化数据](graphics/image02_13.jpg)'
- en: 'In the docker run options, which comes after the main command:'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 在主命令之后的docker run选项中：
- en: '[PRE4]'
  id: totrans-198
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: This is in the `docker-compose.yml` file.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 这在`docker-compose.yml`文件中。
- en: '![Endure Data Using Volumes](graphics/image02_14.jpg)'
  id: totrans-200
  prefs: []
  type: TYPE_IMG
  zh: '![使用卷持久化数据](graphics/image02_14.jpg)'
- en: Note
  id: totrans-201
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: As long as volumes is defined in the `docker-compose` file, when a local change
    is made, such as a file update, the changes will be automatically synced to the
    files in the container(s).
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 只要在`docker-compose`文件中定义了卷，例如文件更新，本地更改将自动同步到容器中的文件。
- en: '![Endure Data Using Volumes](graphics/image02_15.jpg)'
  id: totrans-203
  prefs: []
  type: TYPE_IMG
  zh: '![Endure Data Using Volumes](graphics/image02_15.jpg)'
- en: Ports
  id: totrans-204
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 端口
- en: 'Django, as other web servers do, runs on specific ports. The Dockerfile used
    to build the Django image has a similar command to this: `EXPOSE 8000`.This port
    remains open when the container is run and is open for connection.'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: Django和其他Web服务器一样，运行在特定端口上。用于构建Django镜像的Dockerfile具有类似于此命令：`EXPOSE 8000`。当容器运行时，此端口保持打开并可供连接。
- en: In the Django Dockerfile, we defined our port as `8000` and prefixed the number
    with an address `(0.0.0.0):`
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 在Django Dockerfile中，我们将端口定义为`8000`，并在数字前加上地址`(0.0.0.0):`
- en: '![Ports](graphics/image02_16.jpg)'
  id: totrans-207
  prefs: []
  type: TYPE_IMG
  zh: '![Ports](graphics/image02_16.jpg)'
- en: The number `0.0.0.0` defines the host address running the container.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 数字`0.0.0.0`定义了运行容器的主机地址。
- en: Note
  id: totrans-209
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The address tells `docker-compose` to run the container on our machine or, in
    short, localhost. If we were to skip the address and just expose the port, our
    set up would have unexpected results like a blank page.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 地址告诉`docker-compose`在我们的机器上运行容器，或者简而言之，本地主机。如果我们跳过地址，只是暴露端口，我们的设置将产生意外结果，如空白页面。
- en: 'Consider the following line in the `docker run` options:'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑`docker run`选项中的以下行：
- en: '[PRE5]'
  id: totrans-212
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![Ports](graphics/image02_17.jpg)'
  id: totrans-213
  prefs: []
  type: TYPE_IMG
  zh: '![Ports](graphics/image02_17.jpg)'
- en: 'And the following lines in the `do‑cker-compose.yml`:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 以及在`do‑cker-compose.yml`中的以下行：
- en: '![Ports](graphics/image02_18.jpg)'
  id: totrans-215
  prefs: []
  type: TYPE_IMG
  zh: '![Ports](graphics/image02_18.jpg)'
- en: 'The `docker-compose` port format maps the local workstation port to container
    port. The format is as follows:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: '`docker-compose`端口格式将本地工作站端口映射到容器端口。格式如下：'
- en: '[PRE6]'
  id: totrans-217
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: This allows us from our local machine to access the port 8000 which was mapped
    from the container port.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 这允许我们从本地机器访问从容器端口映射的端口8000。
- en: There's one option at the end, `depends_on`, that is specific to `docker-compose.yml`.
    The `depends_on` specifies the order in which the containers are spun up as soon
    as we run `docker-compose` run.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 最后有一个选项`depends_on`，它是特定于`docker-compose.yml`的。`depends_on`指定容器启动的顺序，只要我们运行`docker-compose`
    run。
- en: 'In our case, the `depends_on` option is under the web service. This means that
    the web service container depends on the `db` service container:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的情况下，`depends_on`选项位于web服务下。这意味着web服务容器依赖于`db`服务容器：
- en: '![Ports](graphics/image02_19.jpg)'
  id: totrans-221
  prefs: []
  type: TYPE_IMG
  zh: '![Ports](graphics/image02_19.jpg)'
- en: Activity 3 — Running the docker-compose File
  id: totrans-222
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 活动3 — 运行docker-compose文件
- en: To get you conversant with the `docker-compose` syntax and commands.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 让您熟悉`docker-compose`的语法和命令。
- en: You have been asked to build and run a simple Python application which exposes
    port 5000 from the image `josephmuli/flask-app`. Define a `docker-compose` file
    and extend the Postgres image as the database. Make sure the database relates
    to the application.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 您被要求构建并运行一个简单的Python应用程序，该应用程序从图像`josephmuli/flask-app`中暴露端口5000。定义一个`docker-compose`文件，并将Postgres图像扩展为数据库。确保数据库与应用程序相关联。
- en: I have prebuilt an image with the name `josephmuli/flask-app`. Extend this image
    in your `docker-compose.yml` file.
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我已经预先构建了一个名为`josephmuli/flask-app`的图像。在您的`docker-compose.yml`文件中扩展此图像。
- en: Make sure to write a version 3 `docker-compose` and define the two services.
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保编写版本3的`docker-compose`并定义两个服务。
- en: Run the application on port `5000`.
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在端口`5000`上运行应用程序。
- en: Open your browser and check the listening port.
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开浏览器并检查监听端口。
- en: Networking with docker-compose
  id: totrans-229
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用docker-compose进行网络连接
- en: By default, `docker-compose` sets up a single network for your application(s)
    where each container can reach and discover other containers.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`docker-compose`为您的应用程序设置了一个单一网络，其中每个容器都可以访问和发现其他容器。
- en: The network is given a name based on the name of the directory it lives in.
    Thus, if your directory is called `py_docker`, when your run `docker-compose up`,
    the network created is called `py_docker_default`.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 网络的名称是根据它所在的目录的名称而命名的。因此，如果您的目录名为`py_docker`，当您运行`docker-compose up`时，创建的网络就叫做`py_docker_default`。
- en: 'We mentioned ports in the previous topic, when creating the WordPress container.
    To explain networking better, we''ll use the `docker-compose.yml` used to spin
    up a WordPress application:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在前面的主题中提到了端口，当创建WordPress容器时。为了更好地解释网络，我们将使用用于启动WordPress应用程序的`docker-compose.yml`：
- en: '![Networking with docker-compose](graphics/image02_20.jpg)'
  id: totrans-233
  prefs: []
  type: TYPE_IMG
  zh: '![使用docker-compose进行网络连接](graphics/image02_20.jpg)'
- en: 'In this file, we have two services: `db` and `wordpress`.'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个文件中，我们有两个服务：`db`和`wordpress`。
- en: In the WordPress service, we have the `ports` option mapping port `80` to port
    `8000`. No wonder, the WordPress app runs on `0.0.0.0:8000` on our browsers.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 在WordPress服务中，我们有`ports`选项将端口`80`映射到端口`8000`。难怪，WordPress应用程序在我们的浏览器上运行在`0.0.0.0:8000`。
- en: 'The ports option is not in the `db` service. However, if you go to the `docker
    hub page for mysql`, you''ll notice that port `3306` is exposed. This is the standard
    port for MySQL. You can obtain more information on MySQL from: [https://hub.docker.com/r/library/mysql](https://hub.docker.com/r/library/mysql).'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: '`db`服务中没有ports选项。然而，如果你去`docker hub页面查看mysql`，你会注意到端口`3306`是暴露的。这是MySQL的标准端口。你可以从这里获取更多关于MySQL的信息：[https://hub.docker.com/r/library/mysql](https://hub.docker.com/r/library/mysql)。'
- en: Note
  id: totrans-237
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: We don't have port mapping for DB because we don't necessarily need the port
    mapped to our computer; instead, we want the WordPress app mapped to the DB for
    communication.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 我们没有为DB进行端口映射，因为我们不一定需要将端口映射到我们的计算机上；相反，我们希望WordPress应用程序映射到DB进行通信。
- en: 'We don''t have port mapping for `db` because we don''t necessarily need the
    port mapped to our local workstation or computer. We only need it to be exposed
    in the container environment and thus it can be connected from the web service
    as in line 23: `WORDPRESS_DB_HOST: db:3306`.'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: '我们没有为`db`进行端口映射，因为我们不一定需要将端口映射到我们的本地工作站或计算机上。我们只需要它在容器环境中暴露，因此它可以从Web服务中连接，就像第23行中的`WORDPRESS_DB_HOST:
    db:3306`一样。'
- en: Note
  id: totrans-240
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'In the `docker-compose` file, this is how you connect one container to another:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 在`docker-compose`文件中，这是如何连接一个容器到另一个容器的方法：
- en: Note the port exposed by the image(s) you want to connect.
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注意所连接的镜像暴露的端口。
- en: Reference the container under the service that is connecting to it; in our case,
    the `db` service is connected to by the WordPress service.
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 引用连接到它的服务下的容器；在我们的情况下，`db`服务被WordPress服务连接。
- en: Since we named the service `db`, we reference this connection as `db:3306`.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们将服务命名为`db`，我们将这个连接称为`db:3306`。
- en: Therefore, the format is `<service>:<port` exposed by that `service>`.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，格式是`<service>:<service暴露的端口>`。
- en: Run the WordPress Containers
  id: totrans-246
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 运行WordPress容器
- en: To give more context on how containers are connected, sync, and communicate.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更好地理解容器是如何连接、同步和通信的。
- en: 'In the compose file, did you notice the restart option? The available values
    for this option are as follows:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 在compose文件中，你注意到了restart选项吗？这个选项的可用值如下：
- en: 'no'
  id: totrans-249
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'no'
- en: always
  id: totrans-250
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: always
- en: on-failure
  id: totrans-251
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: on-failure
- en: unless-stopped
  id: totrans-252
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: unless-stopped
- en: '![Run the WordPress Containers](graphics/image02_21.jpg)'
  id: totrans-253
  prefs: []
  type: TYPE_IMG
  zh: '![运行WordPress容器](graphics/image02_21.jpg)'
- en: 'If it is not specified, the default is `no`. This means that the container
    will not be restarted under any circumstance. However, the `db` service here has
    been specified as restart: always, so the container always restarts.'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: '如果没有指定，那么默认值是`no`。这意味着容器不会在任何情况下重新启动。然而，在这里`db`服务已经被指定为restart: always，所以容器总是会重新启动。'
- en: 'Let''s look at the Django example and see how networking works out there. This
    is the `docker-c` `ompose.yml`:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看Django示例，并了解网络是如何工作的。这是`docker-compose.yml`：
- en: '![Run the WordPress Containers](graphics/image02_22.jpg)'
  id: totrans-256
  prefs: []
  type: TYPE_IMG
  zh: '![运行WordPress容器](graphics/image02_22.jpg)'
- en: 'Immediately, you might not see the networking section present in the WordPress
    site. Here''s a snippet:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 立即，您可能看不到WordPress站点中存在网络部分。这是一个片段：
- en: '[PRE7]'
  id: totrans-258
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The question here is, how did we know that the name and user is `postgres`,
    the HOST is `db`, and the port is `5432`?
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 问题是，我们怎么知道名称和用户是`postgres`，主机是`db`，端口是`5432`？
- en: These are the default values set in the `postgres` image and containers we run.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 这些是在`postgres`镜像和我们运行的容器中设置的默认值。
- en: 'For more clarity, you can take a look at this line, in the official Postgres
    Docker library:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 要更清楚地了解，您可以查看官方Postgres Docker库中的这一行。
- en: 'You can obtain a Postgres Docker sample from GitHub at: [https://github.com/docker-library/postgres/blob/master/10/docker-entrypoint.sh#L101.](https://github.com/docker-library/postgres/blob/master/10/docker-entrypoint.sh#L101.)'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以从GitHub获取一个Postgres Docker示例：[https://github.com/docker-library/postgres/blob/master/10/docker-entrypoint.sh#L101.](https://github.com/docker-library/postgres/blob/master/10/docker-entrypoint.sh#L101.)
- en: '![Run the WordPress Containers](graphics/image02_23.jpg)'
  id: totrans-263
  prefs: []
  type: TYPE_IMG
  zh: '![运行WordPress容器](graphics/image02_23.jpg)'
- en: As earlier explained, the Host is `DB` because the service name is `db` that
    is created by running the `postgres` image.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，主机是`DB`，因为服务名称是通过运行`postgres`镜像创建的`db`。
- en: 'You can obtain a Postgres Docker example from GitHub at: [https://github.com/docker-library/postgres/blob/master/10/Dockerfile#L132:](https://github.com/docker-library/postgres/blob/master/10/Dockerfile#L132:)'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以从GitHub获取一个Postgres Docker示例：[https://github.com/docker-library/postgres/blob/master/10/Dockerfile#L132:](https://github.com/docker-library/postgres/blob/master/10/Dockerfile#L132:)
- en: '![Run the WordPress Containers](graphics/image02_24.jpg)'
  id: totrans-266
  prefs: []
  type: TYPE_IMG
  zh: '![运行WordPress容器](graphics/image02_24.jpg)'
- en: Indirectly, it proves why the `settings.py` was configured in that manner.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 间接地证明了为什么以那种方式配置了`settings.py`。
- en: Summary
  id: totrans-268
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: 'In this lesson, we have done the following:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 在本课程中，我们已经完成了以下工作：
- en: Discussed and displayed a multi-container setup
  id: totrans-270
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 讨论并展示了一个多容器设置
- en: Walked through `docker-compose` commands to build and run multiple containers
    in a parallel manner
  id: totrans-271
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过`docker-compose`命令逐步构建和运行多个容器
- en: Gained a high-level understanding of networking containers and how data is persisted
    in a container from local machines
  id: totrans-272
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获得了对容器网络和如何在本地机器上持久保存数据的高层理解
- en: Built and run applications without even setting them up, via Docker Hub
  id: totrans-273
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 构建和运行应用程序，甚至无需设置，通过Docker Hub
