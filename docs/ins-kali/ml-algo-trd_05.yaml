- en: '5'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '5'
- en: Portfolio Optimization and Performance Evaluation
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 投资组合优化和绩效评估
- en: Alpha factors generate signals that an algorithmic strategy translates into
    trades, which, in turn, produce long and short positions. The returns and risk
    of the resulting portfolio determine the success of the strategy.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: Alpha因子产生信号，算法策略将其转化为交易，进而产生多头和空头头寸。由此产生的投资组合的回报和风险决定了策略的成功与否。
- en: To test a strategy prior to implementation under market conditions, we need
    to simulate the trades that the algorithm would make and verify their performance.
    Strategy evaluation includes backtesting against historical data to optimize the
    strategy's parameters and forward-testing to validate the in-sample performance
    against new, out-of-sample data. The goal is to avoid false discoveries from tailoring
    a strategy to specific past circumstances.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在市场条件下实施策略之前，我们需要模拟算法将进行的交易，并验证其绩效。策略评估包括针对历史数据进行回测，以优化策略的参数，并进行前向测试，以验证样本内绩效对新的样本外数据的有效性。目标是避免根据特定过去情况调整策略而产生虚假发现。
- en: In a portfolio context, positive asset returns can offset negative price movements.
    Positive price changes for one asset are more likely to offset losses on another,
    the lower the correlation between the two positions is. Based on how portfolio
    risk depends on the positions' covariance, Harry Markowitz developed the theory
    behind modern portfolio management based on diversification in 1952\. The result
    is mean-variance optimization, which selects weights for a given set of assets
    to minimize risk, measured as the standard deviation of returns for a given expected
    return.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在投资组合环境中，正的资产回报可以抵消价格下跌。一个资产的正的价格变化更有可能抵消另一个资产的损失，两个头寸之间的相关性越低，这种抵消的可能性就越大。基于投资组合风险取决于头寸协方差的方式，哈里·马科维茨在1952年开发了现代投资组合管理理论，该理论基于分散化选择权重以最小化风险，该风险以给定预期回报的回报标准差来衡量。
- en: The **capital asset pricing model** (**CAPM**) introduces a risk premium, measured
    as the expected return in excess of a risk-free investment, as an equilibrium
    reward for holding an asset. This reward compensates for the exposure to a single
    risk factor—the market—that is systematic as opposed to idiosyncratic to the asset
    and thus cannot be diversified away.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '**资本资产定价模型**（**CAPM**）引入了风险溢价，以超出无风险投资的预期回报来衡量，作为持有资产的均衡回报。这种回报是对持有单一风险因素——市场风险的补偿，这种风险是系统性的，与资产特有的风险相对，因此无法通过分散化消除。'
- en: Risk management has evolved to become more sophisticated as additional risk
    factors and more granular choices for exposure have emerged. The Kelly criterion
    is a popular approach to dynamic portfolio optimization, which is the choice of
    a sequence of positions over time; it was famously adapted from its original application
    in gambling to the stock market by Edward Thorp in 1968.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 随着额外的风险因素和更细粒度的暴露选择的出现，风险管理已经发展成为更复杂的形式。凯利准则是动态投资组合优化的一种流行方法，它是选择一系列随时间变化的头寸的选择；它最初是由爱德华·索普在1968年从赌博中成功地应用到股票市场的。
- en: As a result, there are several approaches to optimize portfolios, including
    the application of **machine learning** (**ML**) to learn hierarchical relationships
    among assets, and to treat their holdings as complements or substitutes with respect
    to the portfolio risk profile.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，有几种方法可以优化投资组合，包括应用**机器学习**（**ML**）来学习资产之间的层次关系，并将它们的持有作为投资组合风险配置的补充或替代品。
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: How to measure portfolio risk and return
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何衡量投资组合风险和回报
- en: Managing portfolio weights using mean-variance optimization and alternatives
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用均值方差优化和替代方法管理投资组合权重
- en: Using machine learning to optimize asset allocation in a portfolio context
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用机器学习优化投资组合配置
- en: Simulating trades and create a portfolio based on alpha factors using Zipline
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Zipline模拟交易并基于alpha因子创建投资组合
- en: How to evaluate portfolio performance using pyfolio
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何使用pyfolio评估投资组合绩效
- en: You can find the code samples for this chapter and links to additional resources
    in the corresponding directory of the GitHub repository. The notebooks include
    color versions of the images..
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在GitHub存储库的相应目录中找到本章的代码示例和其他资源的链接。笔记本包括图像的彩色版本。
- en: How to measure portfolio performance
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何衡量投资组合绩效
- en: To evaluate and compare different strategies or to improve an existing strategy,
    we need metrics that reflect their performance with respect to our objectives.
    In investment and trading, the most common objectives are the return and the risk
    of the investment portfolio.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 为了评估和比较不同的策略，或者改进现有的策略，我们需要反映它们相对于我们目标的绩效的度量标准。在投资和交易中，最常见的目标是投资组合的回报和风险。
- en: Typically, these metrics are compared to a benchmark that represents alternative
    investment opportunities, such as a summary of the investment universe like the
    S&P 500 for US equities or the risk-free interest rate for fixed income assets.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，这些指标会与代表替代投资机会的基准进行比较，比如代表美国股票的标普500指数，或者固定收益资产的无风险利率。
- en: There are several metrics to evaluate these objectives. In this section, we
    will review the most common measures for comparing portfolio results. These measures
    will be useful when we look at different approaches to optimize portfolio performance,
    simulate the interaction of a strategy with the market using Zipline, and compute
    relevant performance metrics using the pyfolio library in later sections.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 有几种指标可以评估这些目标。在本节中，我们将回顾比较投资组合结果的最常见的度量标准。当我们研究不同的方法来优化投资组合绩效，使用Zipline模拟策略与市场的交互，并在后续章节中使用pyfolio库计算相关绩效指标时，这些度量标准将会很有用。
- en: 'We''ll use some simple notation: let *R* be the time series of one-period simple
    portfolio returns, *R*=(*r*[1], ..., *r*[T]), from dates 1 to *T*, and *R*^f =(*r*^f[1],
    ..., *r*^f[T]) be the matching time series of risk-free rates, so that *R*[e]=*R*-*R*[f]
    =(*r*[1]-*r*^f[1],..., *r*[T]-*r*^f[T]) is the excess return.'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用一些简单的符号：让*R*是一个期简单投资组合回报的时间序列，*R*=(*r*[1], ..., *r*[T])，从日期1到*T*，*R*^f=(*r*^f[1],
    ..., *r*^f[T])是相匹配的无风险利率的时间序列，这样*R*[e]=*R*-*R*[f]=(*r*[1]-*r*^f[1],..., *r*[T]-*r*^f[T])是超额回报。
- en: Capturing risk-return trade-offs in a single number
  id: totrans-20
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在一个数字中捕捉风险和回报的权衡
- en: 'The return and risk objectives imply a trade-off: taking more risk may yield
    higher returns in some circumstances, but also implies greater downside. To compare
    how different strategies navigate this trade-off, ratios that compute a measure
    of return per unit of risk are very popular. We''ll discuss the Sharpe ratio and
    the information ratio in turn.'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 预期回报和波动性是不可观测的，但可以从历史数据中估计如下：
- en: The Sharpe ratio
  id: totrans-22
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '>'
- en: 'The ex ante **Sharpe ratio** (**SR**) compares the portfolio''s expected excess
    return to the volatility of this excess return, measured by its standard deviation.
    It measures the compensation as the average excess return per unit of risk taken:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 先验夏普比率（SR）将投资组合的预期超额回报与这种超额回报的波动性进行比较，由其标准差来衡量。它衡量了作为单位风险承担的平均超额回报：
- en: '![](img/B15439_05_001.png)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_001.png)'
- en: 'Expected returns and volatilities are not observable, but can be estimated
    as follows from historical data:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 当你需要比较不同频率的夏普比率时，比如月度和年度数据，你可以将更高频率的夏普比率乘以包含在较低频率中的相应期间的平方根。要将月度夏普比率转换为年度夏普比率，乘以![](img/B15439_05_007.png)，从每日到每月的转换则乘以![](img/B15439_05_007.png)。
- en: '![](img/B15439_05_002.png)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: 夏普比率
- en: Unless the risk-free rate is volatile (as in emerging markets), the standard
    deviation of excess and raw returns will be similar.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 除非无风险利率波动很大（如新兴市场），超额和原始回报的标准差将是相似的。
- en: For **independently and identically distributed** (**IID**) returns, the distribution
    of the SR estimator for tests of statistical significance follows from the application
    of the **central limit theorem** (**CLT**), according to large-sample statistical
    theory, to ![](img/B15439_05_003.png) and ![](img/B15439_05_004.png). The CLT
    implies that sums of IID random variables like ![](img/B15439_05_003.png) and
    ![](img/B15439_05_006.png) converge to the normal distribution.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 对于独立同分布的回报，夏普比率估计的分布用于统计显著性检验，根据大样本统计理论，遵循中心极限定理，对![](img/B15439_05_003.png)和![](img/B15439_05_004.png)。中心极限定理意味着独立同分布的随机变量的总和，如![](img/B15439_05_003.png)和![](img/B15439_05_006.png)，收敛于正态分布。
- en: When you need to compare SR for different frequencies, say for monthly and annual
    data, you can multiply the higher frequency SR by the square root of the number
    of the corresponding period contained in the lower frequency. To convert a monthly
    SR into an annual SR, multiply by ![](img/B15439_05_007.png), and from daily to
    monthly multiply by ![](img/B15439_05_007.png).
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '- 沃伦·巴菲特'
- en: However, financial returns often violate the IID assumption. Andrew Lo has derived
    the necessary adjustments to the distribution and the time aggregation for returns
    that are stationary but autocorrelated. This is important because the time-series
    properties of investment strategies (for example, mean reversion, momentum, and
    other forms of serial correlation) can have a non-trivial impact on the SR estimator
    itself, especially when annualizing the SR from higher-frequency data (Lo, 2002).
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，金融回报经常违反独立同分布的假设。安德鲁·罗已经推导出了对分布和时间聚合的必要调整，用于具有稳定但自相关的回报。这很重要，因为投资策略的时间序列特性（例如，均值回归、动量和其他形式的串行相关）对夏普比率估计本身可能产生非常重要的影响，特别是在从高频数据年化夏普比率时（Lo，2002）。
- en: The information ratio
  id: totrans-31
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 信息比率
- en: The **information ratio** (**IR**) is similar to the Sharpe ratio but uses a
    benchmark rather than the risk-free rate. The benchmark is usually chosen to represent
    the available investment universe such as the S&P 500 for a portfolio on large-cap
    US equities.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 信息比率（IR）类似于夏普比率，但使用基准而不是无风险利率。基准通常被选择为代表可用投资领域的投资组合，例如标普500指数代表大型美国股票投资组合。
- en: 'Hence, the IR measures the excess return of the portfolio, also called alpha,
    relative to the tracking error, which is the deviation of the portfolio returns
    from the benchmark returns, that is:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，信息比率衡量了投资组合的超额回报，也称为阿尔法，相对于跟踪误差，即投资组合回报与基准回报的偏差：
- en: '![](img/B15439_05_009.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_009.png)'
- en: The IR has also been used to explain how excess returns depend on a manager's
    skill and the nature of her strategy, as we will see next.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 夏普比率
- en: The fundamental law of active management
  id: totrans-36
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 主动管理的基本法则
- en: '"Diversification is protection against ignorance. It makes little sense if
    you know what you are doing."'
  id: totrans-37
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “分散是对无知的保护。如果你知道自己在做什么，这就没有多大意义。”
- en: '>'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 回报和风险目标意味着一种权衡：在某些情况下，承担更多风险可能会带来更高的回报，但也意味着更大的下行风险。为了比较不同策略如何应对这种权衡，计算单位风险回报的比率非常受欢迎。我们将依次讨论夏普比率和信息比率。
- en: – Warren Buffet
  id: totrans-39
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 信息比率还被用来解释超额回报如何取决于经理的技能和她的策略的性质，我们将在下面看到。
- en: It's a curious fact that **Renaissance Technologies** (**RenTec**), the top-performing
    quant fund founded by Jim Simons, which we mentioned in *Chapter 1*, *Machine
    Learning for Trading – From Idea to Execution*, has produced similar returns as
    Warren Buffet, despite extremely different approaches. Warren Buffet's investment
    firm Berkshire Hathaway holds some 100-150 stocks for fairly long periods, whereas
    RenTec may execute 100,000 trades per day. How can we compare these distinct strategies?
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 有趣的是，文艺复兴技术（RenTec），由吉姆·西蒙斯创立的表现最佳的量化基金，我们在第1章《交易的机器学习-从构想到执行》中提到过，尽管采取极端不同的方法，但产生了与沃伦·巴菲特类似的回报。沃伦·巴菲特的投资公司伯克希尔哈撒韦持有大约100-150只股票，持有时间相当长，而RenTec可能每天执行10万次交易。我们如何比较这些不同的策略呢？
- en: 'A high IR reflects an attractive out-performance of the benchmark relative
    to the additional risk taken. The **Fundamental Law of Active Management** explains
    how such a result can be achieved: it approximates the IR as the product of the
    **information coefficient** (**IC**) and the breadth of the strategy.'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 高IR反映了相对于额外风险所取得的基准超额表现。**主动管理的基本定律**解释了如何实现这样的结果：它将IR近似为**信息系数**（IC）和策略广度的乘积。
- en: As discussed in the previous chapter, the IC measures the rank correlation between
    return forecasts, like those implied by an alpha factor, and the actual forward
    returns. Hence, it is a measure of the forecasting skill of the manager. The breadth
    of the strategy is measured by the independent number of bets (that is, trades)
    an investor makes in a given time period, and thus represents the ability to apply
    the forecasting skills.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 如前一章所述，IC衡量了回报预测之间的等级相关性，比如由α因子暗示的预期回报和实际前瞻回报。因此，它是对管理人员预测能力的衡量。策略的广度由投资者在给定时间段内进行的独立投注（即交易）数量来衡量，因此代表了应用预测能力的能力。
- en: 'The Fundamental Law states that the IR, also known as the **appraisal risk**
    (Treynor and Black), is the product of both values. In other words, it summarizes
    the importance to play both often (high breadth) and to play well (high IC):'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 基本定律规定IR，也被称为**评估风险**（Treynor和Black），是这两个值的乘积。换句话说，它总结了频繁参与（高广度）和出色表现（高IC）的重要性：
- en: '![](img/B15439_05_010.png)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_010.png)'
- en: 'This framework has been extended to include the **transfer coefficient** (**TC**)
    to reflect portfolio constraints as an additional factor (for example, on short-selling)
    that may limit the information ratio below a level otherwise achievable given
    IC or strategy breadth. The TC proxies the efficiency with which the manager translates
    insights into portfolio bets: if there are no constraints, the TC would simply
    equal one; but if the manager does not short stocks even though forecasts suggests
    they should, the TC will be less than one and reduce the IC (Clarke et al., 2002).'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 这个框架已经扩展到包括**转移系数**（TC），以反映投资组合约束作为一个额外因素（例如，对做空的限制），这可能会限制信息比率低于IC或策略广度本应达到的水平。TC代表了管理人员将见解转化为投资组合赌注的效率：如果没有约束，TC将简单地等于一；但如果管理人员尽管预测表明应该这样做，却不做空股票，TC将小于一并降低IC（Clarke等，2002）。
- en: 'The Fundamental Law is important because it highlights the key drivers of outperformance:
    both accurate predictions and the ability to make independent forecasts and act
    on these forecasts matter.'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 基本定律之所以重要，是因为它突出了超额表现的关键驱动因素：准确的预测和能够独立预测并采取行动的能力都很重要。
- en: 'In practice, managers with a broad set of investment decisions can achieve
    significant risk-adjusted excess returns with information coefficients between
    0.05 and 0.15, as illustrated by the following simulation:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 在实践中，拥有广泛投资决策的管理人员可以通过信息系数在0.05到0.15之间实现显著的风险调整超额回报，如下模拟所示：
- en: '![](img/B15439_05_01.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_01.png)'
- en: 'Figure 5.1: Information ratios for different values of breadth and information
    coefficient'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.1：不同广度和信息系数数值的信息比率
- en: In practice, estimating the breadth of a strategy is difficult, given the cross-sectional
    and time-series correlation among forecasts. You should view the Fundamental Law
    and its extensions as a useful analytical framework for thinking about how to
    improve your risk-adjusted portfolio performance. We'll look at techniques for
    doing so in practice next.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在实践中，估计策略的广度是困难的，考虑到预测之间的横截面和时间序列相关性。您应该将基本定律及其扩展视为一个有用的分析框架，用于思考如何改善您的风险调整投资组合表现。接下来我们将探讨实际的改进技术。
- en: How to manage portfolio risk and return
  id: totrans-51
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何管理投资组合的风险和回报
- en: Portfolio management aims to pick and size positions in financial instruments
    that achieve the desired risk-return trade-off regarding a benchmark. As a portfolio
    manager, in each period, you select positions that optimize diversification to
    reduce risks while achieving a target return. Across periods, these positions
    may require rebalancing to account for changes in weights resulting from price
    movements to achieve or maintain a target risk profile.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 投资组合管理旨在选择和确定金融工具的头寸，以实现相对于基准的期望风险-回报权衡。作为投资组合经理，在每个时期，您选择优化分散的头寸，以降低风险同时实现目标回报。在不同时期，这些头寸可能需要重新平衡，以考虑价格变动导致的权重变化，以实现或维持目标风险配置。
- en: The evolution of modern portfolio management
  id: totrans-53
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 现代投资组合管理的演变
- en: Diversification permits us to reduce risks for a given expected return by exploiting
    how imperfect correlation allows for one asset's gains to make up for another
    asset's losses. Harry Markowitz invented **modern portfolio theory** (**MPT**)
    in 1952 and provided the mathematical tools to optimize diversification by choosing
    appropriate portfolio weights.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 通过分散投资，我们可以通过利用不完美相关性使一个资产的收益弥补另一个资产的损失来降低给定预期回报的风险。哈里·马科维茨于1952年发明了**现代投资组合理论**（MPT）并提供了优化分散投资的数学工具。
- en: Markowitz showed how portfolio risk, measured as the standard deviation of portfolio
    returns, depends on the covariance among the returns of all assets and their relative
    weights. This relationship implies the existence of an **efficient frontier**
    of portfolios that maximizes portfolio returns given a maximal level of portfolio
    risk.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 马科维茨展示了投资组合风险（以投资组合回报的标准差衡量）如何取决于所有资产回报之间的协方差和它们的相对权重。这种关系意味着存在一组投资组合的**有效边界**，在最大化投资组合回报的同时给定最大水平的投资组合风险。
- en: However, mean-variance frontiers are highly sensitive to the estimates of the
    inputs required for their calculation, namely expected returns, volatilities,
    and correlations. In practice, mean-variance portfolios that constrain these inputs
    to reduce sampling errors have performed much better. These constrained special
    cases include equal-weighted, minimum-variance, and risk-parity portfolios.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，均值-方差前沿对于其计算所需的输入的估计非常敏感，即预期回报、波动性和相关性。实际上，将这些输入约束以减少抽样误差的均值-方差投资组合表现得更好。这些受约束的特殊情况包括等权、最小方差和风险平价投资组合。
- en: The **capital asset pricing model** (**CAPM**) is an asset valuation model that
    builds on the MPT risk-return relationship. It introduces the concept of a risk
    premium that an investor can expect in market equilibrium for holding a risky
    asset; the premium compensates for the time value of money and the exposure to
    overall market risk that cannot be eliminated through diversification (as opposed
    to the idiosyncratic risk of specific assets).
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: '**资本资产定价模型**（**CAPM**）是一种资产估值模型，建立在MPT风险-回报关系的基础上。它引入了一个概念，即投资者可以期望在市场均衡状态下持有风险资产时获得的风险溢价；该溢价补偿了货币的时间价值和无法通过分散化消除的整体市场风险的暴露（与特定资产的特异风险相对）。'
- en: 'The economic rationale for **non-diversifiable risk** includes, for example,
    macro drivers of the business risks affecting all equity returns or bond defaults.
    Hence, an asset''s expected return, *E*[*r*[i]], is the sum of the risk-free interest
    rate, *r*[f], and a risk premium proportional to the asset''s exposure to the
    expected excess return of the market portfolio, *r*[m], over the risk-free rate:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '**不可分散风险**的经济基础包括，例如，影响所有股票回报或债券违约的宏观风险驱动因素。因此，资产的预期回报，*E*[*r*[i]]，是无风险利率*r*[f]和风险溢价的总和，该风险溢价与资产对市场组合预期超额回报*r*[m]与无风险利率之间的比例成正比。'
- en: '![](img/B15439_05_011.png)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_011.png)'
- en: In theory, the **market portfolio** contains all investable assets and, in equilibrium,
    will be held by all rational investors. In practice, a broad value-weighted index
    approximates the market, for example, the S&P 500 for US equity investments.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 理论上，**市场组合**包含所有可投资的资产，并且在均衡状态下将被所有理性投资者持有。实际上，一个广泛的价值加权指数近似代表市场，例如，标普500代表美国股票投资。
- en: '![](img/B15439_05_012.png) measures the exposure of asset, *i*, to the excess
    returns of the market portfolio. If the CAPM is valid, the intercept component,
    ![](img/B15439_05_013.png), should be zero. In reality, the CAPM assumptions are
    often not met, and alpha captures the returns left unexplained by exposure to
    the broad market.'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '![](img/B15439_05_012.png)衡量了资产*i*对市场组合超额回报的暴露。如果CAPM有效，则截距项![](img/B15439_05_013.png)应为零。实际上，CAPM的假设通常不成立，而阿尔法捕获了未被广泛市场暴露所解释的回报。'
- en: As discussed in the previous chapter, over time, research uncovered **non-traditional
    sources of risk premiums**, such as the momentum or the equity value effects that
    explained some of the original alpha. Economic rationales, such as behavioral
    biases of under- or overreaction by investors to new information, justify risk
    premiums for exposure to these alternative risk factors.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 正如前一章所讨论的，随着时间的推移，研究发现了**非传统的风险溢价来源**，例如动量或股票价值效应，解释了一些原始阿尔法。经济原理，例如投资者对新信息的欠反应或过度反应的行为偏见，为暴露于这些替代风险因素的风险溢价提供了合理的理由。
- en: These factors evolved into investment styles designed to capture these **alternative
    betas** that became tradable in the form of specialized index funds. Similarly,
    risk management now aims to control the exposure of numerous sources of risk beyond
    the market portfolio.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 这些因素演变成了旨在捕捉这些**替代贝塔**的投资风格，这些贝塔以专门的指数基金的形式可交易。同样，风险管理现在旨在控制除市场组合之外的多种风险来源的暴露。
- en: After isolating contributions from these alternative risk premiums, true alpha
    becomes limited to idiosyncratic asset returns and the manager's ability to time
    risk exposures.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 在隔离这些替代风险溢价的贡献之后，真正的阿尔法被限制为特异资产回报和管理者对风险敞口的时机能力。
- en: The **efficient market hypothesis** (**EMH**) has been refined over the past
    several decades to rectify many of the original shortcomings of the CAPM, including
    imperfect information and the costs associated with transactions, financing, and
    agency. Many behavioral biases have the same effect, and some frictions are modeled
    as behavioral biases.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: '**有效市场假说**（**EMH**）在过去几十年里得到了改进，以纠正CAPM的许多原始缺陷，包括信息不完善以及与交易、融资和代理相关的成本。许多行为偏见具有相同的效果，一些摩擦被建模为行为偏见。'
- en: 'Modern portfolio theory and practice have evolved significantly over the last
    several decades. We will introduce several approaches:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 现代投资组合理论和实践在过去几十年里有了显著的发展。我们将介绍几种方法：
- en: Mean-variance optimization, and its shortcomings
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 均值-方差优化及其缺陷
- en: Alternatives such as minimum-risk and 1/*n* allocation
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最小风险和1/*n*分配等替代方案
- en: Risk parity approaches
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 风险平价方法
- en: Risk factor approaches
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 风险因素方法
- en: Mean-variance optimization
  id: totrans-71
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 均值-方差优化
- en: Modern portfolio theory solves for the optimal portfolio weights to minimize
    volatility for a given expected return or maximize returns for a given level of
    volatility. The key requisite inputs are expected asset returns, standard deviations,
    and the covariance matrix.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 现代投资组合理论解决了最小化给定预期回报的波动性或最大化给定波动性水平的回报的最优投资组合权重。关键的输入要求是预期资产回报、标准差和协方差矩阵。
- en: How it works
  id: totrans-73
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 它是如何运作的
- en: Diversification works because the variance of portfolio returns depends on the
    covariance of the assets. It can be reduced below the weighted average of the
    asset variances by including assets with less than perfect correlation.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 分散化有效是因为投资组合回报的方差取决于资产的协方差。通过包含与完美相关性以下的资产，可以将其降低到资产方差的加权平均值以下。
- en: 'In particular, given a vector, ![](img/B15439_05_014.png), of portfolio weights
    and the covariance matrix, ![](img/B15439_04_009.png), the portfolio variance,
    ![](img/B15439_05_016.png), is defined as:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 特别是，给定一个向量，![](img/B15439_05_014.png)，表示投资组合权重和协方差矩阵，![](img/B15439_04_009.png)，投资组合方差，![](img/B15439_05_016.png)，定义为：
- en: '![](img/B15439_05_017.png)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_017.png)'
- en: 'Markowitz showed that the problem of maximizing the expected portfolio return
    subject to a target risk has an equivalent dual representation of minimizing portfolio
    risk, subject to a target expected return level, ![](img/B15439_05_018.png). Hence,
    the optimization problem becomes:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 马科维茨表明，最大化预期投资组合回报的问题，受到目标风险的等效双重表示，即最小化投资组合风险，受到目标预期回报水平的约束，![](img/B15439_05_018.png)。因此，优化问题变为：
- en: '![](img/B15439_05_019.png)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_019.png)'
- en: Finding the efficient frontier in Python
  id: totrans-79
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在Python中找到有效边界
- en: 'We can calculate an efficient frontier using `scipy.optimize.minimize` and
    the historical estimates for asset returns, standard deviations, and the covariance
    matrix. SciPy ''s `minimize` function implements a range of constrained and unconstrained
    optimization algorithms for scalar functions that output a single number from
    one or more input variables (see the SciPy documentation for more details). The
    code can be found in the `strategy_evaluation` subfolder of the repository for
    this chapter and implements the following sequence of steps:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`scipy.optimize.minimize`和资产收益、标准差和协方差矩阵的历史估计来计算有效边界。SciPy的`minimize`函数实现了一系列约束和无约束的优化算法，用于输出一个或多个输入变量的标量函数（有关更多详细信息，请参阅SciPy文档）。代码可以在本章的存储库的`strategy_evaluation`子文件夹中找到，并实现以下步骤序列：
- en: 'First, the simulation generates random weights using the Dirichlet distribution
    and computes the mean, standard deviation, and SR for each sample portfolio using
    the historical return data:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，模拟使用Dirichlet分布生成随机权重，并使用历史回报数据计算每个样本投资组合的均值、标准差和SR：
- en: '[PRE0]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Next, we set up the quadratic optimization problem to solve for the minimum
    standard deviation for a given return or the maximum SR. To this end, we define
    the functions that measure the key performance metrics:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们设置二次优化问题，以解决给定回报的最小标准差或最大SR。为此，我们定义了衡量关键绩效指标的函数：
- en: '[PRE1]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Next, we define a target function that represents the negative SR for scipy''s
    `minimize` function to optimize, given the constraints that the weights are bounded
    by, [0, 1], and sum to one in absolute terms:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们定义一个目标函数，代表了scipy的`minimize`函数的负SR，以优化权重受到[0, 1]的限制，并且绝对值之和为一：
- en: '[PRE2]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Then, we compute the efficient frontier by iterating over a range of target
    returns and solving for the corresponding minimum variance portfolios. To this
    end, we formulate the optimization problem using the constraints on portfolio
    risk and return as a function of the weights, as follows:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们通过迭代一系列目标回报范围，并解决相应的最小方差投资组合，来计算有效边界。为此，我们使用投资组合风险和回报的约束作为权重的函数来制定优化问题，如下所示：
- en: '[PRE3]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The solution requires iterating over ranges of acceptable values to identify
    optimal risk-return combinations:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 解决方案需要在可接受值范围内进行迭代，以确定最佳的风险-回报组合：
- en: '[PRE4]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The simulation yields a subset of the feasible portfolios, and the efficient
    frontier identifies the optimal in-sample return-risk combinations that were achievable
    given historic data.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 模拟产生了一部分可行的投资组合，有效边界确定了在历史数据给定的情况下可实现的最佳样本内回报风险组合。
- en: '*Figure 5.2* shows the result, including the minimum variance portfolio, the
    portfolio that maximizes the SR, and several portfolios produced by alternative
    optimization strategies that we''ll discuss in the following sections:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5.2*显示了结果，包括最小方差投资组合、最大化SR的投资组合，以及几个由替代优化策略产生的投资组合，我们将在接下来的章节中讨论：'
- en: '![](img/B15439_05_02.png)'
  id: totrans-93
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_02.png)'
- en: 'Figure 5.2: The efficient frontier and different optimized portfolios'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.2：有效边界和不同的优化投资组合
- en: The portfolio optimization can be run at every evaluation step of the trading
    strategy to optimize the positions.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 投资组合优化可以在交易策略的每个评估步骤中运行，以优化头寸。
- en: Challenges and shortcomings
  id: totrans-96
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 挑战和缺陷
- en: The preceding mean-variance frontier estimation illustrates **in-sample**, that
    is, **backward-looking** optimization. In practice, portfolio optimization requires
    forward-looking inputs and outputs. However, expected returns are notoriously
    difficult to estimate accurately. It is best viewed as a starting point and benchmark
    for numerous improvements.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 前述的均值方差边界估计说明了**样本内**，即**向后看**的优化。在实践中，投资组合优化需要前瞻性的输入和输出。然而，预期回报极其难以准确估计。最好将其视为众多改进的起点和基准。
- en: 'The covariance matrix can be estimated somewhat more reliably, which has given
    rise to several alternative approaches. However, covariance matrices with correlated
    assets pose computational challenges since the optimization problem requires inverting
    the matrix. The high condition number induces numerical instability, which in
    turn gives rise to the **Markovitz curse**: the more diversification is required
    (by correlated investment opportunities), the more unreliable the weights produced
    by the algorithm.'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 协方差矩阵可以更可靠地估计，这导致了几种替代方法的出现。然而，具有相关资产的协方差矩阵会带来计算上的挑战，因为优化问题需要求逆矩阵。高条件数会导致数值不稳定，从而产生**马科维茨诅咒**：需要更多分散化（通过相关的投资机会），算法产生的权重就越不可靠。
- en: Many investors prefer to use portfolio-optimization techniques with less onerous
    input requirements. We will now introduce several alternatives that aim to address
    these shortcomings, including a more recent approach based on machine learning.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 许多投资者更喜欢使用投资组合优化技术，其输入要求较少。我们现在将介绍几种旨在解决这些缺点的替代方法，包括基于机器学习的更近期的方法。
- en: Alternatives to mean-variance optimization
  id: totrans-100
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 均值方差优化的替代方案
- en: The challenges with accurate inputs for the mean-variance optimization problem
    have led to the adoption of several practical alternatives that constrain the
    mean, the variance, or both, or omit return estimates that are more challenging,
    such as the risk parity approach, which we'll discuss later in this section.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 对于均值方差优化问题的准确输入的挑战导致采用了几种实际的替代方案，这些替代方案限制了均值、方差或两者，或者省略了更具挑战性的回报估计，比如风险平价方法，我们将在本节后面讨论。
- en: The 1/N portfolio
  id: totrans-102
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1/N投资组合
- en: Simple portfolios provide useful benchmarks to gauge the added value of complex
    models that generate the risk of overfitting. The simplest strategy—an **equally-weighted
    portfolio**—has been shown to be one of the best performers.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 简单的投资组合提供了有用的基准，用于衡量产生过度拟合风险的复杂模型的附加价值。最简单的策略 - **等权投资组合** - 已被证明是最佳表现之一。
- en: Famously, de Miguel, Garlappi, and Uppal (2009) compared the out-of-sample performance
    of portfolios produced by various mean-variance optimizers, including robust Bayesian
    estimators, portfolio constraints, and optimal combinations of portfolios, to
    the simple 1/N rule. They found that the 1/N portfolio produced a higher Sharpe
    ratio than the alternatives on various datasets, explained by the high cost of
    estimation errors that often outweighs the benefits of sophisticated optimization
    out of sample.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 著名的de Miguel，Garlappi和Uppal（2009）比较了由各种均值方差优化器产生的投资组合的外样本表现，包括鲁棒的贝叶斯估计器，投资组合约束和投资组合的最佳组合，与简单的1/N规则。他们发现，1/N投资组合在各种数据集上产生了比其他选择更高的夏普比率，这是由于估计误差的高成本往往超过了复杂优化的外样本收益。
- en: More specifically, they found that the estimation window required for the sample-based
    mean-variance strategy and its extensions to outperform the 1/N benchmark is around
    3,000 months for a portfolio with 25 assets and about 6,000 months for a portfolio
    with 50 assets.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 更具体地说，他们发现，对于具有25个资产的投资组合，基于样本的均值方差策略及其对1/N基准的扩展要超过3000个月的估计窗口，而对于具有50个资产的投资组合，要超过6000个月。
- en: The 1/N portfolio is also included in *Figure 5.2* in the previous section.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 1/N投资组合也包括在前一节的*图5.2*中。
- en: The minimum-variance portfolio
  id: totrans-107
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 最小方差组合
- en: 'Another alternative is the **global minimum-variance** (**GMV**) portfolio,
    which prioritizes the minimization of risk. It is shown in *Figure 5.2* and can
    be calculated, as follows, by minimizing the portfolio standard deviation using
    the mean-variance framework:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个选择是**全局最小方差**（**GMV**）投资组合，它优先考虑风险的最小化。它在*图5.2*中显示，并且可以通过使用均值方差框架最小化投资组合标准差来计算，如下所示：
- en: '[PRE5]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The corresponding minimum volatility portfolio lies on the efficient frontier,
    as shown previously in *Figure 5.2*.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 相应的最小波动率组合位于有效边界上，如前面的*图5.2*所示。
- en: Global Portfolio Optimization – the Black-Litterman approach
  id: totrans-111
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 全局投资组合优化 - Black-Litterman方法
- en: The **Global Portfolio Optimization** approach of Black and Litterman (1992)
    combines economic models with statistical learning. It is popular because it generates
    estimates of expected returns that are plausible in many situations.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: Black和Litterman（1992）的**全局投资组合优化**方法将经济模型与统计学习相结合。它很受欢迎，因为它能够在许多情况下生成可信的预期收益估计。
- en: The technique assumes that the market is a mean-variance portfolio, as implied
    by the CAPM equilibrium model. It builds on the fact that the observed market
    capitalization can be considered as optimal weights assigned to each security
    by the market. Market weights reflect market prices that, in turn, embody the
    market's expectations of future returns.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 该技术假设市场是一个均值方差投资组合，正如CAPM均衡模型所暗示的那样。它建立在这样一个事实上，即观察到的市场资本化可以被视为市场对每个证券分配的最佳权重。市场权重反映了市场价格，而市场价格又体现了市场对未来收益的预期。
- en: The approach can thus reverse-engineer the unobservable future expected returns
    from the assumption that the market is close enough to equilibrium, as defined
    by the CAPM. Investors can adjust these estimates to their own beliefs using a
    shrinkage estimator. The model can be interpreted as a Bayesian approach to portfolio
    optimization. We will introduce Bayesian methods in *Chapter 10*, *Bayesian ML
    – Dynamic Sharpe Ratios and Pairs Trading Strategies*.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 该方法因此可以通过假设市场接近CAPM定义的均衡来反向工程未来预期收益，投资者可以使用缩小估计器调整这些估计值以符合自己的信念。该模型可以被解释为投资组合优化的贝叶斯方法。我们将在*第10章*《贝叶斯ML
    - 动态夏普比率和配对交易策略》中介绍贝叶斯方法。
- en: How to size your bets – the Kelly criterion
  id: totrans-115
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 如何确定下注的大小 - 凯利准则
- en: The **Kelly criterion** has a long history in gambling because it provides guidance
    on how much to stake on each bet in an (infinite) sequence of bets with varying
    (but favorable) odds to maximize terminal wealth. It was published in a 1956 paper,
    *A New Interpretation of the Information Rate*, by John Kelly, who was a colleague
    of Claude Shannon's at Bell Labs. He was intrigued by bets placed on candidates
    at the new quiz show "The $64,000 Question," where a viewer on the west coast
    used the three-hour delay to obtain insider information about the winners.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: '**凯利准则**在赌博中有着悠久的历史，因为它提供了在（无限）一系列具有不同（但有利）赔率的赌注上押注多少以最大化终端财富的指导。它是由约翰·凯利在1956年的一篇名为《信息速率的新解释》的论文中发表的，他是克劳德·香农在贝尔实验室的同事。他对在新的问答节目“6.4万美元的问题”上对候选人下的赌注感到好奇，西海岸的观众利用三小时的延迟获取内幕消息。'
- en: Kelly drew a connection to Shannon's information theory to solve for the bet
    that is optimal for long-term capital growth when the odds are favorable, but
    uncertainty remains. His rule maximizes logarithmic wealth as a function of the
    odds of success of each game and includes implicit bankruptcy protection since
    *log(0)* is negative infinity so that a Kelly gambler would naturally avoid losing
    everything.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 凯利将Shannon的信息理论与赔率有利但仍存在不确定性的情况下的长期资本增长的最佳下注联系起来。他的规则最大化了每场比赛成功的几率的对数财富，并包括隐式的破产保护，因为*log(0)*是负无穷，所以凯利赌徒自然会避免失去一切。
- en: The optimal size of a bet
  id: totrans-118
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 下注的最佳大小
- en: 'Kelly began by analyzing games with a binary win-lose outcome. The key variables
    are:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 凯利开始通过分析具有二元赢-输结果的游戏。关键变量是：
- en: '*b*: The odds defining the amount won for a $1 bet. Odds = 5/1 implies a $5
    gain if the bet wins, plus recovery of the $1 capital.'
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*b*：定义赢得1美元赌注的金额的赔率。赔率=5/1表示如果赌注获胜，则获得5美元，再加上1美元的本金。'
- en: '*p*: The probability defining the likelihood of a favorable outcome.'
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*p*：定义有利结果可能性的概率。'
- en: '*f*: The share of the current capital to bet.'
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*f*：用于下注的当前资本份额。'
- en: '*V*: The value of the capital as a result of betting.'
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*V*：作为赌注结果的资本价值。'
- en: 'The Kelly criterion aims to maximize the value''s growth rate, *G*, of infinitely
    repeated bets:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 凯利准则旨在最大化无限重复投注的价值增长率*G*：
- en: '![](img/B15439_05_020.png)'
  id: totrans-125
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_020.png)'
- en: 'When *W* and *L* are the numbers of wins and losses, then:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 当*W*和*L*分别是赢和输的次数时，那么：
- en: '![](img/B15439_05_021.png)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_021.png)'
- en: 'We can maximize the rate of growth *G* by maximizing *G* with respect to *f*,
    as illustrated using SymPy, as follows (you can find this in the `kelly_rule`
    notebook):'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过最大化关于*f*的*G*来最大化*G*的增长率，如SymPy所示，如下所示（您可以在`kelly_rule`笔记本中找到这个）：
- en: '[PRE6]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'We arrive at the optimal share of capital to bet:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 我们得到了最佳的下注资本份额：
- en: '![](img/B15439_05_022.png)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_022.png)'
- en: Optimal investment – single asset
  id: totrans-132
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 最佳投资-单一资产
- en: In a financial market context, both outcomes and alternatives are more complex,
    but the Kelly criterion logic does still apply. It was made popular by Ed Thorp,
    who first applied it profitably to gambling (described in the book *Beat the Dealer*)
    and later started the successful hedge fund Princeton/Newport Partners.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 在金融市场背景下，结果和替代方案都更加复杂，但凯利准则的逻辑仍然适用。它由Ed Thorp首次成功地将其应用于赌博（在书籍*Beat the Dealer*中描述），后来开始了成功的对冲基金Princeton/Newport
    Partners。
- en: 'With continuous outcomes, the growth rate of capital is defined by an integrate
    over the probability distribution of the different returns that can be optimized
    numerically:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 对于连续结果，资本的增长率由对不同回报的概率分布进行数值优化来定义：
- en: '![](img/B15439_05_023.png)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_023.png)'
- en: 'We can solve this expression for the optimal *f** using the `scipy.optimize`
    module. The `quad` function computes the value of a definite integral between
    two values *a* and *b* using FORTRAN''s QUADPACK library (hence its name). It
    returns the value of the integral and an error estimate:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`scipy.optimize`模块解决这个表达式，找到最佳的*f**。`quad`函数使用FORTRAN的QUADPACK库计算两个值*a*和*b*之间的定积分的值（因此得名）。它返回积分的值和误差估计：
- en: '[PRE7]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Optimal investment – multiple assets
  id: totrans-138
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 最佳投资-多资产
- en: We will use an example with various equities. E. Chan (2008) illustrates how
    to arrive at a multi-asset application of the Kelly criterion, and that the result
    is equivalent to the (potentially levered) maximum Sharpe ratio portfolio from
    the mean-variance optimization.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用各种股票的示例。E. Chan（2008）说明了如何到达凯利准则的多资产应用，并且结果等同于（可能是杠杆的）最大夏普比率组合的均值-方差优化。
- en: 'The computation involves the dot product of the precision matrix, which is
    the inverse of the covariance matrix, and the return matrix:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 计算涉及精度矩阵的点积，该矩阵是协方差矩阵的逆矩阵，以及回报矩阵：
- en: '[PRE8]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The Kelly portfolio is also shown in the previous efficient frontier diagram
    (after normalization so that the sum of the absolute weights equals one). Many
    investors prefer to reduce the Kelly weights to reduce the strategy's volatility,
    and Half-Kelly has become particularly popular.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 凯利组合还显示在之前的有效前沿图表中（经过归一化处理，使得绝对权重之和等于1）。许多投资者更喜欢减少凯利权重以减少策略的波动性，而半凯利已经变得特别受欢迎。
- en: Risk parity
  id: totrans-143
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 风险平价
- en: The fact that the previous 15 years have been characterized by two major crises
    in the global equity markets, a consistently upwardly sloping yield curve, and
    a general decline in interest rates, made risk parity look like a particularly
    compelling option. Many institutions carved out strategic allocations to risk
    parity to further diversify their portfolios.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 过去15年的两次全球股票市场主要危机、持续上升的收益曲线和利率的普遍下降，使得风险平价看起来像一个特别引人注目的选择。许多机构为风险平价划分了战略配置，以进一步实现投资组合的多样化。
- en: 'A simple implementation of risk parity allocates assets according to the inverse
    of their variances, ignoring correlations and, in particular, return forecasts:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 风险平价的简单实现根据它们的方差的倒数分配资产，忽略相关性，特别是回报预测：
- en: '[PRE9]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: The risk parity portfolio is also shown in the efficient frontier diagram at
    the beginning of this section.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 风险平价组合也显示在本节开头的有效前沿图表中。
- en: Risk factor investment
  id: totrans-148
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 风险因素投资
- en: An alternative framework for estimating input is to work down to the underlying
    determinants, or factors, that drive the risk and returns of assets. If we understand
    how the factors influence returns, and we understand the factors, we will be able
    to construct more robust portfolios.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 估计输入的另一种替代框架是向下工作到驱动资产风险和回报的基础决定因素或因子。如果我们了解因子如何影响回报，并且了解这些因子，我们将能够构建更加健壮的投资组合。
- en: The concept of factor investing looks beyond asset class labels. It looks to
    the underlying factor risks that we discussed in the previous chapter on alpha
    factors to maximize the benefits of diversification. Rather than distinguishing
    investment vehicles by labels such as hedge funds or private equity, factor investing
    aims to identify distinct risk-return profiles based on differences in exposure
    to fundamental risk factors (Ang 2014).
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 因子投资的概念超越了资产类别标签。它寻求利用我们在上一章关于阿尔法因子中讨论的基本风险因素来最大化多样化的好处。与通过标签如对冲基金或私募股权来区分投资工具不同，因子投资旨在根据对基本风险因素的暴露差异来识别不同的风险-回报配置（Ang
    2014）。
- en: The naive approach to mean-variance investing plugs (artificial) groupings as
    distinct asset classes into a mean-variance optimizer. Factor investing recognizes
    that such groupings share many of the same factor risks as traditional asset classes.
    Diversification benefits can be overstated, as investors discovered during the
    2008 crisis when correlations among risky asset classes increased due to exposure
    to the same underlying factor risks.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 均值方差投资的朴素方法将（人为的）分组作为不同的资产类别插入均值方差优化器中。因子投资认识到这些分组与传统资产类别共享许多相同的因子风险。分散化效益可能被夸大，正如投资者在2008年危机期间发现的那样，当时由于暴露于相同的基础因子风险，风险资产类别之间的相关性增加了。
- en: In *Chapter 7*, *Linear Models – From Risk Factors to Return Forecasts*, we
    will show how to measure the exposure of a portfolio to various risk factors so
    that you can either adjust the positions to tune your factor exposure, or hedge
    accordingly.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 在*第7章* *线性模型-从风险因素到收益预测*中，我们将展示如何衡量投资组合对各种风险因素的暴露，以便您可以调整头寸来调整您的因子暴露，或者相应地进行对冲。
- en: Hierarchical risk parity
  id: totrans-153
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 分层风险平价
- en: 'Mean-variance optimization is very sensitive to the estimates of expected returns
    and the covariance of these returns. The covariance matrix inversion also becomes
    more challenging and less accurate when returns are highly correlated, as is often
    the case in practice. The result has been called the Markowitz curse: when diversification
    is more important because investments are correlated, conventional portfolio optimizers
    will likely produce an unstable solution. The benefits of diversification can
    be more than offset by mistaken estimates. As discussed, even naive, equally weighted
    portfolios can beat mean-variance and risk-based optimization out of sample.'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 均值方差优化对预期收益的估计和这些收益的协方差非常敏感。当收益高度相关时，协方差矩阵的求逆也变得更具挑战性和不够准确，而这在实践中经常发生。结果被称为马科维茨诅咒：当分散化更为重要因为投资相关时，传统的投资组合优化器可能会产生不稳定的解决方案。分散化的好处可能会被错误的估计所抵消。正如讨论的那样，即使是朴素的等权投资组合也可以在样本外击败均值方差和基于风险的优化。
- en: More robust approaches have incorporated additional constraints (Clarke et al.,
    2002) or Bayesian priors (Black and Litterman, 1992), or used shrinkage estimators
    to make the precision matrix more numerically stable (Ledoit and Wolf, 2003),
    available in scikit-learn ([http://scikit-learn.org/stable/modules/generated/sklearn.covariance.LedoitWolf.html](http://scikit-learn.org/stable/modules/generated/sklearn.covariance.LedoitWolf.html)).
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 更健壮的方法已经纳入了额外的约束条件（Clarke等人，2002年）或贝叶斯先验（Black和Litterman，1992年），或者使用收缩估计器使精度矩阵更加数值稳定（Ledoit和Wolf，2003年），这些都可以在scikit-learn中找到（[http://scikit-learn.org/stable/modules/generated/sklearn.covariance.LedoitWolf.html](http://scikit-learn.org/stable/modules/generated/sklearn.covariance.LedoitWolf.html)）。
- en: '**Hierarchical risk parity** (**HRP**), in contrast, leverages unsupervised
    machine learning to achieve superior out-of-sample portfolio allocations. A recent
    innovation in portfolio optimization leverages graph theory and hierarchical clustering
    to construct a portfolio in three steps (Lopez de Prado, 2015):'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 相比之下，**分层风险平价**（**HRP**）利用无监督机器学习来实现超出样本的投资组合配置。投资组合优化的最新创新利用图论和分层聚类来分三步构建投资组合（Lopez
    de Prado，2015年）：
- en: Define a distance metric so that correlated assets are close to each other,
    and apply single-linkage clustering to identify hierarchical relationships.
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义一个距离度量，使相关资产彼此靠近，并应用单链接聚类来识别层次关系。
- en: Use the hierarchical correlation structure to quasi-diagonalize the covariance
    matrix.
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用分层相关结构来近似对角化协方差矩阵。
- en: Apply top-down inverse-variance weighting using a recursive bisectional search
    to treat clustered assets as complements, rather than substitutes, in portfolio
    construction and to reduce the number of degrees of freedom.
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 应用自顶向下的逆方差加权，使用递归二分搜索将聚类资产视为投资组合构建中的补充而不是替代品，并减少自由度的数量。
- en: A related method to construct **hierarchical clustering portfolios** (**HCP**)
    was presented by Raffinot (2016). Conceptually, complex systems such as financial
    markets tend to have a structure and are often organized in a hierarchical way,
    while the interaction among elements in the hierarchy shapes the dynamics of the
    system. Correlation matrices also lack the notion of hierarchy, which allows weights
    to vary freely and in potentially unintended ways.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: Raffinot（2016年）提出了构建**分层聚类投资组合**（**HCP**）的相关方法。从概念上讲，金融市场等复杂系统往往具有层次结构，并且元素之间的相互作用塑造了系统的动态。相关矩阵也缺乏层次结构的概念，这使得权重可以自由变化，可能以意想不到的方式。
- en: Both HRP and HCP have been tested by JP Morgan (2012) on various equity universes.
    The HRP, in particular, produced equal or superior risk-adjusted returns and Sharpe
    ratios compared to naive diversification, the maximum-diversified portfolios,
    or GMV portfolios.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: JP摩根（2012年）对各种股票市场进行了HRP和HCP的测试。特别是HRP相比于朴素分散化、最大分散化投资组合或GMV投资组合产生了相等或更高的风险调整回报和夏普比率。
- en: We will present the Python implementation in *Chapter 13*, *Data-Driven Risk
    Factors and Asset Allocation with Unsupervised Learning*.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在*第13章* *基于无监督学习的数据驱动风险因素和资产配置*中介绍Python实现。
- en: Trading and managing portfolios with Zipline
  id: totrans-163
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Zipline进行交易和管理投资组合
- en: In the previous chapter, we introduced Zipline to simulate the computation of
    alpha factors from trailing market, fundamental, and alternative data for a cross-section
    of stocks. In this section, we will start acting on the signals emitted by alpha
    factors. We'll do this by submitting buy and sell orders so we can enter long
    and short positions or rebalance the portfolio to adjust our holdings to the most
    recent trade signals.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们介绍了Zipline来模拟从滞后市场、基本和替代数据中为一系列股票计算alpha因子。在本节中，我们将开始根据alpha因子发出的信号进行操作。我们将通过提交买卖订单来进入多头和空头头寸，或者重新平衡投资组合以调整我们的持仓到最近的交易信号。
- en: We will postpone optimizing the portfolio weights until later in this chapter
    and, for now, just assign positions of equal value to each holding. As mentioned
    in the previous chapter, an in-depth introduction to the testing and evaluation
    of strategies that include ML models will follow in *Chapter 6*, *The Machine
    Learning Process*.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将推迟优化投资组合权重，直到本章后面，并且现在只是给每个持仓分配相等价值的位置。如前一章所述，包括ML模型的策略测试和评估的深入介绍将在第6章“机器学习过程”中进行。
- en: Scheduling signal generation and trade execution
  id: totrans-166
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 调度信号生成和交易执行
- en: We will use the custom `MeanReversion` factor developed in the previous chapter
    (see the implementation in `01_backtest_with_trades.ipynb`).
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用在上一章中开发的自定义`MeanReversion`因子（请参阅`01_backtest_with_trades.ipynb`中的实现）。
- en: 'The `Pipeline` created by the `compute_factors()` method returns a table with
    columns containing the 50 longs and shorts. It selects the equities according
    to the largest negative and positive deviations, respectively, of their last monthly
    return from the annual average, normalized by the standard deviation:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: '`compute_factors()`方法创建的`Pipeline`返回一个包含50个多头和空头的列的表。它根据最后一个月回报与年度平均值的最大负偏差和最大正偏差，分别由标准差归一化，选择股票：'
- en: '[PRE10]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'It also limited the universe to the 1,000 stocks with the highest average trading
    volume over the last 30 trading days. `before_trading_start()` ensures the daily
    execution of the `Pipeline` and the recording of the results, including the current
    prices:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 它还将宇宙限制为过去30个交易日平均交易量最高的1,000只股票。`before_trading_start()`确保每日执行`Pipeline`并记录结果，包括当前价格：
- en: '[PRE11]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'The new `rebalance()` method submits trade orders to the `exec_trades()` method
    for the assets flagged for long and short positions by the `Pipeline` with equal
    positive and negative weights. It also divests any current holdings that are no
    longer included in the factor signals:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 新的`rebalance()`方法向由`Pipeline`标记为多头和空头头寸的资产提交交易订单，权重相等的正和负权重。它还清除不再包含在因子信号中的任何当前持仓：
- en: '[PRE12]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: The `rebalance()` method runs according to `date_rules` and `time_rules` set
    by the `schedule_function()` utility at the beginning of the week, right after
    `market_open`, as stipulated by the built-in `US_EQUITIES` calendar (see the Zipline
    documentation for details on rules).
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: '`rebalance()`方法根据`schedule_function()`工具在每周初的`market_open`后按照`date_rules`和`time_rules`运行，如内置的`US_EQUITIES`日历规定的那样（有关规则的详细信息，请参阅Zipline文档）。'
- en: 'You can also specify a trade commission both in relative terms and as a minimum
    amount. There is also an option to define slippage, which is the cost of an adverse
    change in price between trade decision and execution:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以指定交易佣金，可以是相对值，也可以是最低金额。还有一个选项可以定义滑点，即交易决策和执行之间价格不利变化的成本：
- en: '[PRE13]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The algorithm continues to execute after calling the `run_algorithm()` function
    and returns the same backtest performance `DataFrame` that we saw in the previous
    chapter.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 调用`run_algorithm()`函数后，算法将继续执行，并返回与上一章中看到的相同的回测性能`DataFrame`。
- en: Implementing mean-variance portfolio optimization
  id: totrans-178
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 实施均值方差投资组合优化
- en: We demonstrated in the previous section how to find the efficient frontier using
    `scipy.optimize`. In this section, we will leverage the PyPortfolioOpt library,
    which offers portfolio optimization (using SciPy under the hood), including efficient
    frontier techniques and more recent shrinkage approaches that regularize the covariance
    matrix (see *Chapter 7*, *Linear Models – From Risk Factors to Return Forecasts*,
    on shrinkage for linear regression). The code example lives in `02_backtest_with_pf_optimization.ipynb`.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在上一节中演示了如何使用`scipy.optimize`找到有效边界。在本节中，我们将利用PyPortfolioOpt库，该库提供了投资组合优化（在底层使用SciPy），包括有效边界技术和更近期的收缩方法，用于正则化协方差矩阵（有关线性回归的收缩，请参见第7章“线性模型-从风险因素到收益预测”）。代码示例位于`02_backtest_with_pf_optimization.ipynb`中。
- en: 'We''ll use the same setup with 50 long and short positions derived from the
    `MeanReversion` factor ranking. The `rebalance()` function receives the suggested
    long and short positions and passes each subset on to a new `optimize_weights()`
    function to obtain dictionaries with `asset: target_percent` pairs:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: '我们将使用与`MeanReversion`因子排名派生的50个多头和空头头寸相同的设置。`rebalance()`函数接收建议的多头和空头头寸，并将每个子集传递给一个新的`optimize_weights()`函数，以获得`asset:
    target_percent`对的字典：'
- en: '[PRE14]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'The `optimize_weights()` function uses the `EfficientFrontier` object, provided
    by PyPortfolioOpt, to find the weights that maximize the Sharpe ratio based on
    the last year of returns and the covariance matrix, both of which the library
    also computes:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: '`optimize_weights()`函数使用PyPortfolioOpt提供的`EfficientFrontier`对象，找到基于最近一年的回报和协方差矩阵的夏普比率最大化的权重，库也计算这两者：'
- en: '[PRE15]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: It returns normalized weights that sum to 1, set to negative values for the
    short positions.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 它返回归一化的权重，总和为1，并为空头头寸设置为负值。
- en: '*Figure 5.3* shows that, for this particular set of strategies and time frame,
    the mean-variance optimized portfolio performs significantly better:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5.3*显示，对于这组特定策略和时间框架，均值方差优化的投资组合表现显著更好：'
- en: '![](img/B15439_05_03.png)'
  id: totrans-186
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_03.png)'
- en: 'Figure 5.3: Mean-variance vs equal-weighted portfolio performance'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.3：均值方差 vs 等权重投资组合绩效
- en: PyPortfolioOpt also finds the minimum volatility portfolio. More generally speaking,
    this example illustrates how you can add logic to tweak portfolio weights using
    the methods presented in the previous section, or any other of your choosing.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: PyPortfolioOpt还找到了最小波动率投资组合。更一般地说，这个例子说明了如何使用前一节介绍的方法或您选择的其他方法来添加逻辑以调整投资组合权重。
- en: We will now turn to common measures of portfolio return and risk, and how to
    compute them using the pyfolio library.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将转向投资组合回报和风险的常见度量，以及如何使用pyfolio库计算它们。
- en: Measuring backtest performance with pyfolio
  id: totrans-190
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用pyfolio测量回测性能
- en: Pyfolio facilitates the analysis of portfolio performance, both in and out of
    sample using a rich set of metrics and visualizations. It produces tear sheets
    that cover the analysis of returns, positions, and transactions, as well as event
    risk during periods of market stress using several built-in scenarios. It also
    includes Bayesian out-of-sample performance analysis.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: Pyfolio便于使用丰富的指标和可视化分析投资组合绩效，包括样本内外。它生成涵盖收益、头寸和交易分析的泪滴图，以及在市场压力期间使用几个内置场景来分析事件风险。它还包括贝叶斯样本外绩效分析。
- en: Pyfolio relies on portfolio returns and position data and can also take into
    account the transaction costs and slippage losses of trading activity. It uses
    the empyrical library, which can also be used on a standalone basis to compute
    performance metrics.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: Pyfolio依赖于投资组合收益和头寸数据，还可以考虑交易活动的交易成本和滑点损失。它使用empyrical库，该库也可以单独用于计算绩效指标。
- en: Creating the returns and benchmark inputs
  id: totrans-193
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建收益和基准输入
- en: The library is part of the Quantopian ecosystem and is compatible with Zipline
    and Alphalens. We will first demonstrate how to generate the requisite inputs
    from Alphalens and then show how to extract them from a Zipline backtest performance
    `DataFrame`. The code samples for this section are in the notebook `03_pyfolio_demo.ipynb`.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 该库是Quantopian生态系统的一部分，与Zipline和Alphalens兼容。我们首先将演示如何从Alphalens生成所需的输入，然后展示如何从Zipline回测性能`DataFrame`中提取它们。本节的代码示例在笔记本`03_pyfolio_demo.ipynb`中。
- en: Getting pyfolio input from Alphalens
  id: totrans-195
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 从Alphalens获取pyfolio输入
- en: 'Pyfolio also integrates with Alphalens directly and permits the creation of
    pyfolio input data using `create_pyfolio_input`:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: Pyfolio还直接与Alphalens集成，并允许使用`create_pyfolio_input`创建pyfolio输入数据：
- en: '[PRE16]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'There are two options to specify how portfolio weights will be generated:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 有两种选择来指定如何生成投资组合权重：
- en: '`long_short`: If `False`, weights will correspond to factor values divided
    by their absolute value so that negative factor values generate short positions.
    If `True`, factor values are first demeaned so that long and short positions cancel
    each other out, and the portfolio is market neutral.'
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`long_short`：如果为`False`，权重将对应于因子值除以其绝对值，以便负因子值产生空头头寸。如果为`True`，首先对因子值进行去均值处理，以便多头和空头头寸相互抵消，并且投资组合是市场中性的。'
- en: '`equal_weight`: If `True` and `long_short` is `True`, assets will be split
    into two equal-sized groups, with the top/bottom half making up long/short positions.'
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`equal_weight`：如果`True`并且`long_short`为`True`，资产将被分成两个大小相等的组，前/后一半分别构成多头/空头头寸。'
- en: Long-short portfolios can also be created for groups if `factor_data` includes,
    for example, sector information for each asset.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 如果`factor_data`包括每个资产的行业信息，也可以为组创建多空头寸。
- en: Getting pyfolio input from a Zipline backtest
  id: totrans-202
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 从Zipline回测获取pyfolio输入
- en: 'The result of a Zipline backtest can also be converted into the required pyfolio
    input using `extract_rets_pos_txn_from_zipline`:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: Zipline回测的结果也可以使用`extract_rets_pos_txn_from_zipline`转换为所需的pyfolio输入：
- en: '[PRE17]'
  id: totrans-204
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Walk-forward testing – out-of-sample returns
  id: totrans-205
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 走向前测试-样本外收益
- en: Testing a trading strategy involves back- and forward testing. The former involves
    historical data and often refers to the sample period used to fine-tune alpha
    factor parameters. Forward-testing simulates the strategy on new market data to
    validate that it performs well out of sample and is not too closely tailored to
    specific historical circumstances.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 测试交易策略涉及回测和前向测试。前者涉及历史数据，并且通常指用于微调alpha因子参数的样本期。前向测试模拟策略在新的市场数据上的表现，以验证其在样本外表现良好，并且不会过于针对特定的历史情况。
- en: Pyfolio allows for the designation of an out-of-sample period to simulate walk-forward
    testing. There are numerous aspects to take into account when testing a strategy
    to obtain statistically reliable results. We will address this in more detail
    in *Chapter 8*, *The ML4T Workflow – From Model to Strategy Backtesting*.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: Pyfolio允许指定一个样本外期间来模拟走向前测试。在测试策略以获得统计上可靠的结果时，有许多方面需要考虑。我们将在*第8章*“ML4T工作流程-从模型到策略回测”中更详细地讨论这个问题。
- en: 'The `plot_rolling_returns` function displays cumulative in- and out-of-sample
    returns against a user-defined benchmark (we are using the S&P 500). Pyfolio computes
    cumulative returns as the product of simple returns after adding 1 to each:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: '`plot_rolling_returns`函数显示了累积的样本内外收益与用户定义的基准（我们使用标准普尔500指数）的对比。Pyfolio将累积收益计算为每个简单收益加1的乘积：'
- en: '[PRE18]'
  id: totrans-209
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'The plot in *Figure 5.4* includes a cone that shows expanding confidence intervals
    to indicate when out-of-sample returns appear unlikely, given random-walk assumptions.
    Here, our toy strategy did not perform particularly well against the S&P 500 benchmark
    during the simulated 2016 out-of-sample period:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5.4*中的图表包括一个锥体，显示扩展的置信区间，以指示在样本外收益看起来不太可能的时候，考虑到随机游走的假设。在这里，我们的玩具策略在模拟的2016年样本外期间并没有特别好地表现对标准普尔500指数：'
- en: '![](img/B15439_05_04.png)'
  id: totrans-211
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_04.png)'
- en: 'Figure 5.4: Pyfolio cumulative performance plot'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.4：Pyfolio累积绩效图
- en: Summary performance statistics
  id: totrans-213
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 摘要绩效统计
- en: Pyfolio offers several analytic functions and plots. The `perf_stats` summary
    displays the annual and cumulative returns, volatility, skew, and kurtosis of
    returns and the SR.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: Pyfolio提供了几个分析函数和图表。`perf_stats`摘要显示了年度和累积收益、波动率、偏度和收益的峰度以及SR。
- en: 'The following additional metrics (which can also be calculated individually)
    are most important:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 以下附加指标（也可以单独计算）最为重要：
- en: '**Max drawdown**: Highest percentage loss from the previous peak'
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**最大回撤**：从先前峰值的最大百分比损失'
- en: '**Calmar ratio**: Annual portfolio return relative to maximal drawdown'
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Calmar比率**：年度投资组合收益与最大回撤的相对关系'
- en: '**Omega ratio**: Probability-weighted ratio of gains versus losses for a return
    target, zero per default'
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Omega比率**：收益目标的收益与损失的概率加权比率，默认为零'
- en: '**Sortino ratio**: Excess return relative to downside standard deviation'
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Sortino比率**：相对于下行标准差的超额收益'
- en: '**Tail ratio**: Size of the right tail (gains, the absolute value of the 95th
    percentile) relative to the size of the left tail (losses, absolute value of the
    5th percentile)'
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**尾部比率**：右尾（收益，第95百分位的绝对值）相对于左尾（损失，第5百分位的绝对值）的大小'
- en: '**Daily value at risk (VaR)**: Loss corresponding to a return two standard
    deviations below the daily mean'
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**每日风险价值（VaR）**：相当于日均值以下两个标准偏差的损失'
- en: '**Alpha**: Portfolio return unexplained by the benchmark return'
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Alpha**：基准回报无法解释的投资组合回报'
- en: '**Beta**: Exposure to the benchmark'
  id: totrans-223
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Beta**：与基准的暴露'
- en: 'The `plot_perf_stats` function bootstraps estimates of parameter variability
    and displays the result as a box plot:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: '`plot_perf_stats`函数对参数变异性进行自举估计，并将结果显示为箱线图：'
- en: '![](img/B15439_05_05.png)'
  id: totrans-225
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_05.png)'
- en: 'Figure 5.5: Pyfolio performance statistic plot'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.5：Pyfolio表现统计图
- en: 'The `show_perf_stats` function computes numerous metrics for the entire period,
    as well as separately, for in- and out-of-sample periods:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: '`show_perf_stats`函数计算整个期间的众多指标，以及样本内和样本外期间的指标：'
- en: '[PRE19]'
  id: totrans-228
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'For the simulated long-short portfolio derived from the `MeanReversion` factor,
    we obtain the following performance statistics:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 对于从`MeanReversion`因子派生的模拟多空投资组合，我们获得以下绩效统计数据：
- en: '| Metric | All | In-sample | Out-of-sample |'
  id: totrans-230
  prefs: []
  type: TYPE_TB
  zh: '| 指标 | 全部 | 样本内 | 样本外 |'
- en: '| Annual return | 2.80% | 2.10% | 4.70% |'
  id: totrans-231
  prefs: []
  type: TYPE_TB
  zh: '| 年回报 | 2.80% | 2.10% | 4.70% |'
- en: '| Cumulative returns | 11.60% | 6.60% | 4.70% |'
  id: totrans-232
  prefs: []
  type: TYPE_TB
  zh: '| 累积回报 | 11.60% | 6.60% | 4.70% |'
- en: '| Annual volatility | 8.50% | 8.80% | 7.60% |'
  id: totrans-233
  prefs: []
  type: TYPE_TB
  zh: '| 年波动率 | 8.50% | 8.80% | 7.60% |'
- en: '| Sharpe ratio | 0.37 | 0.29 | 0.64 |'
  id: totrans-234
  prefs: []
  type: TYPE_TB
  zh: '| 夏普比率 | 0.37 | 0.29 | 0.64 |'
- en: '| Calmar ratio | 0.21 | 0.16 | 0.57 |'
  id: totrans-235
  prefs: []
  type: TYPE_TB
  zh: '| Calmar比率 | 0.21 | 0.16 | 0.57 |'
- en: '| Stability | 0.26 | 0.01 | 0.67 |'
  id: totrans-236
  prefs: []
  type: TYPE_TB
  zh: '| 稳定性 | 0.26 | 0.01 | 0.67 |'
- en: '| Max drawdown | -13.10% | -13.10% | -8.30% |'
  id: totrans-237
  prefs: []
  type: TYPE_TB
  zh: '| 最大回撤 | -13.10% | -13.10% | -8.30% |'
- en: '| Omega ratio | 1.07 | 1.06 | 1.11 |'
  id: totrans-238
  prefs: []
  type: TYPE_TB
  zh: '| Omega比率 | 1.07 | 1.06 | 1.11 |'
- en: '| Sortino ratio | 0.54 | 0.42 | 0.96 |'
  id: totrans-239
  prefs: []
  type: TYPE_TB
  zh: '| Sortino比率 | 0.54 | 0.42 | 0.96 |'
- en: '| Skew | 0.33 | 0.35 | 0.25 |'
  id: totrans-240
  prefs: []
  type: TYPE_TB
  zh: '| 偏度 | 0.33 | 0.35 | 0.25 |'
- en: '| Kurtosis | 7.2 | 8.04 | 2 |'
  id: totrans-241
  prefs: []
  type: TYPE_TB
  zh: '| 峰度 | 7.2 | 8.04 | 2 |'
- en: '| Tail ratio | 1.04 | 1.06 | 1.01 |'
  id: totrans-242
  prefs: []
  type: TYPE_TB
  zh: '| 尾部比率 | 1.04 | 1.06 | 1.01 |'
- en: '| Daily value at risk | -1.10% | -1.10% | -0.90% |'
  id: totrans-243
  prefs: []
  type: TYPE_TB
  zh: '| 每日风险价值 | -1.10% | -1.10% | -0.90% |'
- en: '| Gross leverage | 0.69 | 0.68 | 0.72 |'
  id: totrans-244
  prefs: []
  type: TYPE_TB
  zh: '| 总杠杆 | 0.69 | 0.68 | 0.72 |'
- en: '| Daily turnover | 8.10% | 8.00% | 8.40% |'
  id: totrans-245
  prefs: []
  type: TYPE_TB
  zh: '| 每日换手率 | 8.10% | 8.00% | 8.40% |'
- en: '| Alpha | 0 | -0.01 | 0.03 |'
  id: totrans-246
  prefs: []
  type: TYPE_TB
  zh: '| Alpha | 0 | -0.01 | 0.03 |'
- en: '| Beta | 0.25 | 0.27 | 0.17 |'
  id: totrans-247
  prefs: []
  type: TYPE_TB
  zh: '| Beta | 0.25 | 0.27 | 0.17 |'
- en: See the appendix for details on the calculation and interpretation of portfolio
    risk and return metrics.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 有关计算和解释投资组合风险和回报指标的详细信息，请参阅附录。
- en: Drawdown periods and factor exposure
  id: totrans-249
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 回撤期和因子暴露
- en: 'The `plot_drawdown_periods(returns)` function plots the principal drawdown
    periods for the portfolio, and several other plotting functions show the rolling
    SR and rolling factor exposures to the market beta or the Fama-French size, growth,
    and momentum factors:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: '`plot_drawdown_periods(returns)`函数绘制了投资组合的主要回撤期，其他几个绘图函数显示了滚动夏普比率和滚动因子暴露到市场β或Fama-French大小、增长和动量因子：'
- en: '[PRE20]'
  id: totrans-251
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'The plots in *Figure 5.6*, which highlights a subset of the visualization contained
    in the various tear sheets, illustrate how pyfolio allows us to drill down into
    the performance characteristics and gives us exposure to fundamental drivers of
    risk and returns:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5.6*中的图表突出了各种泪水表中包含的可视化的子集，说明了pyfolio如何让我们深入了解绩效特征，并让我们接触到风险和回报的基本驱动因素：'
- en: '![](img/B15439_05_06.png)'
  id: totrans-253
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_06.png)'
- en: 'Figure 5.6: Various pyfolio plots of performance over time'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.6：随时间变化的各种pyfolio图表
- en: Modeling event risk
  id: totrans-255
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 建模事件风险
- en: 'Pyfolio also includes timelines for various events that you can use to compare
    the performance of a portfolio to a benchmark during this period. Pyfolio uses
    the S&P 500 by default, but you can also provide benchmark returns of your choice.
    The following example compares the performance to the S&P 500 during the fall
    2015 selloff, following the Brexit vote:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: Pyfolio还包括各种事件的时间表，您可以使用它来比较投资组合在此期间与基准的表现。Pyfolio默认使用标准普尔500指数，但您也可以提供自己选择的基准收益率。以下示例比较了2015年秋季英国脱欧投票后的投资组合表现与标准普尔500指数的表现：
- en: '[PRE21]'
  id: totrans-257
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '*Figure 5.7* shows the resulting plot:'
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5.7*显示了结果图表：'
- en: '![](img/B15439_05_07.png)'
  id: totrans-259
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_07.png)'
- en: 'Figure 5.7: Pyfolio event risk analysis'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.7：Pyfolio事件风险分析
- en: Summary
  id: totrans-261
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we covered the important topic of portfolio management, which
    involves the combination of investment positions with the objective of managing
    risk-return trade-offs. We introduced pyfolio to compute and visualize key risk
    and return metrics, as well as to compare the performance of various algorithms.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们涵盖了投资组合管理的重要主题，这涉及将投资头寸组合在一起，以管理风险和回报的权衡目标。我们介绍了pyfolio来计算和可视化关键的风险和回报指标，以及比较各种算法的表现。
- en: We saw how important accurate predictions are for optimizing portfolio weights
    and maximizing diversification benefits. We also explored how machine learning
    can facilitate more effective portfolio construction by learning hierarchical
    relationships from the asset-returns covariance matrix.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 我们看到准确的预测对于优化投资组合权重和最大化分散效益是多么重要。我们还探讨了机器学习如何通过从资产收益协方差矩阵中学习层次关系，促进更有效的投资组合构建。
- en: We will now move on to the second part of this book, which focuses on the use
    of machine learning models. These models will produce more accurate predictions
    by making more effective use of more diverse information. They do this to capture
    more complex patterns than the simpler alpha factors that were most prominent
    so far.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将转向本书的第二部分，重点是使用机器学习模型。这些模型将通过更有效地利用更多样化的信息来产生更准确的预测。它们这样做是为了捕捉比迄今为止最突出的简单Alpha因子更复杂的模式。
- en: We will begin by training, testing, and tuning linear models for regression
    and classification using cross-validation to achieve robust out-of-sample performance.
    We will also embed these models within the framework for defining and backtesting
    algorithmic trading strategies, which we covered in the previous two chapters.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从训练、测试和调整线性模型开始，用交叉验证来实现稳健的样本外性能。我们还将把这些模型嵌入到定义和回测算法交易策略的框架中，这是我们在前两章中涵盖的内容。
