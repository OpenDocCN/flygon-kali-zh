- en: Computing Candlesticks and Historical Data
  id: totrans-0
  prefs: []
  type: TYPE_NORMAL
  zh: 计算蜡烛图和历史数据
- en: The historical data of a financial instrument is data about all the past prices
    at which a financial instrument was brought or sold. An algorithmic trading strategy
    is always vpot_candlestickirtually executed on historical data to evaluate its
    past performance before it's deployed with real money. This process is called
    **backtesting**. Historical data is quintessential for backtesting (covered in
    detail in [Chapter 8](b415aed0-c473-48ba-8e52-5914c7f0de87.xhtml), *Backtesting
    Strategies*). Also, historical data is needed for computing technical indicators
    (covered in detail in [Chapter 5](16529fe4-d3ea-4017-a6f9-bad85a41d8a0.xhtml),
    *Computing and Plotting Technical Indicators*), which help in making buy-or-sell
    decisions in real-time. Candlestick patterns are widely used tools for stock analysis.
    Various types of candlestick patterns are commonly used by analysts. This chapter
    provides recipes that show you how to fetch historical data using broker APIs,
    how to fetch and compute multiple candlestick patterns – Japanese (**open-high-low-close**
    (**OHLC**)), Line Break, Renko, and Heikin-Ashi – and how to fetch historical
    data using a third-party tool.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 金融工具的历史数据是有关金融工具以往买入或卖出的所有价格的数据。算法交易策略总是在历史数据上执行，以评估其在实际资金部署之前的过去表现。这个过程称为**回测**。历史数据对于回测至关重要（在[第8章](b415aed0-c473-48ba-8e52-5914c7f0de87.xhtml)中有详细介绍，*回测策略*）。此外，计算技术指标（在[第5章](16529fe4-d3ea-4017-a6f9-bad85a41d8a0.xhtml)中有详细介绍，*计算和绘制技术指标*）需要历史数据，这有助于实时做出买入或卖出决策。蜡烛图案是股票分析中广泛使用的工具。分析师通常使用各种类型的蜡烛图案。本章提供了一些配方，向您展示如何使用经纪人API获取历史数据，如何获取和计算多个蜡烛图案-日本（**开盘-最高-最低-收盘**（**OHLC**）），线性突破，Renko和平均趋势烛台-以及如何使用第三方工具获取历史数据。
- en: 'In this chapter, we will cover the following recipes:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下配方：
- en: Fetching historical data using the broker API
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用经纪人API获取历史数据
- en: Fetching historical data with the Japanese (OHLC) candlestick pattern
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用日本（OHLC）蜡烛图案获取历史数据
- en: Fetching the Japanese candlestick pattern with variations in candle intervals
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用蜡烛间隔变化获取日本蜡烛图案
- en: Fetching historical data with the Line Break candlestick pattern
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用线性突破蜡烛图案获取历史数据
- en: Fetching historical data with the Renko candlestick pattern
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Renko蜡烛图案获取历史数据
- en: Fetching historical data with the Heikin-Ashi candlestick pattern
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用平均趋势烛台图案获取历史数据
- en: Fetching historical data using Quandl
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Quandl获取历史数据
- en: Let's get started!
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始吧！
- en: Technical requirements
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'You will need the following to successfully execute the recipes in this chapter:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 要成功执行本章的配方，您需要以下内容：
- en: Python 3.7+
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Python 3.7+
- en: 'Python packages:'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Python包：
- en: '`pyalgotrading` (`$ pip install pyalgotrading`)'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`pyalgotrading`（`$ pip install pyalgotrading`）'
- en: '`quandl` (`$pip install quandl`) this is optional and only needed for the last
    recipe'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`quandl`（`$pip install quandl`）这是可选的，仅在最后一个配方中需要'
- en: The latest Jupyter Notebook for this chapter can be found on GitHub at [https://github.com/PacktPublishing/Python-Algorithmic-Trading-Cookbook/tree/master/Chapter04](https://github.com/PacktPublishing/Python-Algorithmic-Trading-Cookbook/tree/master/Chapter04).
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的最新Jupyter Notebook可以在GitHub上找到[https://github.com/PacktPublishing/Python-Algorithmic-Trading-Cookbook/tree/master/Chapter04](https://github.com/PacktPublishing/Python-Algorithmic-Trading-Cookbook/tree/master/Chapter04)。
- en: The following code will help you set up the broker connection with Zerodha,
    which will be used by all the recipes in this chapter. Please make sure you have
    followed these steps before trying out any of the recipes provided.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码将帮助您设置与Zerodha的经纪人连接，该连接将被本章中的所有配方使用。请确保在尝试任何提供的配方之前已经按照这些步骤进行了操作。
- en: The first thing you need to do to set connectivity with the broker is to gather
    the required API keys. The broker provides unique keys to each customer, typically
    as `api-key` and `api-secret` key pairs. These API keys are chargeable, usually
    on a monthly subscription basis. You need to get your copies of `api-key` and
    `api-secret` from the broker website before you start this chapter. You can refer
    to *Appendix I* for more details.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 与经纪人建立连接的第一件事是收集所需的API密钥。经纪人通常为每个客户提供唯一的密钥，通常为`api-key`和`api-secret`密钥对。这些API密钥通常是收费的，通常是按月订阅的。在开始本章之前，您需要从经纪人网站获取`api-key`和`api-secret`的副本。您可以参考*附录I*获取更多详细信息。
- en: 'Execute the following steps:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤：
- en: 'Import the necessary modules:'
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入必要的模块：
- en: '[PRE0]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Get the `api_key` and `api_secret` keys from the broker. These are unique to
    you and will be used by the broker to identify your Demat account:'
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从经纪人那里获取`api_key`和`api_secret`密钥。这些对您是唯一的，并将被经纪人用于识别您的证券账户：
- en: '[PRE1]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'You will get the following URL:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下URL：
- en: '[PRE2]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: If you are running this for the first time and `kiteconnect` is not installed,
    `pyalgotrading` will automatically install it for you. The final output of *step
    2* will be a link. Click on the link and log in with your Zerodha credentials.
    If the authentication is successful, you will see a link in your browser's address
    bar similar to `https://127.0.0.1/?request_token=&action=login&status=success`.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您是第一次运行此程序，并且未安装`kiteconnect`，`pyalgotrading`将自动为您安装它。*步骤2*的最终输出将是一个链接。单击该链接，并使用您的Zerodha凭据登录。如果身份验证成功，您将在浏览器的地址栏中看到一个类似于`https://127.0.0.1/?request_token=&action=login&status=success`的链接。
- en: 'For example:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 例如：
- en: '[PRE3]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Copy the alphanumeric token and paste it into `request_token`:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 复制字母数字令牌并粘贴到`request_token`中：
- en: '[PRE4]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The `broker_connection` instance is now ready for performing API calls.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '`broker_connection`实例现在已准备好执行API调用。'
- en: The `pyalgotrading` package supports multiple brokers and provides a connection
    object class per broker, with the same methods. It abstracts broker APIs behind
    a unified interface so that users don't need to worry about the underlying broker
    API calls and use all the recipes in this chapter as-is.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '`pyalgotrading`包支持多个经纪人，并为每个经纪人提供一个连接对象类，具有相同的方法。它在统一接口后面抽象了经纪人API，因此用户不需要担心底层经纪人API调用，并且可以像本章中的所有配方一样使用。'
- en: Only the procedure of setting up the broker connection will vary from broker
    to broker. You can refer to the pyalgotrading documentation to learn how to set
    up the broker connection if you are not using Zerodha as your broker. For Zerodha
    users, the aforementioned steps will suffice.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 只有设置经纪人连接的程序会因经纪人而异。如果您不是使用Zerodha作为您的经纪人，您可以参考pyalgotrading文档来学习如何设置经纪人连接。对于Zerodha用户，上述步骤就足够了。
- en: Fetching historical data using the broker API
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用经纪人API获取历史数据
- en: The historical data of a financial instrument is time-series data for the timestamps
    in the past. It can be fetched using the Broker API for a given duration. This
    recipe demonstrates how to set up a broker connection and how to fetch historical
    data for a financial instrument for the duration of a single day.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 金融工具的历史数据是过去时间戳的时间序列数据。可以使用经纪人API获取给定持续时间的数据。这个配方演示了如何设置经纪人连接以及如何获取金融工具的历史数据，持续时间为一天。
- en: Getting ready
  id: totrans-37
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: Make sure the `broker_connection` object is available in your Python namespace.
    Refer to the *Technical requirements* section of this chapter to learn how to
    set it up.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 确保`broker_connection`对象在您的Python命名空间中可用。请参考本章的*技术要求*部分来学习如何设置它。
- en: How to do it…
  id: totrans-39
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'Execute the following steps to complete this recipe:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤完成这个配方：
- en: 'Fetch the historical data for an instrument:'
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取一个工具的历史数据：
- en: '[PRE5]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'You will get the following output:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/acda6f4a-bf25-4f75-8056-4d98504ae96d.png)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![](img/acda6f4a-bf25-4f75-8056-4d98504ae96d.png)'
- en: 'Print the available columns of the `historical_data` DataFrame:'
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打印`historical_data` DataFrame的可用列：
- en: '[PRE6]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'You will get the following output:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '[PRE7]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: How it works…
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'In *step 1*, you use the `get_instrument()` method of `broker_connection` to
    fetch an instrument and assign it to a new attribute, `instrument`. This object
    is an instance of the `Instrument` class. The two parameters needed to call `get_instrument()`
    are the exchange (`''NSE''`) and the trading symbol (`''TATASTEEL''`). Next, you
    fetch the historical data for `instrument` using the `get_historical_data()` method.
    This method takes four arguments, which are described as follows:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤1*中，您使用`broker_connection`的`get_instrument()`方法来获取一个工具并将其分配给一个新属性`instrument`。这个对象是`Instrument`类的一个实例。调用`get_instrument()`所需的两个参数是交易所（'NSE'）和交易符号（'TATASTEEL'）。接下来，您使用`get_historical_data()`方法获取`instrument`的历史数据。这个方法需要四个参数，描述如下：
- en: '`instrument`: The financial instrument for which the historical data must be
    placed. Should be an instance of the `Instrument` class. You pass `instrument`
    here.'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`工具`: 必须放置历史数据的金融工具。应该是`Instrument`类的一个实例。你在这里传递`instrument`。'
- en: '`candle_interval`: A valid string that denotes the duration of each candlestick
    in the historical data. You pass `minute` here. (Possible values can be `minute`,
    `3minute`, `5minute`, `10minute`, `30minute`, `60minute`, and `day`.)'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`candle_interval`: 一个有效的字符串，表示历史数据中每个蜡烛的持续时间。你在这里传递`minute`。（可能的值可以是`minute`，`3minute`，`5minute`，`10minute`，`30minute`，`60minute`和`day`。）'
- en: '`start_date`: The date from which the historical data must be fetched. Should
    be a string in the `YYYY-MM-DD` format. You pass `2020-01-01` here.'
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`start_date`: 必须获取历史数据的日期。应该是`YYYY-MM-DD`格式的字符串。你在这里传递`2020-01-01`。'
- en: '`end_date:` The date until which the historical data must be fetched, inclusive
    of this date. Should be a string in the `YYYY-MM-DD` format. You pass `2020-01-01`
    here.'
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`end_date:` 必须获取历史数据的日期，包括此日期。应该是`YYYY-MM-DD`格式的字符串。你在这里传递`2020-01-01`。'
- en: In *step 2*, you fetch and print the available columns of `historical_data`.
    You get the columns as `timestamp`, `open`, `high`, `low`, `close`, and `volume`.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤2*中，您获取并打印`historical_data`的可用列。您将获得列`timestamp`，`open`，`high`，`low`，`close`和`volume`。
- en: More information on candlesticks will be covered in the next recipe, *Fetching
    historical data using the Japanese (OHLC) candlestick pattern*, and the third
    recipe in this chapter, *Fetching the Japanese candlestick pattern with variations
    in candle intervals*.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 有关蜡烛图案的更多信息将在下一个配方中介绍，即*使用日本（OHLC）蜡烛图案获取历史数据*，以及本章的第三个配方，*在蜡烛间隔中获取日本蜡烛图案的变化*。
- en: Fetching historical data using the Japanese (OHLC) candlestick pattern
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用日本（OHLC）蜡烛图案获取历史数据
- en: The historical data of a financial instrument is an array of candlesticks. Each
    entry in the historical data is a single candlestick. There are various types
    of candlestick patterns.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 金融工具的历史数据是一系列蜡烛图案。历史数据中的每个条目都是一个单独的蜡烛图案。有各种类型的蜡烛图案。
- en: 'This recipe demonstrates the most commonly used candlestick pattern – the Japanese
    candlestick pattern. It is a type of candlestick pattern where each candlestick
    holds a duration and indicates all the prices the instrument would have taken
    on during that duration. This data is represented using four parameters – Open,
    High, Low, and Close. These can be described as follows:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 这个配方演示了最常用的蜡烛图案 - 日本蜡烛图案。这是一种蜡烛图案，其中每根蜡烛持续一段时间，并指示工具在该段时间内可能采取的所有价格。这些数据使用四个参数表示
    - 开盘价、最高价、最低价和收盘价。这些可以描述如下：
- en: '**Open**: The price of the financial instrument at the beginning of the candle''s
    duration'
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**开盘价**: 蜡烛持续时间开始时的金融工具价格'
- en: '**High**: The highest recorded price of the financial instrument during the
    entire duration of the candle'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**最高价**: 整个蜡烛持续时间内金融工具的最高记录价格'
- en: '**Low**: The lowest recorded price of the financial instrument during the entire
    duration of the candle'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**最低价**: 整个蜡烛持续时间内金融工具的最低记录价格'
- en: '**Close**: The price of the financial instrument at the end of the candle''s
    duration'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**收盘价**: 蜡烛持续时间结束时的金融工具价格'
- en: The Japanese candlestick pattern is also known as the **OHLC candlestick pattern**
    based on these parameters. All the timestamps in a Japanese candlestick pattern
    are equally spaced (within market hours). For example, the timestamps on a trading
    day would look like 9:15 a.m., 9:16 a.m., 9:17 a.m., 9:18 a.m., and so on for
    a 1-minute candle interval, where each timestamp is equally spaced at intervals
    of 1 minute.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 日本蜡烛图案也被称为**OHLC蜡烛图案**，基于这些参数。日本蜡烛图案中的所有时间戳都是等间距的（在市场营业时间内）。例如，交易日的时间戳看起来像是上午9:15、上午9:16、上午9:17、上午9:18等，对于1分钟的蜡烛间隔，每个时间戳都是等间距的，间隔为1分钟。
- en: Getting ready
  id: totrans-65
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Make sure the `broker_connection` and `historical_data` objects are available
    in your Python namespace. Refer to the *Technical requirements* section of this
    chapter to set up `broker_connection`. Refer to the previous recipe to set up
    `historical_data`.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 确保`broker_connection`和`historical_data`对象在你的Python命名空间中可用。请参考本章的*技术要求*部分设置`broker_connection`。请参考上一篇设置`historical_data`的食谱。
- en: How to do it…
  id: totrans-67
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做…
- en: 'We execute the following steps to for this recipe:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 我们执行以下步骤来进行这个食谱：
- en: 'Import the necessary modules:'
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入必要的模块：
- en: '[PRE8]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Create a green candle from one of the rows of `historical_data`:'
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从`historical_data`的一行创建一个绿色蜡烛：
- en: '[PRE9]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'You will get the following output:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 你将得到以下输出：
- en: '![](img/8c19dad2-8126-49bf-842b-530183ad8d42.png)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8c19dad2-8126-49bf-842b-530183ad8d42.png)'
- en: 'Create a red candle from one of the rows of `historical_data`:'
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从`historical_data`的一行创建一个红色蜡烛：
- en: '[PRE10]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'This will give you the following output:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 这将给你以下输出：
- en: '![](img/273fcc9f-7f5f-4d06-b72e-96705752369e.png)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![](img/273fcc9f-7f5f-4d06-b72e-96705752369e.png)'
- en: 'Plot a chart for the historical data of an instrument:'
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为一个工具的历史数据绘制图表：
- en: '[PRE11]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'This will give you the following output:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 这将给你以下输出：
- en: '![](img/ca1f393a-ad16-4126-b989-d3512a4872e9.png)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ca1f393a-ad16-4126-b989-d3512a4872e9.png)'
- en: 'Plot a chart for the historical data of another instrument:'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为另一个工具的历史数据绘制图表：
- en: '[PRE12]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'This will give you the following output:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 这将给你以下输出：
- en: '![](img/d8f3fb78-1547-4855-ac79-6d610afa48a0.png)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d8f3fb78-1547-4855-ac79-6d610afa48a0.png)'
- en: 'Plot a chart for the historical data of yet another instrument:'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为另一个工具的历史数据绘制图表：
- en: '[PRE13]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'This will give you the following output:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 这将给你以下输出：
- en: '![](img/9bccb883-f64f-471e-beee-521109686b74.png)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9bccb883-f64f-471e-beee-521109686b74.png)'
- en: How it works…
  id: totrans-91
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理…
- en: In *step 1*, you import `plot_candlestick_chart`, a quick utility function for
    plotting candlestick pattern charts, and `PlotType`, an enum for various types
    of candlestick patterns. The next two steps introduce two types of candlesticks,
    or simply **candles** – a green candle and a red candle. As we mentioned earlier,
    each entry in historical data is a candle. These two steps selectively extract
    a green and red candle from the data. (Please note that the indices that are passed
    to `historical_data.iloc` will be different if you choose a different duration
    for `historical_data`, as in the *Fetching historical data using the broker API*
    recipe). A Japanese candle is green in color if its **close** price is above its
    **open** price. A green candle is also called a **bullish** candle as it is indicative
    that the price was bullish, meaning rising, during that duration. A Japanese candle
    is red in color if its **close** price is below its **open** price. A red candle
    is also called a **bearish** candle as it is indicative that the price was bearish,
    meaning falling, during that duration.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤1*中，导入`plot_candlestick_chart`，一个用于绘制蜡烛图表的快速实用函数，以及`PlotType`，用于各种蜡烛图案类型的枚举。接下来的两步介绍了两种蜡烛图案，或者简单地说是**蜡烛**
    - 一个绿色蜡烛和一个红色蜡烛。正如我们之前提到的，历史数据中的每个条目都是一个蜡烛。这两个步骤有选择性地从数据中提取了一个绿色蜡烛和一个红色蜡烛。（请注意，如果您选择了不同的`historical_data`持续时间，如*使用经纪人API获取历史数据*食谱中所示，传递给`historical_data.iloc`的索引将是不同的）。如果一个日本蜡烛的**收盘**价格高于其**开盘**价格，它就是绿色的。绿色蜡烛也被称为**看涨**蜡烛，因为它表明价格在那段时间内是看涨的，意味着上涨。如果一个日本蜡烛的**收盘**价格低于其**开盘**价格，它就是红色的。红色蜡烛也被称为**看跌**蜡烛，因为它表明价格在那段时间内是看跌的，意味着下跌。
- en: In *step 4*, you plot the complete historical data held by `historical_data`
    using the `plot_candlestick_chart()` function. The chart is a combination of multiple
    candlesticks, each with a different length. Hence, such a chart is called a **candlestick
    pattern chart**. Note that the candle interval is 1 minute, meaning that the timestamps
    are equally spaced in intervals of 1 minute. *Steps 5* and *6* demonstrate similar
    1-minute candle interval candlestick pattern charts for the `NSE:INFY` and `NSE:ICICIBANK`
    instruments.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤4*中，使用`plot_candlestick_chart()`函数绘制`historical_data`持有的完整历史数据。图表是多个蜡烛的组合，每个蜡烛的长度都不同。因此，这样的图表被称为**蜡烛图案图表**。请注意，蜡烛间隔为1分钟，意味着时间戳在1分钟的间隔内是等间距的。*步骤5*和*步骤6*演示了`NSE:INFY`和`NSE:ICICIBANK`工具的类似1分钟蜡烛间隔蜡烛图案图表。
- en: If you are new to candlestick pattern charts, I would recommend that you interact
    with the charts that can be found in this chapter's Jupyter Notebook at [https://github.com/PacktPublishing/Python-Algorithmic-Trading-Cookbook/blob/master/Chapter04/CHAPTER%204.ipynb](https://github.com/PacktPublishing/Python-Algorithmic-Trading-Cookbook/blob/master/Chapter04/CHAPTER%204.ipynb).
    Try hovering over multiple candles to see their values and zoom in/out or pan
    to various durations to see the candles more clearly. Try to relate the color
    of these candles with their descriptions from this recipe. If the charts in the
    Jupyter Notebook do not render automatically for you due to some reason, you can
    download this html file, for the same Jupyter Notebook, open it in your browser
    and interact with it: [https://github.com/PacktPublishing/Python-Algorithmic-Trading-Cookbook/blob/master/Chapter04/CHAPTER%204.ipynb](https://github.com/PacktPublishing/Python-Algorithmic-Trading-Cookbook/blob/master/Chapter04/CHAPTER%204.ipynb).
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您对蜡烛图表模式不熟悉，我建议您与本章Jupyter Notebook中的图表进行交互。尝试悬停在多个蜡烛上以查看它们的值，并放大/缩小或平移以查看蜡烛更清晰的各种持续时间。尝试将这些蜡烛的颜色与本教程中的描述联系起来。如果由于某种原因Jupyter
    Notebook中的图表没有自动呈现给您，您可以下载此html文件，打开它在您的浏览器中进行交互：[https://github.com/PacktPublishing/Python-Algorithmic-Trading-Cookbook/blob/master/Chapter04/CHAPTER%204.ipynb](https://github.com/PacktPublishing/Python-Algorithmic-Trading-Cookbook/blob/master/Chapter04/CHAPTER%204.ipynb)。
- en: Fetching the Japanese candlestick pattern with variations in candle intervals
  id: totrans-95
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 获取具有不同蜡烛间隔的日本蜡烛图案
- en: The historical data of a financial instrument can be analyzed in the form of
    Japanese candlesticks pattern with varying candle intervals. Brokers typically
    support candle intervals of 1 minute, 3 minutes, 5 minutes, 10 minutes, 15 minutes,
    30 minutes, 1 hour, 1 day, and so on. A shorter candle interval hints at a localized
    price movement trend, while a larger candle interval indicates an overall price
    movement trend. Depending on the algorithmic trading strategy, you may need a
    shorter candle interval or a larger one. A candle interval of 1 minute is often
    the smallest available candle interval. This recipe demonstrates the historical
    data of a financial instrument for a duration of a day in various candle intervals.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过不同的蜡烛间隔分析金融工具的历史数据，形成日本蜡烛图案。经纪人通常支持1分钟、3分钟、5分钟、10分钟、15分钟、30分钟、1小时、1天等蜡烛间隔。较短的蜡烛间隔暗示着局部价格走势，而较大的蜡烛间隔则表示整体价格走势。根据算法交易策略的不同，您可能需要较短的蜡烛间隔或较大的蜡烛间隔。1分钟的蜡烛间隔通常是最小的可用蜡烛间隔。本教程演示了金融工具的历史数据，以不同蜡烛间隔为一天的持续时间。
- en: Getting ready
  id: totrans-97
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 做好准备
- en: Make sure the `broker_connection` object is available in your Python namespace.
    Refer to the *Technical requirements* section of this chapter to learn how to
    set up `broker_connection`.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 确保`broker_connection`对象在您的Python命名空间中可用。请参考本章的*技术要求*部分，了解如何设置`broker_connection`。
- en: How to do it…
  id: totrans-99
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做…
- en: 'We execute the following steps for this recipe:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 我们执行以下步骤：
- en: 'Import the necessary modules:'
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入必要的模块：
- en: '[PRE14]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Fetch an instrument:'
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取一个仪器：
- en: '[PRE15]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Plot a chart for the historical data of the instrument with a 1-minute candle
    interval:'
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器的历史数据图表，间隔为1分钟的蜡烛图：
- en: '[PRE16]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'You will get the following output:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到以下输出：
- en: '![](img/95db5fe7-032e-431c-a91d-1bab7dcc19de.png)'
  id: totrans-108
  prefs: []
  type: TYPE_IMG
  zh: '![](img/95db5fe7-032e-431c-a91d-1bab7dcc19de.png)'
- en: 'Plot a chart for the historical data of the instrument with a 3-minute candle
    interval:'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器的历史数据图表，间隔为3分钟的蜡烛图：
- en: '[PRE17]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'You will get the following output:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到以下输出：
- en: '![](img/70cf68b1-6358-40ff-8404-687350291dcf.png)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
  zh: '![](img/70cf68b1-6358-40ff-8404-687350291dcf.png)'
- en: 'Plot a chart for the historical data of the instrument with a 5-minute candle
    interval:'
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器的历史数据图表，间隔为5分钟的蜡烛图：
- en: '[PRE18]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'You will get the following output:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到以下输出：
- en: '![](img/fac26bb3-cdc9-4686-b462-394525e7ec62.png)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
  zh: '![](img/fac26bb3-cdc9-4686-b462-394525e7ec62.png)'
- en: 'Plot a chart for the historical data of the instrument with a 10-minute candle
    interval:'
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器的历史数据图表，间隔为10分钟的蜡烛图：
- en: '[PRE19]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'You will get the following output:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到以下输出：
- en: '![](img/b9295ac1-a6e7-44c4-8918-4f0168111e5a.png)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b9295ac1-a6e7-44c4-8918-4f0168111e5a.png)'
- en: 'Plot a chart for the historical data of the instrument with a 15-minute candle
    interval:'
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器的历史数据图表，间隔为15分钟的蜡烛图：
- en: '[PRE20]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'You will get the following output:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到以下输出：
- en: '![](img/1c18a46f-d277-4c9a-b95b-a507df515b57.png)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1c18a46f-d277-4c9a-b95b-a507df515b57.png)'
- en: 'Plot a chart for the historical data of the instrument with a 30-minute candle
    interval:'
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器的历史数据图表，间隔为30分钟的蜡烛图：
- en: '[PRE21]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'You will get the following output:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到以下输出：
- en: '![](img/aab74cf9-be65-415f-a12f-3ea3a8d714ef.png)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![](img/aab74cf9-be65-415f-a12f-3ea3a8d714ef.png)'
- en: 'Plot a chart for the historical data of the instrument with a 1-hour candle
    interval:'
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器的历史数据图表，间隔为1小时的蜡烛图：
- en: '[PRE22]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Plot a chart for the historical data of the instrument with a 1-day candle
    interval:'
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器的历史数据图表，间隔为1天的蜡烛图：
- en: '[PRE23]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'You will get the following output, which is a single candle:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到以下输出，这是一个单烛：
- en: '![](img/38ff4849-3913-40bf-8224-4a02f01b7414.png)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
  zh: '![](img/38ff4849-3913-40bf-8224-4a02f01b7414.png)'
- en: How it works…
  id: totrans-135
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的…
- en: 'In *step 1*, you import `plot_candlestick_chart`, a quick utility function
    for plotting candlestick pattern charts, and `PlotType`, an enum for various types
    of candlestick patterns. In *step 2*, the `get_instrument()` method of `broker_connection`
    to fetch an instrument and assign it to a new attribute, `instrument`. This object
    is an instance of the `Instrument` class. The two parameters needed to call `get_instrument()`
    are the exchange (`''NSE''`) and the trading symbol (`''TATASTEEL''`). *Steps
    3* and *4* fetch and plot the historical data for the candle intervals; that is,
    1 minute, 3 minutes, 5 minutes, 10 minutes, 15 minutes, 30 minutes, 1 hour, and
    1 day. You use the `get_historical_data()` method to fetch historical data for
    the same instruments and the same start and end dates, with only a different candle
    interval. You use the `plot_candlestick_chart()` function to plot Japanese candlestick
    pattern charts. You can observe the following differences between the charts as
    the candle interval increases:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤1*中，您导入`plot_candlestick_chart`，这是一个用于绘制蜡烛图形式图表的快速实用函数，以及`PlotType`，用于各种蜡烛图形式类型的枚举。在*步骤2*中，使用`broker_connection`的`get_instrument()`方法获取一个工具并将其分配给一个新属性`instrument`。这个对象是`Instrument`类的一个实例。调用`get_instrument()`所需的两个参数是交易所（'NSE'）和交易符号（'TATASTEEL'）。*步骤3*和*步骤4*获取并绘制蜡烛间隔的历史数据；即1分钟，3分钟，5分钟，10分钟，15分钟，30分钟，1小时和1天。您使用`get_historical_data()`方法获取相同工具的历史数据和相同的开始和结束日期，只是蜡烛间隔不同。您使用`plot_candlestick_chart()`函数绘制日本蜡烛图形式图表。您可以观察到以下差异，随着蜡烛间隔的增加：
- en: The total number of candlesticks decreases.
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 蜡烛数量减少。
- en: The spikes in the charts due to sudden price movement are minimized. Smaller
    candle interval charts have more spikes as they focus on local trends, while larger
    candle interval charts have fewer spikes and are smoother.
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于突然的价格波动，图表中的尖峰被最小化。较小的蜡烛间隔图表有更多的尖峰，因为它们关注局部趋势，而较大的蜡烛间隔图表有较少的尖峰，更加平滑。
- en: A long-term trend in the stock price becomes visible.
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 股价的长期趋势变得可见。
- en: Decision-making may become slower because you have to wait longer to get new
    candle data. Slower decisions may or may not be desirable, depending on the strategy.
    For example, for confirming trends, using a combination of data with a smaller
    candle interval, say 3 minutes, and data with a larger candle interval, say 15
    minutes, would be desirable. On the other hand, for grabbing opportunities in
    intraday trading, data with larger candle intervals, such as 1 hour or 1 day,
    would not be desirable.
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 决策可能变得更慢，因为您必须等待更长时间才能获得新的蜡烛数据。根据策略，较慢的决策可能是可取的，也可能不是。例如，为了确认趋势，使用较小的蜡烛间隔数据（例如3分钟）和较大的蜡烛间隔数据（例如15分钟）的组合是可取的。另一方面，对于抓住日内交易的机会，不希望使用较大的蜡烛间隔数据，例如1小时或1天。
- en: The price range (y-axis spread) of adjacent candles may or may not overlap.
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 相邻蜡烛的价格范围（y轴范围）可能重叠，也可能不重叠。
- en: All the timestamps are equally spaced in time (within market hours).
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有时间戳在时间上等间隔（在市场营业时间内）。
- en: Fetching historical data using the Line Break candlestick pattern
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用线段破裂蜡烛图形式获取历史数据
- en: The historical data of a financial instrument can be analyzed in the form of
    the Line Break candlestick pattern, a candlestick pattern that focuses on price
    movement. This differs from the Japanese candlestick pattern, which focuses on
    the time movement. Brokers typically do not provide historical data for the Line
    Break candlestick pattern via APIs. Brokers usually provide historical data using
    the Japanese candlestick pattern that needs to be converted into the Line Break
    candlestick pattern. A shorter candle interval hints at a localized price movement
    trend, while a larger candle interval indicates an overall price movement trend.
    Depending on your algorithmic trading strategy, you may need the candle interval
    to be small or large. A candle interval of 1 minute is often the smallest available
    candle interval.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 金融工具的历史数据可以以线段破裂蜡烛图形式进行分析，这是一种侧重于价格变动的蜡烛图形式。这与侧重于时间变动的日本蜡烛图形式不同。经纪人通常不会通过API提供线段破裂蜡烛图形式的历史数据。经纪人通常使用需要转换为线段破裂蜡烛图形式的日本蜡烛图形式提供历史数据。较短的蜡烛间隔暗示局部价格趋势，而较长的蜡烛间隔则表示整体价格趋势。根据您的算法交易策略，您可能需要蜡烛间隔较小或较大。1分钟的蜡烛间隔通常是最小的可用蜡烛间隔。
- en: 'The Line Break candlestick pattern works as follows:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 线段破裂蜡烛图形式的工作方式如下：
- en: Each candle has only `open` and `close` attributes.
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 每个蜡烛只有“开盘”和“收盘”属性。
- en: The user defines a `Number of Lines` (*n*) setting, which is usually taken as
    `3`.
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 用户定义一个“线段数量”（*n*）设置，通常取为3。
- en: At the end of each candle interval, a green candle is formed if the stock price
    goes higher than the highest of the previous *n* Line Break candles.
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在每个蜡烛间隔结束时，如果股价高于前*n*个线段破裂蜡烛的最高价，将形成一个绿色蜡烛。
- en: At the end of each candle interval, a red candle is formed if the stock price
    goes lower than the lowest of the previous *n* Line Break candles.
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在每个蜡烛间隔结束时，如果股价低于前*n*个线段破裂蜡烛的最低价，将形成一个红色蜡烛。
- en: At the end of each candle interval, if neither point 3 nor point 4 are satisfied,
    no candle is formed. Hence, the timestamps don't need to be equally spaced.
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在每个蜡烛间隔结束时，如果既不满足点3也不满足点4，则不会形成蜡烛。因此，时间戳不需要等间隔。
- en: This recipe shows how we can fetch historical data using the Japanese candlestick
    pattern using the broker API, convert the historical data into a Line Break candlestick
    pattern, and plot it. This is done for multiple candle intervals.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 这个示例展示了如何使用经纪API获取使用日本蜡烛图形式的历史数据，将历史数据转换为线段破裂蜡烛图形式，并绘制它。这是针对多个蜡烛间隔进行的。
- en: Getting ready
  id: totrans-152
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备就绪
- en: Make sure the `broker_connection` object is available in your Python namespace.
    Refer to the *Technical requirements* section of this chapter to learn how to
    set up `broker_connection`.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 确保`broker_connection`对象在您的Python命名空间中可用。请参考本章的*技术要求*部分，了解如何设置`broker_connection`。
- en: How to do it…
  id: totrans-154
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做…
- en: 'We execute the following steps for this recipe:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 我们执行此配方的以下步骤：
- en: 'Import the necessary modules:'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入必要的模块：
- en: '[PRE24]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Fetch the historical data for an instrument and convert it into Line Break
    data:'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取仪器的历史数据并将其转换为Line Break数据：
- en: '[PRE25]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'You will get the following output:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '[PRE26]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Create a green Line Break candle from one of the rows of `historical_data`:'
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从`historical_data`的一行创建一个绿色的Line Break蜡烛：
- en: '[PRE27]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'You will get the following output:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/06737560-972b-4dbd-9b8a-5b7aac0a6328.png)'
  id: totrans-165
  prefs: []
  type: TYPE_IMG
  zh: '![](img/06737560-972b-4dbd-9b8a-5b7aac0a6328.png)'
- en: 'Create a red Line Break candle from one of the rows of `historical_data`:'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从`historical_data`的一行创建一个红色的Line Break蜡烛：
- en: '[PRE28]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'You will get the following output:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/d6d4e6ed-0f78-4724-aabf-811cdc67fefb.png)'
  id: totrans-169
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d6d4e6ed-0f78-4724-aabf-811cdc67fefb.png)'
- en: 'Plot a chart for the historical data of the instrument with a 1-minute candle
    interval:'
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器的历史数据图表，间隔为1分钟蜡烛：
- en: '[PRE29]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'You will get the following output:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/c333ea93-46e7-422f-96b4-7c3ca48f36f1.png)'
  id: totrans-173
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c333ea93-46e7-422f-96b4-7c3ca48f36f1.png)'
- en: 'Plot a chart for the historical data of the instrument with a 3-minute candle
    interval:'
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器的历史数据图表，间隔为3分钟蜡烛：
- en: '[PRE30]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'You will get the following output:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/358d7a35-6c70-4fd2-926a-b862425cd1e3.png)'
  id: totrans-177
  prefs: []
  type: TYPE_IMG
  zh: '![](img/358d7a35-6c70-4fd2-926a-b862425cd1e3.png)'
- en: 'Plot a chart for the historical data of the instrument with a 5-minute candle
    interval:'
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器的历史数据图表，间隔为5分钟蜡烛：
- en: '[PRE31]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'You will get the following output:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/213fbad2-9746-4e31-b123-74fba6ad388f.png)'
  id: totrans-181
  prefs: []
  type: TYPE_IMG
  zh: '![](img/213fbad2-9746-4e31-b123-74fba6ad388f.png)'
- en: 'Plot a chart for the historical data of the instrument with a 10-minute candle
    interval:'
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器的历史数据图表，间隔为10分钟蜡烛：
- en: '[PRE32]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'You will get the following output:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/a254d5c7-8fd3-49d5-baca-a6aa57188f94.png)'
  id: totrans-185
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a254d5c7-8fd3-49d5-baca-a6aa57188f94.png)'
- en: 'Plot a chart for the historical data of the instrument with a 15-minute candle
    interval:'
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器的历史数据图表，间隔为15分钟蜡烛：
- en: '[PRE33]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'You will get the following output:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/0ae9f5d4-a6ae-48a7-8ff5-46a76a1bdf2c.png)'
  id: totrans-189
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0ae9f5d4-a6ae-48a7-8ff5-46a76a1bdf2c.png)'
- en: 'Plot a chart for the historical data of the instrument with a 30-minute candle
    interval:'
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器的历史数据图表，间隔为30分钟蜡烛：
- en: '[PRE34]'
  id: totrans-191
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'You will get the following output:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/27be9a13-bb54-48af-b49f-67ed03514393.png)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
  zh: '![](img/27be9a13-bb54-48af-b49f-67ed03514393.png)'
- en: 'Plot a chart for the historical data of the instrument with a 1-hour candle
    interval:'
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器的历史数据图表，间隔为1小时蜡烛：
- en: '[PRE35]'
  id: totrans-195
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'You will get the following output:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/0a9cd917-6d6b-4e2c-8257-5eab8c5ca531.png)'
  id: totrans-197
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0a9cd917-6d6b-4e2c-8257-5eab8c5ca531.png)'
- en: 'Plot a chart for the historical data of the instrument with a 1-day candle
    interval:'
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器的历史数据图表，间隔为1天蜡烛：
- en: '[PRE36]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'You will get the following output:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/dd6aece0-c34a-4bd5-b686-780fe2336e03.png)'
  id: totrans-201
  prefs: []
  type: TYPE_IMG
  zh: '![](img/dd6aece0-c34a-4bd5-b686-780fe2336e03.png)'
- en: How it works…
  id: totrans-202
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理…
- en: In *step 1*, you import `plot_candlestick_chart`, a quick utility function for
    plotting candlestick pattern charts, `PlotType`, an enum for various types of
    candlestick patterns, and the `Linebreak` function, which can convert historical
    data from the Japanese candlestick pattern in the Line Break candlestick pattern.
    In *step 2*, you use the `get_instrument()` method of `broker_connection` to fetch
    an instrument and assign it to a new attribute, `instrument`. This object is an
    instance of the `Instrument` class. The two parameters needed to call get_instrument()
    are the exchange (`'NSE'`) and the trading symbol (`'TATASTEEL'`). Next, you use
    the `get_historical_data()` method of the `broker_connection` object to fetch
    the historical data for the instrument for the duration of December 2019, with
    a candle interval of 1 minute. The time-series data returned is in the form of
    the Japanese candlestick pattern. The `Linebreak()` function converts this data
    into a Line Break candlestick pattern, another `pandas.DataFrame` object. You
    assign it to `historical_data_1minute_linebreak`. Observe that `historical_data_1minute_linebreak` has
    only `timestamp`, `open`, and `close` columns. Also, observe that the timestamps
    are not equidistant as the Line Break candles are based on price movement and
    not time. In *steps 3* and *4*, you selectively extract a green and a red candle
    from the data. (Please note, the indices passed to `historical_data.iloc` would
    be different if you choose a different duration for `historical_data` fetched
    in the first recipe of this chapter.) Observe that the candles have no shadows
    (lines extending on either side of the main candle body) as the candles only have `open` and
    `close` attributes. In *steps 5*, you plot the complete historical data held by
    `historical_data` using the `plot_candlestick_chart()` function.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤1*中，您导入`plot_candlestick_chart`，一个用于绘制蜡烛图表的快速实用程序函数，`PlotType`，用于各种蜡烛图案的枚举，以及`Linebreak`函数，该函数可以将历史数据从日本蜡烛图案转换为Line
    Break蜡烛图案。在*步骤2*中，您使用`broker_connection`的`get_instrument()`方法来获取一个仪器并将其分配给一个新属性`instrument`。这个对象是`Instrument`类的一个实例。调用`get_instrument()`所需的两个参数是交易所（'NSE'）和交易符号（'TATASTEEL'）。接下来，您使用`broker_connection`对象的`get_historical_data()`方法来获取仪器在2019年12月的历史数据，蜡烛间隔为1分钟。返回的时间序列数据以日本蜡烛图案的形式呈现。`Linebreak()`函数将此数据转换为Line
    Break蜡烛图案，另一个`pandas.DataFrame`对象。您将其分配给`historical_data_1minute_linebreak`。请注意，`historical_data_1minute_linebreak`只有`timestamp`，`open`和`close`列。还要注意，时间戳不是等距的，因为Line
    Break蜡烛是基于价格变动而不是时间。在*步骤3*和*4*中，您有选择地从数据中提取绿色和红色蜡烛。（请注意，如果您选择本章第一个配方中获取的`historical_data`的不同持续时间，传递给`historical_data.iloc`的索引将不同。）请注意，蜡烛没有阴影（延伸在主蜡烛体两侧的线），因为蜡烛只有`open`和`close`属性。在*步骤5*中，您使用`plot_candlestick_chart()`函数绘制`historical_data`保存的完整历史数据。
- en: 'In *steps 6* until *12*, you fetch the historical data using the Japanese candlestick
    pattern, convert it into the Line Break candlestick pattern, and plot the converted
    data for candle intervals of 3 minutes, 5 minutes, 10 minutes, 15 minutes, 30
    minutes, 1 hour, and 1 day. Observe the following differences and similarities
    among the charts as the candle interval increases:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤6*到*12*中，您使用日本蜡烛图案获取历史数据，将其转换为线性破坏蜡烛图案，并绘制3分钟、5分钟、10分钟、15分钟、30分钟、1小时和1天的蜡烛间隔的转换数据。随着蜡烛间隔的增加，观察以下图表之间的差异和相似之处：
- en: The total number of candlesticks decreases.
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 蜡烛图的总数减少。
- en: The spikes in the charts due to sudden price movement are minimized. Smaller
    candle interval charts have more spikes as they focus on local trends, while larger
    candle interval charts have fewer spikes and are smoother.
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于突然的价格波动，图表中的尖峰被最小化。较小的蜡烛间隔图表有更多的尖峰，因为它们关注局部趋势，而较大的蜡烛间隔图表有较少的尖峰，更加平滑。
- en: A long-term trend in the stock price becomes visible.
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 股价的长期趋势变得可见。
- en: Decision-making may become slower because you have to wait longer to get new
    candle data. Slower decisions may or may not be desirable, depending on the strategy.
    For example, to confirm trends, using a combination of data with a smaller candle
    interval, say 3 minutes, and data with a larger candle interval, say 15 minutes,
    would be desirable. On the other hand, to grab opportunities in intraday trading,
    data with larger candle intervals, say 1 hour or 1 day, would not be desirable.
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 决策可能变得更慢，因为您必须等待更长时间才能获得新的蜡烛数据。根据策略，较慢的决策可能是可取的，也可能不是。例如，为了确认趋势，使用较小的蜡烛间隔数据（例如3分钟）和较大的蜡烛间隔数据（例如15分钟）的组合是可取的。另一方面，为了抓住日内交易的机会，使用较大的蜡烛间隔数据（例如1小时或1天）是不可取的。
- en: The price ranges (y-axis spread) of two adjacent candles don't overlap with
    each other. Adjacent candles always share one of their ends.
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 两个相邻蜡烛的价格范围（y轴间距）不会重叠。相邻蜡烛总是共享它们的一端。
- en: None of the timestamps need to be equally spaced in time (unlike the Japanese
    candlestick pattern) as candles are formed based on price movement and not time
    movement.
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 时间戳无需在时间上等间隔（不像日本蜡烛图案），因为蜡烛是基于价格运动而不是时间运动形成的。
- en: If you are interested in finding out about the Math and implementation of Line
    Break candles, please refer to its source code in the `pyalgotrading` package
    at [https://github.com/algobulls/pyalgotrading/blob/master/pyalgotrading/utils/candlesticks/linebreak.py](https://github.com/algobulls/pyalgotrading/blob/master/pyalgotrading/utils/candlesticks/linebreak.py).
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您有兴趣了解线性破坏蜡烛的数学和实现，请参考`pyalgotrading`包中的源代码[https://github.com/algobulls/pyalgotrading/blob/master/pyalgotrading/utils/candlesticks/linebreak.py](https://github.com/algobulls/pyalgotrading/blob/master/pyalgotrading/utils/candlesticks/linebreak.py)。
- en: Fetching historical data using the Renko candlestick pattern
  id: totrans-212
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用莱恩科蜡烛图案获取历史数据
- en: The historical data of a financial instrument can be analyzed in the form of
    the Renko candlestick pattern, a candlestick pattern that focuses on price movement.
    This differs from the Japanese candlestick pattern, which focuses on time movement.
    Brokers typically do not provide historical data as the Renko candlestick pattern
    via APIs. Brokers usually provide historical data by using the Japanese candlestick
    pattern, which needs to be converted into the Renko candlestick pattern. A shorter
    candle interval hints at a localized price movement trend, while a larger candle
    interval indicates an overall price movement trend. Depending on your algorithmic
    trading strategy, you may need the candle interval to be small or large. A candle
    interval of 1 minute is often the smallest available candle interval.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 可以分析金融工具的历史数据，以莱恩科蜡烛图案的形式，这是一种专注于价格运动的蜡烛图案。这与专注于时间运动的日本蜡烛图案不同。经纪人通常不会通过API提供莱恩科蜡烛图案的历史数据。经纪人通常使用日本蜡烛图案提供历史数据，需要将其转换为莱恩科蜡烛图案。较短的蜡烛间隔暗示着局部价格运动趋势，而较大的蜡烛间隔则表示整体价格运动趋势。根据您的算法交易策略，您可能需要蜡烛间隔较小或较大。1分钟的蜡烛间隔通常是最小的可用蜡烛间隔。
- en: 'The Renko candlestick pattern works as follows:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 莱恩科蜡烛图案的工作方式如下：
- en: Each candle only has `open` and `close` attributes.
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 每个蜡烛只有`开盘`和`收盘`属性。
- en: You define a **Brick Count** (`b`) setting, which is usually set to `2`.
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您定义了一个**砖数**（`b`）设置，通常设置为`2`。
- en: Each candle is always fixed and is equal to `Brick Count`. Hence, a candle is
    also called a **brick** here.
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 每个蜡烛都是固定的，等于`砖数`。因此，在这里蜡烛也被称为**砖**。
- en: At the end of every candle interval, a green brick is formed if the stock price
    goes `b` points higher than the highest of the previous brick. If the price goes
    much higher than `b` points in a single candle interval, as many Renko bricks
    are formed to account for the price change.
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在每个蜡烛间隔结束时，如果股价比前一个砖的最高价高出`b`点，将形成一个绿色砖。如果价格在一个蜡烛间隔内高出`b`点，将形成多个莱恩科砖以适应价格变化。
- en: For example, say the price goes 21 points higher than the high of the previous
    brick. If the brick size is `2`, 10 Renko bricks would be formed with the same
    timestamp to account for the 20-point change. For the remaining 1-point change
    (21-20), no brick would be formed until the price goes at least 1 point higher.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，假设价格比前一个砖的高价高出21点。如果砖的大小是`2`，将形成10个莱恩科砖，时间戳相同以适应20点的变化。对于剩下的1点变化（21-20），直到价格至少高出1点，不会形成任何砖。
- en: At the end of every candle interval, a red candle is formed if the stock price
    goes `b` points lower than the lowest of the previous Renko candle. If the price
    goes much lower than `b` points in a single candle interval, as many Renko bricks
    are formed to account for the price change.
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在每个蜡烛间隔结束时，如果股价比前一个莱恩科蜡烛的最低价低出`b`点，将形成一个红色砖。如果价格在一个蜡烛间隔内低出`b`点，将形成多个莱恩科砖以适应价格变化。
- en: For example, say the price goes 21 points lower than the highest previous brick.
    If the brick size is `2`, 10 Renko bricks would be formed with the same timestamp
    to account for the 20-point change. For the remaining 1-point change (21-20),
    no brick would be formed until the price goes at least 1 point lower.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，假设价格比最高前一个砖块低21点。如果砖块大小为`2`，将形成10个Renko砖块，具有相同的时间戳以适应20点的变化。对于剩下的1点变化（21-20），直到价格至少下降1点，不会形成砖块。
- en: No two adjacent candles overlap with each other. Adjacent candles always share
    one of their ends.
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 相邻的两个蜡烛不会重叠。相邻的蜡烛总是共享它们的一端。
- en: None of the timestamps need to be equally spaced (unlike the Japanese candlestick
    pattern) as candles are formed based on price movement and not time movement.
    Also, unlike other patterns, there may be multiple candles with the same timestamp.
  id: totrans-223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 时间戳无需等间距（不像日本蜡烛图案），因为蜡烛是基于价格变动而不是时间变动形成的。而且，与其他图案不同，可能会有多个具有相同时间戳的蜡烛。
- en: This recipe shows how you can fetch historical data as the Japanese candlestick
    pattern using the broker API, as well as how to convert and plot the historical
    data using the Renko candlestick pattern for various candle intervals.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 这个配方展示了如何使用经纪人API获取历史数据作为日本蜡烛图案，以及如何使用Renko蜡烛图案转换和绘制各种蜡烛间隔的历史数据。
- en: Getting ready
  id: totrans-225
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Make sure the `broker_connection` object is available in your Python namespace.
    Refer to the *Technical requirements* section of this chapter to learn how to
    set up `broker_connection`.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 确保`broker_connection`对象在您的Python命名空间中可用。请参考本章的*技术要求*部分，了解如何设置`broker_connection`。
- en: How to do it…
  id: totrans-227
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做…
- en: 'We execute the following steps for this recipe:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 我们执行以下步骤：
- en: 'Import the necessary modules:'
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入必要的模块：
- en: '[PRE37]'
  id: totrans-230
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Fetch the historical data for an instrument and convert it into Renko data:'
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取一个工具的历史数据并将其转换为Renko数据：
- en: '[PRE38]'
  id: totrans-232
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'You will get the following output:'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到以下输出：
- en: '[PRE39]'
  id: totrans-234
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Create a green Renko candle from one of the rows of `historical_data`:'
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从`historical_data`的一行创建一个绿色的Renko蜡烛：
- en: '[PRE40]'
  id: totrans-236
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'You will get the following output:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到以下输出：
- en: '![](img/e3f2e456-99b7-4440-b1f7-2834c11e72f0.png)'
  id: totrans-238
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e3f2e456-99b7-4440-b1f7-2834c11e72f0.png)'
- en: 'Create a red Renko candle from one of the rows of `historical_data`:'
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从`historical_data`的一行创建一个红色的Renko蜡烛：
- en: '[PRE41]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'You will get the following output:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到以下输出：
- en: '![](img/40c86799-c091-4379-af1e-32dcc5cb6aea.png)'
  id: totrans-242
  prefs: []
  type: TYPE_IMG
  zh: '![](img/40c86799-c091-4379-af1e-32dcc5cb6aea.png)'
- en: 'Plot a chart for the historical data of the instrument with a 1-minute candle
    interval:'
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为工具的历史数据绘制一个图表，间隔为1分钟的蜡烛图：
- en: '[PRE42]'
  id: totrans-244
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'You will get the following output:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到以下输出：
- en: '![](img/c7ae00df-e7a1-4cee-936c-c06338e2528b.png)'
  id: totrans-246
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c7ae00df-e7a1-4cee-936c-c06338e2528b.png)'
- en: 'Plot a chart for the historical data of the instrument with a 3-minute candle
    interval:'
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为工具的历史数据绘制一个图表，间隔为3分钟的蜡烛图：
- en: '[PRE43]'
  id: totrans-248
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'You will get the following output:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到以下输出：
- en: '![](img/d85d0255-9503-47a1-aa7e-41f1d314296a.png)'
  id: totrans-250
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d85d0255-9503-47a1-aa7e-41f1d314296a.png)'
- en: 'Plot a chart for the historical data of the instrument with a 5-minute candle
    interval:'
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为工具的历史数据绘制一个图表，间隔为5分钟的蜡烛图：
- en: '[PRE44]'
  id: totrans-252
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'You will get the following output:'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到以下输出：
- en: '![](img/5bd0dda9-a247-47ba-b7fc-ec1e9bf98a86.png)'
  id: totrans-254
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5bd0dda9-a247-47ba-b7fc-ec1e9bf98a86.png)'
- en: 'Plot a chart for the historical data of the instrument with a 10-minute candle
    interval:'
  id: totrans-255
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为工具的历史数据绘制一个图表，间隔为10分钟的蜡烛图：
- en: '[PRE45]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'You will get the following output:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到以下输出：
- en: '![](img/5896de8b-9d3b-4f30-9b7c-4082f3872c21.png)'
  id: totrans-258
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5896de8b-9d3b-4f30-9b7c-4082f3872c21.png)'
- en: 'Plot a chart for the historical data of the instrument with a 15-minute candle
    interval:'
  id: totrans-259
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为工具的历史数据绘制一个图表，间隔为15分钟的蜡烛图：
- en: '[PRE46]'
  id: totrans-260
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'You will get the following output:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到以下输出：
- en: '![](img/78259599-5668-4f55-8d2f-ed81435c6360.png)'
  id: totrans-262
  prefs: []
  type: TYPE_IMG
  zh: '![](img/78259599-5668-4f55-8d2f-ed81435c6360.png)'
- en: 'Plot a chart for the historical data of the instrument with a 30-minute candle
    interval:'
  id: totrans-263
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为工具的历史数据绘制一个图表，间隔为30分钟的蜡烛图：
- en: '[PRE47]'
  id: totrans-264
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'You will get the following output:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到以下输出：
- en: '![](img/17aba6c5-ed1d-431d-a73a-a66e44c3d57b.png)'
  id: totrans-266
  prefs: []
  type: TYPE_IMG
  zh: '![](img/17aba6c5-ed1d-431d-a73a-a66e44c3d57b.png)'
- en: 'Plot a chart for the historical data of the instrument with a 1-hour candle
    interval:'
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为工具的历史数据绘制一个图表，间隔为1小时的蜡烛图：
- en: '[PRE48]'
  id: totrans-268
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'You will get the following output:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到以下输出：
- en: '![](img/3625da45-cc9e-4910-8b7d-6d6c93f6b51f.png)'
  id: totrans-270
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3625da45-cc9e-4910-8b7d-6d6c93f6b51f.png)'
- en: 'Plot a chart for the historical data of the instrument with a 1-day candle
    interval:'
  id: totrans-271
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为工具的历史数据绘制一个图表，间隔为1天的蜡烛图：
- en: '[PRE49]'
  id: totrans-272
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'You will get the following output:'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到以下输出：
- en: '![](img/4051a346-dcb6-4ba4-b78f-73ff2fda08c6.png)'
  id: totrans-274
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4051a346-dcb6-4ba4-b78f-73ff2fda08c6.png)'
- en: How it works…
  id: totrans-275
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理…
- en: In *step 1*, you import `plot_candlestick_chart`, a quick utility function for
    plotting candlestick pattern charts, `PlotType`, an enum for various types of
    candlestick patterns, and the `Renko` function, which can convert historical data
    from the Japanese candlestick pattern into the Renko candlestick pattern. In *step
    2*, you use the `get_instrument()` method of `broker_connection` to fetch an instrument
    and assign it to a new attribute, `instrument`. This object is an instance of
    the `Instrument` class. The two parameters needed to call get_instrument() are
    the exchange (`'NSE'`) and the trading symbol (`'TATASTEEL'`). Next, you use the
    `get_historical_data()` method of the `broker_connection` object to fetch the
    historical data for the duration of December 2019, with a candle interval of 1
    minute. The time-series data returned is in the form of Japanese candlestick pattern.
    The `Renko()` function converts this data into a Renko candlestick pattern, another `pandas.DataFrame` object.
    You assign it to `historical_data_1minute_renko`. Observe that `historical_data_1minute_renko`
    has `timestamp`, `open`, and `close` columns. Also, observe that the timestamps
    are not equidistant as the Renko candles are based on price movement and not time.
    In *step 3* and *4*, you selectively extract a green and a red candle from the
    data (Please note, the indices passed to `historical_data.iloc` fetched in the
    first recipe of this chapter.) Observe that the candles have no shadows (lines
    extending on either side of the main candle body) as the candles only have `open` and
    `close` attributes. In *step 5*, you plot the complete historical data held by
    `historical_data` using the `plot_candlestick_chart()` function.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤1*中，您导入`plot_candlestick_chart`，一个用于绘制蜡烛图表的快速实用程序函数，`PlotType`，用于各种蜡烛图案的枚举，以及`Renko`函数，它可以将日本蜡烛图案的历史数据转换为Renko蜡烛图案。在*步骤2*中，您使用`broker_connection`的`get_instrument()`方法来获取一个工具，并将其分配给一个新属性`instrument`。这个对象是`Instrument`类的一个实例。调用`get_instrument()`所需的两个参数是交易所（'NSE'）和交易符号（'TATASTEEL'）。接下来，您使用`broker_connection`对象的`get_historical_data()`方法来获取2019年12月的历史数据，蜡烛间隔为1分钟。返回的时间序列数据以日本蜡烛图案的形式呈现。`Renko()`函数将这些数据转换为Renko蜡烛图案，另一个`pandas.DataFrame`对象。您将其分配给`historical_data_1minute_renko`。注意`historical_data_1minute_renko`有`timestamp`，`open`和`close`列。还要注意，时间戳不是等距的，因为Renko蜡烛是基于价格运动而不是时间。在*步骤3*和*4*中，您从数据中选择性地提取了一个绿色和一个红色蜡烛（请注意，传递给`historical_data.iloc`的索引是在本章第一个配方中提取的）。注意蜡烛没有阴影（延伸在主蜡烛体两侧的线），因为蜡烛只有`open`和`close`属性。在*步骤5*中，您使用`plot_candlestick_chart()`函数绘制`historical_data`保存的完整历史数据。
- en: 'In *steps 6* until *12*, you fetch the historical data using the Japanese candlestick
    pattern, convert it into the Renko candlestick pattern, and plot the converted
    data for candle intervals of 3 minutes, 5 minutes, 10 minutes, 15 minutes, 30
    minutes, 1 hour, and 1 day. Observe the following differences and similarities
    among the charts as the candle interval increases:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤6*到*12*中，您使用日本蜡烛图案获取历史数据，将其转换为Renko蜡烛图案，并绘制蜡烛间隔为3分钟、5分钟、10分钟、15分钟、30分钟、1小时和1天的转换数据。随着蜡烛间隔的增加，图表之间的以下差异和相似之处：
- en: The total number of candlesticks decreases.
  id: totrans-278
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 蜡烛的总数减少。
- en: The spikes in the charts due to sudden price movement are minimized. Smaller
    candle interval charts have more spikes as they focus on local trends, while larger
    candle interval charts have fewer spikes and are smoother.
  id: totrans-279
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 图表中由突然价格波动引起的尖峰被最小化。较小的蜡烛间隔图表有更多尖峰，因为它们专注于局部趋势，而较大的蜡烛间隔图表有较少的尖峰，更加平滑。
- en: A long-term trend in the stock price becomes visible.
  id: totrans-280
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 股价的长期趋势变得可见。
- en: Decision-making may become slower because you have to wait longer to get new
    candle data. Slower decisions may or may not be desirable, depending on the strategy.
    For example, to confirm trends, using a combination of data with a smaller candle
    interval, say 3 minutes, and data with a larger candle interval, say 15 minutes,
    would be desirable. On the other hand, to grab opportunities in intraday trading,
    data with larger candle intervals, say 1 hour or 1 day, would not be desirable.
  id: totrans-281
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 决策可能变得更慢，因为您必须等待更长时间才能获得新的蜡烛数据。较慢的决策可能是可取的，也可能不是，这取决于策略。例如，为了确认趋势，使用较小的蜡烛间隔数据（例如3分钟）和较大的蜡烛间隔数据（例如15分钟）的组合是可取的。另一方面，为了抓住日内交易的机会，不希望使用较大的蜡烛间隔数据（例如1小时或1天）。
- en: The price ranges (y-axis spread) of two adjacent candles don't overlap with
    each other. Adjacent candles always share one of their ends.
  id: totrans-282
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 相邻蜡烛的价格范围（y轴跨度）不会重叠。相邻蜡烛总是共享它们的一端。
- en: None of the timestamps need to be equally spaced in time (unlike in the Japanese
    candlestick pattern) as candles are formed based on price movement and not time
    movement.
  id: totrans-283
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 时间戳都不需要等距离（不像日本蜡烛图案中那样），因为蜡烛是基于价格运动而不是时间运动形成的。
- en: If you are interested in finding out about the Math and implementation of Renko
    candles, please refer to its source code in the `pyalgotrading` package at [https://github.com/algobulls/pyalgotrading/blob/master/pyalgotrading/utils/candlesticks/renko.py](https://github.com/algobulls/pyalgotrading/blob/master/pyalgotrading/utils/candlesticks/renko.py).
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您对Renko蜡烛的数学和实现感兴趣，请参考`pyalgotrading`包中的源代码[https://github.com/algobulls/pyalgotrading/blob/master/pyalgotrading/utils/candlesticks/renko.py](https://github.com/algobulls/pyalgotrading/blob/master/pyalgotrading/utils/candlesticks/renko.py)。
- en: Fetching historical data using the Heikin-Ashi candlestick pattern
  id: totrans-285
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用平均趋势蜡烛图案获取历史数据
- en: The historical data of a financial instrument can be analyzed in the form of
    the Heikin-Ashi candlestick pattern. Brokers typically do not provide historical
    data using the Heikin-Ashi candlestick pattern via APIs. Brokers usually provide
    historical data using the Japanese candlestick pattern, which needs to be converted
    to the Heikin-Ashi candlestick pattern. A shorter candle interval hints at a localized
    price movement trend, while a larger candle interval indicates an overall price
    movement trend. Based on your algorithmic trading strategy, you may need the candle
    interval to be small or large. A candle interval of 1 minute is often the smallest
    available candle interval.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 金融工具的历史数据可以以Heikin-Ashi蜡烛图案的形式进行分析。经纪人通常不会通过API提供使用Heikin-Ashi蜡烛图案的历史数据。经纪人通常使用日本蜡烛图案提供历史数据，需要将其转换为Heikin-Ashi蜡烛图案。较短的蜡烛间隔暗示着局部价格走势，而较大的蜡烛间隔则表示整体价格走势。根据您的算法交易策略，您可能需要蜡烛间隔较小或较大。1分钟的蜡烛间隔通常是最小的可用蜡烛间隔。
- en: 'The Heikin-Ashi candlestick pattern works as follows:'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: Heikin-Ashi蜡烛图案的工作原理如下：
- en: 'Each candle has `Close`, `Open`, `High`, and `Low` attributes. For each candle,
    the following occurs:'
  id: totrans-288
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每根蜡烛都有`收盘价`、`开盘价`、`最高价`和`最低价`属性。对于每根蜡烛，发生以下情况：
- en: '`Close` is calculated as the average of the `Open`, `High`, `Low`, and `Close` attributes
    of the current Japanese candle.'
  id: totrans-289
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`收盘价`被计算为当前日本蜡烛的`开盘价`、`最高价`、`最低价`和`收盘价`属性的平均值。'
- en: '`Open` is the average of the `Open` and `Close` attributes of the previous
    Heikin-Ashi candle.'
  id: totrans-290
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`开盘价`是前一个Heikin-Ashi蜡烛的`开盘价`和`收盘价`属性的平均值。'
- en: '`High` is max of:'
  id: totrans-291
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`最高价`是：'
- en: '`Open` of current Heikin-Ashi candle'
  id: totrans-292
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当前Heikin-Ashi蜡烛的`开盘价`
- en: '`Close` of current Heikin-Ashi candle'
  id: totrans-293
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当前Heikin-Ashi蜡烛的`收盘价`
- en: '`High` of current Japanese candle'
  id: totrans-294
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当前日本蜡烛的`最高价`
- en: '`Low` is the min of:'
  id: totrans-295
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`最低价`是：'
- en: '`Open` of current Heikin-Ashi candle'
  id: totrans-296
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当前Heikin-Ashi蜡烛的`开盘价`
- en: '`Close` of current Heikin-Ashi candle'
  id: totrans-297
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当前Heikin-Ashi蜡烛的`收盘价`
- en: '`Low` of current Japanese Candle'
  id: totrans-298
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当前日本蜡烛的`最低价`
- en: A green candle is formed when `Close` is higher than `Open`. (This is the same
    as the green candle in the Japanese candlestick pattern.)
  id: totrans-299
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当`收盘价`高于`开盘价`时形成绿色蜡烛。（这与日本蜡烛图案中的绿色蜡烛相同。）
- en: A red candle is formed when `Close` is lower than `Open`. (This is the same
    as the red candle in the Japanese candlestick pattern.)
  id: totrans-300
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当`收盘价`低于`开盘价`时形成红色蜡烛。（这与日本蜡烛图案中的红色蜡烛相同。）
- en: All the timestamps are equally spaced (within market hours).
  id: totrans-301
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有时间戳均匀分布（在市场营业时间内）。
- en: This recipe shows you how to fetch historical data using Japanese candlestick
    pattern when using the broker API, as well as how to convert and plot the historical
    data using the Heikin-Ashi candlestick pattern for various candle intervals.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 本食谱向您展示了如何在使用经纪人API时使用日本蜡烛图案获取历史数据，以及如何使用Heikin-Ashi蜡烛图案转换和绘制历史数据，以适应各种蜡烛间隔。
- en: Getting ready
  id: totrans-303
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Make sure the `broker_connection` object is available in your Python namespace.
    Refer to the *Technical requirements* section of this chapter to learn how to
    set up `broker_connection`.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 确保`broker_connection`对象在您的Python命名空间中可用。请参考本章的*技术要求*部分，了解如何设置`broker_connection`。
- en: How to do it…
  id: totrans-305
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: 'We execute the following steps for this recipe:'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 我们对这个食谱执行以下步骤：
- en: 'Import the necessary modules:'
  id: totrans-307
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入必要的模块：
- en: '[PRE50]'
  id: totrans-308
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'Fetch the historical data for an instrument and convert it into Heikin-Ashi
    data:'
  id: totrans-309
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取仪器的历史数据并将其转换为Heikin-Ashi数据：
- en: '[PRE51]'
  id: totrans-310
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'You will get the following output:'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/e6ce20c1-3076-4026-956e-e551d4e769d9.png)'
  id: totrans-312
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e6ce20c1-3076-4026-956e-e551d4e769d9.png)'
- en: 'Create a green Heikin-Ashi candle for one row of data:'
  id: totrans-313
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为一行数据创建一个绿色Heikin-Ashi蜡烛：
- en: '[PRE52]'
  id: totrans-314
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'You will get the following output:'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/6d87f35f-5267-4821-817a-4788a36977fb.png)'
  id: totrans-316
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6d87f35f-5267-4821-817a-4788a36977fb.png)'
- en: 'Create a red Heikin-Ashi candle for one row of data:'
  id: totrans-317
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为一行数据创建一个红色Heikin-Ashi蜡烛：
- en: '[PRE53]'
  id: totrans-318
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'You will get the following output:'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/59a36b0a-c1da-4a2c-a26d-40aed004707a.png)'
  id: totrans-320
  prefs: []
  type: TYPE_IMG
  zh: '![](img/59a36b0a-c1da-4a2c-a26d-40aed004707a.png)'
- en: 'Plot a chart for the historical data of the instrument with a 1-minute candle
    interval:'
  id: totrans-321
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器历史数据的图表，间隔为1分钟蜡烛：
- en: '[PRE54]'
  id: totrans-322
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'You will get the following output:'
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/93d8dcab-2716-4f4a-a5ff-69622ad7720b.png)'
  id: totrans-324
  prefs: []
  type: TYPE_IMG
  zh: '![](img/93d8dcab-2716-4f4a-a5ff-69622ad7720b.png)'
- en: 'Plot a chart for the historical data of the instrument with a 3-minute candle
    interval:'
  id: totrans-325
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器历史数据的图表，间隔为3分钟蜡烛：
- en: '[PRE55]'
  id: totrans-326
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'You will get the following output:'
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/2b9e5c4a-1f20-4ff8-b655-cb450ec4b51d.png)'
  id: totrans-328
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2b9e5c4a-1f20-4ff8-b655-cb450ec4b51d.png)'
- en: 'Plot a chart for the historical data of the instrument with a 5-minute candle
    interval:'
  id: totrans-329
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器历史数据的图表，间隔为5分钟蜡烛：
- en: '[PRE56]'
  id: totrans-330
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'You will get the following output:'
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/43712f77-438b-4284-8391-ff59e6dce24c.png)'
  id: totrans-332
  prefs: []
  type: TYPE_IMG
  zh: '![](img/43712f77-438b-4284-8391-ff59e6dce24c.png)'
- en: 'Plot a chart for the historical data of the instrument with a 10-minute candle
    interval:'
  id: totrans-333
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器历史数据的图表，间隔为10分钟蜡烛：
- en: '[PRE57]'
  id: totrans-334
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'You will get the following output:'
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/ca2c179b-4020-49ae-aed3-13ade0abd2fe.png)'
  id: totrans-336
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ca2c179b-4020-49ae-aed3-13ade0abd2fe.png)'
- en: 'Plot a chart for the historical data of the instrument with a 15-minute candle
    interval:'
  id: totrans-337
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器历史数据的图表，间隔为15分钟蜡烛：
- en: '[PRE58]'
  id: totrans-338
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'You will get the following output:'
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/3d3462b5-0b58-4a56-b97b-031f2523d8ca.png)'
  id: totrans-340
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3d3462b5-0b58-4a56-b97b-031f2523d8ca.png)'
- en: 'Plot a chart for the historical data of the instrument with a 30-minute candle
    interval:'
  id: totrans-341
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器历史数据的图表，间隔为30分钟蜡烛：
- en: '[PRE59]'
  id: totrans-342
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: 'You will get the following output:'
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/f18afad9-d8a5-4bff-9f26-e0e6d0d4234c.png)'
  id: totrans-344
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f18afad9-d8a5-4bff-9f26-e0e6d0d4234c.png)'
- en: 'Plot a chart for the historical data of the instrument with a 1-hour candle
    interval:'
  id: totrans-345
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器历史数据的图表，间隔为1小时蜡烛：
- en: '[PRE60]'
  id: totrans-346
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: 'You will get the following output:'
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/bd8109ae-7421-4c0d-a7fa-268be204c0fb.png)'
  id: totrans-348
  prefs: []
  type: TYPE_IMG
  zh: '![](img/bd8109ae-7421-4c0d-a7fa-268be204c0fb.png)'
- en: 'Plot a chart for the historical data of the instrument with a 1-day candle
    interval:'
  id: totrans-349
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制仪器历史数据的图表，间隔为1天蜡烛：
- en: '[PRE61]'
  id: totrans-350
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 'You will get the following output:'
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/dfc0ca08-a2ff-4cfe-acbd-b0cd7c5e99e5.png)'
  id: totrans-352
  prefs: []
  type: TYPE_IMG
  zh: '![](img/dfc0ca08-a2ff-4cfe-acbd-b0cd7c5e99e5.png)'
- en: How it works…
  id: totrans-353
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理…
- en: In *step 1*, you import `plot_candlestick_chart`, a quick utility function for
    plotting candlestick pattern charts, `PlotType`, an enum for various types of
    candlestick patterns, and the `HeikinAshi` function, which can convert historical
    data from the Japanese candlestick pattern into data that's applicable to the
    Heikin-Ashi candlestick pattern. In *step 2*, you use the `get_instrument()` method
    of `broker_connection` to fetch an instrument and assign it to a new attribute,
    `instrument`. This object is an instance of the `Instrument` class. The two parameters
    needed to call `get_instrument()` are the exchange (`'NSE'`) and the trading symbol
    (`'TATASTEEL'`). Next, you use the `get_historical_data()` method of the `broker_connection`
    object to fetch the historical data for the duration of December 2019, with a
    candle interval of 1 minute. The time-series data returned is in the form of Japanese
    candlestick pattern. The `HeikinAshi()` function converts this data to Heikin-Ashi
    candlestick pattern, another `pandas.DataFrame` object. You assign it to `historical_data_1minute_heikinashi`.
    Observe that `historical_data_1minute_heikinashi` has `timestamp`, `close`, `open`,
    `high`, and `low` columns. Also, observe that the timestamps are equidistant as
    the Heikin-Ashi candles are based on the average values of the Japanese candles.
    In *steps 3* and *4*, you selectively extract a green and a red candle from the
    data. (Please note, this indices passed to `historical_data.iloc` would be different
    if you choose a different duration for `historical_data` fetched in the first
    recipe of this chapter.) Observe that the candles have shadows (lines extending
    on either side of the main candle body) as the candle have `high` and `low` attributes,
    along with the `open` and `close` attributes. In *step 5*, you plot the complete
    historical data held by `historical_data` using the `plot_candlstick_charts()`
    function.
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤1*中，您导入`plot_candlestick_chart`，一个用于绘制蜡烛图案图表的快速实用程序函数，`PlotType`，用于各种蜡烛图案类型的枚举，以及`HeikinAshi`函数，该函数可以将日本蜡烛图案的历史数据转换为适用于平均趋势蜡烛图案的数据。在*步骤2*中，您使用`broker_connection`的`get_instrument()`方法获取一个工具，并将其分配给一个新属性`instrument`。这个对象是`Instrument`类的一个实例。调用`get_instrument()`所需的两个参数是交易所（'NSE'）和交易符号（'TATASTEEL'）。接下来，您使用`broker_connection`对象的`get_historical_data()`方法获取2019年12月的历史数据，蜡烛间隔为1分钟。返回的时间序列数据以日本蜡烛图案的形式呈现。`HeikinAshi()`函数将这些数据转换为平均趋势蜡烛图案，另一个`pandas.DataFrame`对象。您将其分配给`historical_data_1minute_heikinashi`。请注意，`historical_data_1minute_heikinashi`具有`timestamp`、`close`、`open`、`high`和`low`列。还要注意，时间戳是等距的，因为平均趋势蜡烛是基于日本蜡烛的平均值。在*步骤3*和*4*中，您从数据中选择性地提取了一个绿色蜡烛和一个红色蜡烛。（请注意，如果您选择本章第一个配方中获取的`historical_data`的不同持续时间，传递给`historical_data.iloc`的索引将不同。）请注意，蜡烛具有阴影（延伸在主蜡烛体两侧的线），因为蜡烛具有`high`和`low`属性，以及`open`和`close`属性。在*步骤5*中，您使用`plot_candlstick_charts()`函数绘制`historical_data`中保存的完整历史数据。
- en: 'In *steps 6* until *12*, you fetch the historical data using the Japanese candlestick
    pattern, converts it into the Heikin-Ashi candlestick pattern, and plots the converted
    data for candle intervals of 3 minutes, 5 minutes, 10 minutes, 15 minutes, 30
    minutes, 1 hour, and 1 day, respectively. Observe the following differences and
    similarities among the charts as the candle interval increases:'
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤6*至*12*中，您使用日本蜡烛图案获取历史数据，将其转换为平均趋势蜡烛图案，并分别绘制3分钟、5分钟、10分钟、15分钟、30分钟、1小时和1天的蜡烛间隔的转换数据。随着蜡烛间隔的增加，观察以下图表之间的差异和相似之处：
- en: The total number of candlesticks decreases.
  id: totrans-356
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 蜡烛图的总数减少。
- en: The spikes in the charts due to sudden price movement are minimized. Smaller
    candle interval charts have more spikes as they focus on local trends, while larger
    candle interval charts have fewer spikes and are smoother.
  id: totrans-357
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于突然的价格波动，图表中的尖峰被最小化。较小蜡烛间隔的图表有更多的尖峰，因为它们关注局部趋势，而较大蜡烛间隔的图表有较少的尖峰，更加平滑。
- en: A long-term trend in the stock price becomes visible.
  id: totrans-358
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 股价的长期趋势变得可见。
- en: Decision-making may become slower because you have to wait longer to get new
    candle data. Slower decisions may or may not be desirable, depending on the strategy.
    For example, to confirm trends, using a combination of data with a smaller candle
    interval, say 3 minutes, and data with a larger candle interval, say 15 minutes,
    would be desirable. On the other hand, to grab opportunities in intraday trading,
    data with larger candle intervals, say 1 hour or 1 day, would not be desirable.
  id: totrans-359
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 决策可能变得更慢，因为您必须等待更长时间才能获取新的蜡烛数据。较慢的决策可能是可取的，也可能不是，这取决于策略。例如，为了确认趋势，使用较小蜡烛间隔的数据（例如3分钟）和较大蜡烛间隔的数据（例如15分钟）的组合是可取的。另一方面，为了抓住日内交易的机会，不希望使用较大蜡烛间隔的数据（例如1小时或1天）。
- en: The price ranges (y-axis spread) of adjacent candles may or may not overlap.
  id: totrans-360
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 相邻蜡烛的价格范围（y轴跨度）可能重叠，也可能不重叠。
- en: All the timestamps are equally spaced in time (within market hours).
  id: totrans-361
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有时间戳在时间上均匀分布（在市场营业时间内）。
- en: If you are interested in finding out about the Math and implementation of Heikin-Ashi
    candles, please refer to the source code in the `pyalgotrading` package at [https://github.com/algobulls/pyalgotrading/blob/master/pyalgotrading/utils/candlesticks/heikinashi.py](https://github.com/algobulls/pyalgotrading/blob/master/pyalgotrading/utils/candlesticks/heikinashi.py).
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您有兴趣了解平均趋势蜡烛的数学和实现，请参考`pyalgotrading`包中的源代码[https://github.com/algobulls/pyalgotrading/blob/master/pyalgotrading/utils/candlesticks/heikinashi.py](https://github.com/algobulls/pyalgotrading/blob/master/pyalgotrading/utils/candlesticks/heikinashi.py)。
- en: Fetching historical data using Quandl
  id: totrans-363
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Quandl获取历史数据
- en: So far, in all the recipes in this chapter, you have used the broker connection
    to fetch historical data. In this recipe, you will fetch historical data using
    a third-party tool, Quandl ([https://www.quandl.com/tools/python](https://www.quandl.com/tools/python)).
    It has a free to use Python version which can be easily installed using `pip`.
    This recipe demonstrates the use of `quandl` to fetch historical data of **FAAMG**
    stock prices (Facebook, Amazon, Apple, Microsoft, and Google).
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，在本章的所有配方中，您都使用了经纪人连接来获取历史数据。在这个配方中，您将使用第三方工具Quandl（[https://www.quandl.com/tools/python](https://www.quandl.com/tools/python)）来获取历史数据。它有一个免费使用的Python版本，可以使用`pip`轻松安装。这个配方演示了使用`quandl`来获取**FAAMG**股票价格（Facebook、亚马逊、苹果、微软和谷歌）的历史数据。
- en: Getting ready
  id: totrans-365
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Make sure you have installed the Python `quandl` package. If you haven''t,
    you can install it using the following `pip` command:'
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 确保您已安装Python的`quandl`包。如果没有，您可以使用以下`pip`命令进行安装：
- en: '[PRE62]'
  id: totrans-367
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: How to do it…
  id: totrans-368
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做…
- en: 'We execute the following steps for this recipe:'
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: 我们为这个配方执行以下步骤：
- en: 'Import the necessary modules:'
  id: totrans-370
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入必要的模块：
- en: '[PRE63]'
  id: totrans-371
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'Plot a chart for the historical data of Facebook with a 1-day candle interval:'
  id: totrans-372
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制Facebook的历史数据图表，间隔为1天蜡烛：
- en: '[PRE64]'
  id: totrans-373
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'You will get the following output:'
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/2d71218d-450a-465e-b7ab-93d85be55eeb.png)'
  id: totrans-375
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2d71218d-450a-465e-b7ab-93d85be55eeb.png)'
- en: 'Plot a chart for the historical data of Amazon with a 1-day candle interval:'
  id: totrans-376
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制亚马逊的历史数据图表，间隔为1天蜡烛：
- en: '[PRE65]'
  id: totrans-377
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: 'You will get the following output:'
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/2c9e01c8-7e1f-4424-bc21-e3f37d3710e1.png)'
  id: totrans-379
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2c9e01c8-7e1f-4424-bc21-e3f37d3710e1.png)'
- en: 'Plot a chart for the historical data of Apple with a 1-day candle interval:'
  id: totrans-380
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制苹果的历史数据图表，间隔为1天蜡烛：
- en: '[PRE66]'
  id: totrans-381
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'You will get the following output:'
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/f1be033d-d543-45e8-9bed-524fb25c4131.png)'
  id: totrans-383
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f1be033d-d543-45e8-9bed-524fb25c4131.png)'
- en: 'Plot a chart for the historical data of Microsoft with a 1-day candle interval:'
  id: totrans-384
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制微软的历史数据图表，间隔为1天蜡烛：
- en: '[PRE67]'
  id: totrans-385
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'You will get the following output:'
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/eb2909f1-4625-4284-8944-c6eb0112fe0d.png)'
  id: totrans-387
  prefs: []
  type: TYPE_IMG
  zh: '![](img/eb2909f1-4625-4284-8944-c6eb0112fe0d.png)'
- en: 'Plot a chart for the historical data of Google with a 1-day candle interval:'
  id: totrans-388
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制谷歌的历史数据图表，间隔为1天蜡烛：
- en: '[PRE68]'
  id: totrans-389
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'You will get the following output:'
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: 您将获得以下输出：
- en: '![](img/1c9ce622-24a8-4866-9855-e70e553dc739.png)'
  id: totrans-391
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1c9ce622-24a8-4866-9855-e70e553dc739.png)'
- en: How it works…
  id: totrans-392
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理…
- en: In *step 1*, you import `plot_candlestick_chart`, a quick utility function for
    plotting candlestick pattern charts, `PlotType`, an enum for various types of
    candlestick patterns, and the `quandl` module. In the remaining steps, historical
    data for the Facebook, Amazon, Apple, Microsoft, and Google stocks are fetched
    using `quandl.get()` and plotted using the `plot_candlestick_chart()` method.
    The data that's returned by the `quandl` is in the OHLC (open, high, low, close)
    format.
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤1*中，您导入`plot_candlestick_chart`，一个用于绘制蜡烛图表的快速实用程序函数，`PlotType`，用于各种蜡烛图案的枚举，以及`quandl`模块。在剩下的步骤中，使用`quandl.get()`获取Facebook、亚马逊、苹果、微软和谷歌股票的历史数据，并使用`plot_candlestick_chart()`方法绘制。`quandl`返回的数据格式为OHLC（开盘价、最高价、最低价、收盘价）格式。
- en: The upside of such third-party modules is that they are free and you don't need
    to set up a broker connection to fetch the historical data. The downside is that
    this data from the free package has its limitations. For example, the data cannot
    be fetched in real-time and the data cannot be fetched for intraday trading (1-minute
    candle, 3-minute candle, and so on).
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: 这种第三方模块的优势在于它们是免费的，您无需设置经纪人连接来获取历史数据。缺点是来自免费包的数据有其局限性。例如，无法实时获取数据，也无法获取分时交易的数据（1分钟蜡烛、3分钟蜡烛等）。
- en: So, whether you want to use this data depends on your requirements. It may be
    good for testing or flow flushing the existing code base, but not good enough
    for providing live data feeds, which are needed during real trading sessions.
  id: totrans-395
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，您是否要使用这些数据取决于您的需求。这可能对于测试或流动冲洗现有代码库很好，但不足以提供实时数据源，这在真实交易会话期间是必需的。
