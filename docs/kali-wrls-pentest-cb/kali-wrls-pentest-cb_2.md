# 第二章：攻击访问控制

在本章中，我们将涵盖以下内容：

+   处理战争驾驶

+   映射接入点并提高准确性

+   创建伪装接入点

+   通过 MAC 欺骗规避 MAC 过滤

+   识别淫秽客户端

# 介绍

在处理无线网络时，可能使用的攻击类型之一是访问控制攻击。属于这一类别的攻击旨在通过规避访问控制措施来渗透和破坏无线网络。这些类型的访问控制措施包括 MAC 过滤、错误配置、伪装接入点以及本章中将讨论的其他项目。

在我们深入研究访问控制之前，让我们更详细地了解一下，以更清楚地理解我们在本章中攻击的是什么。

访问控制过程涉及辨识和授权。任何针对访问控制的攻击都会试图窃取凭据，或者冒充用户或系统，以获取访问权限并执行未经授权或明显恶意的活动。正因为访问控制是攻击的常见目标，组织必须实施强大和适当的控制。

在无线网络上，访问控制可以采用多种不同形式，每种形式可以独立使用，也可以一起部署以形成更强大的解决方案。无线网络中使用的访问控制机制的一些示例包括：

+   **MAC 过滤**：这是一个过程，其中 MAC 地址被输入到接入点中，目的是允许或禁止持有这些 MAC 地址的设备访问。

+   **隐藏 SSID**：这种技术是由网络管理员使用的，用于阻止网络标识符在公开环境中的广播。

+   **接入点位置**：网络所有者可以选择将他们的接入点放置在建筑物内的特定地理区域，以限制广播的范围。这限制了恶意方或攻击方获取访问权限的信号量。

这只是一个潜在的措施清单，可以用于访问控制，以限制无线网络仅授权用户的可访问性。

一旦访问控制被破坏或颠覆，攻击者可以继续深入到目标网络中。攻击者可能通过利用无线网络或连接到无线网络的设备中存在的缺陷或错误配置，或者甚至是被忽视或低估的选项来规避访问控制。

# 访问控制攻击类型

访问控制攻击有多种形式，其中并非所有形式都能在本书的页面中涵盖。但是，我们可以涵盖这种类型攻击中许多更常见的形式。在我们开始探索每一种攻击之前，让我们首先列出本章将涵盖的攻击：

+   战争驾驶

+   伪装接入点

+   MAC 欺骗

+   临时关联

+   AP 错误配置

+   客户端错误关联

+   未经授权的关联

+   淫秽客户端

请记住，这只是可以用来针对无线网络上的访问控制的攻击类型中的一些，它们不应被视为唯一的访问控制攻击类型。

# 处理战争驾驶

用于针对访问控制的最早和最常用的攻击形式之一是一种称为战争驾驶的技术。简而言之，这种技术是使用无线设备以及专门用于检测或探测到达无线设备范围内的无线网络的软件。

战车如此受欢迎和有效的原因在于，许多计算机用户，无论是个人还是企业，多年来一直在部署`802.11`无线接入点，却很少考虑安全性。允许用户漫游的无线网络的部署已经超过了采取措施来保护他们的接入点和设备免受潜在攻击的重要性。

对于部署了配置错误或不安全的无线网络，我们有一类攻击者参与这种被称为战车的做法。参与这种活动的人会建造定制的设备，由硬件和软件组合而成，目的是在公共场所巡游，寻找无线接入点和设备。这些人可能只是对定位和针对特定网络感兴趣，或者在某些情况下，他们甚至可能会将这些信息分享到在线数据库或网站，让任何访问者都可以搜索这些接入点。

在实践中，个人使用这种攻击方法是通过在探索目标区域之前启用他们的无线设备和软件。当攻击者选择探索目标区域时，他们可以使用自行车、汽车、摩托车、步行，甚至使用新的方法，如无线无人机。无论使用哪种方法，只要攻击方对探索目标区域采取合理的系统方法，他们就会发现许多无线设备和/或网络。一旦他们找到这些无线网络，他们就可以浏览他们收集到的信息，并确定要专注和渗透的无线目标。

在 Kali Linux 中，我们有许多工具可以轻松促进战车的实践。在发行版中，每一个对战车有用的工具都有其自己的一套功能，这些功能可能存在于其他工具中，也可能不存在。在本书中，我们将专注于使用一种更受欢迎的工具来进行战车，这种工具被称为 Kismet。

战车不仅有一种形式，还有其他属于这个术语的子类型。具体来说：

+   **战飞**：与战车相同，但使用小型飞机或超轻型飞机

+   **战气球**：与战飞相同，但使用气球

+   **战步行**：这涉及将检测设备放在背包或类似物品中，穿过建筑物和其他设施

# 准备工作

要开始操作，您需要准备以下物品：

+   一个能够进入监视模式的无线网卡

+   Kali Linux 安装了 Kismet（默认 Kali 安装的一部分）

这里列出的物品是基本要求，如果需要，您可以轻松地使用更多（或不同的）组件。例如，如果您想要增强范围，您可以使用一个带有外部天线连接的 USB 无线网卡，以获得更好的接收效果。您也可以使用不同的无线应用程序来完成这项任务；但是，由于 Kismet 非常受欢迎，我们将在本文中使用它。

# 如何做到这一点...

Kismet 是一个有效的工具，用于定位和提取无线接入点和设备的有用信息。

在命令行上启动 Kismet 之前，需要注意一点：如果您使用外部 Wi-Fi 适配器，您应该在发出命令之前安装和配置它。默认情况下，Kismet 应该配置为使用物理系统上存在的无线适配器；但是，如果您选择使用外部适配器，您可能需要执行额外的配置，以便让您的适配器被 Kismet 识别。

在本教程中，我们将通过从命令提示符启动 Kismet 来启动 Kismet，但也可以通过应用程序菜单中的*无线攻击*部分启动它。在任何一种情况下，启动 Kismet 都将导致在此处记录的相同步骤：

1.  打开终端窗口。

1.  在命令提示符处，输入命令`kismet`。

1.  现在，您将从半图形环境中配置 Kismet。您将使用* Tab *和* Enter *键进行导航。

1.  如果您看不到灰色字母行，请使用* Tab *键突出显示`否`。否则，保持`是`突出显示。

1.  按一次* Enter *键。

1.  按一次* Enter *键以确认 Kismet 正在以 root 身份运行。

1.  按一次* Enter *键自动启动 Kismet 服务器。

1.  按一次* Enter *键以验证您要启动 Kismet 服务器。

1.  按一次* Enter *键以验证您可以`添加`捕获源：

1.  根据使用`ifconfig`发现的无线接口的名称进行输入。如果您记不得，可以打开另一个控制台窗口，并再次运行`ifconfig`命令以确定正确的接口（通常以`wlan`开头的名称）。以下屏幕截图显示了接口输入屏幕：

![](img/54c728c8-b6f7-4881-98fb-29a28c861e2a.png)

Kismet 界面配置

以下是要遵循的 Kismet 界面配置步骤

1.  1.  按一次* Tab *键。

1.  在名称字段中输入无线接口的名称。

1.  按一次* Tab *键。

1.  再次按* Tab *键。

1.  按一次* Enter *键。

1.  如果您输入名称正确，Kismet 应该能够识别命名的无线接口。它还将生成不需要的虚拟接口的名称，例如`wlan0mon`、`wlan0monmon`和`wmaster0`。

1.  当在 shell（Kismet 窗口）的右下角显示`关闭控制台窗口`时，按一次键盘的* Tab *键以突出显示`关闭控制台窗口`。

1.  按一次* Enter *键。

1.  无线接入点的列表将显示在 shell（Kismet 窗口）的左上方。

1.  单击下拉菜单中的`查看`。

1.  单击监视活动。

一旦您到达这一点，您会注意到设备将开始填充窗口。您将看到与每个设备相关的名称、信道、无线标准和其他信息。如果您等待足够长的时间，您会注意到会出现其他设备，并且列出的其他项目可能会有更多的信息填充，这些信息以前可能不存在。

在查看 Kismet 窗口中显示的网络列表时，可能会看到一些看起来有些不同的条目。例如，请查看以下屏幕截图：

![](img/90d061fe-c76f-4517-ba5f-77b626df25ab.png)

主 Kismet 窗口显示检测到的无线客户端。

如果您查看窗口中的项目，您会注意到有一个`探测网络`的条目。您可以移动到列表中的此项目上，并使用* + *或* - *来打开或关闭选择。您会注意到，当您展开项目时，您会看到会显示一系列项目。此列表记录了来自附近系统的探测请求。这些探测是由无线启用的系统发送的，该系统试图连接到它过去连接过的网络。仔细分析出现在探测请求下的网络名称可以揭示系统连接到的不同接入点的名称，并让您了解系统可能是如何或在哪里使用的。请记住，只要设备未与无线网络关联，许多操作系统都会发送这些探测请求。

还有其他软件包可以用来执行 Kismet 正在执行的相同操作；但是，Kismet 具有高度可定制和被动的优势。被动意味着软件不会向周围的无线接入点发送任何信息，而是监听与接入点相关的连接和流量，以揭示其存在并确定其名称。此外，该软件包还具有检测隐藏接入点的能力，而其他类似的软件包可能无法做到这一点。

# 映射接入点并提高准确性

战车驾驶的下一步是增强您收集的数据，包括有关接入点或设备本身的位置或地理数据。在现代，通过使用全球定位系统（GPS）技术来收集这些数据已经变得非常容易。现代 GPS 设备可以连接到笔记本电脑或笔记本电脑等系统，使用蓝牙、USB 甚至在某些情况下使用串行连接。如果您打算使用平板电脑或智能手机等移动设备进行战车驾驶，那么您的设备很可能已经包含了内置的 GPS，可以用来映射接入点。

如果您要使用外部 GPS 设备，重要的是要注意并非所有这些设备都是平等的。一些设备能够在开机后很短的时间内获取卫星定位和位置，而其他设备可能需要长达两分钟甚至更长的时间才能在冷启动后获取卫星定位。影响 GPS 数据质量和准确性的另一个因素是 GPS 设备更新其位置的频率；一些设备可能更频繁地更新其坐标，而其他设备可能更新得不那么频繁，可能会影响坐标的准确性。

实际上，所有 GPS 设备都可以用于进行战车驾驶。唯一的要求是这些 GPS 设备能够向请求系统或软件提供当前和相当准确的 GPS 数据。

# 准备工作

要开始工作，您需要准备以下物品：

+   能够进入监视模式的无线网卡

+   已安装 Kismet 的 Kali Linux（默认 Kali 安装的一部分）

+   蓝牙或 USB GPS 设备

这里列出的项目是基本要求，如果需要，您可以轻松地使用更多（或不同）的组件。例如，如果您想要增强范围，可以使用一个带有外部天线连接的基于 USB 的无线网卡，这样可以获得更好的接收。您也可以使用不同的无线应用程序来完成此任务，而不是 Kismet；但是，由于 Kismet 非常受欢迎，我们将在本教程中使用它。

# 操作步骤...

为了让 Kismet 访问 GPS 数据，我们需要先进行一些设置。这是通过使用 GPSD 来完成的。GPSD 实用程序用于从 GPS 返回信息，然后我们将在 Kismet 中使用这些信息：

![](img/69cc3c81-d607-40ed-ad22-032e7a5ba254.jpg)

能够与 Kismet 一起使用的 USB GPS 设备

1.  首先，要使用`gpsd`，您很可能需要安装它，因为它通常不作为 Kali 的安装过程的一部分。为了安装这个服务，我们只需使用以下命令：

```
        apt-get install gpsd

```

1.  然后，我们需要安装第二个称为`gpsd-clients`的软件包，以帮助检索 GPS 数据的过程。我们通过发出以下命令来安装这个软件包：

```
        apt-get install gpsd-clients

```

1.  安装完成后，现在应该连接您的 GPS 硬件。我们可以通过发出以下命令来验证 GPS dongle 是否存在：

```
        lsusb

```

1.  然后，验证您的无线适配器是否存在，并获取接口名称：

```
    ifconfig

```

1.  接下来，确保您的 GPS 适配器显示在`/dev/`目录中。要做到这一点，使用以下命令：

```
        ls /dev/gps*

```

上述命令显示在以下屏幕截图中：

![](img/0f834315-3d02-403b-971b-7d43eb55a754.png)

列出 GPS 设备的结果

1.  这也应该帮助你识别名称。一旦你在`/dev/`中确定了路径，将其作为参数传递给`gpsd`：

```
    gpsd /dev/gps[x]

```

1.  一旦你确定了`gps`的名称并成功地将其传递给`gpsd`进程，现在是时候转到 Kismet，看看它是否检测到 GPS。为此，你将像之前一样启动 Kismet。

1.  进入 Kismet 后，使用反引号/重音符号按钮（``` ) to access the Kismet menu at the top. Scroll right to the Windows menu, then select GPS Details:

![](img/cb99f363-0ff7-44f8-86f6-9d316895561a.png)

GPS details window

9.  Provided that you are getting a good signal with your GPS you should see a window that shows something similar to the following screenshot:

![](img/4461db74-2491-44d8-98bf-114da2d43ea0.png)

GPS signal received in Kismet

Keep in mind that, if you do not receive signals from multiple satellites, you will not be able to get reliable location information. In the event that you are unable to receive a decent signal from multiple satellites, you should try a different location by moving and waiting a few moments to see if you can reacquire a signal.

5.  Our next step is to convert the `.netxml` files created during a session of Kismet to `csv` format. To do this, we will use an application called `giskismet`, which will allow us to convert the `netxml` to our intended `csv` format. Before we do anything, we need to install `giskismet`; to do this, we perform the following steps:

1\. `apt-get update`.

2\. `apt-get install giskismet`.

3\. Press *Enter*.

```

giskismet ­-x Kismet-DATE.netxml ­-q "select *

from  wireless" ­-o wardrive.kml

```

Once you have Kismet configured to use a GPS to determine the location of wireless access points and clients, you can also use it to detect rogue access points that are not under your control, but are attached to your network. To do this, you need to know the access points that are approved to attach to your network, then use Kismet to survey the area and locate those access points that you do not recognize and may be connected to your network.

With a KML file created from the original data, we can now do the real cool part and import this data into Google Earth:

1.  Using your browser, open Google Earth.
2.  On the left, click My Places.
3.  Click Import KML file.
4.  Choose the location of the file you want to upload.
5.  Select and open the KML file. A preview of the list will open in Google Earth.
6.  To keep these places in your list, click Save.
7.  The locations will be saved to My Places.

8.  The following screenshot shows information from a KML file displayed within Google Earth.

![](img/dc045f01-062b-409f-afec-37b9ed6fbc9e.jpg)

KML data merged into Google Earth

# Creating a rogue access point

Another effective way to compromise or circumvent access control on a wireless network is to create what is known as a rogue access point. A rogue access point is simply a wireless access point that has been installed on a network without explicit permission or authorization from the owner or administrator of that network. In practice, a rogue access point can be put in place by a well-intentioned employee, or even a malicious party such as a disgruntled employee, or in an intruder.

An access point can come in one of two forms: it can be either a soft access point or some form of hard access point.

A soft access point is an access point that is created through software such as the types we have in Kali as well as other third-party applications. It can even be argued that the software present on smartphones creates a soft access point out of the smartphone itself by sharing out the phone's internet access through a Wi-Fi connection.

A hard access point is more straightforward, as it takes the form of a hardware device that can be purchased at a computer store or big-box retailer. In fact, this is the type of access point that most will think of when they think of setting up their own wireless network. These access points come from many different vendors, but they all tend to offer similar functions with various enhancements added on by each individual vendor.

# Getting ready

To get things started, you will need to have the following items in place:

*   A wireless card capable of entering monitor mode
*   Kali Linux with Kismet installed (part of the default Kali installation)

The items listed here are basic requirements and you could easily use more (or different) components if so desired. If you want enhanced range, for example, you could use a USB-based wireless card that has connections for an external antenna that could get better reception.

# How to do it...

In order to configure a rogue access point, we need to perform several steps. The goal of all these steps is to configure the wireless adapter on a system to mimic an access point and use a second adapter (preferably wired) to connect to the internet. The end result is traffic intercepted by the adapter mimicking the access point will direct traffic to the wired adapter and to the internet and send responses back to the requesting client back through the wireless adapter.

First, let's configure an adapter to connect to the internet:

1.  Open a Terminal window, and run the `ifconfig` command as covered in Chapter 1, *Kali Linux and Wireless Networking*.
2.  Identify the wired or wireless adapter you wish to use to connect to the internet and the one you will use as an access point.

3.  Take note of the adapter names (usually `wlan` for wireless and `eth` for wired) for reference and to keep track of which adapter is which. You will want to be certain which adapter will be connecting to the internet, and which will be the access point.
4.  You can use the Kali GUI to connect one adapter to the internet (in this example, we will name this adapter `eth0`).

The next portion of our process is to bring up the wireless adapter and configure as the gateway for your access point. We can do this by performing the following. We will assume that the interface name is `wlan0` for this this example:

1.  Configure the gateway for the `wlan0` using the `ifconfig` command by executing the following (in this example, we will set the gateway to `10.0.0.1/24`, but it could be set to any valid gateway provided it doesn't conflict with an existing address range or gateway):

```

Ifconfig wlan0 10.0.0.1/24 up

```

2.  Once we have the `wlan0` configured as our gateway we now want to configure both DHCP and DNS to issue IP addresses and perform name resolution for our clients. By configuring our rogue access point to issue IP addresses to requesting clients, it now becomes possible to provide them the addresses of both our gateway and DNS server. The DNS portion becomes very important when we wish to perform man-in-the-middle and sniffing attacks as it allows us to intercept name queries and redirect them as we see fit.
3.  Our steps in this process is to configure and execute `dnsmasq`. This utility will allow us to perform both the roles of DHCP and DNS.
4.  We start by first creating a file named `dnsmasq.conf`, which informs the `dnsmasq` application how to work. To do this, you will need to open a text editor such as `gedit` or anything that creates simple text files. In this file, you will enter information like the following:

```

interface=wlan0

dhcp-range=10.0.0.10,10.0.0.250,12h

dhcp-option=3,10.0.0.1

dhcp-option=6,10.0.0.1

server=8.8.8.8

```

5.  Once completed, save this information to a file named `dnsmasq.conf`.

What this file you just created does is the following:

*   **Interface**: This states which interface to listen for requests and hand out addresses on.
*   **Dhcp-range**: This provides the `dhcp` range as well as the number of hours to lease an IP for.
*   **Dhcp-option**: These are the `dhcp` servers.
*   **Server**: this is the address of the DNS server that you will be forwarding queries to. Keep in mind that with just this file in place the access point we are configuring will forward all requests to `8.8.8.8` to be resolved (in this case the address points to one of Google's free DNS servers). If we don't do anything else, this system will only act like any other access point without doing anything special.

If we wish to intercept requests we need to create an additional file known as `fakehosts.conf`, which allows us to inform `dnsmasq` which queries we want to intercept:

1.  We start by first creating a file named `fakehosts.conf`, which informs the `dnsmasq` application which requests will be intercepted.
2.  To do this, you will need to open a text editor such as gedit or anything that creates simple text files much like we did previously. In this file, you will enter information like the following:

```

10.0.0.9 usatoday.com

10.0.0.9 zelda.com

将此文件保存为 fakehosts.conf

```

3.  This will cause the `dnsmasq` DNS server to respond with `10.0.0.9` to any request for either of these addresses. In an actual attack scenario, we would put in the IP address of a server we control, so that when a victim visited it they would provide information or get infected with malware, or something else we desire.
4.  We then need to start `dnsmasq` up, as follows:

```

dnsmasq -C dnsmasq.conf -H fakehosts.conf

```

5.  This tells `dnsmasq` to configure itself using `dnsmasq.conf` (`-C`) and refer to `fakehosts.conf` for the information on the spoofed hosts.

6.  With the configuration and successful startup of `dnsmasq` (meaning no errors are returned) we can now bring up the access point itself. What this means is that we will be starting up a service that allows our wireless adapter to advertise itself as an access point to anyone willing to attach to it. To do this, we need to run a program known as `hostapd`.
7.  In order to run `hostapd`, we first need to install it; this is done by running the following command:

```

apt-get install hostapd

```

8.  Next, much like `dnsmasq`, we need to create a `conf` file that tells `hostapd.conf` how to function; we do this by performing the following steps:
    1.  Open a text editor.
    2.  Enter the following in the file:

```

interface=wlan0

driver=nl80211

ssid=freewifi

channel=1

```

1.  3.  Save the file as `hostapd.conf`.
    4.  What this file is providing us is vital configuration information; here is what each line provides:
        *   **Interface**: This is the name of the interface to listen on.
        *   **Driver**: This is the name of the driver to use. In this case, I have used the `nl80211`, which works with a broad range of wireless adapters, but you may need to research the driver for your device if this one doesn't function for you.
        *   **Ssid**: This will be the name of the network to be advertised.
        *   **Channel**: This is the channel that will be used to broadcast the wireless signal on. This value can be set to any value channel for your wireless environment.

9.  Next, we need to bring up the access point; we do this by executing the following command:

```

hostapd ./hostapd.conf

```

10.  This will bring up the access point. It is possible that you may see an error message about failing to update, but this is normal and generally has no ill effects.
11.  Next, we need to perform some routing by directing traffic from `wlan0` to `eth0` essentially create a very simple NAT setup. To do this, issue the following commands:

```

sysctl -w net.ipv4.ip_forward=1

iptables -P FORWARD ACCEPT

iptables --table nat -A POSTROUTING -o

wlan0 -j MASQUERADE

```

At this stage, you should now be able to connect to free Wi-Fi, get an IP address, and start using the internet.

Once you have the rogue access point running, you have plenty of options as to how you can use it to cause grief for those attaching to it. For example, running a packet sniffer such as Wireshark on the access point itself will allow you to capture traffic as it moves across the access point. This means that victims attaching to the access point can have important data such as login credentials revealed if they aren't otherwise protected.

# Evading MAC filtering with MAC spoofing

During your explorations, one technique that may be deployed against you an effort to stop you is a technique known as MAC filtering. Simply put, MAC filtering is a countermeasure that involves either whitelisting the MAC addresses of devices approved to be on your network or blacklisting devices that you don't want on your network. While this technique is incredibly rare and often encountered on none but the smallest of networks it is still a countermeasure that frequently pops up as a recommended security mechanism. Here, we will explore how to evade MAC filtering and gain access to a network anyway.

In most consumer and commercial grade access points, it is not difficult to find an option for MAC filtering. Usually, this option goes by the name of MAC filtering or it may be under a group of settings for access control and may even be labeled as approved or blocked devices in some access points. No matter what name it goes by it still performs the same function which is that the administrator of the wireless network will choose to collect all the MAC addresses from the wireless devices they control and enter each manually into the access point, thereby whitelisting them. On the other hand, the administrator may choose to use blacklisting which is where they will detect rogue devices that have attached or are attempting to attach to the wireless network and then manually enter their MAC addresses blocking them. In either case, the process can be rather tedious and time-consuming and will get more so as the size of the network increases along with increased changes being made to the wireless network.

As you may guess from the name of this section, there is a way to evade MAC filtering and that is through a very easy and effective technique known as MAC spoofing:

![](img/94bc6ac6-eb5e-416f-b3c2-c3fe13422aa4.jpg)

MAC Filtering option in a wireless router

MAC spoofing is a technique where we change the MAC address that is being reported by the network card or adapter. As a quick refresher, you should recall that the MAC address, sometimes called the physical address, is a hexadecimal value that is assigned to each and every network card as it's manufactured. Partially due to design and partially due to industry-standard, these addresses are intended to be unique, so that no two network cards should ever have the same MAC address. It is because of this very reason that MAC filtering is able to function as it does. However, by using MAC spoofing, we can change the address that is being reported and therefore put in whatever address we want to have reported from the network adapter. In practice, this means that by changing our MAC address to one of our choosing we can either evade blacklisting by changing our MAC address to something new or we can circumvent whitelisting by using the MAC address of an approved device.

So, let's take a look at how we do this.

# Getting ready

To get things started, you will need to have the following items in place:

*   A wireless card capable of entering monitor mode
*   Kali Linux
*   `airmon-ng`
*   `airodump-ng`
*   MAC changer

The items listed here are basic requirements and you could easily use more (or different) components if so desired. If you want enhanced range, for example, you could use a USB-based wireless card that has connections for an external antenna that could get better reception. In this recipe, we will also make use of two of the components of the `aircrack-ng` suite (which we will see more of throughout this book) to identify clients and their MAC addresses to attack.

# How to do it...

Following are the steps to carry out the attack:

1.  The first step in carrying out this type of attack is to switch your Wi-Fi adapter into monitoring mode, so we can detect the information we need to detect traffic and their associated MAC addresses. To do this, we run the following commands:

```

airmon-ng start wlan0

```

2.  In this case, the command sequence tells Kali to start the `airmon-ng` process on the `wlan0` interface. This application will start the interface in monitoring mode which is very important. Basically, monitor mode in Wi-Fi allows the card to observe all wireless traffic without having to associate to any access point first.
3.  With this done we now wish to see all the connected clients to a specific access point. To do this, we simply use the following command sequence:

```

airodump-ng -i wlan0mon

```

Note that the name of the interface we are using is `**wlan0mon**` instead of `**wlan0**`. This is because when we executed `**airmon-ng**` it switched the card into monitor mode while adding a new interface `**wlan0mon**`. You can view these interface names through a simple run of the `**ifconfig**` command.

4.  `airodump-ng` now shows us a list of all connected clients at the bottom of the Terminal. The second column lists the MAC addresses of the connected client, which we will be spoofing in order to authenticate with the wireless network. Of course, we are interested is something very specific. Take a look at the following graphic of the `airdump-ng` in action:

![](img/822534c0-4601-4cef-b42a-f506b254ef40.png)

airodump-ng in action.

5.  Pay attention to the bottom three lines of the interface. When we look closely, we see the first of these three shows a client that is not associated to any access point, but the following two entries show clients that are associated. To determine which access point a station is associated with, we need only look at the first column of entries and match the MAC address of an access point on the bottom three lines with the MAC of an access point up top. We can even determine that name by looking to see the name of the network that corresponds to the MAC. Not too bad.

Note that you may see more than one client attach to any one access point which is completely normal. Just make sure that when you choose the MAC address of a station connected to an access point that you have the correct access point and the MAC address of the station correct so you don't have to rerun the `airodump` multiple times.

6.  Once we have selected a network and have noted the MAC address of a station associated with it, we now want to spoof that address on the system we want to be able to attach to the target. To do this is fairly simple to accomplish.
7.  First, we shut down the `wlan0mon` interface in order to use the wireless card for the next steps. To do this, we run the following command:

```

Airmon-ng stop wlan0mon

```

8.  Now we need to shut down the wireless interface that we wish to change the MAC address on. To do this, we run the following command:

```

ifconfig wlan0 down

```

9.  Now we can use the utility `macchanger` to alter the MAC address to the one we noted earlier. To do this, execute the following command:

```

macchanger -m [New MAC Address] wlan0

```

10.  Once the command successfully completes, we can bring the interface back up using `ifconfig`:

```

ifconfig wlan0 up

```

1.  现在我们已经将适配器的 MAC 地址更改为新的 MAC 地址，我们可以尝试与网络进行身份验证，看看我们是否能够连接。如果我们能够选择网络并成功连接，那么我们就做对了。如果没有，请再次检查你伪造的 MAC 地址与你从`airodump`中收集的 MAC 地址是否一致。另外，如果网络正在运行诸如 WEP 或 WPA 之类的保护措施，你将无法连接。不过，别担心；如果你遇到困难，我们将在本书的后面解决这个问题。

# 识别混杂客户端

在一个安全（或被认为是安全的）网络上放置了一个恶意接入点，现在就有可能发生大量的损害和其他恶作剧。混杂客户端是一个问题，因为这些客户端会发送探测请求，寻找它们可能过去连接过的无线网络。它们参与这个过程的事实使得它们可能会意外地连接到一个网络，并且对安全构成问题。

探测数据包是一种特殊类型的请求，用于连接先前关联的网络接入点。这些数据包由智能手机、笔记本电脑和其他当前未连接到 Wi-Fi 网络的设备发送，用于定位和连接先前关联的网络。当这个探测数据包被发送出去并且客户端先前关联的网络被识别出来时，它们将尝试重新关联，就像它们以前做过的那样。

除了其他配置和技术信息外，大多数设备每 40 到 60 秒发送一次这个请求，这使得使用这些请求来跟踪人员的移动特别有用。我应该指出的是，这些数据包中没有嵌入位置信息。我们只知道如果我们从某个设备接收到了探测请求，它就在监视芯片的一定距离内。

探测请求中嵌入的另一个有趣的信息是 SSID。一个未连接到任何网络的设备将向公众以及特定的接入点发送探测请求：已记住的设备。

例如，当你在家里时，假设你连接到了名为 HOME 的家庭 Wi-Fi 网络。当你没有连接到 HOME 时，一个带有 SSID HOME 的探测请求被广播出去。因此，我们不仅可以知道某个设备距离我们的 Wi-Fi 芯片有一定的距离，我们现在还知道它们设备上记住的网络。这是一个常被批评的漏洞。不过，在我们的情况下，这对于唯一识别某人特别有用。

# 准备工作

为了开始，你需要准备好以下物品：

+   一个能够进入监视模式的无线网卡

+   安装了 Kismet 的 Kali Linux（默认 Kali 安装的一部分）

这里列出的项目是基本要求，如果需要，你可以轻松地使用更多（或不同）的组件。例如，如果你想要增强范围，你可以使用一个带有外部天线连接的基于 USB 的无线网卡，这样可以获得更好的接收效果。你也可以使用其他无线应用程序来完成这个任务；然而，由于 Kismet 非常受欢迎，我们将在这个教程中使用它。

# 如何做…

Kismet 是一个有效的工具，用于定位和提取无线接入点和设备的有用信息。

只是一个小小的警告：在命令行中发出启动 kismet 的命令之前，您应该确保如果您使用外部 Wi-Fi 适配器，您已经在发出命令之前安装和配置好了它。默认情况下，kismet 应该配置为使用物理系统上存在的无线适配器；但是，如果您选择使用外部适配器，您可能需要执行额外的配置，以便让 kismet 自己识别和配置您的适配器。

在这个教程中，我们将通过命令提示符启动 kismet。但是，它也可以从应用程序菜单的无线攻击部分启动。无论哪种情况，启动 kismet 都会导致这里记录的相同步骤：

1.  打开一个终端窗口。

1.  在命令提示符下，输入命令`kismet`。

1.  现在，您将从半图形环境中配置 Kismet。您将使用*Tab*和*Enter*键进行导航。

1.  使用*Tab*键突出显示“否”如果你看不到灰色字母行。否则，保持“是”突出显示。

1.  再按一次*Enter*键。

1.  按一次*Enter*键以确认 Kismet 正在以 root 身份运行。

1.  再按一次*Enter*键以自动启动 Kismet 服务器。

1.  按一次*Enter*键以验证你要启动 Kismet 服务器。

1.  按一次*Enter*键以验证您可以“添加”一个捕获源。

1.  输入您使用`ifconfig`发现的无线接口的名称。如果您不记得，可以打开另一个控制台窗口，再次运行`ifconfig`命令以确定正确的接口（通常以`wlan`开头命名）。以下屏幕截图显示了接口输入屏幕：

![](img/3a8311ad-be9e-4be7-b4ec-f2b1ca0ba0ed.png)

Kismet 接口配置

以下是 Kismet 接口配置的步骤：

1.  再按一次*Tab*键。

1.  在“名称”字段中输入无线接口的名称。

1.  按一次*Tab*键。

1.  再按一次*Tab*键。

1.  再按一次*Enter*键。

1.  Kismet 应该能够识别已命名的无线接口，如果你输入的名字是正确的话。它还会生成不需要的虚拟接口的名称，比如`wlan0mon`，`wlan0monmon`和`wmaster0`。

1.  当在 shell（Kismet 窗口）的右下角显示“关闭控制台窗口”时，按一次键盘上的*Tab*键以突出显示“关闭控制台窗口”。

1.  再按一次*Enter*键。

1.  无线接入点的列表将显示在 shell（Kismet 窗口）的左上方。

1.  单击下拉菜单中的“查看”。

1.  单击“监视活动”。

与之前一样，如果等待足够长的时间，我们将看到更多的信息填充 Kismet 窗口，包括与探测网络相关的条目。与之前不同的是，我们想看看是否可以以某种方式使用这些信息，我们可以：

![](img/79a1a32d-0c20-4f1f-b995-714b39198175.png)

kismet 窗口显示检测到的无线客户端。

如果您在探测网络标题下识别出一个吸引您注意的网络，那么您可以使用我们其他食谱中的信息来诱使受害者遭受攻击。我们这样做的方式是创建一个恶意访问点，就像我们在之前的食谱中所做的那样。这一次的不同之处在于，我们将使用我们希望攻击的探测网络的名称来启动恶意访问点。如果一切顺利，客户端最终会连接到我们创建的访问点，然后我们可以开始嗅探流量或执行其他操作。
