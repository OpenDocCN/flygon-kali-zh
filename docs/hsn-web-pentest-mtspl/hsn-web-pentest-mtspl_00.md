# 前言

在当今快速发展的技术世界中，安全行业的变化速度惊人，而涉及组织的网络攻击数量也在迅速增加。为了保护自己免受这些现实世界的攻击，许多公司引入了安全审计、风险和漏洞评估等流程管理，旨在帮助公司评估其业务资产的风险。为了保护这些资产，许多公司雇佣了安全专业人员，目的是识别公司应用程序和网络中的风险、漏洞和威胁。对于安全专业人员来说，建立自己的技能并熟悉最新的攻击方式至关重要。此外，为了提高效率，许多人在利用和枚举方面首选 Metasploit。

关于网络利用和后期利用，我们有许多资源可供利用，但在 Web 应用程序方面，很少有人选择 Metasploit。本书将帮助安全顾问和专业人士了解 Metasploit 在 Web 应用程序方面的另一面。它还将使读者能够在 Web 应用程序渗透测试项目中更有效地使用 Metasploit。

# 本书适合对象

本书旨在为渗透测试人员、道德黑客、安全顾问以及对 Web 应用程序渗透测试有一定了解并希望了解更多或深入研究 Metasploit 框架的人员设计。

# 本书涵盖内容

第一章《Web 应用程序渗透测试简介》涵盖了 Metasploit 的设置和安装，以及渗透测试生命周期、OWASP 前 10 名和 Sans 前 25 名等详细信息。

第二章《Metasploit 基础知识》解释了 Metasploit 的基础知识，从安装到利用。还涵盖了 Metasploit 的基本术语和其他不常用的选项。

第三章《Metasploit Web 界面》专注于 Metasploit Web GUI 界面的介绍，该界面可在 Metasploit 社区版中使用，然后再深入其他主题。

第四章《使用 Metasploit 进行侦察》涵盖了渗透测试生命周期中的第一个过程：侦察。从抓取横幅到 WEBDAV 侦察，将通过特定的 Metasploit 模块解释基本的侦察过程。

第五章《使用 Metasploit 进行 Web 应用程序枚举》专注于 Web 应用程序渗透测试中最重要的过程之一，即枚举。本章将从文件和目录枚举的基础知识开始，然后进入从网站爬取和抓取，以及涉及 Metasploit 模块的进一步枚举。

第六章《使用 WMAP 进行漏洞扫描》涵盖了 Metasploit 框架的 WMAP 模块，用于扫描 Web 应用程序。

第七章《使用 Metasploit 进行漏洞评估（Nessus）》涵盖了通过 Metasploit 利用 Nessus 漏洞扫描器进行目标漏洞评估扫描的过程。

第八章《CMS 漏洞测试-WordPress》涵盖了 WordPress 漏洞的枚举以及如何利用它们。

第九章《CMS 漏洞测试-Joomla》涵盖了 Joomla 漏洞的枚举以及如何利用它们。

第十章《CMS 漏洞测试-Drupal》涵盖了 Drupal 漏洞的枚举以及如何利用它们。

第十一章，*JBoss 上的渗透测试*，涵盖了枚举、利用和访问 JBoss 服务器的方法。

第十二章，*Apache Tomcat 上的渗透测试*，涵盖了枚举、利用和访问 Tomcat 服务器的方法。

第十三章，*Jenkins 上的渗透测试*，涵盖了枚举、利用和访问运行 Jenkins 服务器的方法。

第十四章，*逻辑漏洞挖掘-Web 应用模糊测试*，侧重于利用 Web 应用程序的业务逻辑中存在的缺陷。我们将深入介绍这些内容，以及模糊测试 Web 应用程序以识别漏洞的方法。

第十五章，*编写渗透测试报告*，介绍了报告撰写的基础知识以及如何使用不同的工具来自动化报告撰写过程。

# 充分利用本书

对 Metasploit Framework 和 Python 或 Ruby 等脚本语言的基本了解将有助于理解各章节。

| **书中涉及的软件/硬件** | **操作系统要求** |
| --- | --- |
| Metasploit Framework | Windows/macOS/*nix |

**如果您使用本书的数字版本，我们建议您自己输入代码。这样做将有助于避免与复制和粘贴代码相关的任何潜在错误。**

# 下载彩色图片

我们还提供了一个 PDF 文件，其中包含本书中使用的屏幕截图/图表的彩色图像。您可以在这里下载：[`www.packtpub.com/sites/default/files/downloads/9781789953527_ColorImages.pdf`](http://www.packtpub.com/sites/default/files/downloads/9781789953527_ColorImages.pdf)

# 使用的约定

本书中使用了许多文本约定。

`CodeInText`：表示文本中的代码词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 句柄。这是一个例子："将下载的`WebStorm-10*.dmg`磁盘映像文件挂载为系统中的另一个磁盘。"

代码块设置如下：

[PRE0]

当我们希望引起您对代码块的特定部分的注意时，相关行或项目将以粗体显示：

[PRE1]

任何命令行输入或输出都以以下形式书写：

[PRE2]

**粗体**：表示一个新术语、一个重要单词或屏幕上看到的单词。例如，菜单或对话框中的单词会以这种形式出现在文本中。这是一个例子："从管理面板中选择系统信息。"

警告或重要说明会以这种形式出现。

提示和技巧会出现在这样的形式中。

# 免责声明

本书中的信息仅供以合乎道德的方式使用。如果您没有设备所有者的书面许可，请不要使用本书中的任何信息。如果您进行非法行为，您可能会被逮捕并依法起诉。如果您滥用本书中包含的任何信息，Packt Publishing 不承担任何责任。本书中的信息只能在获得适当人员的书面授权后在测试环境中使用。

# 联系我们

我们随时欢迎读者的反馈。

**一般反馈**：如果您对本书的任何方面有疑问，请在邮件主题中提及书名，并发送电子邮件至`customercare@packtpub.com`。

**勘误**:尽管我们已经尽一切努力确保内容的准确性，但错误确实会发生。如果您在本书中发现错误，我们将不胜感激地请您向我们报告。请访问[www.packtpub.com/support/errata](https://www.packtpub.com/support/errata)，选择您的书，点击勘误提交表格链接，并输入详细信息。

**盗版**:如果您在互联网上发现我们作品的任何形式的非法副本，我们将不胜感激地请您向我们提供位置地址或网站名称。请通过`copyright@packt.com`与我们联系，并提供材料链接。

**如果您有兴趣成为作者**：如果您在某个专题上有专业知识，并且有兴趣撰写或为一本书做出贡献，请访问[authors.packtpub.com](http://authors.packtpub.com/)。

# 评论

请留下评论。一旦您阅读并使用了本书，为什么不在购买它的网站上留下评论呢？潜在的读者可以看到并使用您的客观意见来做出购买决定，我们在 Packt 可以了解您对我们产品的看法，我们的作者可以看到您对他们的书的反馈。谢谢！

有关 Packt 的更多信息，请访问[packt.com](http://www.packt.com/)。

# 目录

1.  [标题页]

1.  [版权和鸣谢]

1.  [使用 Metasploit 进行 Web 渗透测试]

1.  [关于 Packt]

1.  [为什么订阅？]

1.  [贡献者]

1.  [关于作者]

1.  [关于审阅者]

1.  [Packt 正在寻找像您这样的作者]

1.  [前言]

1.  [这本书是为谁写的]

1.  [本书涵盖的内容]

1.  [充分利用本书]

1.  [下载彩色图片]

1.  [使用的约定]

1.  [免责声明]

1.  [联系我们]

1.  [评论]

1.  [介绍]

1.  [Web 应用程序渗透测试简介]

1.  [什么是渗透测试？]

1.  [渗透测试类型]

1.  [白盒渗透测试]

1.  [黑盒渗透测试]

1.  [灰盒渗透测试]

1.  [渗透测试阶段]

1.  [侦察和信息收集]

1.  [枚举]

1.  [漏洞评估和分析]

1.  [利用]

1.  [报告]

1.  [重要术语]

1.  [渗透测试方法论]

1.  [开放源安全测试方法手册（OSSTMM）]

1.  [运营安全指标]

1.  [信任分析]

1.  [人类安全测试]

1.  [物理安全测试]

1.  无线安全测试

1.  电信安全测试

1.  数据网络安全测试

1.  合规性法规

1.  使用 STAR 进行报告

1.  OSSTMM 测试类型

1.  信息系统安全评估框架（ISSAF）

1.  渗透测试执行标准（PTES）

1.  预交互

1.  情报收集

1.  威胁建模

1.  漏洞分析

1.  利用

1.  后渗透

1.  报告

1.  常见弱点枚举（CWE）

1.  OWASP 前 10 名

1.  SANS 前 25 名

1.  总结

1.  问题

1.  进一步阅读

1.  Metasploit Essentials

1.  技术要求

1.  介绍 Metasploit Framework

1.  Metasploit Framework 术语

1.  安装和设置 Metasploit

1.  在*nix 上安装 Metasploit Framework

1.  在 Windows 上安装 Metasploit Framework

1.  开始使用 Metasploit Framework

1.  使用 msfconsole 与 Metasploit Framework 进行交互

1.  MSF 控制台命令

1.  自定义全局设置

1.  在 MSF 中进行变量操作

1.  探索 MSF 模块

1.  在 MSF 中运行 OS 命令

1.  在 Metasploit Framework 中设置数据库连接

1.  在 MSF 中加载插件

1.  使用 Metasploit 模块

1.  在 MSF 中搜索模块

1.  在 MSF 中检查主机和服务

1.  使用 MSF 进行 Nmap 扫描

1.  在 MSF 中设置有效负载处理

1.  MSF 有效负载生成

1.  使用 msfconsole 生成 MSF 有效负载（一行代码）

1.  使用 msfvenom 生成 MSF 有效负载

1.  总结

1.  问题

1.  进一步阅读

1.  Metasploit Web 界面

1.  技术要求

1.  介绍 Metasploit Web 界面

1.  安装和设置 Web 界面

1.  在 Windows 上安装 Metasploit Community Edition

1.  在 Linux/Debian 上安装 Metasploit 社区版

1.  使用 Metasploit Web 界面入门

1.  接口

1.  主菜单

1.  项目标签栏

1.  导航面包屑

1.  任务栏

1.  项目创建

1.  默认项目

1.  创建自定义项目

1.  目标枚举

1.  使用内置选项

1.  导入扫描结果

1.  模块选择

1.  辅助模块

1.  使用漏洞模块

1.  会话交互

1.  后渗透模块

1.  摘要

1.  问题

1.  进一步阅读

1.  使用 Metasploit 进行渗透测试生命周期

1.  使用 Metasploit 进行侦察

1.  技术要求

1.  侦察简介

1.  主动侦察

1.  横幅抓取

1.  HTTP 头检测

1.  Web 机器人页面枚举

1.  查找隐藏的 Git 仓库

1.  开放代理检测

1.  被动侦察

1.  存档域 URL

1.  Censys

1.  SSL 侦察

1.  摘要

1.  问题

1.  进一步阅读

1.  使用 Metasploit 进行 Web 应用枚举

1.  技术要求

1.  枚举简介

1.  DNS 枚举

1.  额外工作-编辑源代码

1.  列举文件

1.  使用 Metasploit 进行爬虫和抓取

1.  扫描虚拟主机

1.  摘要

1.  问题

1.  进一步阅读

1.  使用 WMAP 进行漏洞扫描

1.  技术要求

1.  了解 WMAP

1.  WMAP 扫描过程

1.  数据侦察

1.  加载扫描器

1.  WMAP 配置

1.  启动 WMAP

1.  WMAP 模块执行顺序

1.  将模块添加到 WMAP

1.  使用 WMAP 进行集群扫描

1.  摘要

1.  问题

1.  进一步阅读

1.  使用 Metasploit 进行漏洞评估（Nessus）

1.  技术要求

1.  Nessus 简介

1.  使用 Nessus 与 Metasploit

1.  通过 Metasploit 进行 Nessus 身份验证

1.  基本命令

1.  修补 Metasploit 库

1.  通过 Metasploit 执行 Nessus 扫描

1.  使用 Metasploit DB 进行 Nessus 扫描

1.  在 Metasploit DB 中导入 Nessus 扫描

1.  摘要

1.  问题

1.  进一步阅读

1.  渗透测试内容管理系统（CMS）

1.  CMS 渗透测试-WordPress

1.  技术要求

1.  WordPress 简介

1.  WordPress 架构

1.  文件/目录结构

1.  基本文件夹

1.  wp-includes

1.  wp-admin

1.  wp-content

1.  使用 Metasploit 进行 WordPress 侦察和枚举

1.  版本检测

1.  自述文件.html

1.  元生成器

1.  通过 JavaScript 和 CSS 文件获取版本

1.  通过 feed 获取版本

1.  使用大纲处理器标记语言（OPML）

1.  唯一/高级指纹识别

1.  使用 Metasploit 进行 WordPress 侦察

1.  使用 Metasploit 进行 WordPress 枚举

1.  WordPress 的漏洞评估

1.  WordPress 利用部分 1-WordPress 任意文件删除

1.  漏洞流和分析

1.  使用 Metasploit 利用漏洞

1.  WordPress 利用部分 2-未经身份验证的 SQL 注入

1.  漏洞流和分析

1.  使用 Metasploit 利用漏洞

1.  WordPress 利用部分 3-WordPress 5.0.0 远程代码执行

1.  漏洞流和分析

1.  使用 Metasploit 利用漏洞

1.  走额外的一英里-定制 Metasploit 利用

1.  摘要

1.  问题

1.  进一步阅读

1.  Pentesting CMSes-Joomla

1.  技术要求

1.  介绍 Joomla

1.  Joomla 架构

1.  文件和目录结构

1.  侦察和枚举

1.  版本检测

1.  通过元标记检测

1.  通过服务器标头检测

1.  通过语言配置检测

1.  通过 README.txt 检测

1.  通过清单文件检测

1.  通过唯一关键字检测

1.  使用 Metasploit 进行 Joomla 侦察

1.  使用 Metasploit 枚举 Joomla 插件和模块

1.  页面枚举

1.  插件枚举

1.  使用 Joomla 进行漏洞扫描

1.  使用 Metasploit 利用 Joomla

1.  利用漏洞的工作原理？

1.  Joomla shell 上传

1.  总结

1.  问题

1.  进一步阅读

1.  Pentesting CMSes-Drupal

1.  技术要求

1.  Drupal 及其架构简介

1.  Drupal 的架构

1.  目录结构

1.  Drupal 侦察和枚举

1.  通过 README.txt 检测

1.  通过元标记检测

1.  通过服务器标头检测

1.  通过 CHANGELOG.txt 检测

1.  通过 install.php 检测

1.  插件、主题和模块枚举

1.  使用 droopescan 进行 Drupal 漏洞扫描

1.  利用 Drupal

1.  使用 Drupalgeddon2 利用 Drupal

1.  了解 Drupalgeddon 漏洞

1.  使用 Metasploit 利用 Drupalgeddon2

1.  RESTful Web Services 漏洞利用- unserialize()

1.  了解序列化

1.  什么是 POP 链？

1.  反序列化有效负载

1.  使用 Metasploit 利用 RESTful Web Services RCE 通过 unserialize()进行利用

1.  总结

1.  问题

1.  进一步阅读

1.  在技术平台上执行渗透测试

1.  技术平台上的渗透测试-JBoss

1.  技术要求

1.  JBoss 简介

1.  JBoss 架构（JBoss 5）

1.  JBoss 文件和目录结构

1.  侦察和枚举

1.  通过主页检测

1.  通过错误页面检测

1.  通过标题 HTML 标签检测

1.  通过 X-Powered-By 检测

1.  通过哈希 favicon.ico 检测

1.  通过样式表（CSS）检测

1.  使用 Metasploit 进行 JBoss 状态扫描

1.  JBoss 服务枚举

1.  在 JBoss AS 上进行漏洞评估

1.  使用 JexBoss 进行漏洞扫描

1.  易受攻击的 JBoss 入口点

1.  JBoss 利用

1.  通过管理控制台利用 JBoss

1.  通过 JMX 控制台（MainDeployer 方法）利用

1.  使用 Metasploit 通过 JMX 控制台（MainDeployer）利用

1.  通过 JMX 控制台（BSHDeployer）利用

1.  使用 Metasploit 通过 JMX 控制台（BSHDeployer）利用

1.  通过 Web 控制台（Java 小程序）利用

1.  通过 Web 控制台（调用程序方法）利用

1.  创建 BSH 脚本

1.  使用 webconsole_invoker.rb 部署 BSH 脚本

1.  通过 JMXInvokerServlet（JexBoss）利用

1.  使用 Metasploit 通过 JMXInvokerServlet 利用

1.  摘要

1.  问题

1.  进一步阅读

1.  在技术平台上进行渗透测试 - Apache Tomcat

1.  技术要求

1.  Tomcat 简介

1.  Apache Tomcat 架构

1.  文件及其目录结构

1.  检测 Tomcat 安装

1.  通过 HTTP 响应头 - X-Powered-By 检测

1.  通过 HTTP 响应头 - WWW-Authenticate 检测

1.  通过 HTML 标签 - 标题标签检测

1.  通过 HTTP 401 未经授权错误检测

1.  通过唯一指纹（哈希）检测

1.  通过目录和文件检测

1.  版本检测

1.  通过 HTTP 404 错误页面披露版本

1.  通过 Release-Notes.txt 披露版本

1.  通过 Changelog.html 披露版本

1.  利用 Tomcat

1.  The Apache Tomcat JSP upload bypass vulnerability

1.  Tomcat WAR shell upload (authenticated)

1.  An introduction to Apache Struts

1.  Understanding OGNL

1.  OGNL expression injection

1.  Testing for remote code execution via OGNL injection

1.  Testing for blind remote code execution via OGNL injection

1.  Testing for OGNL out-of-band injection

1.  Struts 2 exploitation using Metasploit

1.  Summary

1.  Questions

1.  Further reading

1.  Penetration Testing on Technological Platforms - Jenkins

1.  Technical requirements

1.  Introduction to Jenkins

1.  Jenkins terminology

1.  The Stapler library

1.  URL routing

1.  Apache Groovy

1.  Meta-programming

1.  Abstract syntax tree

1.  Pipeline

1.  Jenkins reconnaissance and enumeration

1.  Detecting Jenkins using favicon hashes

1.  Detecting Jenkins using HTTP response headers

1.  Jenkins enumeration using Metasploit

1.  Exploiting Jenkins

1.  Jenkins ACL bypass

1.  Understanding Jenkins unauthenticated RCE

1.  Summary

1.  Questions

1.  Further reading

1.  Logical Bug Hunting

1.  Web Application Fuzzing - Logical Bug Hunting

1.  Technical requirements

1.  What is fuzzing?

1.  Fuzzing terminology

1.  Fuzzing attack types

1.  Application fuzzing

1.  Protocol fuzzing

1.  File-format fuzzing

1.  Introduction to web app fuzzing

1.  Fuzzer installation (Wfuzz)

1.  Fuzzer installation (ffuf)

1.  Identifying web application attack vectors

1.  HTTP request verbs

1.  Fuzzing HTTP methods/verbs using Wfuzz

1.  Fuzzing HTTP methods/verbs using ffuf

1.  Fuzzing HTTP methods/verbs using Burp Suite Intruder

1.  HTTP request URIs

1.  Fuzzing an HTTP request URl path using Wfuzz

1.  &#xA0;Fuzzing an HTTP request URl path using ffuf

1.  Fuzzing an HTTP request URl path using Burp Suite Intruder

1.  使用 Wfuzz 模糊处理 HTTP 请求 URL 文件名和文件扩展名

1.  使用 Wfuzz 模糊处理 HTTP 请求 URL 文件名和文件扩展名

1.  使用 Burp Suite Intruder 模糊处理 HTTP 请求 URL 文件名和文件扩展名

1.  使用 Wfuzz 模糊处理 HTTP 请求 URL

1.  使用 Burp Suite Intruder 模糊处理 HTTP 请求 URL

1.  HTTP 请求头

1.  使用 Wfuzz、ffuf 和 Burp Suite 模糊处理标准 HTTP 头部

1.  场景 1 - Cookie 头部模糊处理

1.  场景 2 - 用户定义的 Cookie 头部模糊处理

1.  使用 Wfuzz、ffuf 和 Burp Suite 模糊处理自定义标头

1.  场景 3 - 自定义头部模糊处理

1.  摘要

1.  问题

1.  进一步阅读

1.  编写渗透测试报告

1.  技术要求

1.  报告写作简介

1.  编写执行报告

1.  标题页

1.  文档版本控制

1.  目录

1.  目标

1.  定义范围

1.  主要发现（影响）

1.  问题概述

1.  战略建议

1.  编写详细的技术报告

1.  标题页

1.  文档版本控制

1.  目录

1.  报告摘要

1.  定义范围

1.  使用的方法

1.  CVSS

1.  漏洞摘要

1.  结论

1.  附录

1.  Dradis 框架简介

1.  预安装配置

1.  安装和设置

1.  开始使用 Dradis

1.  将第三方报告导入到 Dradis 中

1.  在 Dradis 中定义安全测试方法

1.  使用 Dradis 组织报告

1.  在 Dradis 中导出报告

1.  使用 Serpico

1.  安装和设置

1.  开始使用 Serpico

1.  从 Metasploit 导入数据到 Serpico 中

1.  将第三方报告导入到 Serpico 中

1.  Serpico 中的用户管理

1.  在 Serpico 中管理模板

1.  以多种格式生成报告

1.  摘要

1.  问题

1.  进一步阅读

1.  评估

1.  第一章

1.  第二章

1.  第三章

1.  第四章

1.  第五章

1.  第六章

1.  第七章

1.  第八章

1.  第九章

1.  第十章

1.  第十一章

1.  第十二章

1.  第十三章

1.  第十四章

1.  第十五章

1.  您可能喜欢的其他书籍

1.  留下评论-让其他读者知道您的想法
